
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Legacy instructions &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Memory Layout on AArch64 Linux" href="memory.html" />
    <link rel="prev" title="HugeTLBpage on ARM64" href="hugetlbpage.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="legacy-instructions">
<h1>Legacy instructions<a class="headerlink" href="#legacy-instructions" title="Permalink to this headline">¶</a></h1>
<p>The arm64 port of the Linux kernel provides infrastructure to support
emulation of instructions which have been deprecated, or obsoleted in
the architecture. The infrastructure code uses undefined instruction
hooks to support emulation. Where available it also allows turning on
the instruction execution in hardware.</p>
<p>The emulation mode can be controlled by writing to sysctl nodes
(/proc/sys/abi). The following explains the different execution
behaviours and the corresponding values of the sysctl nodes -</p>
<ul>
<li><dl class="simple">
<dt>Undef</dt><dd><p>Value: 0</p>
</dd>
</dl>
<p>Generates undefined instruction abort. Default for instructions that
have been obsoleted in the architecture, e.g., SWP</p>
</li>
<li><dl class="simple">
<dt>Emulate</dt><dd><p>Value: 1</p>
</dd>
</dl>
<p>Uses software emulation. To aid migration of software, in this mode
usage of emulated instruction is traced as well as rate limited
warnings are issued. This is the default for deprecated
instructions, .e.g., CP15 barriers</p>
</li>
<li><dl class="simple">
<dt>Hardware Execution</dt><dd><p>Value: 2</p>
</dd>
</dl>
<p>Although marked as deprecated, some implementations may support the
enabling/disabling of hardware support for the execution of these
instructions. Using hardware execution generally provides better
performance, but at the loss of ability to gather runtime statistics
about the use of the deprecated instructions.</p>
</li>
</ul>
<p>The default mode depends on the status of the instruction in the
architecture. Deprecated instructions should default to emulation
while obsolete instructions must be undefined by default.</p>
<p>Note: Instruction emulation may not be possible in all cases. See
individual instruction notes for further information.</p>
<section id="supported-legacy-instructions">
<h2>Supported legacy instructions<a class="headerlink" href="#supported-legacy-instructions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>SWP{B}</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Node</dt>
<dd class="field-odd"><p>/proc/sys/abi/swp</p>
</dd>
<dt class="field-even">Status</dt>
<dd class="field-even"><p>Obsolete</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p>Undef (0)</p>
</dd>
</dl>
<ul class="simple">
<li><p>CP15 Barriers</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Node</dt>
<dd class="field-odd"><p>/proc/sys/abi/cp15_barrier</p>
</dd>
<dt class="field-even">Status</dt>
<dd class="field-even"><p>Deprecated</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p>Emulate (1)</p>
</dd>
</dl>
<ul class="simple">
<li><p>SETEND</p></li>
</ul>
<dl class="field-list">
<dt class="field-odd">Node</dt>
<dd class="field-odd"><p>/proc/sys/abi/setend</p>
</dd>
<dt class="field-even">Status</dt>
<dd class="field-even"><p>Deprecated</p>
</dd>
<dt class="field-odd">Default</dt>
<dd class="field-odd"><p>Emulate (1)*</p>
<p>Note: All the cpus on the system must have mixed endian support at EL0
for this feature to be enabled. If a new CPU - which doesn’t support mixed
endian - is hotplugged in after this feature has been enabled, there could
be unexpected results in the application.</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Legacy instructions</a><ul>
<li><a class="reference internal" href="#supported-legacy-instructions">Supported legacy instructions</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/arm64/legacy_instructions.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/arm64/legacy_instructions.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>