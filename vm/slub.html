<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Short users guide for SLUB &mdash; The Linux Kernel 5.19.0-selftest+ documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Split page table lock" href="split_page_table_lock.html" />
    <link rel="prev" title="remap_file_pages() system call" href="remap_file_pages.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          </a>
              <div class="version">
                5.19.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux Memory Management Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#memory-management-guide">Memory Management Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#legacy-documentation">Legacy Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="active_mm.html">Active MM</a></li>
<li class="toctree-l3"><a class="reference internal" href="arch_pgtable_helpers.html">Architecture Page Table Helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="balance.html">Memory Balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="damon/index.html">DAMON: Data Access MONitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="free_page_reporting.html">Free Page Reporting</a></li>
<li class="toctree-l3"><a class="reference internal" href="frontswap.html">Frontswap</a></li>
<li class="toctree-l3"><a class="reference internal" href="hmm.html">Heterogeneous Memory Management (HMM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="hwpoison.html">hwpoison</a></li>
<li class="toctree-l3"><a class="reference internal" href="hugetlbfs_reserv.html">Hugetlbfs Reservation</a></li>
<li class="toctree-l3"><a class="reference internal" href="ksm.html">Kernel Samepage Merging</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory-model.html">Physical Memory Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="mmu_notifier.html">When do you need to notify inside page table lock ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="numa.html">What is NUMA?</a></li>
<li class="toctree-l3"><a class="reference internal" href="overcommit-accounting.html">Overcommit Accounting</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_migration.html">Page migration</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_frags.html">Page fragments</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_owner.html">page owner: Tracking about who allocated each page</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_table_check.html">Page Table Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="remap_file_pages.html">remap_file_pages() system call</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Short users guide for SLUB</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#some-more-sophisticated-uses-of-slub-debug">Some more sophisticated uses of slub_debug:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="split_page_table_lock.html">Split page table lock</a></li>
<li class="toctree-l3"><a class="reference internal" href="transhuge.html">Transparent Hugepage Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="unevictable-lru.html">Unevictable LRU Infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="vmalloced-kernel-stacks.html">Virtually Mapped Kernel Stack Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="vmemmap_dedup.html">A vmemmap diet for HugeTLB and Device DAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="z3fold.html">z3fold</a></li>
<li class="toctree-l3"><a class="reference internal" href="zsmalloc.html">zsmalloc</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Linux Memory Management Documentation</a> &raquo;</li>
      <li>Short users guide for SLUB</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/vm/slub.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="short-users-guide-for-slub">
<span id="slub"></span><h1>Short users guide for SLUB<a class="headerlink" href="#short-users-guide-for-slub" title="Permalink to this headline">¶</a></h1>
<p>The basic philosophy of SLUB is very different from SLAB. SLAB
requires rebuilding the kernel to activate debug options for all
slab caches. SLUB always includes full debugging but it is off by default.
SLUB can enable debugging only for selected slabs in order to avoid
an impact on overall system performance which may make a bug more
difficult to find.</p>
<p>In order to switch debugging on one can add an option <code class="docutils literal notranslate"><span class="pre">slub_debug</span></code>
to the kernel command line. That will enable full debugging for
all slabs.</p>
<p>Typically one would then use the <code class="docutils literal notranslate"><span class="pre">slabinfo</span></code> command to get statistical
data and perform operation on the slabs. By default <code class="docutils literal notranslate"><span class="pre">slabinfo</span></code> only lists
slabs that have data in them. See “slabinfo -h” for more options when
running the command. <code class="docutils literal notranslate"><span class="pre">slabinfo</span></code> can be compiled with</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gcc -o slabinfo tools/vm/slabinfo.c
</pre></div>
</div>
<p>Some of the modes of operation of <code class="docutils literal notranslate"><span class="pre">slabinfo</span></code> require that slub debugging
be enabled on the command line. F.e. no tracking information will be
available without debugging on and validation can only partially
be performed if debugging was not switched on.</p>
<section id="some-more-sophisticated-uses-of-slub-debug">
<h2>Some more sophisticated uses of slub_debug:<a class="headerlink" href="#some-more-sophisticated-uses-of-slub-debug" title="Permalink to this headline">¶</a></h2>
<p>Parameters may be given to <code class="docutils literal notranslate"><span class="pre">slub_debug</span></code>. If none is specified then full
debugging is enabled. Format:</p>
<dl class="simple">
<dt>slub_debug=&lt;Debug-Options&gt;</dt><dd><p>Enable options for all slabs</p>
</dd>
<dt>slub_debug=&lt;Debug-Options&gt;,&lt;slab name1&gt;,&lt;slab name2&gt;,…</dt><dd><p>Enable options only for select slabs (no spaces
after a comma)</p>
</dd>
</dl>
<p>Multiple blocks of options for all slabs or selected slabs can be given, with
blocks of options delimited by ‘;’. The last of “all slabs” blocks is applied
to all slabs except those that match one of the “select slabs” block. Options
of the first “select slabs” blocks that matches the slab’s name are applied.</p>
<p>Possible debug options are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>F               Sanity checks on (enables SLAB_DEBUG_CONSISTENCY_CHECKS
                Sorry SLAB legacy issues)
Z               Red zoning
P               Poisoning (object and padding)
U               User tracking (free and alloc)
T               Trace (please only use on single slabs)
A               Enable failslab filter mark for the cache
O               Switch debugging off for caches that would have
                caused higher minimum slab orders
-               Switch all debugging off (useful if the kernel is
                configured with CONFIG_SLUB_DEBUG_ON)
</pre></div>
</div>
<p>F.e. in order to boot just with sanity checks and red zoning one would specify:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=FZ
</pre></div>
</div>
<p>Trying to find an issue in the dentry cache? Try:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=,dentry
</pre></div>
</div>
<p>to only enable debugging on the dentry cache.  You may use an asterisk at the
end of the slab name, in order to cover all slabs with the same prefix.  For
example, here’s how you can poison the dentry cache as well as all kmalloc
slabs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=P,kmalloc-*,dentry
</pre></div>
</div>
<p>Red zoning and tracking may realign the slab.  We can just apply sanity checks
to the dentry cache with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=F,dentry
</pre></div>
</div>
<p>Debugging options may require the minimum possible slab order to increase as
a result of storing the metadata (for example, caches with PAGE_SIZE object
sizes).  This has a higher liklihood of resulting in slab allocation errors
in low memory situations or if there’s high fragmentation of memory.  To
switch off debugging for such caches by default, use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=O
</pre></div>
</div>
<p>You can apply different options to different list of slab names, using blocks
of options. This will enable red zoning for dentry and user tracking for
kmalloc. All other slabs will not get any debugging enabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=Z,dentry;U,kmalloc-*
</pre></div>
</div>
<p>You can also enable options (e.g. sanity checks and poisoning) for all caches
except some that are deemed too performance critical and don’t need to be
debugged by specifying global debug options followed by a list of slab names
with “-” as options:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=FZ;-,zs_handle,zspage
</pre></div>
</div>
<p>The state of each debug option for a slab can be found in the respective files
under:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/kernel/slab/&lt;slab name&gt;/
</pre></div>
</div>
<p>If the file contains 1, the option is enabled, 0 means disabled. The debug
options from the <code class="docutils literal notranslate"><span class="pre">slub_debug</span></code> parameter translate to the following files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>F       sanity_checks
Z       red_zone
P       poison
U       store_user
T       trace
A       failslab
</pre></div>
</div>
<p>Careful with tracing: It may spew out lots of information and never stop if
used on the wrong slab.</p>
<section id="slab-merging">
<h3>Slab merging<a class="headerlink" href="#slab-merging" title="Permalink to this headline">¶</a></h3>
<p>If no debug options are specified then SLUB may merge similar slabs together
in order to reduce overhead and increase cache hotness of objects.
<code class="docutils literal notranslate"><span class="pre">slabinfo</span> <span class="pre">-a</span></code> displays which slabs were merged together.</p>
</section>
<section id="slab-validation">
<h3>Slab validation<a class="headerlink" href="#slab-validation" title="Permalink to this headline">¶</a></h3>
<p>SLUB can validate all object if the kernel was booted with slub_debug. In
order to do so you must have the <code class="docutils literal notranslate"><span class="pre">slabinfo</span></code> tool. Then you can do</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slabinfo -v
</pre></div>
</div>
<p>which will test all objects. Output will be generated to the syslog.</p>
<p>This also works in a more limited way if boot was without slab debug.
In that case <code class="docutils literal notranslate"><span class="pre">slabinfo</span> <span class="pre">-v</span></code> simply tests all reachable objects. Usually
these are in the cpu slabs and the partial slabs. Full slabs are not
tracked by SLUB in a non debug situation.</p>
</section>
<section id="getting-more-performance">
<h3>Getting more performance<a class="headerlink" href="#getting-more-performance" title="Permalink to this headline">¶</a></h3>
<p>To some degree SLUB’s performance is limited by the need to take the
list_lock once in a while to deal with partial slabs. That overhead is
governed by the order of the allocation for each slab. The allocations
can be influenced by kernel parameters:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">slub_min_objects</span></code></dt><dd><p>allows to specify how many objects must at least fit into one
slab in order for the allocation order to be acceptable.  In
general slub will be able to perform this number of
allocations on a slab without consulting centralized resources
(list_lock) where contention may occur.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">slub_min_order</span></code></dt><dd><p>specifies a minimum order of slabs. A similar effect like
<code class="docutils literal notranslate"><span class="pre">slub_min_objects</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">slub_max_order</span></code></dt><dd><p>specified the order at which <code class="docutils literal notranslate"><span class="pre">slub_min_objects</span></code> should no
longer be checked. This is useful to avoid SLUB trying to
generate super large order pages to fit <code class="docutils literal notranslate"><span class="pre">slub_min_objects</span></code>
of a slab cache with large object sizes into one high order
page. Setting command line parameter
<code class="docutils literal notranslate"><span class="pre">debug_guardpage_minorder=N</span></code> (N &gt; 0), forces setting
<code class="docutils literal notranslate"><span class="pre">slub_max_order</span></code> to 0, what cause minimum possible order of
slabs allocation.</p>
</dd>
</dl>
</section>
<section id="slub-debug-output">
<h3>SLUB Debug output<a class="headerlink" href="#slub-debug-output" title="Permalink to this headline">¶</a></h3>
<p>Here is a sample of slub debug output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>====================================================================
BUG kmalloc-8: Right Redzone overwritten
--------------------------------------------------------------------

INFO: 0xc90f6d28-0xc90f6d2b. First byte 0x00 instead of 0xcc
INFO: Slab 0xc528c530 flags=0x400000c3 inuse=61 fp=0xc90f6d58
INFO: Object 0xc90f6d20 @offset=3360 fp=0xc90f6d58
INFO: Allocated in get_modalias+0x61/0xf5 age=53 cpu=1 pid=554

Bytes b4 (0xc90f6d10): 00 00 00 00 00 00 00 00 5a 5a 5a 5a 5a 5a 5a 5a ........ZZZZZZZZ
Object   (0xc90f6d20): 31 30 31 39 2e 30 30 35                         1019.005
Redzone  (0xc90f6d28): 00 cc cc cc                                     .
Padding  (0xc90f6d50): 5a 5a 5a 5a 5a 5a 5a 5a                         ZZZZZZZZ

  [&lt;c010523d&gt;] dump_trace+0x63/0x1eb
  [&lt;c01053df&gt;] show_trace_log_lvl+0x1a/0x2f
  [&lt;c010601d&gt;] show_trace+0x12/0x14
  [&lt;c0106035&gt;] dump_stack+0x16/0x18
  [&lt;c017e0fa&gt;] object_err+0x143/0x14b
  [&lt;c017e2cc&gt;] check_object+0x66/0x234
  [&lt;c017eb43&gt;] __slab_free+0x239/0x384
  [&lt;c017f446&gt;] kfree+0xa6/0xc6
  [&lt;c02e2335&gt;] get_modalias+0xb9/0xf5
  [&lt;c02e23b7&gt;] dmi_dev_uevent+0x27/0x3c
  [&lt;c027866a&gt;] dev_uevent+0x1ad/0x1da
  [&lt;c0205024&gt;] kobject_uevent_env+0x20a/0x45b
  [&lt;c020527f&gt;] kobject_uevent+0xa/0xf
  [&lt;c02779f1&gt;] store_uevent+0x4f/0x58
  [&lt;c027758e&gt;] dev_attr_store+0x29/0x2f
  [&lt;c01bec4f&gt;] sysfs_write_file+0x16e/0x19c
  [&lt;c0183ba7&gt;] vfs_write+0xd1/0x15a
  [&lt;c01841d7&gt;] sys_write+0x3d/0x72
  [&lt;c0104112&gt;] sysenter_past_esp+0x5f/0x99
  [&lt;b7f7b410&gt;] 0xb7f7b410
  =======================

FIX kmalloc-8: Restoring Redzone 0xc90f6d28-0xc90f6d2b=0xcc
</pre></div>
</div>
<p>If SLUB encounters a corrupted object (full detection requires the kernel
to be booted with slub_debug) then the following output will be dumped
into the syslog:</p>
<ol class="arabic">
<li><p>Description of the problem encountered</p>
<p>This will be a message in the system log starting with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>===============================================
BUG &lt;slab cache affected&gt;: &lt;What went wrong&gt;
-----------------------------------------------

INFO: &lt;corruption start&gt;-&lt;corruption_end&gt; &lt;more info&gt;
INFO: Slab &lt;address&gt; &lt;slab information&gt;
INFO: Object &lt;address&gt; &lt;object information&gt;
INFO: Allocated in &lt;kernel function&gt; age=&lt;jiffies since alloc&gt; cpu=&lt;allocated by
   cpu&gt; pid=&lt;pid of the process&gt;
INFO: Freed in &lt;kernel function&gt; age=&lt;jiffies since free&gt; cpu=&lt;freed by cpu&gt;
   pid=&lt;pid of the process&gt;
</pre></div>
</div>
<p>(Object allocation / free information is only available if SLAB_STORE_USER is
set for the slab. slub_debug sets that option)</p>
</li>
<li><p>The object contents if an object was involved.</p>
<p>Various types of lines can follow the BUG SLUB line:</p>
<dl>
<dt>Bytes b4 &lt;address&gt;<span class="classifier">&lt;bytes&gt;</span></dt><dd><p>Shows a few bytes before the object where the problem was detected.
Can be useful if the corruption does not stop with the start of the
object.</p>
</dd>
<dt>Object &lt;address&gt;<span class="classifier">&lt;bytes&gt;</span></dt><dd><p>The bytes of the object. If the object is inactive then the bytes
typically contain poison values. Any non-poison value shows a
corruption by a write after free.</p>
</dd>
<dt>Redzone &lt;address&gt;<span class="classifier">&lt;bytes&gt;</span></dt><dd><p>The Redzone following the object. The Redzone is used to detect
writes after the object. All bytes should always have the same
value. If there is any deviation then it is due to a write after
the object boundary.</p>
<p>(Redzone information is only available if SLAB_RED_ZONE is set.
slub_debug sets that option)</p>
</dd>
<dt>Padding &lt;address&gt;<span class="classifier">&lt;bytes&gt;</span></dt><dd><p>Unused data to fill up the space in order to get the next object
properly aligned. In the debug case we make sure that there are
at least 4 bytes of padding. This allows the detection of writes
before the object.</p>
</dd>
</dl>
</li>
<li><p>A stackdump</p>
<p>The stackdump describes the location where the error was detected. The cause
of the corruption is may be more likely found by looking at the function that
allocated or freed the object.</p>
</li>
<li><p>Report on how the problem was dealt with in order to ensure the continued
operation of the system.</p>
<p>These are messages in the system log beginning with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>FIX &lt;slab cache affected&gt;: &lt;corrective action taken&gt;
</pre></div>
</div>
<p>In the above sample SLUB found that the Redzone of an active object has
been overwritten. Here a string of 8 characters was written into a slab that
has the length of 8 characters. However, a 8 character string needs a
terminating 0. That zero has overwritten the first byte of the Redzone field.
After reporting the details of the issue encountered the FIX SLUB message
tells us that SLUB has restored the Redzone to its proper value and then
system operations continue.</p>
</li>
</ol>
</section>
<section id="emergency-operations">
<h3>Emergency operations<a class="headerlink" href="#emergency-operations" title="Permalink to this headline">¶</a></h3>
<p>Minimal debugging (sanity checks alone) can be enabled by booting with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=F
</pre></div>
</div>
<p>This will be generally be enough to enable the resiliency features of slub
which will keep the system running even if a bad kernel component will
keep corrupting objects. This may be important for production systems.
Performance will be impacted by the sanity checks and there will be a
continual stream of error messages to the syslog but no additional memory
will be used (unlike full debugging).</p>
<p>No guarantees. The kernel component still needs to be fixed. Performance
may be optimized further by locating the slab that experiences corruption
and enabling debugging only for that cache</p>
<p>I.e.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=F,dentry
</pre></div>
</div>
<p>If the corruption occurs by writing after the end of the object then it
may be advisable to enable a Redzone to avoid corrupting the beginning
of other objects:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slub_debug=FZ,dentry
</pre></div>
</div>
</section>
<section id="extended-slabinfo-mode-and-plotting">
<h3>Extended slabinfo mode and plotting<a class="headerlink" href="#extended-slabinfo-mode-and-plotting" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>The <code class="docutils literal notranslate"><span class="pre">slabinfo</span></code> tool has a special ‘extended’ (‘-X’) mode that includes:</dt><dd><ul class="simple">
<li><p>Slabcache Totals</p></li>
<li><p>Slabs sorted by size (up to -N &lt;num&gt; slabs, default 1)</p></li>
<li><p>Slabs sorted by loss (up to -N &lt;num&gt; slabs, default 1)</p></li>
</ul>
</dd>
</dl>
<p>Additionally, in this mode <code class="docutils literal notranslate"><span class="pre">slabinfo</span></code> does not dynamically scale
sizes (G/M/K) and reports everything in bytes (this functionality is
also available to other slabinfo modes via ‘-B’ option) which makes
reporting more precise and accurate. Moreover, in some sense the <cite>-X’
mode also simplifies the analysis of slabs’ behaviour, because its
output can be plotted using the ``slabinfo-gnuplot.sh`</cite> script. So it
pushes the analysis from looking through the numbers (tons of numbers)
to something easier – visual analysis.</p>
<p>To generate plots:</p>
<ol class="loweralpha">
<li><p>collect slabinfo extended records, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>while [ 1 ]; do slabinfo -X &gt;&gt; FOO_STATS; sleep 1; done
</pre></div>
</div>
</li>
<li><p>pass stats file(-s) to <code class="docutils literal notranslate"><span class="pre">slabinfo-gnuplot.sh</span></code> script:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slabinfo-gnuplot.sh FOO_STATS [FOO_STATS2 .. FOO_STATSN]
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">slabinfo-gnuplot.sh</span></code> script will pre-processes the collected records
and generates 3 png files (and 3 pre-processing cache files) per STATS
file:
- Slabcache Totals: FOO_STATS-totals.png
- Slabs sorted by size: FOO_STATS-slabs-by-size.png
- Slabs sorted by loss: FOO_STATS-slabs-by-loss.png</p>
</li>
</ol>
<p>Another use case, when <code class="docutils literal notranslate"><span class="pre">slabinfo-gnuplot.sh</span></code> can be useful, is when you
need to compare slabs’ behaviour “prior to” and “after” some code
modification.  To help you out there, <code class="docutils literal notranslate"><span class="pre">slabinfo-gnuplot.sh</span></code> script
can ‘merge’ the <cite>Slabcache Totals</cite> sections from different
measurements. To visually compare N plots:</p>
<ol class="loweralpha">
<li><p>Collect as many STATS1, STATS2, .. STATSN files as you need:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>while [ 1 ]; do slabinfo -X &gt;&gt; STATS&lt;X&gt;; sleep 1; done
</pre></div>
</div>
</li>
<li><p>Pre-process those STATS files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slabinfo-gnuplot.sh STATS1 STATS2 .. STATSN
</pre></div>
</div>
</li>
<li><p>Execute <code class="docutils literal notranslate"><span class="pre">slabinfo-gnuplot.sh</span></code> in ‘-t’ mode, passing all of the
generated pre-processed *-totals:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>slabinfo-gnuplot.sh -t STATS1-totals STATS2-totals .. STATSN-totals
</pre></div>
</div>
<p>This will produce a single plot (png file).</p>
<p>Plots, expectedly, can be large so some fluctuations or small spikes
can go unnoticed. To deal with that, <code class="docutils literal notranslate"><span class="pre">slabinfo-gnuplot.sh</span></code> has two
options to ‘zoom-in’/’zoom-out’:</p>
<ol class="loweralpha simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">%d,%d</span></code> – overwrites the default image width and height</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">%d,%d</span></code> – specifies a range of samples to use (for example,
in <code class="docutils literal notranslate"><span class="pre">slabinfo</span> <span class="pre">-X</span> <span class="pre">&gt;&gt;</span> <span class="pre">FOO_STATS;</span> <span class="pre">sleep</span> <span class="pre">1;</span></code> case, using a <code class="docutils literal notranslate"><span class="pre">-r</span>
<span class="pre">40,60</span></code> range will plot only samples collected between 40th and
60th seconds).</p></li>
</ol>
</li>
</ol>
</section>
<section id="debugfs-files-for-slub">
<h3>DebugFS files for SLUB<a class="headerlink" href="#debugfs-files-for-slub" title="Permalink to this headline">¶</a></h3>
<p>For more information about current state of SLUB caches with the user tracking
debug option enabled, debugfs files are available, typically under
/sys/kernel/debug/slab/&lt;cache&gt;/ (created only for caches with enabled user
tracking). There are 2 types of these files with the following debug
information:</p>
<ol class="arabic">
<li><p>alloc_traces:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Prints information about unique allocation traces of the currently
allocated objects. The output is sorted by frequency of each trace.

Information in the output:
Number of objects, allocating function, minimal/average/maximal jiffies since alloc,
pid range of the allocating processes, cpu mask of allocating cpus, and stack trace.

Example:::

1085 populate_error_injection_list+0x97/0x110 age=166678/166680/166682 pid=1 cpus=1::
    __slab_alloc+0x6d/0x90
    kmem_cache_alloc_trace+0x2eb/0x300
    populate_error_injection_list+0x97/0x110
    init_error_injection+0x1b/0x71
    do_one_initcall+0x5f/0x2d0
    kernel_init_freeable+0x26f/0x2d7
    kernel_init+0xe/0x118
    ret_from_fork+0x22/0x30
</pre></div>
</div>
</li>
<li><p>free_traces:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Prints information about unique freeing traces of the currently allocated
objects. The freeing traces thus come from the previous life-cycle of the
objects and are reported as not available for objects allocated for the first
time. The output is sorted by frequency of each trace.

Information in the output:
Number of objects, freeing function, minimal/average/maximal jiffies since free,
pid range of the freeing processes, cpu mask of freeing cpus, and stack trace.

Example:::

1980 &lt;not-available&gt; age=4294912290 pid=0 cpus=0
51 acpi_ut_update_ref_count+0x6a6/0x782 age=236886/237027/237772 pid=1 cpus=1
    kfree+0x2db/0x420
    acpi_ut_update_ref_count+0x6a6/0x782
    acpi_ut_update_object_reference+0x1ad/0x234
    acpi_ut_remove_reference+0x7d/0x84
    acpi_rs_get_prt_method_data+0x97/0xd6
    acpi_get_irq_routing_table+0x82/0xc4
    acpi_pci_irq_find_prt_entry+0x8e/0x2e0
    acpi_pci_irq_lookup+0x3a/0x1e0
    acpi_pci_irq_enable+0x77/0x240
    pcibios_enable_device+0x39/0x40
    do_pci_enable_device.part.0+0x5d/0xe0
    pci_enable_device_flags+0xfc/0x120
    pci_enable_device+0x13/0x20
    virtio_pci_probe+0x9e/0x170
    local_pci_probe+0x48/0x80
    pci_device_probe+0x105/0x1c0
</pre></div>
</div>
</li>
</ol>
<p>Christoph Lameter, May 30, 2007
Sergey Senozhatsky, October 23, 2015</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="remap_file_pages.html" class="btn btn-neutral float-left" title="remap_file_pages() system call" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="split_page_table_lock.html" class="btn btn-neutral float-right" title="Split page table lock" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright The kernel development community.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>