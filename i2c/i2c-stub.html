
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>i2c-stub &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Linux I2C slave interface description" href="slave-interface.html" />
    <link rel="prev" title="Linux I2C fault injection" href="gpio-fault-injection.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="i2c-stub">
<h1>i2c-stub<a class="headerlink" href="#i2c-stub" title="Permalink to this headline">¶</a></h1>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This module is a very simple fake I2C/SMBus driver.  It implements six
types of SMBus commands: write quick, (r/w) byte, (r/w) byte data, (r/w)
word data, (r/w) I2C block data, and (r/w) SMBus block data.</p>
<p>You need to provide chip addresses as a module parameter when loading this
driver, which will then only react to SMBus commands to these addresses.</p>
<p>No hardware is needed nor associated with this module.  It will accept write
quick commands to the specified addresses; it will respond to the other
commands (also to the specified addresses) by reading from or writing to
arrays in memory.  It will also spam the kernel logs for every command it
handles.</p>
<p>A pointer register with auto-increment is implemented for all byte
operations.  This allows for continuous byte reads like those supported by
EEPROMs, among others.</p>
<p>SMBus block command support is disabled by default, and must be enabled
explicitly by setting the respective bits (0x03000000) in the functionality
module parameter.</p>
<p>SMBus block commands must be written to configure an SMBus command for
SMBus block operations. Writes can be partial. Block read commands always
return the number of bytes selected with the largest write so far.</p>
<p>The typical use-case is like this:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>load this module</p></li>
<li><p>use i2cset (from the i2c-tools project) to pre-load some data</p></li>
<li><p>load the target chip driver module</p></li>
<li><p>observe its behavior in the kernel log</p></li>
</ol>
</div></blockquote>
<p>There’s a script named i2c-stub-from-dump in the i2c-tools package which
can load register values automatically from a chip dump.</p>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>int chip_addr[10]:</dt><dd><p>The SMBus addresses to emulate chips at.</p>
</dd>
<dt>unsigned long functionality:</dt><dd><p>Functionality override, to disable some commands. See I2C_FUNC_*
constants in &lt;linux/i2c.h&gt; for the suitable values. For example,
value 0x1f0000 would only enable the quick, byte and byte data
commands.</p>
</dd>
<dt>u8 bank_reg[10], u8 bank_mask[10], u8 bank_start[10], u8 bank_end[10]:</dt><dd><p>Optional bank settings. They tell which bits in which register
select the active bank, as well as the range of banked registers.</p>
</dd>
</dl>
</section>
<section id="caveats">
<h2>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h2>
<p>If your target driver polls some byte or word waiting for it to change, the
stub could lock it up.  Use i2cset to unlock it.</p>
<p>If you spam it hard enough, printk can be lossy.  This module really wants
something like relayfs.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">i2c-stub</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#caveats">Caveats</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/i2c/i2c-stub.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/i2c/i2c-stub.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>