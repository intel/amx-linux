
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Tmpfs &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="ARM64 架構" href="../arm64/index.html" />
    <link rel="prev" title="Debugfs" href="debugfs.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>此文件的目的是爲讓中文讀者更容易閱讀和理解，而不是作爲一個分支。因此，
如果您對此文件有任何意見或改動，請先嘗試更新原始英文文件。如果要更改或
修正某處翻譯文件，請將意見或補丁發送給維護者（聯繫方式見下）。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>如果您發現本文檔與原始文件有任何不同或者有翻譯問題，請聯繫該文件的譯者，
或者發送電子郵件給胡皓文以獲取幫助：&lt;<a class="reference external" href="mailto:src&#46;res&#37;&#52;&#48;email&#46;cn">src<span>&#46;</span>res<span>&#64;</span>email<span>&#46;</span>cn</a>&gt;。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Original</dt>
<dd class="field-odd"><p><a class="reference internal" href="../../../filesystems/tmpfs.html"><span class="doc">Tmpfs</span></a></p>
</dd>
</dl>
<p>Translated by Wang Qing &lt;<a class="reference external" href="mailto:wangqing&#37;&#52;&#48;vivo&#46;com">wangqing<span>&#64;</span>vivo<span>&#46;</span>com</a>&gt;
and Hu Haowen &lt;<a class="reference external" href="mailto:src&#46;res&#37;&#52;&#48;email&#46;cn">src<span>&#46;</span>res<span>&#64;</span>email<span>&#46;</span>cn</a>&gt;</p>
<section id="tmpfs">
<h1>Tmpfs<a class="headerlink" href="#tmpfs" title="Permalink to this headline">¶</a></h1>
<p>Tmpfs是一個將所有文件都保存在虛擬內存中的文件系統。</p>
<p>tmpfs中的所有內容都是臨時的，也就是說沒有任何文件會在硬碟上創建。
如果卸載tmpfs實例，所有保存在其中的文件都會丟失。</p>
<p>tmpfs將所有文件保存在內核緩存中，隨著文件內容增長或縮小可以將不需要的
頁面swap出去。它具有最大限制，可以通過「mount -o remount …」調整。</p>
<p>和ramfs（創建tmpfs的模板）相比，tmpfs包含交換和限制檢查。和tmpfs相似的另
一個東西是RAM磁碟（/dev/ram*），可以在物理RAM中模擬固定大小的硬碟，並在
此之上創建一個普通的文件系統。Ramdisks無法swap，因此無法調整它們的大小。</p>
<p>由於tmpfs完全保存於頁面緩存和swap中，因此所有tmpfs頁面將在/proc/meminfo
中顯示爲「Shmem」，而在free(1)中顯示爲「Shared」。請注意，這些計數還包括
共享內存(shmem，請參閱ipcs(1))。獲得計數的最可靠方法是使用df(1)和du(1)。</p>
<p>tmpfs具有以下用途：</p>
<ol class="arabic">
<li><p>內核總有一個無法看到的內部掛載，用於共享匿名映射和SYSV共享內存。</p>
<p>掛載不依賴於CONFIG_TMPFS。如果CONFIG_TMPFS未設置，tmpfs對用戶不可見。
但是內部機制始終存在。</p>
</li>
<li><p>glibc 2.2及更高版本期望將tmpfs掛載在/dev/shm上以用於POSIX共享內存
(shm_open，shm_unlink)。添加內容到/etc/fstab應注意如下：</p>
<blockquote>
<div><p>tmpfs   /dev/shm        tmpfs   defaults        0 0</p>
</div></blockquote>
<p>使用時需要記住創建掛載tmpfs的目錄。</p>
<p>SYSV共享內存無需掛載，內部已默認支持。(在2.3內核版本中，必須掛載
tmpfs的前身(shm fs)才能使用SYSV共享內存)</p>
</li>
<li><p>很多人（包括我）都覺的在/tmp和/var/tmp上掛載非常方便，並具有較大的
swap分區。目前循環掛載tmpfs可以正常工作，所以大多數發布都應當可以
使用mkinitrd通過/tmp訪問/tmp。</p></li>
<li><p>也許還有更多我不知道的地方:-)</p></li>
</ol>
<p>tmpfs有三個用於調整大小的掛載選項：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 87%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>size</p></td>
<td><p>tmpfs實例分配的字節數限制。默認值是不swap時物理RAM的一半。
如果tmpfs實例過大，機器將死鎖，因爲OOM處理將無法釋放該內存。</p></td>
</tr>
<tr class="row-even"><td><p>nr_blocks</p></td>
<td><p>與size相同，但以PAGE_SIZE爲單位。</p></td>
</tr>
<tr class="row-odd"><td><p>nr_inodes</p></td>
<td><p>tmpfs實例的最大inode個數。默認值是物理內存頁數的一半，或者
(有高端內存的機器)低端內存RAM的頁數，二者以較低者為準。</p></td>
</tr>
</tbody>
</table>
<p>這些參數接受後綴k，m或g表示千，兆和千兆字節，可以在remount時更改。
size參數也接受後綴％用來限制tmpfs實例占用物理RAM的百分比：
未指定size或nr_blocks時，默認值爲size=50％</p>
<p>如果nr_blocks=0（或size=0），block個數將不受限制；如果nr_inodes=0，
inode個數將不受限制。這樣掛載通常是不明智的，因爲它允許任何具有寫權限的
用戶通過訪問tmpfs耗盡機器上的所有內存；但同時這樣做也會增強在多個CPU的
場景下的訪問。</p>
<p>tmpfs具有爲所有文件設置NUMA內存分配策略掛載選項(如果啓用了CONFIG_NUMA),
可以通過「mount -o remount …」調整</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 49%" />
<col style="width: 51%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>mpol=default</p></td>
<td><p>採用進程分配策略
(請參閱 set_mempolicy(2))</p></td>
</tr>
<tr class="row-even"><td><p>mpol=prefer:Node</p></td>
<td><p>傾向從給定的節點分配</p></td>
</tr>
<tr class="row-odd"><td><p>mpol=bind:NodeList</p></td>
<td><p>只允許從指定的鍊表分配</p></td>
</tr>
<tr class="row-even"><td><p>mpol=interleave</p></td>
<td><p>傾向於依次從每個節點分配</p></td>
</tr>
<tr class="row-odd"><td><p>mpol=interleave:NodeList</p></td>
<td><p>依次從每個節點分配</p></td>
</tr>
<tr class="row-even"><td><p>mpol=local</p></td>
<td><p>優先本地節點分配內存</p></td>
</tr>
</tbody>
</table>
<p>NodeList格式是以逗號分隔的十進位數字表示大小和範圍，最大和最小範圍是用-
分隔符的十進位數來表示。例如，mpol=bind0-3,5,7,9-15</p>
<p>帶有有效NodeList的內存策略將按指定格式保存，在創建文件時使用。當任務在該
文件系統上創建文件時，會使用到掛載時的內存策略NodeList選項，如果設置的話，
由調用任務的cpuset[請參見Documentation/admin-guide/cgroup-v1/cpusets.rst]
以及下面列出的可選標誌約束。如果NodeLists爲設置爲空集，則文件的內存策略將
恢復爲「默認」策略。</p>
<p>NUMA內存分配策略有可選標誌，可以用於模式結合。在掛載tmpfs時指定這些可選
標誌可以在NodeList之前生效。
<a class="reference internal" href="../../../admin-guide/mm/numa_memory_policy.html"><span class="doc">NUMA Memory Policy</span></a>列出所有可用的內存
分配策略模式標誌及其對內存策略。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>=static         相當於     MPOL_F_STATIC_NODES
=relative       相當於     MPOL_F_RELATIVE_NODES
</pre></div>
</div>
<p>例如，mpol=bind=staticNodeList相當於MPOL_BIND|MPOL_F_STATIC_NODES的分配策略</p>
<p>請注意，如果內核不支持NUMA，那麼使用mpol選項掛載tmpfs將會失敗；nodelist指定不
在線的節點也會失敗。如果您的系統依賴於此，但內核會運行不帶NUMA功能(也許是安全
revocery內核)，或者具有較少的節點在線，建議從自動模式中省略mpol選項掛載選項。
可以在以後通過「mount -o remount,mpol=Policy:NodeList MountPoint」添加到掛載點。</p>
<p>要指定初始根目錄，可以使用如下掛載選項：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>模式</p></td>
<td><p>權限用八進位數字表示</p></td>
</tr>
<tr class="row-even"><td><p>uid</p></td>
<td><p>用戶ID</p></td>
</tr>
<tr class="row-odd"><td><p>gid</p></td>
<td><p>組ID</p></td>
</tr>
</tbody>
</table>
<p>這些選項對remount沒有任何影響。您可以通過chmod(1),chown(1)和chgrp(1)的更改
已經掛載的參數。</p>
<p>tmpfs具有選擇32位還是64位inode的掛載選項：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 35%" />
<col style="width: 65%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>inode64</p></td>
<td><p>使用64位inode</p></td>
</tr>
<tr class="row-even"><td><p>inode32</p></td>
<td><p>使用32位inode</p></td>
</tr>
</tbody>
</table>
<p>在32位內核上，默認是inode32，掛載時指定inode64會被拒絕。
在64位內核上，默認配置是CONFIG_TMPFS_INODE64。inode64避免了單個設備上可能有多個
具有相同inode編號的文件；比如32位應用程式使用glibc如果長期訪問tmpfs，一旦達到33
位inode編號，就有EOVERFLOW失敗的危險，無法打開大於2GiB的文件，並返回EINVAL。</p>
<p>所以’mount -t tmpfs -o size=10G,nr_inodes=10k,mode=700 tmpfs /mytmpfs’將在
/mytmpfs上掛載tmpfs實例，分配只能由root用戶訪問的10GB RAM/SWAP，可以有10240個
inode的實例。</p>
<dl class="field-list simple">
<dt class="field-odd">作者</dt>
<dd class="field-odd"><p>Christoph Rohland &lt;<a class="reference external" href="mailto:cr&#37;&#52;&#48;sap&#46;com">cr<span>&#64;</span>sap<span>&#46;</span>com</a>&gt;, 1.12.01</p>
</dd>
<dt class="field-even">更新</dt>
<dd class="field-even"><p>Hugh Dickins, 4 June 2007</p>
</dd>
<dt class="field-odd">更新</dt>
<dd class="field-odd"><p>KOSAKI Motohiro, 16 Mar 2010</p>
</dd>
<dt class="field-even">更新</dt>
<dd class="field-even"><p>Chris Down, 13 July 2020</p>
</dd>
</dl>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/translations/zh_TW/filesystems/tmpfs.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/translations/zh_TW/filesystems/tmpfs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>