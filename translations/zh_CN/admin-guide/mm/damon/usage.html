
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>详细用法 &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="基于DAMON的回收" href="reclaim.html" />
    <link rel="prev" title="入门指南" href="start.html" />
   
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>此文件的目的是为让中文读者更容易阅读和理解，而不是作为一个分支。 因此，
如果您对此文件有任何意见或更新，请先尝试更新原始英文文件。</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>如果您发现本文档与原始文件有任何不同或者有翻译问题，请联系该文件的译者，
或者请求时奎亮的帮助：&lt;<a class="reference external" href="mailto:alexs&#37;&#52;&#48;kernel&#46;org">alexs<span>&#64;</span>kernel<span>&#46;</span>org</a>&gt;。</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Original</dt>
<dd class="field-odd"><p><a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html"><span class="doc">Detailed Usages</span></a></p>
</dd>
<dt class="field-even">翻译</dt>
<dd class="field-even"><p>司延腾 Yanteng Si &lt;<a class="reference external" href="mailto:siyanteng&#37;&#52;&#48;loongson&#46;cn">siyanteng<span>&#64;</span>loongson<span>&#46;</span>cn</a>&gt;</p>
</dd>
<dt class="field-odd">校译</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<section id="id1">
<h1>详细用法<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>DAMON 为不同的用户提供了下面这些接口。</p>
<ul class="simple">
<li><p><em>DAMON用户空间工具。</em>
<a class="reference external" href="https://github.com/awslabs/damo">这</a> 为有这特权的人， 如系统管理员，希望有一个刚好
可以工作的人性化界面。
使用它，用户可以以人性化的方式使用DAMON的主要功能。不过，它可能不会为特殊情况进行高度调整。
它同时支持虚拟和物理地址空间的监测。更多细节，请参考它的 <a class="reference external" href="https://github.com/awslabs/damo/blob/next/USAGE.md">使用文档</a>。</p></li>
<li><p><em>sysfs接口。</em>
<a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html#sysfs-interface"><span class="std std-ref">这</span></a> 是为那些希望更高级的使用DAMON的特权用户空间程序员准备的。
使用它，用户可以通过读取和写入特殊的sysfs文件来使用DAMON的主要功能。因此，你可以编写和使
用你个性化的DAMON sysfs包装程序，代替你读/写sysfs文件。  <a class="reference external" href="https://github.com/awslabs/damo">DAMON用户空间工具</a> 就是这种程序的一个例子  它同时支持虚拟和物理地址
空间的监测。注意，这个界面只提供简单的监测结果 <a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html#damos-stats"><span class="std std-ref">统计</span></a>。对于详细的监测
结果，DAMON提供了一个:ref:<cite>跟踪点 &lt;tracepoint&gt;</cite>。</p></li>
<li><p><em>debugfs interface.</em>
<a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html#debugfs-interface"><span class="std std-ref">这</span></a> 几乎与:ref:<cite>sysfs interface &lt;sysfs_interface&gt;</cite> 接
口相同。这将在下一个LTS内核发布后被移除，所以用户应该转移到
<a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html#sysfs-interface"><span class="std std-ref">sysfs interface</span></a>。</p></li>
<li><p><em>内核空间编程接口。</em>
<a class="reference internal" href="../../../../../mm/damon/api.html"><span class="doc">这</span></a> 这是为内核空间程序员准备的。使用它，用户可以通过为你编写内
核空间的DAMON应用程序，最灵活有效地利用DAMON的每一个功能。你甚至可以为各种地址空间扩展DAMON。
详细情况请参考接口 <a class="reference internal" href="../../../../../mm/damon/api.html"><span class="doc">文件</span></a>。</p></li>
</ul>
<section id="sysfs">
<h2>sysfs接口<a class="headerlink" href="#sysfs" title="Permalink to this headline">¶</a></h2>
<p>DAMON的sysfs接口是在定义 <code class="docutils literal notranslate"><span class="pre">CONFIG_DAMON_SYSFS</span></code> 时建立的。它在其sysfs目录下创建多
个目录和文件， <code class="docutils literal notranslate"><span class="pre">&lt;sysfs&gt;/kernel/mm/damon/</span></code> 。你可以通过对该目录下的文件进行写入和
读取来控制DAMON。</p>
<p>对于一个简短的例子，用户可以监测一个给定工作负载的虚拟地址空间，如下所示:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd /sys/kernel/mm/damon/admin/
# echo 1 &gt; kdamonds/nr &amp;&amp; echo 1 &gt; kdamonds/0/contexts/nr
# echo vaddr &gt; kdamonds/0/contexts/0/operations
# echo 1 &gt; kdamonds/0/contexts/0/targets/nr
# echo $(pidof &lt;workload&gt;) &gt; kdamonds/0/contexts/0/targets/0/pid
# echo on &gt; kdamonds/0/state
</pre></div>
</div>
<section id="id4">
<h3>文件层次结构<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>DAMON sysfs接口的文件层次结构如下图所示。在下图中，父子关系用缩进表示，每个目录有
<code class="docutils literal notranslate"><span class="pre">/</span></code> 后缀，每个目录中的文件用逗号（”,”）分开。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/sys/kernel/mm/damon/admin
│ kdamonds/nr_kdamonds
│ │ 0/state,pid
│ │ │ contexts/nr_contexts
│ │ │ │ 0/operations
│ │ │ │ │ monitoring_attrs/
│ │ │ │ │ │ intervals/sample_us,aggr_us,update_us
│ │ │ │ │ │ nr_regions/min,max
│ │ │ │ │ targets/nr_targets
│ │ │ │ │ │ 0/pid_target
│ │ │ │ │ │ │ regions/nr_regions
│ │ │ │ │ │ │ │ 0/start,end
│ │ │ │ │ │ │ │ ...
│ │ │ │ │ │ ...
│ │ │ │ │ schemes/nr_schemes
│ │ │ │ │ │ 0/action
│ │ │ │ │ │ │ access_pattern/
│ │ │ │ │ │ │ │ sz/min,max
│ │ │ │ │ │ │ │ nr_accesses/min,max
│ │ │ │ │ │ │ │ age/min,max
│ │ │ │ │ │ │ quotas/ms,bytes,reset_interval_ms
│ │ │ │ │ │ │ │ weights/sz_permil,nr_accesses_permil,age_permil
│ │ │ │ │ │ │ watermarks/metric,interval_us,high,mid,low
│ │ │ │ │ │ │ stats/nr_tried,sz_tried,nr_applied,sz_applied,qt_exceeds
│ │ │ │ │ │ ...
│ │ │ │ ...
│ │ ...
</pre></div>
</div>
</section>
<section id="id5">
<h3>根<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>DAMON sysfs接口的根是 <code class="docutils literal notranslate"><span class="pre">&lt;sysfs&gt;/kernel/mm/damon/</span></code> ，它有一个名为 <code class="docutils literal notranslate"><span class="pre">admin</span></code> 的
目录。该目录包含特权用户空间程序控制DAMON的文件。拥有根权限的用户空间工具或deamons可以
使用这个目录。</p>
</section>
<section id="kdamonds">
<h3>kdamonds/<a class="headerlink" href="#kdamonds" title="Permalink to this headline">¶</a></h3>
<p>与监测相关的信息包括请求规格和结果被称为DAMON上下文。DAMON用一个叫做kdamond的内核线程
执行每个上下文，多个kdamonds可以并行运行。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">admin</span></code> 目录下，有一个目录，即``kdamonds``，它有控制kdamonds的文件存在。在开始
时，这个目录只有一个文件，<code class="docutils literal notranslate"><span class="pre">nr_kdamonds</span></code>。向该文件写入一个数字（<code class="docutils literal notranslate"><span class="pre">N</span></code>），就会创建名为
<code class="docutils literal notranslate"><span class="pre">0</span></code> 到 <code class="docutils literal notranslate"><span class="pre">N-1</span></code> 的子目录数量。每个目录代表每个kdamond。</p>
</section>
<section id="kdamonds-n">
<h3>kdamonds/&lt;N&gt;/<a class="headerlink" href="#kdamonds-n" title="Permalink to this headline">¶</a></h3>
<p>在每个kdamond目录中，存在两个文件（<code class="docutils literal notranslate"><span class="pre">state</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pid</span></code> ）和一个目录( <code class="docutils literal notranslate"><span class="pre">contexts</span></code> )。</p>
<p>读取 <code class="docutils literal notranslate"><span class="pre">state</span></code> 时，如果kdamond当前正在运行，则返回 <code class="docutils literal notranslate"><span class="pre">on</span></code> ，如果没有运行则返回 <code class="docutils literal notranslate"><span class="pre">off</span></code> 。
写入 <code class="docutils literal notranslate"><span class="pre">on</span></code> 或 <code class="docutils literal notranslate"><span class="pre">off</span></code> 使kdamond处于状态。向 <code class="docutils literal notranslate"><span class="pre">state</span></code> 文件写 <code class="docutils literal notranslate"><span class="pre">update_schemes_stats</span></code> ，
更新kdamond的每个基于DAMON的操作方案的统计文件的内容。关于统计信息的细节，请参考
<a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html#sysfs-schemes-stats"><span class="std std-ref">stats section</span></a>.</p>
<p>如果状态为 <code class="docutils literal notranslate"><span class="pre">on</span></code>，读取 <code class="docutils literal notranslate"><span class="pre">pid</span></code> 显示kdamond线程的pid。</p>
<p><code class="docutils literal notranslate"><span class="pre">contexts</span></code> 目录包含控制这个kdamond要执行的监测上下文的文件。</p>
</section>
<section id="kdamonds-n-contexts">
<h3>kdamonds/&lt;N&gt;/contexts/<a class="headerlink" href="#kdamonds-n-contexts" title="Permalink to this headline">¶</a></h3>
<p>在开始时，这个目录只有一个文件，即 <code class="docutils literal notranslate"><span class="pre">nr_contexts</span></code> 。向该文件写入一个数字( <code class="docutils literal notranslate"><span class="pre">N</span></code> )，就会创
建名为``0`` 到 <code class="docutils literal notranslate"><span class="pre">N-1</span></code> 的子目录数量。每个目录代表每个监测背景。目前，每个kdamond只支持
一个上下文，所以只有 <code class="docutils literal notranslate"><span class="pre">0</span></code> 或 <code class="docutils literal notranslate"><span class="pre">1</span></code> 可以被写入文件。</p>
</section>
<section id="contexts-n">
<h3>contexts/&lt;N&gt;/<a class="headerlink" href="#contexts-n" title="Permalink to this headline">¶</a></h3>
<p>在每个上下文目录中，存在一个文件(<code class="docutils literal notranslate"><span class="pre">operations</span></code>)和三个目录(<code class="docutils literal notranslate"><span class="pre">monitoring_attrs</span></code>,
<code class="docutils literal notranslate"><span class="pre">targets</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">schemes</span></code>)。</p>
<p>DAMON支持多种类型的监测操作，包括对虚拟地址空间和物理地址空间的监测。你可以通过向文件
中写入以下关键词之一，并从文件中读取，来设置和获取DAMON将为上下文使用何种类型的监测操作。</p>
<blockquote>
<div><ul class="simple">
<li><p>vaddr: 监测特定进程的虚拟地址空间</p></li>
<li><p>paddr: 监视系统的物理地址空间</p></li>
</ul>
</div></blockquote>
</section>
<section id="contexts-n-monitoring-attrs">
<h3>contexts/&lt;N&gt;/monitoring_attrs/<a class="headerlink" href="#contexts-n-monitoring-attrs" title="Permalink to this headline">¶</a></h3>
<p>用于指定监测属性的文件，包括所需的监测质量和效率，都在 <code class="docutils literal notranslate"><span class="pre">monitoring_attrs</span></code> 目录中。
具体来说，这个目录下有两个目录，即 <code class="docutils literal notranslate"><span class="pre">intervals</span></code> 和 <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code> 。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">intervals</span></code> 目录下，存在DAMON的采样间隔(<code class="docutils literal notranslate"><span class="pre">sample_us</span></code>)、聚集间隔(<code class="docutils literal notranslate"><span class="pre">aggr_us</span></code>)
和更新间隔(<code class="docutils literal notranslate"><span class="pre">update_us</span></code>)三个文件。你可以通过写入和读出这些文件来设置和获取微秒级的值。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code> 目录下，有两个文件分别用于DAMON监测区域的下限和上限（<code class="docutils literal notranslate"><span class="pre">min</span></code> 和 <code class="docutils literal notranslate"><span class="pre">max</span></code> ），
这两个文件控制着监测的开销。你可以通过向这些文件的写入和读出来设置和获取这些值。</p>
<p>关于间隔和监测区域范围的更多细节，请参考设计文件 (<a class="reference internal" href="../../../../../mm/damon/design.html"><span class="doc">Design</span></a>)。</p>
</section>
<section id="contexts-n-targets">
<h3>contexts/&lt;N&gt;/targets/<a class="headerlink" href="#contexts-n-targets" title="Permalink to this headline">¶</a></h3>
<p>在开始时，这个目录只有一个文件 <code class="docutils literal notranslate"><span class="pre">nr_targets</span></code> 。向该文件写入一个数字(<code class="docutils literal notranslate"><span class="pre">N</span></code>)，就可以创建
名为 <code class="docutils literal notranslate"><span class="pre">0</span></code> 到 <code class="docutils literal notranslate"><span class="pre">N-1</span></code> 的子目录的数量。每个目录代表每个监测目标。</p>
</section>
<section id="targets-n">
<h3>targets/&lt;N&gt;/<a class="headerlink" href="#targets-n" title="Permalink to this headline">¶</a></h3>
<p>在每个目标目录中，存在一个文件(<code class="docutils literal notranslate"><span class="pre">pid_target</span></code>)和一个目录(<code class="docutils literal notranslate"><span class="pre">regions</span></code>)。</p>
<p>如果你把 <code class="docutils literal notranslate"><span class="pre">vaddr</span></code> 写到 <code class="docutils literal notranslate"><span class="pre">contexts/&lt;N&gt;/operations</span></code> 中，每个目标应该是一个进程。你
可以通过将进程的pid写到 <code class="docutils literal notranslate"><span class="pre">pid_target</span></code> 文件中来指定DAMON的进程。</p>
</section>
<section id="targets-n-regions">
<h3>targets/&lt;N&gt;/regions<a class="headerlink" href="#targets-n-regions" title="Permalink to this headline">¶</a></h3>
<p>当使用 <code class="docutils literal notranslate"><span class="pre">vaddr</span></code> 监测操作集时（ <code class="docutils literal notranslate"><span class="pre">vaddr</span></code> 被写入 <code class="docutils literal notranslate"><span class="pre">contexts/&lt;N&gt;/operations</span></code> 文
件），DAMON自动设置和更新监测目标区域，这样就可以覆盖目标进程的整个内存映射。然而，用户可
能希望将初始监测区域设置为特定的地址范围。</p>
<p>相反，当使用 <code class="docutils literal notranslate"><span class="pre">paddr</span></code> 监测操作集时，DAMON不会自动设置和更新监测目标区域（ <code class="docutils literal notranslate"><span class="pre">paddr</span></code>
被写入 <code class="docutils literal notranslate"><span class="pre">contexts/&lt;N&gt;/operations</span></code> 中）。因此，在这种情况下，用户应该自己设置监测目标
区域。</p>
<p>在这种情况下，用户可以按照自己的意愿明确设置初始监测目标区域，将适当的值写入该目录下的文件。</p>
<p>开始时，这个目录只有一个文件， <code class="docutils literal notranslate"><span class="pre">nr_regions</span></code> 。向该文件写入一个数字(<code class="docutils literal notranslate"><span class="pre">N</span></code>)，就可以创
建名为 <code class="docutils literal notranslate"><span class="pre">0</span></code> 到  <code class="docutils literal notranslate"><span class="pre">N-1</span></code> 的子目录。每个目录代表每个初始监测目标区域。</p>
</section>
<section id="regions-n">
<h3>regions/&lt;N&gt;/<a class="headerlink" href="#regions-n" title="Permalink to this headline">¶</a></h3>
<p>在每个区域目录中，你会发现两个文件（ <code class="docutils literal notranslate"><span class="pre">start</span></code>  和  <code class="docutils literal notranslate"><span class="pre">end</span></code> ）。你可以通过向文件写入
和从文件中读出，分别设置和获得初始监测目标区域的起始和结束地址。</p>
</section>
<section id="contexts-n-schemes">
<h3>contexts/&lt;N&gt;/schemes/<a class="headerlink" href="#contexts-n-schemes" title="Permalink to this headline">¶</a></h3>
<p>对于一版的基于DAMON的数据访问感知的内存管理优化，用户通常希望系统对特定访问模式的内存区
域应用内存管理操作。DAMON从用户那里接收这种形式化的操作方案，并将这些方案应用于目标内存
区域。用户可以通过读取和写入这个目录下的文件来获得和设置这些方案。</p>
<p>在开始时，这个目录只有一个文件，<code class="docutils literal notranslate"><span class="pre">nr_schemes</span></code>。向该文件写入一个数字(<code class="docutils literal notranslate"><span class="pre">N</span></code>)，就可以
创建名为``0``到``N-1``的子目录的数量。每个目录代表每个基于DAMON的操作方案。</p>
</section>
<section id="schemes-n">
<h3>schemes/&lt;N&gt;/<a class="headerlink" href="#schemes-n" title="Permalink to this headline">¶</a></h3>
<p>在每个方案目录中，存在四个目录(<code class="docutils literal notranslate"><span class="pre">access_pattern</span></code>, <code class="docutils literal notranslate"><span class="pre">quotas</span></code>,``watermarks``,
和 <code class="docutils literal notranslate"><span class="pre">stats</span></code>)和一个文件(<code class="docutils literal notranslate"><span class="pre">action</span></code>)。</p>
<p><code class="docutils literal notranslate"><span class="pre">action</span></code> 文件用于设置和获取你想应用于具有特定访问模式的内存区域的动作。可以写入文件
和从文件中读取的关键词及其含义如下。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">willneed</span></code>: 对有 <code class="docutils literal notranslate"><span class="pre">MADV_WILLNEED</span></code> 的区域调用 <code class="docutils literal notranslate"><span class="pre">madvise()</span></code> 。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cold</span></code>: 对具有 <code class="docutils literal notranslate"><span class="pre">MADV_COLD</span></code> 的区域调用 <code class="docutils literal notranslate"><span class="pre">madvise()</span></code> 。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pageout</span></code>: 为具有 <code class="docutils literal notranslate"><span class="pre">MADV_PAGEOUT</span></code> 的区域调用 <code class="docutils literal notranslate"><span class="pre">madvise()</span></code> 。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hugepage</span></code>: 为带有 <code class="docutils literal notranslate"><span class="pre">MADV_HUGEPAGE</span></code> 的区域调用 <code class="docutils literal notranslate"><span class="pre">madvise()</span></code> 。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nohugepage</span></code>: 为带有 <code class="docutils literal notranslate"><span class="pre">MADV_NOHUGEPAGE</span></code> 的区域调用 <code class="docutils literal notranslate"><span class="pre">madvise()</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lru_prio</span></code>: 在其LRU列表上对区域进行优先排序。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lru_deprio</span></code>: 对区域的LRU列表进行降低优先处理。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stat</span></code>: 什么都不做，只计算统计数据</p></li>
</ul>
</div></blockquote>
</section>
<section id="schemes-n-access-pattern">
<h3>schemes/&lt;N&gt;/access_pattern/<a class="headerlink" href="#schemes-n-access-pattern" title="Permalink to this headline">¶</a></h3>
<p>每个基于DAMON的操作方案的目标访问模式由三个范围构成，包括以字节为单位的区域大小、每个
聚合区间的监测访问次数和区域年龄的聚合区间数。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">access_pattern</span></code> 目录下，存在三个目录（ <code class="docutils literal notranslate"><span class="pre">sz</span></code>, <code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">age</span></code> ），
每个目录有两个文件（<code class="docutils literal notranslate"><span class="pre">min</span></code> 和 <code class="docutils literal notranslate"><span class="pre">max</span></code> ）。你可以通过向  <code class="docutils literal notranslate"><span class="pre">sz</span></code>, <code class="docutils literal notranslate"><span class="pre">nr_accesses</span></code>, 和
<code class="docutils literal notranslate"><span class="pre">age</span></code>  目录下的 <code class="docutils literal notranslate"><span class="pre">min</span></code> 和 <code class="docutils literal notranslate"><span class="pre">max</span></code> 文件分别写入和读取来设置和获取给定方案的访问模式。</p>
</section>
<section id="schemes-n-quotas">
<h3>schemes/&lt;N&gt;/quotas/<a class="headerlink" href="#schemes-n-quotas" title="Permalink to this headline">¶</a></h3>
<p>每个 <code class="docutils literal notranslate"><span class="pre">动作</span></code> 的最佳 <code class="docutils literal notranslate"><span class="pre">目标访问模式</span></code> 取决于工作负载，所以不容易找到。更糟糕的是，将某些动作
的方案设置得过于激进会造成严重的开销。为了避免这种开销，用户可以为每个方案限制时间和大小配额。
具体来说，用户可以要求DAMON尽量只使用特定的时间（<code class="docutils literal notranslate"><span class="pre">时间配额</span></code>）来应用行动，并且在给定的时间间
隔（<code class="docutils literal notranslate"><span class="pre">重置间隔</span></code>）内，只对具有目标访问模式的内存区域应用行动，而不使用特定数量（<code class="docutils literal notranslate"><span class="pre">大小配额</span></code>）。</p>
<p>当预计超过配额限制时，DAMON会根据 <code class="docutils literal notranslate"><span class="pre">目标访问模式</span></code> 的大小、访问频率和年龄，对找到的内存区域
进行优先排序。为了进行个性化的优先排序，用户可以为这三个属性设置权重。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">quotas</span></code> 目录下，存在三个文件（<code class="docutils literal notranslate"><span class="pre">ms</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, <code class="docutils literal notranslate"><span class="pre">reset_interval_ms</span></code>）和一个
目录(<code class="docutils literal notranslate"><span class="pre">weights</span></code>)，其中有三个文件(<code class="docutils literal notranslate"><span class="pre">sz_permil</span></code>, <code class="docutils literal notranslate"><span class="pre">nr_accesses_permil</span></code>, 和
<code class="docutils literal notranslate"><span class="pre">age_permil</span></code>)。</p>
<p>你可以设置以毫秒为单位的 <code class="docutils literal notranslate"><span class="pre">时间配额</span></code> ，以字节为单位的 <code class="docutils literal notranslate"><span class="pre">大小配额</span></code> ，以及以毫秒为单位的 <code class="docutils literal notranslate"><span class="pre">重</span>
<span class="pre">置间隔</span></code> ，分别向这三个文件写入数值。你还可以通过向 <code class="docutils literal notranslate"><span class="pre">weights</span></code> 目录下的三个文件写入数值来设
置大小、访问频率和年龄的优先权，单位为千分之一。</p>
</section>
<section id="schemes-n-watermarks">
<h3>schemes/&lt;N&gt;/watermarks/<a class="headerlink" href="#schemes-n-watermarks" title="Permalink to this headline">¶</a></h3>
<p>为了便于根据系统状态激活和停用每个方案，DAMON提供了一个称为水位的功能。该功能接收五个值，称为
<code class="docutils literal notranslate"><span class="pre">度量</span></code> 、<code class="docutils literal notranslate"><span class="pre">间隔</span></code> 、<code class="docutils literal notranslate"><span class="pre">高</span></code> 、<code class="docutils literal notranslate"><span class="pre">中</span></code> 、<code class="docutils literal notranslate"><span class="pre">低</span></code> 。<code class="docutils literal notranslate"><span class="pre">度量值</span></code> 是指可以测量的系统度量值，如
自由内存比率。如果系统的度量值 <code class="docutils literal notranslate"><span class="pre">高</span></code> 于memoent的高值或 <code class="docutils literal notranslate"><span class="pre">低</span></code> 于低值，则该方案被停用。如果
该值低于 <code class="docutils literal notranslate"><span class="pre">中</span></code> ，则该方案被激活。</p>
<p>在水位目录下，存在五个文件(<code class="docutils literal notranslate"><span class="pre">metric</span></code>, <code class="docutils literal notranslate"><span class="pre">interval_us</span></code>,``high``, <code class="docutils literal notranslate"><span class="pre">mid</span></code>, and <code class="docutils literal notranslate"><span class="pre">low</span></code>)
用于设置每个值。你可以通过向这些文件的写入来分别设置和获取这五个值。</p>
<p>可以写入 <code class="docutils literal notranslate"><span class="pre">metric</span></code> 文件的关键词和含义如下。</p>
<blockquote>
<div><ul class="simple">
<li><p>none: 忽略水位</p></li>
<li><p>free_mem_rate: 系统的自由内存率（千分比）。</p></li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">interval</span></code> 应以微秒为单位写入。</p>
</section>
<section id="schemes-n-stats">
<h3>schemes/&lt;N&gt;/stats/<a class="headerlink" href="#schemes-n-stats" title="Permalink to this headline">¶</a></h3>
<p>DAMON统计每个方案被尝试应用的区域的总数量和字节数，每个方案被成功应用的区域的两个数字，以及
超过配额限制的总数量。这些统计数据可用于在线分析或调整方案。</p>
<p>可以通过读取 <code class="docutils literal notranslate"><span class="pre">stats</span></code> 目录下的文件(<code class="docutils literal notranslate"><span class="pre">nr_tried</span></code>, <code class="docutils literal notranslate"><span class="pre">sz_tried</span></code>, <code class="docutils literal notranslate"><span class="pre">nr_applied</span></code>,
<code class="docutils literal notranslate"><span class="pre">sz_applied</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">qt_exceeds</span></code>)）分别检索这些统计数据。这些文件不是实时更新的，所以
你应该要求DAMON sysfs接口通过在相关的 <code class="docutils literal notranslate"><span class="pre">kdamonds/&lt;N&gt;/state</span></code> 文件中写入一个特殊的关键字
<code class="docutils literal notranslate"><span class="pre">update_schemes_stats</span></code> 来更新统计信息的文件内容。</p>
<section id="id6">
<h4>用例<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>下面的命令应用了一个方案：”如果一个大小为[4KiB, 8KiB]的内存区域在[10, 20]的聚合时间间隔内
显示出每一个聚合时间间隔[0, 5]的访问量，请分页该区域。对于分页，每秒最多只能使用10ms，而且每
秒分页不能超过1GiB。在这一限制下，首先分页出具有较长年龄的内存区域。另外，每5秒钟检查一次系统
的可用内存率，当可用内存率低于50%时开始监测和分页，但如果可用内存率大于60%，或低于30%，则停
止监测。“</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;sysfs&gt;/kernel/mm/damon/admin
# # populate directories
# echo 1 &gt; kdamonds/nr_kdamonds; echo 1 &gt; kdamonds/0/contexts/nr_contexts;
# echo 1 &gt; kdamonds/0/contexts/0/schemes/nr_schemes
# cd kdamonds/0/contexts/0/schemes/0
# # set the basic access pattern and the action
# echo 4096 &gt; access_patterns/sz/min
# echo 8192 &gt; access_patterns/sz/max
# echo 0 &gt; access_patterns/nr_accesses/min
# echo 5 &gt; access_patterns/nr_accesses/max
# echo 10 &gt; access_patterns/age/min
# echo 20 &gt; access_patterns/age/max
# echo pageout &gt; action
# # set quotas
# echo 10 &gt; quotas/ms
# echo $((1024*1024*1024)) &gt; quotas/bytes
# echo 1000 &gt; quotas/reset_interval_ms
# # set watermark
# echo free_mem_rate &gt; watermarks/metric
# echo 5000000 &gt; watermarks/interval_us
# echo 600 &gt; watermarks/high
# echo 500 &gt; watermarks/mid
# echo 300 &gt; watermarks/low
</pre></div>
</div>
<p>请注意，我们强烈建议使用用户空间的工具，如 <a class="reference external" href="https://github.com/awslabs/damo">damo</a> ，
而不是像上面那样手动读写文件。以上只是一个例子。</p>
</section>
</section>
</section>
<section id="debugfs">
<h2>debugfs接口<a class="headerlink" href="#debugfs" title="Permalink to this headline">¶</a></h2>
<p>DAMON导出了八个文件, <code class="docutils literal notranslate"><span class="pre">attrs</span></code>, <code class="docutils literal notranslate"><span class="pre">target_ids</span></code>, <code class="docutils literal notranslate"><span class="pre">init_regions</span></code>,
<code class="docutils literal notranslate"><span class="pre">schemes</span></code>, <code class="docutils literal notranslate"><span class="pre">monitor_on</span></code>, <code class="docutils literal notranslate"><span class="pre">kdamond_pid</span></code>, <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> 和
<code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> under its debugfs directory, <code class="docutils literal notranslate"><span class="pre">&lt;debugfs&gt;/damon/</span></code>.</p>
<section id="id7">
<h3>属性<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>用户可以通过读取和写入 <code class="docutils literal notranslate"><span class="pre">attrs</span></code> 文件获得和设置 <code class="docutils literal notranslate"><span class="pre">采样间隔</span></code> 、 <code class="docutils literal notranslate"><span class="pre">聚集间隔</span></code> 、 <code class="docutils literal notranslate"><span class="pre">更新间隔</span></code>
以及监测目标区域的最小/最大数量。要详细了解监测属性，请参考 <cite>:doc:/mm/damon/design</cite> 。例如，
下面的命令将这些值设置为5ms、100ms、1000ms、10和1000，然后再次检查:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo 5000 100000 1000000 10 1000 &gt; attrs
# cat attrs
5000 100000 1000000 10 1000
</pre></div>
</div>
</section>
<section id="id">
<h3>目标ID<a class="headerlink" href="#id" title="Permalink to this headline">¶</a></h3>
<p>一些类型的地址空间支持多个监测目标。例如，虚拟内存地址空间的监测可以有多个进程作为监测目标。用户
可以通过写入目标的相关id值来设置目标，并通过读取 <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> 文件来获得当前目标的id。在监
测虚拟地址空间的情况下，这些值应该是监测目标进程的pid。例如，下面的命令将pid为42和4242的进程设
为监测目标，并再次检查:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo 42 4242 &gt; target_ids
# cat target_ids
42 4242
</pre></div>
</div>
<p>用户还可以通过在文件中写入一个特殊的关键字 “paddrn” 来监测系统的物理内存地址空间。因为物理地
址空间监测不支持多个目标，读取文件会显示一个假值，即 <code class="docutils literal notranslate"><span class="pre">42</span></code> ，如下图所示:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo paddr &gt; target_ids
# cat target_ids
42
</pre></div>
</div>
<p>请注意，设置目标ID并不启动监测。</p>
</section>
<section id="id8">
<h3>初始监测目标区域<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>在虚拟地址空间监测的情况下，DAMON自动设置和更新监测的目标区域，这样就可以覆盖目标进程的整个
内存映射。然而，用户可能希望将监测区域限制在特定的地址范围内，如堆、栈或特定的文件映射区域。
或者，一些用户可以知道他们工作负载的初始访问模式，因此希望为“自适应区域调整”设置最佳初始区域。</p>
<p>相比之下，DAMON在物理内存监测的情况下不会自动设置和更新监测目标区域。因此，用户应该自己设置
监测目标区域。</p>
<p>在这种情况下，用户可以通过在 <code class="docutils literal notranslate"><span class="pre">init_regions</span></code> 文件中写入适当的值，明确地设置他们想要的初
始监测目标区域。输入的每一行应代表一个区域，形式如下:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;target idx&gt; &lt;start address&gt; &lt;end address&gt;
</pre></div>
</div>
<p>目标idx应该是 <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> 文件中目标的索引，从 <code class="docutils literal notranslate"><span class="pre">0</span></code> 开始，区域应该按照地址顺序传递。
例如，下面的命令将设置几个地址范围， <code class="docutils literal notranslate"><span class="pre">1-100</span></code> 和 <code class="docutils literal notranslate"><span class="pre">100-200</span></code> 作为pid 42的初始监测目标
区域，这是 <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> 中的第一个（索引 <code class="docutils literal notranslate"><span class="pre">0</span></code> ），另外几个地址范围， <code class="docutils literal notranslate"><span class="pre">20-40</span></code> 和
<code class="docutils literal notranslate"><span class="pre">50-100</span></code> 作为pid 4242的地址，这是 <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> 中的第二个（索引 <code class="docutils literal notranslate"><span class="pre">1</span></code> ）:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# cat target_ids
42 4242
# echo &quot;0   1       100
        0   100     200
        1   20      40
        1   50      100&quot; &gt; init_regions
</pre></div>
</div>
<p>请注意，这只是设置了初始的监测目标区域。在虚拟内存监测的情况下，DAMON会在一个 <code class="docutils literal notranslate"><span class="pre">更新间隔</span></code>
后自动更新区域的边界。因此，在这种情况下，如果用户不希望更新的话，应该把 <code class="docutils literal notranslate"><span class="pre">更新间隔</span></code> 设
置得足够大。</p>
</section>
<section id="id9">
<h3>方案<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>对于通常的基于DAMON的数据访问感知的内存管理优化，用户只是希望系统对特定访问模式的内存区域应用内
存管理操作。DAMON从用户那里接收这种形式化的操作方案，并将这些方案应用到目标进程中。</p>
<p>用户可以通过读取和写入 <code class="docutils literal notranslate"><span class="pre">scheme</span></code> debugfs文件来获得和设置这些方案。读取该文件还可以显示每个
方案的统计数据。在文件中，每一个方案都应该在每一行中以下列形式表示出来:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;target access pattern&gt; &lt;action&gt; &lt;quota&gt; &lt;watermarks&gt;
</pre></div>
</div>
<p>你可以通过简单地在文件中写入一个空字符串来禁用方案。</p>
<section id="id10">
<h4>目标访问模式<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">&lt;目标访问模式&gt;</span></code> 是由三个范围构成的，形式如下:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>min-size max-size min-acc max-acc min-age max-age
</pre></div>
</div>
<p>具体来说，区域大小的字节数（ <cite>min-size</cite> 和 <cite>max-size</cite> ），访问频率的每聚合区间的监测访问次
数（ <cite>min-acc</cite> 和 <cite>max-acc</cite> ），区域年龄的聚合区间数（ <cite>min-age</cite> 和 <cite>max-age</cite> ）都被指定。
请注意，这些范围是封闭区间。</p>
</section>
<section id="id11">
<h4>动作<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">&lt;action&gt;</span></code> 是一个预定义的内存管理动作的整数，DAMON将应用于具有目标访问模式的区域。支持
的数字和它们的含义如下:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- 0: Call ``madvise()`` for the region with ``MADV_WILLNEED``
- 1: Call ``madvise()`` for the region with ``MADV_COLD``
- 2: Call ``madvise()`` for the region with ``MADV_PAGEOUT``
- 3: Call ``madvise()`` for the region with ``MADV_HUGEPAGE``
- 4: Call ``madvise()`` for the region with ``MADV_NOHUGEPAGE``
- 5: Do nothing but count the statistics
</pre></div>
</div>
</section>
<section id="id12">
<h4>配额<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>每个 <code class="docutils literal notranslate"><span class="pre">动作</span></code> 的最佳 <code class="docutils literal notranslate"><span class="pre">目标访问模式</span></code> 取决于工作负载，所以不容易找到。更糟糕的是，将某个
动作的方案设置得过于激进会导致严重的开销。为了避免这种开销，用户可以通过下面表格中的 <code class="docutils literal notranslate"><span class="pre">&lt;quota&gt;</span></code>
来限制方案的时间和大小配额:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;ms&gt; &lt;sz&gt; &lt;reset interval&gt; &lt;priority weights&gt;
</pre></div>
</div>
<p>这使得DAMON在 <code class="docutils literal notranslate"><span class="pre">&lt;reset</span> <span class="pre">interval&gt;</span></code> 毫秒内，尽量只用 <code class="docutils literal notranslate"><span class="pre">&lt;ms&gt;</span></code> 毫秒的时间对 <code class="docutils literal notranslate"><span class="pre">目标访</span>
<span class="pre">问模式</span></code> 的内存区域应用动作，并在 <code class="docutils literal notranslate"><span class="pre">&lt;reset</span> <span class="pre">interval&gt;</span></code> 内只对最多&lt;sz&gt;字节的内存区域应
用动作。将 <code class="docutils literal notranslate"><span class="pre">&lt;ms&gt;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&lt;sz&gt;</span></code> 都设置为零，可以禁用配额限制。</p>
<p>当预计超过配额限制时，DAMON会根据 <code class="docutils literal notranslate"><span class="pre">目标访问模式</span></code> 的大小、访问频率和年龄，对发现的内存
区域进行优先排序。为了实现个性化的优先级，用户可以在 <code class="docutils literal notranslate"><span class="pre">&lt;优先级权重&gt;</span></code> 中设置这三个属性的
权重，具体形式如下:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;size weight&gt; &lt;access frequency weight&gt; &lt;age weight&gt;
</pre></div>
</div>
</section>
<section id="id13">
<h4>水位<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>有些方案需要根据系统特定指标的当前值来运行，如自由内存比率。对于这种情况，用户可以为该条
件指定水位。:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;metric&gt; &lt;check interval&gt; &lt;high mark&gt; &lt;middle mark&gt; &lt;low mark&gt;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;metric&gt;</span></code> 是一个预定义的整数，用于要检查的度量。支持的数字和它们的含义如下。</p>
<blockquote>
<div><ul class="simple">
<li><p>0: 忽视水位</p></li>
<li><p>1: 系统空闲内存率 (千分比)</p></li>
</ul>
</div></blockquote>
<p>每隔 <code class="docutils literal notranslate"><span class="pre">&lt;检查间隔&gt;</span></code> 微秒检查一次公制的值。</p>
<p>如果该值高于 <code class="docutils literal notranslate"><span class="pre">&lt;高标&gt;</span></code> 或低于 <code class="docutils literal notranslate"><span class="pre">&lt;低标&gt;</span></code> ，该方案被停用。如果该值低于 <code class="docutils literal notranslate"><span class="pre">&lt;中标&gt;</span></code> ，
该方案将被激活。</p>
</section>
<section id="id14">
<h4>统计数据<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>它还统计每个方案被尝试应用的区域的总数量和字节数，每个方案被成功应用的区域的两个数量，以
及超过配额限制的总数量。这些统计数据可用于在线分析或调整方案。</p>
<p>统计数据可以通过读取方案文件来显示。读取该文件将显示你在每一行中输入的每个 <code class="docutils literal notranslate"><span class="pre">方案</span></code> ，
统计的五个数字将被加在每一行的末尾。</p>
</section>
<section id="id15">
<h4>例子<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>下面的命令应用了一个方案：”如果一个大小为[4KiB, 8KiB]的内存区域在[10, 20]的聚合时间
间隔内显示出每一个聚合时间间隔[0, 5]的访问量，请分页出该区域。对于分页，每秒最多只能使
用10ms，而且每秒分页不能超过1GiB。在这一限制下，首先分页出具有较长年龄的内存区域。另外，
每5秒钟检查一次系统的可用内存率，当可用内存率低于50%时开始监测和分页，但如果可用内存率
大于60%，或低于30%，则停止监测“:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# scheme=&quot;4096 8192  0 5    10 20    2&quot;  # target access pattern and action
# scheme+=&quot; 10 $((1024*1024*1024)) 1000&quot; # quotas
# scheme+=&quot; 0 0 100&quot;                     # prioritization weights
# scheme+=&quot; 1 5000000 600 500 300&quot;       # watermarks
# echo &quot;$scheme&quot; &gt; schemes
</pre></div>
</div>
</section>
</section>
<section id="id16">
<h3>开关<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>除非你明确地启动监测，否则如上所述的文件设置不会产生效果。你可以通过写入和读取 <code class="docutils literal notranslate"><span class="pre">monitor_on</span></code>
文件来启动、停止和检查监测的当前状态。写入 <code class="docutils literal notranslate"><span class="pre">on</span></code> 该文件可以启动对有属性的目标的监测。写入
<code class="docutils literal notranslate"><span class="pre">off</span></code> 该文件则停止这些目标。如果每个目标进程被终止，DAMON也会停止。下面的示例命令开启、关
闭和检查DAMON的状态:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo on &gt; monitor_on
# echo off &gt; monitor_on
# cat monitor_on
off
</pre></div>
</div>
<p>请注意，当监测开启时，你不能写到上述的debugfs文件。如果你在DAMON运行时写到这些文件，将会返
回一个错误代码，如 <code class="docutils literal notranslate"><span class="pre">-EBUSY</span></code> 。</p>
</section>
<section id="pid">
<h3>监测线程PID<a class="headerlink" href="#pid" title="Permalink to this headline">¶</a></h3>
<p>DAMON通过一个叫做kdamond的内核线程来进行请求监测。你可以通过读取 <code class="docutils literal notranslate"><span class="pre">kdamond_pid</span></code> 文件获
得该线程的 <code class="docutils literal notranslate"><span class="pre">pid</span></code> 。当监测被 <code class="docutils literal notranslate"><span class="pre">关闭</span></code> 时，读取该文件不会返回任何信息:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# cat monitor_on
off
# cat kdamond_pid
none
# echo on &gt; monitor_on
# cat kdamond_pid
18594
</pre></div>
</div>
</section>
<section id="id17">
<h3>使用多个监测线程<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>每个监测上下文都会创建一个 <code class="docutils literal notranslate"><span class="pre">kdamond</span></code> 线程。你可以使用 <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code>
文件为多个 <code class="docutils literal notranslate"><span class="pre">kdamond</span></code> 需要的用例创建和删除监测上下文。</p>
<p>将新上下文的名称写入 <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> 文件，在 <code class="docutils literal notranslate"><span class="pre">DAMON</span> <span class="pre">debugfs</span></code> 目录上创建一个该名称的目录。
该目录将有该上下文的 <code class="docutils literal notranslate"><span class="pre">DAMON</span> <span class="pre">debugfs</span></code> 文件:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# ls foo
# ls: cannot access &#39;foo&#39;: No such file or directory
# echo foo &gt; mk_contexts
# ls foo
# attrs  init_regions  kdamond_pid  schemes  target_ids
</pre></div>
</div>
<p>如果不再需要上下文，你可以通过把上下文的名字放到 <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> 文件中来删除它和相应的目录:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo foo &gt; rm_contexts
# ls foo
# ls: cannot access &#39;foo&#39;: No such file or directory
</pre></div>
</div>
<p>注意， <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> 、 <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> 和 <code class="docutils literal notranslate"><span class="pre">monitor_on</span></code> 文件只在根目录下。</p>
</section>
</section>
<section id="id18">
<h2>监测结果的监测点<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>DAMON通过一个tracepoint <code class="docutils literal notranslate"><span class="pre">damon:damon_aggregated</span></code> 提供监测结果.  当监测开启时，你可
以记录追踪点事件，并使用追踪点支持工具如perf显示结果。比如说:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo on &gt; monitor_on
# perf record -e damon:damon_aggregated &amp;
# sleep 5
# kill 9 $(pidof perf)
# echo off &gt; monitor_on
# perf script
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">详细用法</a><ul>
<li><a class="reference internal" href="#sysfs">sysfs接口</a><ul>
<li><a class="reference internal" href="#id4">文件层次结构</a></li>
<li><a class="reference internal" href="#id5">根</a></li>
<li><a class="reference internal" href="#kdamonds">kdamonds/</a></li>
<li><a class="reference internal" href="#kdamonds-n">kdamonds/&lt;N&gt;/</a></li>
<li><a class="reference internal" href="#kdamonds-n-contexts">kdamonds/&lt;N&gt;/contexts/</a></li>
<li><a class="reference internal" href="#contexts-n">contexts/&lt;N&gt;/</a></li>
<li><a class="reference internal" href="#contexts-n-monitoring-attrs">contexts/&lt;N&gt;/monitoring_attrs/</a></li>
<li><a class="reference internal" href="#contexts-n-targets">contexts/&lt;N&gt;/targets/</a></li>
<li><a class="reference internal" href="#targets-n">targets/&lt;N&gt;/</a></li>
<li><a class="reference internal" href="#targets-n-regions">targets/&lt;N&gt;/regions</a></li>
<li><a class="reference internal" href="#regions-n">regions/&lt;N&gt;/</a></li>
<li><a class="reference internal" href="#contexts-n-schemes">contexts/&lt;N&gt;/schemes/</a></li>
<li><a class="reference internal" href="#schemes-n">schemes/&lt;N&gt;/</a></li>
<li><a class="reference internal" href="#schemes-n-access-pattern">schemes/&lt;N&gt;/access_pattern/</a></li>
<li><a class="reference internal" href="#schemes-n-quotas">schemes/&lt;N&gt;/quotas/</a></li>
<li><a class="reference internal" href="#schemes-n-watermarks">schemes/&lt;N&gt;/watermarks/</a></li>
<li><a class="reference internal" href="#schemes-n-stats">schemes/&lt;N&gt;/stats/</a><ul>
<li><a class="reference internal" href="#id6">用例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#debugfs">debugfs接口</a><ul>
<li><a class="reference internal" href="#id7">属性</a></li>
<li><a class="reference internal" href="#id">目标ID</a></li>
<li><a class="reference internal" href="#id8">初始监测目标区域</a></li>
<li><a class="reference internal" href="#id9">方案</a><ul>
<li><a class="reference internal" href="#id10">目标访问模式</a></li>
<li><a class="reference internal" href="#id11">动作</a></li>
<li><a class="reference internal" href="#id12">配额</a></li>
<li><a class="reference internal" href="#id13">水位</a></li>
<li><a class="reference internal" href="#id14">统计数据</a></li>
<li><a class="reference internal" href="#id15">例子</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16">开关</a></li>
<li><a class="reference internal" href="#pid">监测线程PID</a></li>
<li><a class="reference internal" href="#id17">使用多个监测线程</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18">监测结果的监测点</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../../_sources/translations/zh_CN/admin-guide/mm/damon/usage.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../../../_sources/translations/zh_CN/admin-guide/mm/damon/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>