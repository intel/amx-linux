
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Linux kernel coding style &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Subsystem and maintainer tree specific development process notes" href="maintainer-handbooks.html" />
    <link rel="prev" title="Programming Language" href="programming-language.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="linux-kernel-coding-style">
<span id="codingstyle"></span><h1>Linux kernel coding style<a class="headerlink" href="#linux-kernel-coding-style" title="Permalink to this headline">¶</a></h1>
<p>This is a short document describing the preferred coding style for the
linux kernel.  Coding style is very personal, and I won’t <strong>force</strong> my
views on anybody, but this is what goes for anything that I have to be
able to maintain, and I’d prefer it for most other things too.  Please
at least consider the points made here.</p>
<p>First off, I’d suggest printing out a copy of the GNU coding standards,
and NOT read it.  Burn them, it’s a great symbolic gesture.</p>
<p>Anyway, here goes:</p>
<section id="indentation">
<h2>1) Indentation<a class="headerlink" href="#indentation" title="Permalink to this headline">¶</a></h2>
<p>Tabs are 8 characters, and thus indentations are also 8 characters.
There are heretic movements that try to make indentations 4 (or even 2!)
characters deep, and that is akin to trying to define the value of PI to
be 3.</p>
<p>Rationale: The whole idea behind indentation is to clearly define where
a block of control starts and ends.  Especially when you’ve been looking
at your screen for 20 straight hours, you’ll find it a lot easier to see
how the indentation works if you have large indentations.</p>
<p>Now, some people will claim that having 8-character indentations makes
the code move too far to the right, and makes it hard to read on a
80-character terminal screen.  The answer to that is that if you need
more than 3 levels of indentation, you’re screwed anyway, and should fix
your program.</p>
<p>In short, 8-char indents make things easier to read, and have the added
benefit of warning you when you’re nesting your functions too deep.
Heed that warning.</p>
<p>The preferred way to ease multiple indentation levels in a switch statement is
to align the <code class="docutils literal notranslate"><span class="pre">switch</span></code> and its subordinate <code class="docutils literal notranslate"><span class="pre">case</span></code> labels in the same column
instead of <code class="docutils literal notranslate"><span class="pre">double-indenting</span></code> the <code class="docutils literal notranslate"><span class="pre">case</span></code> labels.  E.g.:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="sc">&#39;G&#39;</span><span class="o">:</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="sc">&#39;g&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">mem</span><span class="w"> </span><span class="o">&lt;&lt;=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="sc">&#39;M&#39;</span><span class="o">:</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="sc">&#39;m&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">mem</span><span class="w"> </span><span class="o">&lt;&lt;=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="sc">&#39;K&#39;</span><span class="o">:</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="sc">&#39;k&#39;</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">mem</span><span class="w"> </span><span class="o">&lt;&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">fallthrough</span><span class="p">;</span><span class="w"></span>
<span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Don’t put multiple statements on a single line unless you have
something to hide:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="n">do_this</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">do_something_everytime</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Don’t use commas to avoid using braces:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">do_this</span><span class="p">(),</span><span class="w"> </span><span class="n">do_that</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>Always uses braces for multiple statements:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">do_this</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">do_that</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Don’t put multiple assignments on a single line either.  Kernel coding style
is super simple.  Avoid tricky expressions.</p>
<p>Outside of comments, documentation and except in Kconfig, spaces are never
used for indentation, and the above example is deliberately broken.</p>
<p>Get a decent editor and don’t leave whitespace at the end of lines.</p>
</section>
<section id="breaking-long-lines-and-strings">
<h2>2) Breaking long lines and strings<a class="headerlink" href="#breaking-long-lines-and-strings" title="Permalink to this headline">¶</a></h2>
<p>Coding style is all about readability and maintainability using commonly
available tools.</p>
<p>The preferred limit on the length of a single line is 80 columns.</p>
<p>Statements longer than 80 columns should be broken into sensible chunks,
unless exceeding 80 columns significantly increases readability and does
not hide information.</p>
<p>Descendants are always substantially shorter than the parent and
are placed substantially to the right.  A very commonly used style
is to align descendants to a function open parenthesis.</p>
<p>These same rules are applied to function headers with a long argument list.</p>
<p>However, never break user-visible strings such as printk messages because
that breaks the ability to grep for them.</p>
</section>
<section id="placing-braces-and-spaces">
<h2>3) Placing Braces and Spaces<a class="headerlink" href="#placing-braces-and-spaces" title="Permalink to this headline">¶</a></h2>
<p>The other issue that always comes up in C styling is the placement of
braces.  Unlike the indent size, there are few technical reasons to
choose one placement strategy over the other, but the preferred way, as
shown to us by the prophets Kernighan and Ritchie, is to put the opening
brace last on the line, and put the closing brace first, thusly:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">we</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This applies to all non-function statement blocks (if, switch, for,
while, do).  E.g.:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="nl">KOBJ_ADD</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;add&quot;</span><span class="p">;</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="nl">KOBJ_REMOVE</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;remove&quot;</span><span class="p">;</span><span class="w"></span>
<span class="k">case</span><span class="w"> </span><span class="nl">KOBJ_CHANGE</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;change&quot;</span><span class="p">;</span><span class="w"></span>
<span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>However, there is one special case, namely functions: they have the
opening brace at the beginning of the next line, thus:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">body</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">function</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Heretic people all over the world have claimed that this inconsistency
is …  well …  inconsistent, but all right-thinking people know that
(a) K&amp;R are <strong>right</strong> and (b) K&amp;R are right.  Besides, functions are
special anyway (you can’t nest them in C).</p>
<p>Note that the closing brace is empty on a line of its own, <strong>except</strong> in
the cases where it is followed by a continuation of the same statement,
ie a <code class="docutils literal notranslate"><span class="pre">while</span></code> in a do-statement or an <code class="docutils literal notranslate"><span class="pre">else</span></code> in an if-statement, like
this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">body</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">do</span><span class="o">-</span><span class="n">loop</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">..</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">....</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Rationale: K&amp;R.</p>
<p>Also, note that this brace-placement also minimizes the number of empty
(or almost empty) lines, without any loss of readability.  Thus, as the
supply of new-lines on your screen is not a renewable resource (think
25-line terminal screens here), you have more empty lines to put
comments on.</p>
<p>Do not unnecessarily use braces where a single statement will do.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">action</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if (condition)
        do_this();
else
        do_that();
</pre></div>
</div>
<p>This does not apply if only one branch of a conditional statement is a single
statement; in the latter case use braces in both branches:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">do_this</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">do_that</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">otherwise</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Also, use braces when a loop contains more than a single simple statement:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">do_something</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="spaces">
<h3>3.1) Spaces<a class="headerlink" href="#spaces" title="Permalink to this headline">¶</a></h3>
<p>Linux kernel style for use of spaces depends (mostly) on
function-versus-keyword usage.  Use a space after (most) keywords.  The
notable exceptions are sizeof, typeof, alignof, and __attribute__, which look
somewhat like functions (and are usually used with parentheses in Linux,
although they are not required in the language, as in: <code class="docutils literal notranslate"><span class="pre">sizeof</span> <span class="pre">info</span></code> after
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">fileinfo</span> <span class="pre">info;</span></code> is declared).</p>
<p>So use a space after these keywords:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if, switch, case, for, do, while
</pre></div>
</div>
<p>but not with sizeof, typeof, alignof, or __attribute__.  E.g.,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="nc">file</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Do not add spaces around (inside) parenthesized expressions.  This example is
<strong>bad</strong>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="k">struct</span> <span class="nc">file</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>When declaring pointer data or a function that returns a pointer type, the
preferred use of <code class="docutils literal notranslate"><span class="pre">*</span></code> is adjacent to the data name or function name and not
adjacent to the type name.  Examples:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">linux_banner</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">memparse</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">retptr</span><span class="p">);</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">match_strdup</span><span class="p">(</span><span class="n">substring_t</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Use one space around (on each side of) most binary and ternary operators,
such as any of these:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>=  +  -  &lt;  &gt;  *  /  %  |  &amp;  ^  &lt;=  &gt;=  ==  !=  ?  :
</pre></div>
</div>
<p>but no space after unary operators:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&amp;  *  +  -  ~  !  sizeof  typeof  alignof  __attribute__  defined
</pre></div>
</div>
<p>no space before the postfix increment &amp; decrement unary operators:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>++  --
</pre></div>
</div>
<p>no space after the prefix increment &amp; decrement unary operators:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>++  --
</pre></div>
</div>
<p>and no space around the <code class="docutils literal notranslate"><span class="pre">.</span></code> and <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> structure member operators.</p>
<p>Do not leave trailing whitespace at the ends of lines.  Some editors with
<code class="docutils literal notranslate"><span class="pre">smart</span></code> indentation will insert whitespace at the beginning of new lines as
appropriate, so you can start typing the next line of code right away.
However, some such editors do not remove the whitespace if you end up not
putting a line of code there, such as if you leave a blank line.  As a result,
you end up with lines containing trailing whitespace.</p>
<p>Git will warn you about patches that introduce trailing whitespace, and can
optionally strip the trailing whitespace for you; however, if applying a series
of patches, this may make later patches in the series fail by changing their
context lines.</p>
</section>
</section>
<section id="naming">
<h2>4) Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h2>
<p>C is a Spartan language, and your naming conventions should follow suit.
Unlike Modula-2 and Pascal programmers, C programmers do not use cute
names like ThisVariableIsATemporaryCounter. A C programmer would call that
variable <code class="docutils literal notranslate"><span class="pre">tmp</span></code>, which is much easier to write, and not the least more
difficult to understand.</p>
<p>HOWEVER, while mixed-case names are frowned upon, descriptive names for
global variables are a must.  To call a global function <code class="docutils literal notranslate"><span class="pre">foo</span></code> is a
shooting offense.</p>
<p>GLOBAL variables (to be used only if you <strong>really</strong> need them) need to
have descriptive names, as do global functions.  If you have a function
that counts the number of active users, you should call that
<code class="docutils literal notranslate"><span class="pre">count_active_users()</span></code> or similar, you should <strong>not</strong> call it <code class="docutils literal notranslate"><span class="pre">cntusr()</span></code>.</p>
<p>Encoding the type of a function into the name (so-called Hungarian
notation) is asinine - the compiler knows the types anyway and can check
those, and it only confuses the programmer.</p>
<p>LOCAL variable names should be short, and to the point.  If you have
some random integer loop counter, it should probably be called <code class="docutils literal notranslate"><span class="pre">i</span></code>.
Calling it <code class="docutils literal notranslate"><span class="pre">loop_counter</span></code> is non-productive, if there is no chance of it
being mis-understood.  Similarly, <code class="docutils literal notranslate"><span class="pre">tmp</span></code> can be just about any type of
variable that is used to hold a temporary value.</p>
<p>If you are afraid to mix up your local variable names, you have another
problem, which is called the function-growth-hormone-imbalance syndrome.
See chapter 6 (Functions).</p>
<p>For symbol names and documentation, avoid introducing new usage of
‘master / slave’ (or ‘slave’ independent of ‘master’) and ‘blacklist /
whitelist’.</p>
<dl class="simple">
<dt>Recommended replacements for ‘master / slave’ are:</dt><dd><p>‘{primary,main} / {secondary,replica,subordinate}’
‘{initiator,requester} / {target,responder}’
‘{controller,host} / {device,worker,proxy}’
‘leader / follower’
‘director / performer’</p>
</dd>
<dt>Recommended replacements for ‘blacklist/whitelist’ are:</dt><dd><p>‘denylist / allowlist’
‘blocklist / passlist’</p>
</dd>
</dl>
<p>Exceptions for introducing new usage is to maintain a userspace ABI/API,
or when updating code for an existing (as of 2020) hardware or protocol
specification that mandates those terms. For new specifications
translate specification usage of the terminology to the kernel coding
standard where possible.</p>
</section>
<section id="typedefs">
<h2>5) Typedefs<a class="headerlink" href="#typedefs" title="Permalink to this headline">¶</a></h2>
<p>Please don’t use things like <code class="docutils literal notranslate"><span class="pre">vps_t</span></code>.
It’s a <strong>mistake</strong> to use typedef for structures and pointers. When you see a</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">vps_t</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>in the source, what does it mean?
In contrast, if it says</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nc">virtual_container</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>you can actually tell what <code class="docutils literal notranslate"><span class="pre">a</span></code> is.</p>
<p>Lots of people think that typedefs <code class="docutils literal notranslate"><span class="pre">help</span> <span class="pre">readability</span></code>. Not so. They are
useful only for:</p>
<blockquote>
<div><ol class="loweralpha">
<li><p>totally opaque objects (where the typedef is actively used to <strong>hide</strong>
what the object is).</p>
<p>Example: <code class="docutils literal notranslate"><span class="pre">pte_t</span></code> etc. opaque objects that you can only access using
the proper accessor functions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Opaqueness and <code class="docutils literal notranslate"><span class="pre">accessor</span> <span class="pre">functions</span></code> are not good in themselves.
The reason we have them for things like pte_t etc. is that there
really is absolutely <strong>zero</strong> portably accessible information there.</p>
</div>
</li>
<li><p>Clear integer types, where the abstraction <strong>helps</strong> avoid confusion
whether it is <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">long</span></code>.</p>
<p>u8/u16/u32 are perfectly fine typedefs, although they fit into
category (d) better than here.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Again - there needs to be a <strong>reason</strong> for this. If something is
<code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span></code>, then there’s no reason to do</p>
<blockquote>
<div><p>typedef unsigned long myflags_t;</p>
</div></blockquote>
</div>
<p>but if there is a clear reason for why it under certain circumstances
might be an <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code> and under other configurations might be
<code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span></code>, then by all means go ahead and use a typedef.</p>
</li>
<li><p>when you use sparse to literally create a <strong>new</strong> type for
type-checking.</p></li>
<li><p>New types which are identical to standard C99 types, in certain
exceptional circumstances.</p>
<p>Although it would only take a short amount of time for the eyes and
brain to become accustomed to the standard types like <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code>,
some people object to their use anyway.</p>
<p>Therefore, the Linux-specific <code class="docutils literal notranslate"><span class="pre">u8/u16/u32/u64</span></code> types and their
signed equivalents which are identical to standard types are
permitted – although they are not mandatory in new code of your
own.</p>
<p>When editing existing code which already uses one or the other set
of types, you should conform to the existing choices in that code.</p>
</li>
<li><p>Types safe for use in userspace.</p>
<p>In certain structures which are visible to userspace, we cannot
require C99 types and cannot use the <code class="docutils literal notranslate"><span class="pre">u32</span></code> form above. Thus, we
use __u32 and similar types in all structures which are shared
with userspace.</p>
</li>
</ol>
</div></blockquote>
<p>Maybe there are other cases too, but the rule should basically be to NEVER
EVER use a typedef unless you can clearly match one of those rules.</p>
<p>In general, a pointer, or a struct that has elements that can reasonably
be directly accessed should <strong>never</strong> be a typedef.</p>
</section>
<section id="functions">
<h2>6) Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>Functions should be short and sweet, and do just one thing.  They should
fit on one or two screenfuls of text (the ISO/ANSI screen size is 80x24,
as we all know), and do one thing and do that well.</p>
<p>The maximum length of a function is inversely proportional to the
complexity and indentation level of that function.  So, if you have a
conceptually simple function that is just one long (but simple)
case-statement, where you have to do lots of small things for a lot of
different cases, it’s OK to have a longer function.</p>
<p>However, if you have a complex function, and you suspect that a
less-than-gifted first-year high-school student might not even
understand what the function is all about, you should adhere to the
maximum limits all the more closely.  Use helper functions with
descriptive names (you can ask the compiler to in-line them if you think
it’s performance-critical, and it will probably do a better job of it
than you would have done).</p>
<p>Another measure of the function is the number of local variables.  They
shouldn’t exceed 5-10, or you’re doing something wrong.  Re-think the
function, and split it into smaller pieces.  A human brain can
generally easily keep track of about 7 different things, anything more
and it gets confused.  You know you’re brilliant, but maybe you’d like
to understand what you did 2 weeks from now.</p>
<p>In source files, separate functions with one blank line.  If the function is
exported, the <strong>EXPORT</strong> macro for it should follow immediately after the
closing function brace line.  E.g.:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">system_is_up</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">system_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SYSTEM_RUNNING</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">system_is_up</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<section id="function-prototypes">
<h3>6.1) Function prototypes<a class="headerlink" href="#function-prototypes" title="Permalink to this headline">¶</a></h3>
<p>In function prototypes, include parameter names with their data types.
Although this is not required by the C language, it is preferred in Linux
because it is a simple way to add valuable information for the reader.</p>
<p>Do not use the <code class="docutils literal notranslate"><span class="pre">extern</span></code> keyword with function declarations as this makes
lines longer and isn’t strictly necessary.</p>
<p>When writing function prototypes, please keep the <a class="reference external" href="https://lore.kernel.org/mm-commits/CAHk-=wiOCLRny5aifWNhr621kYrJwhfURsa0vFPeUEm8mF0ufg&#64;mail.gmail.com/">order of elements regular</a>.
For example, using this function declaration example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>__init void * __must_check action(enum magic value, size_t size, u8 count,
                                  char *fmt, ...) __printf(4, 5) __malloc;
</pre></div>
</div>
<p>The preferred order of elements for a function prototype is:</p>
<ul class="simple">
<li><p>storage class (below, <code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">__always_inline</span></code>, noting that <code class="docutils literal notranslate"><span class="pre">__always_inline</span></code>
is technically an attribute but is treated like <code class="docutils literal notranslate"><span class="pre">inline</span></code>)</p></li>
<li><p>storage class attributes (here, <code class="docutils literal notranslate"><span class="pre">__init</span></code> – i.e. section declarations, but also
things like <code class="docutils literal notranslate"><span class="pre">__cold</span></code>)</p></li>
<li><p>return type (here, <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code>)</p></li>
<li><p>return type attributes (here, <code class="docutils literal notranslate"><span class="pre">__must_check</span></code>)</p></li>
<li><p>function name (here, <code class="docutils literal notranslate"><span class="pre">action</span></code>)</p></li>
<li><p>function parameters (here, <code class="docutils literal notranslate"><span class="pre">(enum</span> <span class="pre">magic</span> <span class="pre">value,</span> <span class="pre">size_t</span> <span class="pre">size,</span> <span class="pre">u8</span> <span class="pre">count,</span> <span class="pre">char</span> <span class="pre">*fmt,</span> <span class="pre">...)</span></code>,
noting that parameter names should always be included)</p></li>
<li><p>function parameter attributes (here, <code class="docutils literal notranslate"><span class="pre">__printf(4,</span> <span class="pre">5)</span></code>)</p></li>
<li><p>function behavior attributes (here, <code class="docutils literal notranslate"><span class="pre">__malloc</span></code>)</p></li>
</ul>
<p>Note that for a function <strong>definition</strong> (i.e. the actual function body),
the compiler does not allow function parameter attributes after the
function parameters. In these cases, they should go after the storage
class attributes (e.g. note the changed position of <code class="docutils literal notranslate"><span class="pre">__printf(4,</span> <span class="pre">5)</span></code>
below, compared to the <strong>declaration</strong> example above):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static __always_inline __init __printf(4, 5) void * __must_check action(enum magic value,
               size_t size, u8 count, char *fmt, ...) __malloc
{
       ...
}
</pre></div>
</div>
</section>
</section>
<section id="centralized-exiting-of-functions">
<h2>7) Centralized exiting of functions<a class="headerlink" href="#centralized-exiting-of-functions" title="Permalink to this headline">¶</a></h2>
<p>Albeit deprecated by some people, the equivalent of the goto statement is
used frequently by compilers in form of the unconditional jump instruction.</p>
<p>The goto statement comes in handy when a function exits from multiple
locations and some common work such as cleanup has to be done.  If there is no
cleanup needed then just return directly.</p>
<p>Choose label names which say what the goto does or why the goto exists.  An
example of a good name could be <code class="docutils literal notranslate"><span class="pre">out_free_buffer:</span></code> if the goto frees <code class="docutils literal notranslate"><span class="pre">buffer</span></code>.
Avoid using GW-BASIC names like <code class="docutils literal notranslate"><span class="pre">err1:</span></code> and <code class="docutils literal notranslate"><span class="pre">err2:</span></code>, as you would have to
renumber them if you ever add or remove exit paths, and they make correctness
difficult to verify anyway.</p>
<p>The rationale for using gotos is:</p>
<ul class="simple">
<li><p>unconditional statements are easier to understand and follow</p></li>
<li><p>nesting is reduced</p></li>
<li><p>errors by not updating individual exit points when making
modifications are prevented</p></li>
<li><p>saves the compiler work to optimize redundant code away ;)</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">fun</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kmalloc</span><span class="p">(</span><span class="n">SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">GFP_KERNEL</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">buffer</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">condition1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">loop1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="p">...</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">goto</span><span class="w"> </span><span class="n">out_free_buffer</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="nl">out_free_buffer</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="n">kfree</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>A common type of bug to be aware of is <code class="docutils literal notranslate"><span class="pre">one</span> <span class="pre">err</span> <span class="pre">bugs</span></code> which look like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">err</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="n">kfree</span><span class="p">(</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">bar</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">kfree</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The bug in this code is that on some exit paths <code class="docutils literal notranslate"><span class="pre">foo</span></code> is NULL.  Normally the
fix for this is to split it up into two error labels <code class="docutils literal notranslate"><span class="pre">err_free_bar:</span></code> and
<code class="docutils literal notranslate"><span class="pre">err_free_foo:</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="nl">err_free_bar</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="n">kfree</span><span class="p">(</span><span class="n">foo</span><span class="o">-&gt;</span><span class="n">bar</span><span class="p">);</span><span class="w"></span>
<span class="nl">err_free_foo</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="n">kfree</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Ideally you should simulate errors to test all exit paths.</p>
</section>
<section id="commenting">
<h2>8) Commenting<a class="headerlink" href="#commenting" title="Permalink to this headline">¶</a></h2>
<p>Comments are good, but there is also a danger of over-commenting.  NEVER
try to explain HOW your code works in a comment: it’s much better to
write the code so that the <strong>working</strong> is obvious, and it’s a waste of
time to explain badly written code.</p>
<p>Generally, you want your comments to tell WHAT your code does, not HOW.
Also, try to avoid putting comments inside a function body: if the
function is so complex that you need to separately comment parts of it,
you should probably go back to chapter 6 for a while.  You can make
small comments to note or warn about something particularly clever (or
ugly), but try to avoid excess.  Instead, put the comments at the head
of the function, telling people what it does, and possibly WHY it does
it.</p>
<p>When commenting the kernel API functions, please use the kernel-doc format.
See the files at <a class="reference internal" href="../doc-guide/index.html#doc-guide"><span class="std std-ref">Documentation/doc-guide/</span></a> and
<code class="docutils literal notranslate"><span class="pre">scripts/kernel-doc</span></code> for details.</p>
<p>The preferred style for long (multi-line) comments is:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * This is the preferred style for multi-line</span>
<span class="cm"> * comments in the Linux kernel source code.</span>
<span class="cm"> * Please use it consistently.</span>
<span class="cm"> *</span>
<span class="cm"> * Description:  A column of asterisks on the left side,</span>
<span class="cm"> * with beginning and ending almost-blank lines.</span>
<span class="cm"> */</span><span class="w"></span>
</pre></div>
</div>
<p>For files in net/ and drivers/net/ the preferred style for long (multi-line)
comments is a little different.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* The preferred comment style for files in net/ and drivers/net</span>
<span class="cm"> * looks like this.</span>
<span class="cm"> *</span>
<span class="cm"> * It is nearly the same as the generally preferred comment style,</span>
<span class="cm"> * but there is no initial almost-blank line.</span>
<span class="cm"> */</span><span class="w"></span>
</pre></div>
</div>
<p>It’s also important to comment data, whether they are basic types or derived
types.  To this end, use just one data declaration per line (no commas for
multiple data declarations).  This leaves you room for a small comment on each
item, explaining its use.</p>
</section>
<section id="you-ve-made-a-mess-of-it">
<h2>9) You’ve made a mess of it<a class="headerlink" href="#you-ve-made-a-mess-of-it" title="Permalink to this headline">¶</a></h2>
<p>That’s OK, we all do.  You’ve probably been told by your long-time Unix
user helper that <code class="docutils literal notranslate"><span class="pre">GNU</span> <span class="pre">emacs</span></code> automatically formats the C sources for
you, and you’ve noticed that yes, it does do that, but the defaults it
uses are less than desirable (in fact, they are worse than random
typing - an infinite number of monkeys typing into GNU emacs would never
make a good program).</p>
<p>So, you can either get rid of GNU emacs, or change it to use saner
values.  To do the latter, you can stick the following in your .emacs file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(defun c-lineup-arglist-tabs-only (ignored)
  &quot;Line up argument lists by tabs, not spaces&quot;
  (let* ((anchor (c-langelem-pos c-syntactic-element))
         (column (c-langelem-2nd-pos c-syntactic-element))
         (offset (- (1+ column) anchor))
         (steps (floor offset c-basic-offset)))
    (* (max steps 1)
       c-basic-offset)))

(dir-locals-set-class-variables
 &#39;linux-kernel
 &#39;((c-mode . (
        (c-basic-offset . 8)
        (c-label-minimum-indentation . 0)
        (c-offsets-alist . (
                (arglist-close         . c-lineup-arglist-tabs-only)
                (arglist-cont-nonempty .
                    (c-lineup-gcc-asm-reg c-lineup-arglist-tabs-only))
                (arglist-intro         . +)
                (brace-list-intro      . +)
                (c                     . c-lineup-C-comments)
                (case-label            . 0)
                (comment-intro         . c-lineup-comment)
                (cpp-define-intro      . +)
                (cpp-macro             . -1000)
                (cpp-macro-cont        . +)
                (defun-block-intro     . +)
                (else-clause           . 0)
                (func-decl-cont        . +)
                (inclass               . +)
                (inher-cont            . c-lineup-multi-inher)
                (knr-argdecl-intro     . 0)
                (label                 . -1000)
                (statement             . 0)
                (statement-block-intro . +)
                (statement-case-intro  . +)
                (statement-cont        . +)
                (substatement          . +)
                ))
        (indent-tabs-mode . t)
        (show-trailing-whitespace . t)
        ))))

(dir-locals-set-directory-class
 (expand-file-name &quot;~/src/linux-trees&quot;)
 &#39;linux-kernel)
</pre></div>
</div>
<p>This will make emacs go better with the kernel coding style for C
files below <code class="docutils literal notranslate"><span class="pre">~/src/linux-trees</span></code>.</p>
<p>But even if you fail in getting emacs to do sane formatting, not
everything is lost: use <code class="docutils literal notranslate"><span class="pre">indent</span></code>.</p>
<p>Now, again, GNU indent has the same brain-dead settings that GNU emacs
has, which is why you need to give it a few command line options.
However, that’s not too bad, because even the makers of GNU indent
recognize the authority of K&amp;R (the GNU people aren’t evil, they are
just severely misguided in this matter), so you just give indent the
options <code class="docutils literal notranslate"><span class="pre">-kr</span> <span class="pre">-i8</span></code> (stands for <code class="docutils literal notranslate"><span class="pre">K&amp;R,</span> <span class="pre">8</span> <span class="pre">character</span> <span class="pre">indents</span></code>), or use
<code class="docutils literal notranslate"><span class="pre">scripts/Lindent</span></code>, which indents in the latest style.</p>
<p><code class="docutils literal notranslate"><span class="pre">indent</span></code> has a lot of options, and especially when it comes to comment
re-formatting you may want to take a look at the man page.  But
remember: <code class="docutils literal notranslate"><span class="pre">indent</span></code> is not a fix for bad programming.</p>
<p>Note that you can also use the <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> tool to help you with
these rules, to quickly re-format parts of your code automatically,
and to review full files in order to spot coding style mistakes,
typos and possible improvements. It is also handy for sorting <code class="docutils literal notranslate"><span class="pre">#includes</span></code>,
for aligning variables/macros, for reflowing text and other similar tasks.
See the file <a class="reference internal" href="clang-format.html#clangformat"><span class="std std-ref">Documentation/process/clang-format.rst</span></a>
for more details.</p>
</section>
<section id="kconfig-configuration-files">
<h2>10) Kconfig configuration files<a class="headerlink" href="#kconfig-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>For all of the Kconfig* configuration files throughout the source tree,
the indentation is somewhat different.  Lines under a <code class="docutils literal notranslate"><span class="pre">config</span></code> definition
are indented with one tab, while help text is indented an additional two
spaces.  Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config AUDIT
      bool &quot;Auditing support&quot;
      depends on NET
      help
        Enable auditing infrastructure that can be used with another
        kernel subsystem, such as SELinux (which requires this for
        logging of avc messages output).  Does not do system-call
        auditing without CONFIG_AUDITSYSCALL.
</pre></div>
</div>
<p>Seriously dangerous features (such as write support for certain
filesystems) should advertise this prominently in their prompt string:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config ADFS_FS_RW
      bool &quot;ADFS write support (DANGEROUS)&quot;
      depends on ADFS_FS
      ...
</pre></div>
</div>
<p>For full documentation on the configuration files, see the file
<a class="reference internal" href="../kbuild/kconfig-language.html"><span class="doc">Kconfig Language</span></a>.</p>
</section>
<section id="data-structures">
<h2>11) Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h2>
<p>Data structures that have visibility outside the single-threaded
environment they are created and destroyed in should always have
reference counts.  In the kernel, garbage collection doesn’t exist (and
outside the kernel garbage collection is slow and inefficient), which
means that you absolutely <strong>have</strong> to reference count all your uses.</p>
<p>Reference counting means that you can avoid locking, and allows multiple
users to have access to the data structure in parallel - and not having
to worry about the structure suddenly going away from under them just
because they slept or did something else for a while.</p>
<p>Note that locking is <strong>not</strong> a replacement for reference counting.
Locking is used to keep data structures coherent, while reference
counting is a memory management technique.  Usually both are needed, and
they are not to be confused with each other.</p>
<p>Many data structures can indeed have two levels of reference counting,
when there are users of different <code class="docutils literal notranslate"><span class="pre">classes</span></code>.  The subclass count counts
the number of subclass users, and decrements the global count just once
when the subclass count goes to zero.</p>
<p>Examples of this kind of <code class="docutils literal notranslate"><span class="pre">multi-level-reference-counting</span></code> can be found in
memory management (<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mm_struct</span></code>: mm_users and mm_count), and in
filesystem code (<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">super_block</span></code>: s_count and s_active).</p>
<p>Remember: if another thread can find your data structure, and you don’t
have a reference count on it, you almost certainly have a bug.</p>
</section>
<section id="macros-enums-and-rtl">
<h2>12) Macros, Enums and RTL<a class="headerlink" href="#macros-enums-and-rtl" title="Permalink to this headline">¶</a></h2>
<p>Names of macros defining constants and labels in enums are capitalized.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CONSTANT 0x12345</span>
</pre></div>
</div>
<p>Enums are preferred when defining several related constants.</p>
<p>CAPITALIZED macro names are appreciated but macros resembling functions
may be named in lower case.</p>
<p>Generally, inline functions are preferable to macros resembling functions.</p>
<p>Macros with multiple statements should be enclosed in a do - while block:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define macrofun(a, b, c)                       \</span>
<span class="cp">        do {                                    \</span>
<span class="cp">                if (a == 5)                     \</span>
<span class="cp">                        do_this(b, c);          \</span>
<span class="cp">        } while (0)</span>
</pre></div>
</div>
<p>Things to avoid when using macros:</p>
<ol class="arabic simple">
<li><p>macros that affect control flow:</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define FOO(x)                                  \</span>
<span class="cp">        do {                                    \</span>
<span class="cp">                if (blah(x) &lt; 0)                \</span>
<span class="cp">                        return -EBUGGERED;      \</span>
<span class="cp">        } while (0)</span>
</pre></div>
</div>
<p>is a <strong>very</strong> bad idea.  It looks like a function call but exits the <code class="docutils literal notranslate"><span class="pre">calling</span></code>
function; don’t break the internal parsers of those who will read the code.</p>
<ol class="arabic simple" start="2">
<li><p>macros that depend on having a local variable with a magic name:</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define FOO(val) bar(index, val)</span>
</pre></div>
</div>
<p>might look like a good thing, but it’s confusing as hell when one reads the
code and it’s prone to breakage from seemingly innocent changes.</p>
<p>3) macros with arguments that are used as l-values: FOO(x) = y; will
bite you if somebody e.g. turns FOO into an inline function.</p>
<p>4) forgetting about precedence: macros defining constants using expressions
must enclose the expression in parentheses. Beware of similar issues with
macros using parameters.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CONSTANT 0x4000</span>
<span class="cp">#define CONSTEXP (CONSTANT | 3)</span>
</pre></div>
</div>
<p>5) namespace collisions when defining local variables in macros resembling
functions:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define FOO(x)                          \</span>
<span class="cp">({                                      \</span>
<span class="cp">        typeof(x) ret;                  \</span>
<span class="cp">        ret = calc_ret(x);              \</span>
<span class="cp">        (ret);                          \</span>
<span class="cp">})</span>
</pre></div>
</div>
<p>ret is a common name for a local variable - __foo_ret is less likely
to collide with an existing variable.</p>
<p>The cpp manual deals with macros exhaustively. The gcc internals manual also
covers RTL which is used frequently with assembly language in the kernel.</p>
</section>
<section id="printing-kernel-messages">
<h2>13) Printing kernel messages<a class="headerlink" href="#printing-kernel-messages" title="Permalink to this headline">¶</a></h2>
<p>Kernel developers like to be seen as literate. Do mind the spelling
of kernel messages to make a good impression. Do not use incorrect
contractions like <code class="docutils literal notranslate"><span class="pre">dont</span></code>; use <code class="docutils literal notranslate"><span class="pre">do</span> <span class="pre">not</span></code> or <code class="docutils literal notranslate"><span class="pre">don't</span></code> instead. Make the
messages concise, clear, and unambiguous.</p>
<p>Kernel messages do not have to be terminated with a period.</p>
<p>Printing numbers in parentheses (%d) adds no value and should be avoided.</p>
<p>There are a number of driver model diagnostic macros in &lt;linux/dev_printk.h&gt;
which you should use to make sure messages are matched to the right device
and driver, and are tagged with the right level:  dev_err(), dev_warn(),
dev_info(), and so forth.  For messages that aren’t associated with a
particular device, &lt;linux/printk.h&gt; defines <a class="reference internal" href="../core-api/printk-basics.html#c.pr_notice" title="pr_notice"><code class="xref c c-func docutils literal notranslate"><span class="pre">pr_notice()</span></code></a>, <a class="reference internal" href="../core-api/printk-basics.html#c.pr_info" title="pr_info"><code class="xref c c-func docutils literal notranslate"><span class="pre">pr_info()</span></code></a>,
<a class="reference internal" href="../core-api/printk-basics.html#c.pr_warn" title="pr_warn"><code class="xref c c-func docutils literal notranslate"><span class="pre">pr_warn()</span></code></a>, <a class="reference internal" href="../core-api/printk-basics.html#c.pr_err" title="pr_err"><code class="xref c c-func docutils literal notranslate"><span class="pre">pr_err()</span></code></a>, etc.</p>
<p>Coming up with good debugging messages can be quite a challenge; and once
you have them, they can be a huge help for remote troubleshooting.  However
debug message printing is handled differently than printing other non-debug
messages.  While the other pr_XXX() functions print unconditionally,
<a class="reference internal" href="../core-api/printk-basics.html#c.pr_debug" title="pr_debug"><code class="xref c c-func docutils literal notranslate"><span class="pre">pr_debug()</span></code></a> does not; it is compiled out by default, unless either DEBUG is
defined or CONFIG_DYNAMIC_DEBUG is set.  That is true for dev_dbg() also,
and a related convention uses VERBOSE_DEBUG to add dev_vdbg() messages to
the ones already enabled by DEBUG.</p>
<p>Many subsystems have Kconfig debug options to turn on -DDEBUG in the
corresponding Makefile; in other cases specific files #define DEBUG.  And
when a debug message should be unconditionally printed, such as if it is
already inside a debug-related #ifdef section, printk(KERN_DEBUG …) can be
used.</p>
</section>
<section id="allocating-memory">
<h2>14) Allocating memory<a class="headerlink" href="#allocating-memory" title="Permalink to this headline">¶</a></h2>
<p>The kernel provides the following general purpose memory allocators:
<a class="reference internal" href="../core-api/mm-api.html#c.kmalloc" title="kmalloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">kmalloc()</span></code></a>, <a class="reference internal" href="../core-api/mm-api.html#c.kzalloc" title="kzalloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">kzalloc()</span></code></a>, <a class="reference internal" href="../core-api/mm-api.html#c.kmalloc_array" title="kmalloc_array"><code class="xref c c-func docutils literal notranslate"><span class="pre">kmalloc_array()</span></code></a>, <a class="reference internal" href="../core-api/mm-api.html#c.kcalloc" title="kcalloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">kcalloc()</span></code></a>, <a class="reference internal" href="../core-api/mm-api.html#c.vmalloc" title="vmalloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">vmalloc()</span></code></a>, and
<a class="reference internal" href="../core-api/mm-api.html#c.vzalloc" title="vzalloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">vzalloc()</span></code></a>.  Please refer to the API documentation for further information
about them.  <a class="reference internal" href="../core-api/memory-allocation.html#memory-allocation"><span class="std std-ref">Documentation/core-api/memory-allocation.rst</span></a></p>
<p>The preferred form for passing a size of a struct is the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="p">...);</span><span class="w"></span>
</pre></div>
</div>
<p>The alternative form where struct name is spelled out hurts readability and
introduces an opportunity for a bug when the pointer variable type is changed
but the corresponding sizeof that is passed to a memory allocator is not.</p>
<p>Casting the return value which is a void pointer is redundant. The conversion
from void pointer to any other pointer type is guaranteed by the C programming
language.</p>
<p>The preferred form for allocating an array is the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kmalloc_array</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(...),</span><span class="w"> </span><span class="p">...);</span><span class="w"></span>
</pre></div>
</div>
<p>The preferred form for allocating a zeroed array is the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kcalloc</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(...),</span><span class="w"> </span><span class="p">...);</span><span class="w"></span>
</pre></div>
</div>
<p>Both forms check for overflow on the allocation size n * sizeof(…),
and return NULL if that occurred.</p>
<p>These generic allocation functions all emit a stack dump on failure when used
without __GFP_NOWARN so there is no use in emitting an additional failure
message when NULL is returned.</p>
</section>
<section id="the-inline-disease">
<h2>15) The inline disease<a class="headerlink" href="#the-inline-disease" title="Permalink to this headline">¶</a></h2>
<p>There appears to be a common misperception that gcc has a magic “make me
faster” speedup option called <code class="docutils literal notranslate"><span class="pre">inline</span></code>. While the use of inlines can be
appropriate (for example as a means of replacing macros, see Chapter 12), it
very often is not. Abundant use of the inline keyword leads to a much bigger
kernel, which in turn slows the system as a whole down, due to a bigger
icache footprint for the CPU and simply because there is less memory
available for the pagecache. Just think about it; a pagecache miss causes a
disk seek, which easily takes 5 milliseconds. There are a LOT of cpu cycles
that can go into these 5 milliseconds.</p>
<p>A reasonable rule of thumb is to not put inline at functions that have more
than 3 lines of code in them. An exception to this rule are the cases where
a parameter is known to be a compiletime constant, and as a result of this
constantness you <em>know</em> the compiler will be able to optimize most of your
function away at compile time. For a good example of this later case, see
the <a class="reference internal" href="../core-api/mm-api.html#c.kmalloc" title="kmalloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">kmalloc()</span></code></a> inline function.</p>
<p>Often people argue that adding inline to functions that are static and used
only once is always a win since there is no space tradeoff. While this is
technically correct, gcc is capable of inlining these automatically without
help, and the maintenance issue of removing the inline when a second user
appears outweighs the potential value of the hint that tells gcc to do
something it would have done anyway.</p>
</section>
<section id="function-return-values-and-names">
<h2>16) Function return values and names<a class="headerlink" href="#function-return-values-and-names" title="Permalink to this headline">¶</a></h2>
<p>Functions can return values of many different kinds, and one of the
most common is a value indicating whether the function succeeded or
failed.  Such a value can be represented as an error-code integer
(-Exxx = failure, 0 = success) or a <code class="docutils literal notranslate"><span class="pre">succeeded</span></code> boolean (0 = failure,
non-zero = success).</p>
<p>Mixing up these two sorts of representations is a fertile source of
difficult-to-find bugs.  If the C language included a strong distinction
between integers and booleans then the compiler would find these mistakes
for us… but it doesn’t.  To help prevent such bugs, always follow this
convention:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>If the name of a function is an action or an imperative command,
the function should return an error-code integer.  If the name
is a predicate, the function should return a &quot;succeeded&quot; boolean.
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">add</span> <span class="pre">work</span></code> is a command, and the add_work() function returns 0
for success or -EBUSY for failure.  In the same way, <code class="docutils literal notranslate"><span class="pre">PCI</span> <span class="pre">device</span> <span class="pre">present</span></code> is
a predicate, and the <a class="reference internal" href="../driver-api/pci/pci.html#c.pci_dev_present" title="pci_dev_present"><code class="xref c c-func docutils literal notranslate"><span class="pre">pci_dev_present()</span></code></a> function returns 1 if it succeeds in
finding a matching device or 0 if it doesn’t.</p>
<p>All EXPORTed functions must respect this convention, and so should all
public functions.  Private (static) functions need not, but it is
recommended that they do.</p>
<p>Functions whose return value is the actual result of a computation, rather
than an indication of whether the computation succeeded, are not subject to
this rule.  Generally they indicate failure by returning some out-of-range
result.  Typical examples would be functions that return pointers; they use
NULL or the ERR_PTR mechanism to report failure.</p>
</section>
<section id="using-bool">
<h2>17) Using bool<a class="headerlink" href="#using-bool" title="Permalink to this headline">¶</a></h2>
<p>The Linux kernel bool type is an alias for the C99 _Bool type. bool values can
only evaluate to 0 or 1, and implicit or explicit conversion to bool
automatically converts the value to true or false. When using bool types the
!! construction is not needed, which eliminates a class of bugs.</p>
<p>When working with bool values the true and false definitions should be used
instead of 1 and 0.</p>
<p>bool function return types and stack variables are always fine to use whenever
appropriate. Use of bool is encouraged to improve readability and is often a
better option than ‘int’ for storing boolean values.</p>
<p>Do not use bool if cache line layout or size of the value matters, as its size
and alignment varies based on the compiled architecture. Structures that are
optimized for alignment and size should not use bool.</p>
<p>If a structure has many true/false values, consider consolidating them into a
bitfield with 1 bit members, or using an appropriate fixed width type, such as
u8.</p>
<p>Similarly for function arguments, many true/false values can be consolidated
into a single bitwise ‘flags’ argument and ‘flags’ can often be a more
readable alternative if the call-sites have naked true/false constants.</p>
<p>Otherwise limited use of bool in structures and arguments can improve
readability.</p>
</section>
<section id="don-t-re-invent-the-kernel-macros">
<h2>18) Don’t re-invent the kernel macros<a class="headerlink" href="#don-t-re-invent-the-kernel-macros" title="Permalink to this headline">¶</a></h2>
<p>The header file include/linux/kernel.h contains a number of macros that
you should use, rather than explicitly coding some variant of them yourself.
For example, if you need to calculate the length of an array, take advantage
of the macro</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define ARRAY_SIZE(x) (sizeof(x) / sizeof((x)[0]))</span>
</pre></div>
</div>
<p>Similarly, if you need to calculate the size of some structure member, use</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define sizeof_field(t, f) (sizeof(((t*)0)-&gt;f))</span>
</pre></div>
</div>
<p>There are also min() and max() macros that do strict type checking if you
need them.  Feel free to peruse that header file to see what else is already
defined that you shouldn’t reproduce in your code.</p>
</section>
<section id="editor-modelines-and-other-cruft">
<h2>19) Editor modelines and other cruft<a class="headerlink" href="#editor-modelines-and-other-cruft" title="Permalink to this headline">¶</a></h2>
<p>Some editors can interpret configuration information embedded in source files,
indicated with special markers.  For example, emacs interprets lines marked
like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">-*-</span><span class="w"> </span><span class="nl">mode</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">-*-</span><span class="w"></span>
</pre></div>
</div>
<p>Or like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">Local Variables:</span>
<span class="cm">compile-command: &quot;gcc -DMAGIC_DEBUG_FLAG foo.c&quot;</span>
<span class="cm">End:</span>
<span class="cm">*/</span><span class="w"></span>
</pre></div>
</div>
<p>Vim interprets markers that look like this:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* vim:set sw=8 noet */</span><span class="w"></span>
</pre></div>
</div>
<p>Do not include any of these in source files.  People have their own personal
editor configurations, and your source files should not override them.  This
includes markers for indentation and mode configuration.  People may use their
own custom mode, or may have some other magic method for making indentation
work correctly.</p>
</section>
<section id="inline-assembly">
<h2>20) Inline assembly<a class="headerlink" href="#inline-assembly" title="Permalink to this headline">¶</a></h2>
<p>In architecture-specific code, you may need to use inline assembly to interface
with CPU or platform functionality.  Don’t hesitate to do so when necessary.
However, don’t use inline assembly gratuitously when C can do the job.  You can
and should poke hardware from C when possible.</p>
<p>Consider writing simple helper functions that wrap common bits of inline
assembly, rather than repeatedly writing them with slight variations.  Remember
that inline assembly can use C parameters.</p>
<p>Large, non-trivial assembly functions should go in .S files, with corresponding
C prototypes defined in C header files.  The C prototypes for assembly
functions should use <code class="docutils literal notranslate"><span class="pre">asmlinkage</span></code>.</p>
<p>You may need to mark your asm statement as volatile, to prevent GCC from
removing it if GCC doesn’t notice any side effects.  You don’t always need to
do so, though, and doing so unnecessarily can limit optimization.</p>
<p>When writing a single inline assembly statement containing multiple
instructions, put each instruction on a separate line in a separate quoted
string, and end each string except the last with <code class="docutils literal notranslate"><span class="pre">\n\t</span></code> to properly indent
the next instruction in the assembly output:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">asm</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;magic %reg1, #42</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">     </span><span class="s">&quot;more_magic %reg2, %reg3&quot;</span><span class="w"></span>
<span class="w">     </span><span class="o">:</span><span class="w"> </span><span class="cm">/* outputs */</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="cm">/* inputs */</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="cm">/* clobbers */</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="conditional-compilation">
<h2>21) Conditional Compilation<a class="headerlink" href="#conditional-compilation" title="Permalink to this headline">¶</a></h2>
<p>Wherever possible, don’t use preprocessor conditionals (#if, #ifdef) in .c
files; doing so makes code harder to read and logic harder to follow.  Instead,
use such conditionals in a header file defining functions for use in those .c
files, providing no-op stub versions in the #else case, and then call those
functions unconditionally from .c files.  The compiler will avoid generating
any code for the stub calls, producing identical results, but the logic will
remain easy to follow.</p>
<p>Prefer to compile out entire functions, rather than portions of functions or
portions of expressions.  Rather than putting an ifdef in an expression, factor
out part or all of the expression into a separate helper function and apply the
conditional to that function.</p>
<p>If you have a function or variable which may potentially go unused in a
particular configuration, and the compiler would warn about its definition
going unused, mark the definition as __maybe_unused rather than wrapping it in
a preprocessor conditional.  (However, if a function or variable <em>always</em> goes
unused, delete it.)</p>
<p>Within code, where possible, use the IS_ENABLED macro to convert a Kconfig
symbol into a C boolean expression, and use it in a normal C conditional:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IS_ENABLED</span><span class="p">(</span><span class="n">CONFIG_SOMETHING</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The compiler will constant-fold the conditional away, and include or exclude
the block of code just as with an #ifdef, so this will not add any runtime
overhead.  However, this approach still allows the C compiler to see the code
inside the block, and check it for correctness (syntax, types, symbol
references, etc).  Thus, you still have to use an #ifdef if the code inside the
block references symbols that will not exist if the condition is not met.</p>
<p>At the end of any non-trivial #if or #ifdef block (more than a few lines),
place a comment after the #endif on the same line, noting the conditional
expression used.  For instance:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef CONFIG_SOMETHING</span>
<span class="p">...</span><span class="w"></span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_SOMETHING */</span><span class="cp"></span>
</pre></div>
</div>
</section>
<section id="do-not-crash-the-kernel">
<h2>22) Do not crash the kernel<a class="headerlink" href="#do-not-crash-the-kernel" title="Permalink to this headline">¶</a></h2>
<p>In general, the decision to crash the kernel belongs to the user, rather
than to the kernel developer.</p>
<section id="avoid-panic">
<h3>Avoid panic()<a class="headerlink" href="#avoid-panic" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../driver-api/basics.html#c.panic" title="panic"><code class="xref c c-func docutils literal notranslate"><span class="pre">panic()</span></code></a> should be used with care and primarily only during system boot.
<a class="reference internal" href="../driver-api/basics.html#c.panic" title="panic"><code class="xref c c-func docutils literal notranslate"><span class="pre">panic()</span></code></a> is, for example, acceptable when running out of memory during boot and
not being able to continue.</p>
</section>
<section id="use-warn-rather-than-bug">
<h3>Use WARN() rather than BUG()<a class="headerlink" href="#use-warn-rather-than-bug" title="Permalink to this headline">¶</a></h3>
<p>Do not add new code that uses any of the BUG() variants, such as BUG(),
BUG_ON(), or VM_BUG_ON(). Instead, use a WARN*() variant, preferably
WARN_ON_ONCE(), and possibly with recovery code. Recovery code is not
required if there is no reasonable way to at least partially recover.</p>
<p>“I’m too lazy to do error handling” is not an excuse for using BUG(). Major
internal corruptions with no way of continuing may still use BUG(), but need
good justification.</p>
</section>
<section id="use-warn-on-once-rather-than-warn-or-warn-on">
<h3>Use WARN_ON_ONCE() rather than WARN() or WARN_ON()<a class="headerlink" href="#use-warn-on-once-rather-than-warn-or-warn-on" title="Permalink to this headline">¶</a></h3>
<p>WARN_ON_ONCE() is generally preferred over WARN() or WARN_ON(), because it
is common for a given warning condition, if it occurs at all, to occur
multiple times. This can fill up and wrap the kernel log, and can even slow
the system enough that the excessive logging turns into its own, additional
problem.</p>
</section>
<section id="do-not-warn-lightly">
<h3>Do not WARN lightly<a class="headerlink" href="#do-not-warn-lightly" title="Permalink to this headline">¶</a></h3>
<p>WARN*() is intended for unexpected, this-should-never-happen situations.
WARN*() macros are not to be used for anything that is expected to happen
during normal operation. These are not pre- or post-condition asserts, for
example. Again: WARN*() must not be used for a condition that is expected
to trigger easily, for example, by user space actions. pr_warn_once() is a
possible alternative, if you need to notify the user of a problem.</p>
</section>
<section id="do-not-worry-about-panic-on-warn-users">
<h3>Do not worry about panic_on_warn users<a class="headerlink" href="#do-not-worry-about-panic-on-warn-users" title="Permalink to this headline">¶</a></h3>
<p>A few more words about panic_on_warn: Remember that <code class="docutils literal notranslate"><span class="pre">panic_on_warn</span></code> is an
available kernel option, and that many users set this option. This is why
there is a “Do not WARN lightly” writeup, above. However, the existence of
panic_on_warn users is not a valid reason to avoid the judicious use
WARN*(). That is because, whoever enables panic_on_warn has explicitly
asked the kernel to crash if a WARN*() fires, and such users must be
prepared to deal with the consequences of a system that is somewhat more
likely to crash.</p>
</section>
<section id="use-build-bug-on-for-compile-time-assertions">
<h3>Use BUILD_BUG_ON() for compile-time assertions<a class="headerlink" href="#use-build-bug-on-for-compile-time-assertions" title="Permalink to this headline">¶</a></h3>
<p>The use of BUILD_BUG_ON() is acceptable and encouraged, because it is a
compile-time assertion that has no effect at runtime.</p>
</section>
</section>
<section id="appendix-i-references">
<h2>Appendix I) References<a class="headerlink" href="#appendix-i-references" title="Permalink to this headline">¶</a></h2>
<p>The C Programming Language, Second Edition
by Brian W. Kernighan and Dennis M. Ritchie.
Prentice Hall, Inc., 1988.
ISBN 0-13-110362-8 (paperback), 0-13-110370-9 (hardback).</p>
<p>The Practice of Programming
by Brian W. Kernighan and Rob Pike.
Addison-Wesley, Inc., 1999.
ISBN 0-201-61586-X.</p>
<p>GNU manuals - where in compliance with K&amp;R and this text - for cpp, gcc,
gcc internals and indent, all available from <a class="reference external" href="https://www.gnu.org/manual/">https://www.gnu.org/manual/</a></p>
<p>WG14 is the international standardization working group for the programming
language C, URL: <a class="reference external" href="http://www.open-std.org/JTC1/SC22/WG14/">http://www.open-std.org/JTC1/SC22/WG14/</a></p>
<p>Kernel <a class="reference internal" href="#codingstyle"><span class="std std-ref">process/coding-style.rst</span></a>, by <a class="reference external" href="mailto:greg&#37;&#52;&#48;kroah&#46;com">greg<span>&#64;</span>kroah<span>&#46;</span>com</a> at OLS 2002:
<a class="reference external" href="http://www.kroah.com/linux/talks/ols_2002_kernel_codingstyle_talk/html/">http://www.kroah.com/linux/talks/ols_2002_kernel_codingstyle_talk/html/</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Linux kernel coding style</a><ul>
<li><a class="reference internal" href="#indentation">1) Indentation</a></li>
<li><a class="reference internal" href="#breaking-long-lines-and-strings">2) Breaking long lines and strings</a></li>
<li><a class="reference internal" href="#placing-braces-and-spaces">3) Placing Braces and Spaces</a><ul>
<li><a class="reference internal" href="#spaces">3.1) Spaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#naming">4) Naming</a></li>
<li><a class="reference internal" href="#typedefs">5) Typedefs</a></li>
<li><a class="reference internal" href="#functions">6) Functions</a><ul>
<li><a class="reference internal" href="#function-prototypes">6.1) Function prototypes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#centralized-exiting-of-functions">7) Centralized exiting of functions</a></li>
<li><a class="reference internal" href="#commenting">8) Commenting</a></li>
<li><a class="reference internal" href="#you-ve-made-a-mess-of-it">9) You’ve made a mess of it</a></li>
<li><a class="reference internal" href="#kconfig-configuration-files">10) Kconfig configuration files</a></li>
<li><a class="reference internal" href="#data-structures">11) Data structures</a></li>
<li><a class="reference internal" href="#macros-enums-and-rtl">12) Macros, Enums and RTL</a></li>
<li><a class="reference internal" href="#printing-kernel-messages">13) Printing kernel messages</a></li>
<li><a class="reference internal" href="#allocating-memory">14) Allocating memory</a></li>
<li><a class="reference internal" href="#the-inline-disease">15) The inline disease</a></li>
<li><a class="reference internal" href="#function-return-values-and-names">16) Function return values and names</a></li>
<li><a class="reference internal" href="#using-bool">17) Using bool</a></li>
<li><a class="reference internal" href="#don-t-re-invent-the-kernel-macros">18) Don’t re-invent the kernel macros</a></li>
<li><a class="reference internal" href="#editor-modelines-and-other-cruft">19) Editor modelines and other cruft</a></li>
<li><a class="reference internal" href="#inline-assembly">20) Inline assembly</a></li>
<li><a class="reference internal" href="#conditional-compilation">21) Conditional Compilation</a></li>
<li><a class="reference internal" href="#do-not-crash-the-kernel">22) Do not crash the kernel</a><ul>
<li><a class="reference internal" href="#avoid-panic">Avoid panic()</a></li>
<li><a class="reference internal" href="#use-warn-rather-than-bug">Use WARN() rather than BUG()</a></li>
<li><a class="reference internal" href="#use-warn-on-once-rather-than-warn-or-warn-on">Use WARN_ON_ONCE() rather than WARN() or WARN_ON()</a></li>
<li><a class="reference internal" href="#do-not-warn-lightly">Do not WARN lightly</a></li>
<li><a class="reference internal" href="#do-not-worry-about-panic-on-warn-users">Do not worry about panic_on_warn users</a></li>
<li><a class="reference internal" href="#use-build-bug-on-for-compile-time-assertions">Use BUILD_BUG_ON() for compile-time assertions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix-i-references">Appendix I) References</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/process/coding-style.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/process/coding-style.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>