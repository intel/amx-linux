
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1. The tip tree handbook &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Networking subsystem (netdev)" href="maintainer-netdev.html" />
    <link rel="prev" title="Subsystem and maintainer tree specific development process notes" href="maintainer-handbooks.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="the-tip-tree-handbook">
<h1><span class="section-number">1. </span>The tip tree handbook<a class="headerlink" href="#the-tip-tree-handbook" title="Permalink to this headline">¶</a></h1>
<section id="what-is-the-tip-tree">
<h2><span class="section-number">1.1. </span>What is the tip tree?<a class="headerlink" href="#what-is-the-tip-tree" title="Permalink to this headline">¶</a></h2>
<p>The tip tree is a collection of several subsystems and areas of
development. The tip tree is both a direct development tree and a
aggregation tree for several sub-maintainer trees. The tip tree gitweb URL
is: <a class="reference external" href="https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git">https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git</a></p>
<p>The tip tree contains the following subsystems:</p>
<blockquote>
<div><ul>
<li><p><strong>x86 architecture</strong></p>
<p>The x86 architecture development takes place in the tip tree except
for the x86 KVM and XEN specific parts which are maintained in the
corresponding subsystems and routed directly to mainline from
there. It’s still good practice to Cc the x86 maintainers on
x86-specific KVM and XEN patches.</p>
<p>Some x86 subsystems have their own maintainers in addition to the
overall x86 maintainers.  Please Cc the overall x86 maintainers on
patches touching files in arch/x86 even when they are not called out
by the MAINTAINER file.</p>
<p>Note, that <code class="docutils literal notranslate"><span class="pre">x86&#64;kernel.org</span></code> is not a mailing list. It is merely a
mail alias which distributes mails to the x86 top-level maintainer
team. Please always Cc the Linux Kernel mailing list (LKML)
<code class="docutils literal notranslate"><span class="pre">linux-kernel&#64;vger.kernel.org</span></code>, otherwise your mail ends up only in
the private inboxes of the maintainers.</p>
</li>
<li><p><strong>Scheduler</strong></p>
<p>Scheduler development takes place in the -tip tree, in the
sched/core branch - with occasional sub-topic trees for
work-in-progress patch-sets.</p>
</li>
<li><p><strong>Locking and atomics</strong></p>
<p>Locking development (including atomics and other synchronization
primitives that are connected to locking) takes place in the -tip
tree, in the locking/core branch - with occasional sub-topic trees
for work-in-progress patch-sets.</p>
</li>
<li><p><strong>Generic interrupt subsystem and interrupt chip drivers</strong>:</p>
<ul class="simple">
<li><p>interrupt core development happens in the irq/core branch</p></li>
<li><p>interrupt chip driver development also happens in the irq/core
branch, but the patches are usually applied in a separate maintainer
tree and then aggregated into irq/core</p></li>
</ul>
</li>
<li><p><strong>Time, timers, timekeeping, NOHZ and related chip drivers</strong>:</p>
<ul class="simple">
<li><p>timekeeping, clocksource core, NTP and alarmtimer development
happens in the timers/core branch, but patches are usually applied in
a separate maintainer tree and then aggregated into timers/core</p></li>
<li><p>clocksource/event driver development happens in the timers/core
branch, but patches are mostly applied in a separate maintainer tree
and then aggregated into timers/core</p></li>
</ul>
</li>
<li><p><strong>Performance counters core, architecture support and tooling</strong>:</p>
<ul class="simple">
<li><p>perf core and architecture support development happens in the
perf/core branch</p></li>
<li><p>perf tooling development happens in the perf tools maintainer
tree and is aggregated into the tip tree.</p></li>
</ul>
</li>
<li><p><strong>CPU hotplug core</strong></p></li>
<li><p><strong>RAS core</strong></p>
<p>Mostly x86-specific RAS patches are collected in the tip ras/core
branch.</p>
</li>
<li><p><strong>EFI core</strong></p>
<p>EFI development in the efi git tree. The collected patches are
aggregated in the tip efi/core branch.</p>
</li>
<li><p><strong>RCU</strong></p>
<p>RCU development happens in the linux-rcu tree. The resulting changes
are aggregated into the tip core/rcu branch.</p>
</li>
<li><p><strong>Various core code components</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p>debugobjects</p></li>
<li><p>objtool</p></li>
<li><p>random bits and pieces</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</section>
<section id="patch-submission-notes">
<h2><span class="section-number">1.2. </span>Patch submission notes<a class="headerlink" href="#patch-submission-notes" title="Permalink to this headline">¶</a></h2>
<section id="selecting-the-tree-branch">
<h3><span class="section-number">1.2.1. </span>Selecting the tree/branch<a class="headerlink" href="#selecting-the-tree-branch" title="Permalink to this headline">¶</a></h3>
<p>In general, development against the head of the tip tree master branch is
fine, but for the subsystems which are maintained separately, have their
own git tree and are only aggregated into the tip tree, development should
take place against the relevant subsystem tree or branch.</p>
<p>Bug fixes which target mainline should always be applicable against the
mainline kernel tree. Potential conflicts against changes which are already
queued in the tip tree are handled by the maintainers.</p>
</section>
<section id="patch-subject">
<h3><span class="section-number">1.2.2. </span>Patch subject<a class="headerlink" href="#patch-subject" title="Permalink to this headline">¶</a></h3>
<p>The tip tree preferred format for patch subject prefixes is
‘subsys/component:’, e.g. ‘x86/apic:’, ‘x86/mm/fault:’, ‘sched/fair:’,
‘genirq/core:’. Please do not use file names or complete file paths as
prefix. ‘git log path/to/file’ should give you a reasonable hint in most
cases.</p>
<p>The condensed patch description in the subject line should start with a
uppercase letter and should be written in imperative tone.</p>
</section>
<section id="changelog">
<h3><span class="section-number">1.2.3. </span>Changelog<a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h3>
<p>The general rules about changelogs in the process documentation, see
<a class="reference internal" href="submitting-patches.html#submittingpatches"><span class="std std-ref">Documentation/process/</span></a>, apply.</p>
<p>The tip tree maintainers set value on following these rules, especially on
the request to write changelogs in imperative mood and not impersonating
code or the execution of it. This is not just a whim of the
maintainers. Changelogs written in abstract words are more precise and
tend to be less confusing than those written in the form of novels.</p>
<p>It’s also useful to structure the changelog into several paragraphs and not
lump everything together into a single one. A good structure is to explain
the context, the problem and the solution in separate paragraphs and this
order.</p>
<p>Examples for illustration:</p>
<blockquote>
<div><p>Example 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x86/intel_rdt/mbm: Fix MBM overflow handler during hot cpu

When a CPU is dying, we cancel the worker and schedule a new worker on a
different CPU on the same domain. But if the timer is already about to
expire (say 0.99s) then we essentially double the interval.

We modify the hot cpu handling to cancel the delayed work on the dying
cpu and run the worker immediately on a different cpu in same domain. We
donot flush the worker because the MBM overflow worker reschedules the
worker on same CPU and scans the domain-&gt;cpu_mask to get the domain
pointer.
</pre></div>
</div>
<p>Improved version:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x86/intel_rdt/mbm: Fix MBM overflow handler during CPU hotplug

When a CPU is dying, the overflow worker is canceled and rescheduled on a
different CPU in the same domain. But if the timer is already about to
expire this essentially doubles the interval which might result in a non
detected overflow.

Cancel the overflow worker and reschedule it immediately on a different CPU
in the same domain. The work could be flushed as well, but that would
reschedule it on the same CPU.
</pre></div>
</div>
<p>Example 2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>time: POSIX CPU timers: Ensure that variable is initialized

If cpu_timer_sample_group returns -EINVAL, it will not have written into
*sample. Checking for cpu_timer_sample_group&#39;s return value precludes the
potential use of an uninitialized value of now in the following block.
Given an invalid clock_idx, the previous code could otherwise overwrite
*oldval in an undefined manner. This is now prevented. We also exploit
short-circuiting of &amp;&amp; to sample the timer only if the result will
actually be used to update *oldval.
</pre></div>
</div>
<p>Improved version:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>posix-cpu-timers: Make set_process_cpu_timer() more robust

Because the return value of cpu_timer_sample_group() is not checked,
compilers and static checkers can legitimately warn about a potential use
of the uninitialized variable &#39;now&#39;. This is not a runtime issue as all
call sites hand in valid clock ids.

Also cpu_timer_sample_group() is invoked unconditionally even when the
result is not used because *oldval is NULL.

Make the invocation conditional and check the return value.
</pre></div>
</div>
<p>Example 3:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The entity can also be used for other purposes.

Let&#39;s rename it to be more generic.
</pre></div>
</div>
<p>Improved version:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The entity can also be used for other purposes.

Rename it to be more generic.
</pre></div>
</div>
</div></blockquote>
<p>For complex scenarios, especially race conditions and memory ordering
issues, it is valuable to depict the scenario with a table which shows
the parallelism and the temporal order of events. Here is an example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CPU0                            CPU1
free_irq(X)                     interrupt X
                                spin_lock(desc-&gt;lock)
                                wake irq thread()
                                spin_unlock(desc-&gt;lock)
spin_lock(desc-&gt;lock)
remove action()
shutdown_irq()
release_resources()             thread_handler()
spin_unlock(desc-&gt;lock)           access released resources.
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^
synchronize_irq()
</pre></div>
</div>
<p>Lockdep provides similar useful output to depict a possible deadlock
scenario:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CPU0                                    CPU1
rtmutex_lock(&amp;rcu-&gt;rt_mutex)
  spin_lock(&amp;rcu-&gt;rt_mutex.wait_lock)
                                        local_irq_disable()
                                        spin_lock(&amp;timer-&gt;it_lock)
                                        spin_lock(&amp;rcu-&gt;mutex.wait_lock)
--&gt; Interrupt
    spin_lock(&amp;timer-&gt;it_lock)
</pre></div>
</div>
</section>
<section id="function-references-in-changelogs">
<h3><span class="section-number">1.2.4. </span>Function references in changelogs<a class="headerlink" href="#function-references-in-changelogs" title="Permalink to this headline">¶</a></h3>
<p>When a function is mentioned in the changelog, either the text body or the
subject line, please use the format ‘function_name()’. Omitting the
brackets after the function name can be ambiguous:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Subject: subsys/component: Make reservation_count static

reservation_count is only used in reservation_stats. Make it static.
</pre></div>
</div>
<p>The variant with brackets is more precise:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Subject: subsys/component: Make reservation_count() static

reservation_count() is only called from reservation_stats(). Make it
static.
</pre></div>
</div>
</section>
<section id="backtraces-in-changelogs">
<h3><span class="section-number">1.2.5. </span>Backtraces in changelogs<a class="headerlink" href="#backtraces-in-changelogs" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="submitting-patches.html#backtraces"><span class="std std-ref">Backtraces in commit messages</span></a>.</p>
</section>
<section id="ordering-of-commit-tags">
<h3><span class="section-number">1.2.6. </span>Ordering of commit tags<a class="headerlink" href="#ordering-of-commit-tags" title="Permalink to this headline">¶</a></h3>
<p>To have a uniform view of the commit tags, the tip maintainers use the
following tag ordering scheme:</p>
<blockquote>
<div><ul>
<li><p>Fixes: 12char-SHA1 (“sub/sys: Original subject line”)</p>
<p>A Fixes tag should be added even for changes which do not need to be
backported to stable kernels, i.e. when addressing a recently introduced
issue which only affects tip or the current head of mainline. These tags
are helpful to identify the original commit and are much more valuable
than prominently mentioning the commit which introduced a problem in the
text of the changelog itself because they can be automatically
extracted.</p>
<p>The following example illustrates the difference:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Commit

  abcdef012345678 (&quot;x86/xxx: Replace foo with bar&quot;)

left an unused instance of variable foo around. Remove it.

Signed-off-by: J.Dev &lt;j.dev@mail&gt;
</pre></div>
</div>
<p>Please say instead:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The recent replacement of foo with bar left an unused instance of
variable foo around. Remove it.

Fixes: abcdef012345678 (&quot;x86/xxx: Replace foo with bar&quot;)
Signed-off-by: J.Dev &lt;j.dev@mail&gt;
</pre></div>
</div>
<p>The latter puts the information about the patch into the focus and
amends it with the reference to the commit which introduced the issue
rather than putting the focus on the original commit in the first place.</p>
</li>
<li><p>Reported-by: <code class="docutils literal notranslate"><span class="pre">Reporter</span> <span class="pre">&lt;reporter&#64;mail&gt;</span></code></p></li>
<li><p>Originally-by: <code class="docutils literal notranslate"><span class="pre">Original</span> <span class="pre">author</span> <span class="pre">&lt;original-author&#64;mail&gt;</span></code></p></li>
<li><p>Suggested-by: <code class="docutils literal notranslate"><span class="pre">Suggester</span> <span class="pre">&lt;suggester&#64;mail&gt;</span></code></p></li>
<li><p>Co-developed-by: <code class="docutils literal notranslate"><span class="pre">Co-author</span> <span class="pre">&lt;co-author&#64;mail&gt;</span></code></p>
<p>Signed-off: <code class="docutils literal notranslate"><span class="pre">Co-author</span> <span class="pre">&lt;co-author&#64;mail&gt;</span></code></p>
<p>Note, that Co-developed-by and Signed-off-by of the co-author(s) must
come in pairs.</p>
</li>
<li><p>Signed-off-by: <code class="docutils literal notranslate"><span class="pre">Author</span> <span class="pre">&lt;author&#64;mail&gt;</span></code></p>
<p>The first Signed-off-by (SOB) after the last Co-developed-by/SOB pair is the
author SOB, i.e. the person flagged as author by git.</p>
</li>
<li><p>Signed-off-by: <code class="docutils literal notranslate"><span class="pre">Patch</span> <span class="pre">handler</span> <span class="pre">&lt;handler&#64;mail&gt;</span></code></p>
<p>SOBs after the author SOB are from people handling and transporting
the patch, but were not involved in development. SOB chains should
reflect the <strong>real</strong> route a patch took as it was propagated to us,
with the first SOB entry signalling primary authorship of a single
author. Acks should be given as Acked-by lines and review approvals
as Reviewed-by lines.</p>
<p>If the handler made modifications to the patch or the changelog, then
this should be mentioned <strong>after</strong> the changelog text and <strong>above</strong>
all commit tags in the following format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>... changelog text ends.

[ handler: Replaced foo by bar and updated changelog ]

First-tag: .....
</pre></div>
</div>
<p>Note the two empty new lines which separate the changelog text and the
commit tags from that notice.</p>
<p>If a patch is sent to the mailing list by a handler then the author has
to be noted in the first line of the changelog with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>From: Author &lt;author@mail&gt;

Changelog text starts here....
</pre></div>
</div>
<p>so the authorship is preserved. The ‘From:’ line has to be followed
by a empty newline. If that ‘From:’ line is missing, then the patch
would be attributed to the person who sent (transported, handled) it.
The ‘From:’ line is automatically removed when the patch is applied
and does not show up in the final git changelog. It merely affects
the authorship information of the resulting Git commit.</p>
</li>
<li><p>Tested-by: <code class="docutils literal notranslate"><span class="pre">Tester</span> <span class="pre">&lt;tester&#64;mail&gt;</span></code></p></li>
<li><p>Reviewed-by: <code class="docutils literal notranslate"><span class="pre">Reviewer</span> <span class="pre">&lt;reviewer&#64;mail&gt;</span></code></p></li>
<li><p>Acked-by: <code class="docutils literal notranslate"><span class="pre">Acker</span> <span class="pre">&lt;acker&#64;mail&gt;</span></code></p></li>
<li><p>Cc: <code class="docutils literal notranslate"><span class="pre">cc-ed-person</span> <span class="pre">&lt;person&#64;mail&gt;</span></code></p>
<p>If the patch should be backported to stable, then please add a ‘<code class="docutils literal notranslate"><span class="pre">Cc:</span>
<span class="pre">stable&#64;vger.kernel.org</span></code>’ tag, but do not Cc stable when sending your
mail.</p>
</li>
<li><p>Link: <code class="docutils literal notranslate"><span class="pre">https://link/to/information</span></code></p>
<p>For referring to an email on LKML or other kernel mailing lists,
please use the lore.kernel.org redirector URL:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>https://lore.kernel.org/r/email-message@id
</pre></div>
</div>
<p>The kernel.org redirector is considered a stable URL, unlike other email
archives.</p>
<p>Maintainers will add a Link tag referencing the email of the patch
submission when they apply a patch to the tip tree. This tag is useful
for later reference and is also used for commit notifications.</p>
</li>
</ul>
</div></blockquote>
<p>Please do not use combined tags, e.g. <code class="docutils literal notranslate"><span class="pre">Reported-and-tested-by</span></code>, as
they just complicate automated extraction of tags.</p>
</section>
<section id="links-to-documentation">
<h3><span class="section-number">1.2.7. </span>Links to documentation<a class="headerlink" href="#links-to-documentation" title="Permalink to this headline">¶</a></h3>
<p>Providing links to documentation in the changelog is a great help to later
debugging and analysis.  Unfortunately, URLs often break very quickly
because companies restructure their websites frequently.  Non-‘volatile’
exceptions include the Intel SDM and the AMD APM.</p>
<p>Therefore, for ‘volatile’ documents, please create an entry in the kernel
bugzilla <a class="reference external" href="https://bugzilla.kernel.org">https://bugzilla.kernel.org</a> and attach a copy of these documents
to the bugzilla entry. Finally, provide the URL of the bugzilla entry in
the changelog.</p>
</section>
<section id="patch-resend-or-reminders">
<h3><span class="section-number">1.2.8. </span>Patch resend or reminders<a class="headerlink" href="#patch-resend-or-reminders" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="submitting-patches.html#resend-reminders"><span class="std std-ref">Don’t get discouraged - or impatient</span></a>.</p>
</section>
<section id="merge-window">
<h3><span class="section-number">1.2.9. </span>Merge window<a class="headerlink" href="#merge-window" title="Permalink to this headline">¶</a></h3>
<p>Please do not expect large patch series to be handled during the merge
window or even during the week before.  Such patches should be submitted in
mergeable state <em>at</em> <em>least</em> a week before the merge window opens.
Exceptions are made for bug fixes and <em>sometimes</em> for small standalone
drivers for new hardware or minimally invasive patches for hardware
enablement.</p>
<p>During the merge window, the maintainers instead focus on following the
upstream changes, fixing merge window fallout, collecting bug fixes, and
allowing themselves a breath. Please respect that.</p>
<p>The release candidate -rc1 is the starting point for new patches to be
applied which are targeted for the next merge window.</p>
</section>
<section id="git">
<h3><span class="section-number">1.2.10. </span>Git<a class="headerlink" href="#git" title="Permalink to this headline">¶</a></h3>
<p>The tip maintainers accept git pull requests from maintainers who provide
subsystem changes for aggregation in the tip tree.</p>
<p>Pull requests for new patch submissions are usually not accepted and do not
replace proper patch submission to the mailing list. The main reason for
this is that the review workflow is email based.</p>
<p>If you submit a larger patch series it is helpful to provide a git branch
in a private repository which allows interested people to easily pull the
series for testing. The usual way to offer this is a git URL in the cover
letter of the patch series.</p>
</section>
<section id="testing">
<h3><span class="section-number">1.2.11. </span>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p>Code should be tested before submitting to the tip maintainers.  Anything
other than minor changes should be built, booted and tested with
comprehensive (and heavyweight) kernel debugging options enabled.</p>
<p>These debugging options can be found in kernel/configs/x86_debug.config
and can be added to an existing kernel config by running:</p>
<blockquote>
<div><p>make x86_debug.config</p>
</div></blockquote>
<p>Some of these options are x86-specific and can be left out when testing
on other architectures.</p>
</section>
</section>
<section id="coding-style-notes">
<h2><span class="section-number">1.3. </span>Coding style notes<a class="headerlink" href="#coding-style-notes" title="Permalink to this headline">¶</a></h2>
<section id="comment-style">
<h3><span class="section-number">1.3.1. </span>Comment style<a class="headerlink" href="#comment-style" title="Permalink to this headline">¶</a></h3>
<p>Sentences in comments start with an uppercase letter.</p>
<p>Single line comments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* This is a single line comment */
</pre></div>
</div>
<p>Multi-line comments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/*
 * This is a properly formatted
 * multi-line comment.
 *
 * Larger multi-line comments should be split into paragraphs.
 */
</pre></div>
</div>
<p>No tail comments:</p>
<blockquote>
<div><p>Please refrain from using tail comments. Tail comments disturb the
reading flow in almost all contexts, but especially in code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if (somecondition_is_true) /* Don&#39;t put a comment here */
        dostuff(); /* Neither here */

seed = MAGIC_CONSTANT; /* Nor here */
</pre></div>
</div>
<p>Use freestanding comments instead:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* This condition is not obvious without a comment */
if (somecondition_is_true) {
        /* This really needs to be documented */
        dostuff();
}

/* This magic initialization needs a comment. Maybe not? */
seed = MAGIC_CONSTANT;
</pre></div>
</div>
</div></blockquote>
<p>Comment the important things:</p>
<blockquote>
<div><p>Comments should be added where the operation is not obvious. Documenting
the obvious is just a distraction:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* Decrement refcount and check for zero */
if (refcount_dec_and_test(&amp;p-&gt;refcnt)) {
        do;
        lots;
        of;
        magic;
        things;
}
</pre></div>
</div>
<p>Instead, comments should explain the non-obvious details and document
constraints:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if (refcount_dec_and_test(&amp;p-&gt;refcnt)) {
        /*
         * Really good explanation why the magic things below
         * need to be done, ordering and locking constraints,
         * etc..
         */
        do;
        lots;
        of;
        magic;
        /* Needs to be the last operation because ... */
        things;
}
</pre></div>
</div>
</div></blockquote>
<p>Function documentation comments:</p>
<blockquote>
<div><p>To document functions and their arguments please use kernel-doc format
and not free form comments:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/**
 * magic_function - Do lots of magic stuff
 * @magic:      Pointer to the magic data to operate on
 * @offset:     Offset in the data array of @magic
 *
 * Deep explanation of mysterious things done with @magic along
 * with documentation of the return values.
 *
 * Note, that the argument descriptors above are arranged
 * in a tabular fashion.
 */
</pre></div>
</div>
<p>This applies especially to globally visible functions and inline
functions in public header files. It might be overkill to use kernel-doc
format for every (static) function which needs a tiny explanation. The
usage of descriptive function names often replaces these tiny comments.
Apply common sense as always.</p>
</div></blockquote>
</section>
<section id="documenting-locking-requirements">
<h3><span class="section-number">1.3.2. </span>Documenting locking requirements<a class="headerlink" href="#documenting-locking-requirements" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Documenting locking requirements is a good thing, but comments are not
necessarily the best choice. Instead of writing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/* Caller must hold foo-&gt;lock */
void func(struct foo *foo)
{
        ...
}
</pre></div>
</div>
<p>Please use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void func(struct foo *foo)
{
        lockdep_assert_held(&amp;foo-&gt;lock);
        ...
}
</pre></div>
</div>
<p>In PROVE_LOCKING kernels, lockdep_assert_held() emits a warning
if the caller doesn’t hold the lock.  Comments can’t do that.</p>
</div></blockquote>
</section>
<section id="bracket-rules">
<h3><span class="section-number">1.3.3. </span>Bracket rules<a class="headerlink" href="#bracket-rules" title="Permalink to this headline">¶</a></h3>
<p>Brackets should be omitted only if the statement which follows ‘if’, ‘for’,
‘while’ etc. is truly a single line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if (foo)
        do_something();
</pre></div>
</div>
<p>The following is not considered to be a single line statement even
though C does not require brackets:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for (i = 0; i &lt; end; i++)
        if (foo[i])
                do_something(foo[i]);
</pre></div>
</div>
<p>Adding brackets around the outer loop enhances the reading flow:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for (i = 0; i &lt; end; i++) {
        if (foo[i])
                do_something(foo[i]);
}
</pre></div>
</div>
</section>
<section id="variable-declarations">
<h3><span class="section-number">1.3.4. </span>Variable declarations<a class="headerlink" href="#variable-declarations" title="Permalink to this headline">¶</a></h3>
<p>The preferred ordering of variable declarations at the beginning of a
function is reverse fir tree order:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct long_struct_name *descriptive_name;
unsigned long foo, bar;
unsigned int tmp;
int ret;
</pre></div>
</div>
<p>The above is faster to parse than the reverse ordering:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int ret;
unsigned int tmp;
unsigned long foo, bar;
struct long_struct_name *descriptive_name;
</pre></div>
</div>
<p>And even more so than random ordering:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>unsigned long foo, bar;
int ret;
struct long_struct_name *descriptive_name;
unsigned int tmp;
</pre></div>
</div>
<p>Also please try to aggregate variables of the same type into a single
line. There is no point in wasting screen space:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>unsigned long a;
unsigned long b;
unsigned long c;
unsigned long d;
</pre></div>
</div>
<p>It’s really sufficient to do:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>unsigned long a, b, c, d;
</pre></div>
</div>
<p>Please also refrain from introducing line splits in variable declarations:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct long_struct_name *descriptive_name = container_of(bar,
                                              struct long_struct_name,
                                              member);
struct foobar foo;
</pre></div>
</div>
<p>It’s way better to move the initialization to a separate line after the
declarations:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct long_struct_name *descriptive_name;
struct foobar foo;

descriptive_name = container_of(bar, struct long_struct_name, member);
</pre></div>
</div>
</section>
<section id="variable-types">
<h3><span class="section-number">1.3.5. </span>Variable types<a class="headerlink" href="#variable-types" title="Permalink to this headline">¶</a></h3>
<p>Please use the proper u8, u16, u32, u64 types for variables which are meant
to describe hardware or are used as arguments for functions which access
hardware. These types are clearly defining the bit width and avoid
truncation, expansion and 32/64-bit confusion.</p>
<p>u64 is also recommended in code which would become ambiguous for 32-bit
kernels when ‘unsigned long’ would be used instead. While in such
situations ‘unsigned long long’ could be used as well, u64 is shorter
and also clearly shows that the operation is required to be 64 bits wide
independent of the target CPU.</p>
<p>Please use ‘unsigned int’ instead of ‘unsigned’.</p>
</section>
<section id="constants">
<h3><span class="section-number">1.3.6. </span>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h3>
<p>Please do not use literal (hexa)decimal numbers in code or initializers.
Either use proper defines which have descriptive names or consider using
an enum.</p>
</section>
<section id="struct-declarations-and-initializers">
<h3><span class="section-number">1.3.7. </span>Struct declarations and initializers<a class="headerlink" href="#struct-declarations-and-initializers" title="Permalink to this headline">¶</a></h3>
<p>Struct declarations should align the struct member names in a tabular
fashion:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct bar_order {
        unsigned int    guest_id;
        int             ordered_item;
        struct menu     *menu;
};
</pre></div>
</div>
<p>Please avoid documenting struct members within the declaration, because
this often results in strangely formatted comments and the struct members
become obfuscated:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct bar_order {
        unsigned int    guest_id; /* Unique guest id */
        int             ordered_item;
        /* Pointer to a menu instance which contains all the drinks */
        struct menu     *menu;
};
</pre></div>
</div>
<p>Instead, please consider using the kernel-doc format in a comment preceding
the struct declaration, which is easier to read and has the added advantage
of including the information in the kernel documentation, for example, as
follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/**
 * struct bar_order - Description of a bar order
 * @guest_id:           Unique guest id
 * @ordered_item:       The item number from the menu
 * @menu:               Pointer to the menu from which the item
 *                      was ordered
 *
 * Supplementary information for using the struct.
 *
 * Note, that the struct member descriptors above are arranged
 * in a tabular fashion.
 */
struct bar_order {
        unsigned int    guest_id;
        int             ordered_item;
        struct menu     *menu;
};
</pre></div>
</div>
<p>Static struct initializers must use C99 initializers and should also be
aligned in a tabular fashion:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static struct foo statfoo = {
        .a              = 0,
        .plain_integer  = CONSTANT_DEFINE_OR_ENUM,
        .bar            = &amp;statbar,
};
</pre></div>
</div>
<p>Note that while C99 syntax allows the omission of the final comma,
we recommend the use of a comma on the last line because it makes
reordering and addition of new lines easier, and makes such future
patches slightly easier to read as well.</p>
</section>
<section id="line-breaks">
<h3><span class="section-number">1.3.8. </span>Line breaks<a class="headerlink" href="#line-breaks" title="Permalink to this headline">¶</a></h3>
<p>Restricting line length to 80 characters makes deeply indented code hard to
read.  Consider breaking out code into helper functions to avoid excessive
line breaking.</p>
<p>The 80 character rule is not a strict rule, so please use common sense when
breaking lines. Especially format strings should never be broken up.</p>
<p>When splitting function declarations or function calls, then please align
the first argument in the second line with the first argument in the first
line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static int long_function_name(struct foobar *barfoo, unsigned int id,
                              unsigned int offset)
{

      if (!id) {
              ret = longer_function_name(barfoo, DEFAULT_BARFOO_ID,
                                         offset);
      ...
</pre></div>
</div>
</section>
<section id="namespaces">
<h3><span class="section-number">1.3.9. </span>Namespaces<a class="headerlink" href="#namespaces" title="Permalink to this headline">¶</a></h3>
<p>Function/variable namespaces improve readability and allow easy
grepping. These namespaces are string prefixes for globally visible
function and variable names, including inlines. These prefixes should
combine the subsystem and the component name such as ‘x86_comp_’,
‘sched_’, ‘irq_’, and ‘mutex_’.</p>
<p>This also includes static file scope functions that are immediately put
into globally visible driver templates - it’s useful for those symbols
to carry a good prefix as well, for backtrace readability.</p>
<p>Namespace prefixes may be omitted for local static functions and
variables. Truly local functions, only called by other local functions,
can have shorter descriptive names - our primary concern is greppability
and backtrace readability.</p>
<p>Please note that ‘xxx_vendor_’ and ‘vendor_xxx_` prefixes are not
helpful for static functions in vendor-specific files. After all, it
is already clear that the code is vendor-specific. In addition, vendor
names should only be for truly vendor-specific functionality.</p>
<p>As always apply common sense and aim for consistency and readability.</p>
</section>
</section>
<section id="commit-notifications">
<h2><span class="section-number">1.4. </span>Commit notifications<a class="headerlink" href="#commit-notifications" title="Permalink to this headline">¶</a></h2>
<p>The tip tree is monitored by a bot for new commits. The bot sends an email
for each new commit to a dedicated mailing list
(<code class="docutils literal notranslate"><span class="pre">linux-tip-commits&#64;vger.kernel.org</span></code>) and Cc’s all people who are
mentioned in one of the commit tags. It uses the email message ID from the
Link tag at the end of the tag list to set the In-Reply-To email header so
the message is properly threaded with the patch submission email.</p>
<p>The tip maintainers and submaintainers try to reply to the submitter
when merging a patch, but they sometimes forget or it does not fit the
workflow of the moment. While the bot message is purely mechanical, it
also implies a ‘Thank you! Applied.’.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1. The tip tree handbook</a><ul>
<li><a class="reference internal" href="#what-is-the-tip-tree">1.1. What is the tip tree?</a></li>
<li><a class="reference internal" href="#patch-submission-notes">1.2. Patch submission notes</a><ul>
<li><a class="reference internal" href="#selecting-the-tree-branch">1.2.1. Selecting the tree/branch</a></li>
<li><a class="reference internal" href="#patch-subject">1.2.2. Patch subject</a></li>
<li><a class="reference internal" href="#changelog">1.2.3. Changelog</a></li>
<li><a class="reference internal" href="#function-references-in-changelogs">1.2.4. Function references in changelogs</a></li>
<li><a class="reference internal" href="#backtraces-in-changelogs">1.2.5. Backtraces in changelogs</a></li>
<li><a class="reference internal" href="#ordering-of-commit-tags">1.2.6. Ordering of commit tags</a></li>
<li><a class="reference internal" href="#links-to-documentation">1.2.7. Links to documentation</a></li>
<li><a class="reference internal" href="#patch-resend-or-reminders">1.2.8. Patch resend or reminders</a></li>
<li><a class="reference internal" href="#merge-window">1.2.9. Merge window</a></li>
<li><a class="reference internal" href="#git">1.2.10. Git</a></li>
<li><a class="reference internal" href="#testing">1.2.11. Testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coding-style-notes">1.3. Coding style notes</a><ul>
<li><a class="reference internal" href="#comment-style">1.3.1. Comment style</a></li>
<li><a class="reference internal" href="#documenting-locking-requirements">1.3.2. Documenting locking requirements</a></li>
<li><a class="reference internal" href="#bracket-rules">1.3.3. Bracket rules</a></li>
<li><a class="reference internal" href="#variable-declarations">1.3.4. Variable declarations</a></li>
<li><a class="reference internal" href="#variable-types">1.3.5. Variable types</a></li>
<li><a class="reference internal" href="#constants">1.3.6. Constants</a></li>
<li><a class="reference internal" href="#struct-declarations-and-initializers">1.3.7. Struct declarations and initializers</a></li>
<li><a class="reference internal" href="#line-breaks">1.3.8. Line breaks</a></li>
<li><a class="reference internal" href="#namespaces">1.3.9. Namespaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#commit-notifications">1.4. Commit notifications</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/process/maintainer-tip.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/process/maintainer-tip.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>