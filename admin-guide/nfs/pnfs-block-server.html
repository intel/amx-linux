
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>pNFS block layout server user guide &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="pNFS SCSI layout server user guide" href="pnfs-scsi-server.html" />
    <link rel="prev" title="NFS ID Mapper" href="nfs-idmapper.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pnfs-block-layout-server-user-guide">
<h1>pNFS block layout server user guide<a class="headerlink" href="#pnfs-block-layout-server-user-guide" title="Permalink to this headline">Â¶</a></h1>
<p>The Linux NFS server now supports the pNFS block layout extension.  In this
case the NFS server acts as Metadata Server (MDS) for pNFS, which in addition
to handling all the metadata access to the NFS export also hands out layouts
to the clients to directly access the underlying block devices that are
shared with the client.</p>
<p>To use pNFS block layouts with the Linux NFS server the exported file
system needs to support the pNFS block layouts (currently just XFS), and the
file system must sit on shared storage (typically iSCSI) that is accessible
to the clients in addition to the MDS.  As of now the file system needs to
sit directly on the exported volume, striping or concatenation of
volumes on the MDS and clients is not supported yet.</p>
<p>On the server, pNFS block volume support is automatically if the file system
support it.  On the client make sure the kernel has the CONFIG_PNFS_BLOCK
option enabled, the blkmapd daemon from nfs-utils is running, and the
file system is mounted using the NFSv4.1 protocol version (mount -o vers=4.1).</p>
<p>If the nfsd server needs to fence a non-responding client it calls
/sbin/nfsd-recall-failed with the first argument set to the IP address of
the client, and the second argument set to the device node without the /dev
prefix for the file system to be fenced. Below is an example file that shows
how to translate the device into a serial number from SCSI EVPD 0x80:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &gt; /sbin/nfsd-recall-failed &lt;&lt; EOF
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nv">CLIENT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="nv">DEV</span><span class="o">=</span><span class="s2">&quot;/dev/</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="nv">EVPD</span><span class="o">=</span><span class="sb">`</span>sg_inq --page<span class="o">=</span>0x80 <span class="si">${</span><span class="nv">DEV</span><span class="si">}</span> <span class="p">|</span> <span class="se">\</span>
        grep <span class="s2">&quot;Unit serial number:&quot;</span> <span class="p">|</span> <span class="se">\</span>
        awk -F <span class="s1">&#39;: &#39;</span> <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>

<span class="nb">echo</span> <span class="s2">&quot;fencing client </span><span class="si">${</span><span class="nv">CLIENT</span><span class="si">}</span><span class="s2"> serial </span><span class="si">${</span><span class="nv">EVPD</span><span class="si">}</span><span class="s2">&quot;</span> &gt;&gt; /var/log/pnfsd-fence.log
EOF
</pre></div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/nfs/pnfs-block-server.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/nfs/pnfs-block-server.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>