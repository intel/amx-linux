
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>NVIDIA Tegra SoC Uncore Performance Monitoring Unit (PMU) &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Amlogic SoC DDR Bandwidth Performance Monitoring Unit (PMU)" href="meson-ddr-pmu.html" />
    <link rel="prev" title="Alibaba’s T-Head SoC Uncore Performance Monitoring Unit (PMU)" href="alibaba_pmu.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="nvidia-tegra-soc-uncore-performance-monitoring-unit-pmu">
<h1>NVIDIA Tegra SoC Uncore Performance Monitoring Unit (PMU)<a class="headerlink" href="#nvidia-tegra-soc-uncore-performance-monitoring-unit-pmu" title="Permalink to this headline">¶</a></h1>
<p>The NVIDIA Tegra SoC includes various system PMUs to measure key performance
metrics like memory bandwidth, latency, and utilization:</p>
<ul class="simple">
<li><p>Scalable Coherency Fabric (SCF)</p></li>
<li><p>NVLink-C2C0</p></li>
<li><p>NVLink-C2C1</p></li>
<li><p>CNVLink</p></li>
<li><p>PCIE</p></li>
</ul>
<section id="pmu-driver">
<h2>PMU Driver<a class="headerlink" href="#pmu-driver" title="Permalink to this headline">¶</a></h2>
<p>The PMUs in this document are based on ARM CoreSight PMU Architecture as
described in document: ARM IHI 0091. Since this is a standard architecture, the
PMUs are managed by a common driver “arm-cs-arch-pmu”. This driver describes
the available events and configuration of each PMU in sysfs. Please see the
sections below to get the sysfs path of each PMU. Like other uncore PMU drivers,
the driver provides “cpumask” sysfs attribute to show the CPU id used to handle
the PMU event. There is also “associated_cpus” sysfs attribute, which contains a
list of CPUs associated with the PMU instance.</p>
</section>
<section id="scf-pmu">
<span id="scf-pmu-section"></span><h2>SCF PMU<a class="headerlink" href="#scf-pmu" title="Permalink to this headline">¶</a></h2>
<p>The SCF PMU monitors system level cache events, CPU traffic, and
strongly-ordered (SO) PCIE write traffic to local/remote memory. Please see
<a class="reference internal" href="#nvidia-uncore-pmu-traffic-coverage-section"><span class="std std-ref">Traffic Coverage</span></a> for more info about the PMU
traffic coverage.</p>
<p>The events and configuration options of this PMU device are described in sysfs,
see /sys/bus/event_sources/devices/nvidia_scf_pmu_&lt;socket-id&gt;.</p>
<p>Example usage:</p>
<ul>
<li><p>Count event id 0x0 in socket 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_scf_pmu_0/event=0x0/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 in socket 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_scf_pmu_1/event=0x0/
</pre></div>
</div>
</li>
</ul>
</section>
<section id="nvlink-c2c0-pmu">
<h2>NVLink-C2C0 PMU<a class="headerlink" href="#nvlink-c2c0-pmu" title="Permalink to this headline">¶</a></h2>
<p>The NVLink-C2C0 PMU monitors incoming traffic from a GPU/CPU connected with
NVLink-C2C (Chip-2-Chip) interconnect. The type of traffic captured by this PMU
varies dependent on the chip configuration:</p>
<ul>
<li><p>NVIDIA Grace Hopper Superchip: Hopper GPU is connected with Grace SoC.</p>
<p>In this config, the PMU captures GPU ATS translated or EGM traffic from the GPU.</p>
</li>
<li><p>NVIDIA Grace CPU Superchip: two Grace CPU SoCs are connected.</p>
<p>In this config, the PMU captures read and relaxed ordered (RO) writes from
PCIE device of the remote SoC.</p>
</li>
</ul>
<p>Please see <a class="reference internal" href="#nvidia-uncore-pmu-traffic-coverage-section"><span class="std std-ref">Traffic Coverage</span></a> for more info about
the PMU traffic coverage.</p>
<p>The events and configuration options of this PMU device are described in sysfs,
see /sys/bus/event_sources/devices/nvidia_nvlink_c2c0_pmu_&lt;socket-id&gt;.</p>
<p>Example usage:</p>
<ul>
<li><p>Count event id 0x0 from the GPU/CPU connected with socket 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_nvlink_c2c0_pmu_0/event=0x0/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 from the GPU/CPU connected with socket 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_nvlink_c2c0_pmu_1/event=0x0/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 from the GPU/CPU connected with socket 2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_nvlink_c2c0_pmu_2/event=0x0/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 from the GPU/CPU connected with socket 3:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_nvlink_c2c0_pmu_3/event=0x0/
</pre></div>
</div>
</li>
</ul>
</section>
<section id="nvlink-c2c1-pmu">
<h2>NVLink-C2C1 PMU<a class="headerlink" href="#nvlink-c2c1-pmu" title="Permalink to this headline">¶</a></h2>
<p>The NVLink-C2C1 PMU monitors incoming traffic from a GPU connected with
NVLink-C2C (Chip-2-Chip) interconnect. This PMU captures untranslated GPU
traffic, in contrast with NvLink-C2C0 PMU that captures ATS translated traffic.
Please see <a class="reference internal" href="#nvidia-uncore-pmu-traffic-coverage-section"><span class="std std-ref">Traffic Coverage</span></a> for more info about
the PMU traffic coverage.</p>
<p>The events and configuration options of this PMU device are described in sysfs,
see /sys/bus/event_sources/devices/nvidia_nvlink_c2c1_pmu_&lt;socket-id&gt;.</p>
<p>Example usage:</p>
<ul>
<li><p>Count event id 0x0 from the GPU connected with socket 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_nvlink_c2c1_pmu_0/event=0x0/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 from the GPU connected with socket 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_nvlink_c2c1_pmu_1/event=0x0/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 from the GPU connected with socket 2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_nvlink_c2c1_pmu_2/event=0x0/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 from the GPU connected with socket 3:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_nvlink_c2c1_pmu_3/event=0x0/
</pre></div>
</div>
</li>
</ul>
</section>
<section id="cnvlink-pmu">
<h2>CNVLink PMU<a class="headerlink" href="#cnvlink-pmu" title="Permalink to this headline">¶</a></h2>
<p>The CNVLink PMU monitors traffic from GPU and PCIE device on remote sockets
to local memory. For PCIE traffic, this PMU captures read and relaxed ordered
(RO) write traffic. Please see <a class="reference internal" href="#nvidia-uncore-pmu-traffic-coverage-section"><span class="std std-ref">Traffic Coverage</span></a>
for more info about the PMU traffic coverage.</p>
<p>The events and configuration options of this PMU device are described in sysfs,
see /sys/bus/event_sources/devices/nvidia_cnvlink_pmu_&lt;socket-id&gt;.</p>
<p>Each SoC socket can be connected to one or more sockets via CNVLink. The user can
use “rem_socket” bitmap parameter to select the remote socket(s) to monitor.
Each bit represents the socket number, e.g. “rem_socket=0xE” corresponds to
socket 1 to 3.
/sys/bus/event_sources/devices/nvidia_cnvlink_pmu_&lt;socket-id&gt;/format/rem_socket
shows the valid bits that can be set in the “rem_socket” parameter.</p>
<p>The PMU can not distinguish the remote traffic initiator, therefore it does not
provide filter to select the traffic source to monitor. It reports combined
traffic from remote GPU and PCIE devices.</p>
<p>Example usage:</p>
<ul>
<li><p>Count event id 0x0 for the traffic from remote socket 1, 2, and 3 to socket 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_cnvlink_pmu_0/event=0x0,rem_socket=0xE/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 for the traffic from remote socket 0, 2, and 3 to socket 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_cnvlink_pmu_1/event=0x0,rem_socket=0xD/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 for the traffic from remote socket 0, 1, and 3 to socket 2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_cnvlink_pmu_2/event=0x0,rem_socket=0xB/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 for the traffic from remote socket 0, 1, and 2 to socket 3:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_cnvlink_pmu_3/event=0x0,rem_socket=0x7/
</pre></div>
</div>
</li>
</ul>
</section>
<section id="pcie-pmu">
<h2>PCIE PMU<a class="headerlink" href="#pcie-pmu" title="Permalink to this headline">¶</a></h2>
<p>The PCIE PMU monitors all read/write traffic from PCIE root ports to
local/remote memory. Please see <a class="reference internal" href="#nvidia-uncore-pmu-traffic-coverage-section"><span class="std std-ref">Traffic Coverage</span></a>
for more info about the PMU traffic coverage.</p>
<p>The events and configuration options of this PMU device are described in sysfs,
see /sys/bus/event_sources/devices/nvidia_pcie_pmu_&lt;socket-id&gt;.</p>
<p>Each SoC socket can support multiple root ports. The user can use
“root_port” bitmap parameter to select the port(s) to monitor, i.e.
“root_port=0xF” corresponds to root port 0 to 3.
/sys/bus/event_sources/devices/nvidia_pcie_pmu_&lt;socket-id&gt;/format/root_port
shows the valid bits that can be set in the “root_port” parameter.</p>
<p>Example usage:</p>
<ul>
<li><p>Count event id 0x0 from root port 0 and 1 of socket 0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_pcie_pmu_0/event=0x0,root_port=0x3/
</pre></div>
</div>
</li>
<li><p>Count event id 0x0 from root port 0 and 1 of socket 1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf stat -a -e nvidia_pcie_pmu_1/event=0x0,root_port=0x3/
</pre></div>
</div>
</li>
</ul>
</section>
<section id="traffic-coverage">
<span id="nvidia-uncore-pmu-traffic-coverage-section"></span><h2>Traffic Coverage<a class="headerlink" href="#traffic-coverage" title="Permalink to this headline">¶</a></h2>
<p>The PMU traffic coverage may vary dependent on the chip configuration:</p>
<ul>
<li><p><strong>NVIDIA Grace Hopper Superchip</strong>: Hopper GPU is connected with Grace SoC.</p>
<p>Example configuration with two Grace SoCs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>*********************************          *********************************
* SOCKET-A                      *          * SOCKET-B                      *
*                               *          *                               *
*                     ::::::::  *          *  ::::::::                     *
*                     : PCIE :  *          *  : PCIE :                     *
*                     ::::::::  *          *  ::::::::                     *
*                         |     *          *      |                        *
*                         |     *          *      |                        *
*  :::::::            ::::::::: *          *  :::::::::            ::::::: *
*  :     :            :       : *          *  :       :            :     : *
*  : GPU :&lt;--NVLink--&gt;: Grace :&lt;---CNVLink---&gt;: Grace :&lt;--NVLink--&gt;: GPU : *
*  :     :    C2C     :  SoC  : *          *  :  SoC  :    C2C     :     : *
*  :::::::            ::::::::: *          *  :::::::::            ::::::: *
*     |                   |     *          *      |                   |    *
*     |                   |     *          *      |                   |    *
*  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;           &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;  *          *   &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;           &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; *
*  &amp; GMEM &amp;           &amp; CMEM &amp;  *          *   &amp; CMEM &amp;           &amp; GMEM &amp; *
*  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;           &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;  *          *   &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;           &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp; *
*                               *          *                               *
*********************************          *********************************

GMEM = GPU Memory (e.g. HBM)
CMEM = CPU Memory (e.g. LPDDR5X)
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Following table contains traffic coverage of Grace SoC PMU in socket-A:</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+--------------+-------+-----------+-----------+-----+----------+----------+
|              |                        Source                             |
+              +-------+-----------+-----------+-----+----------+----------+
| Destination  |       |GPU ATS    |GPU Not-ATS|     | Socket-B | Socket-B |
|              |PCI R/W|Translated,|Translated | CPU | CPU/PCIE1| GPU/PCIE2|
|              |       |EGM        |           |     |          |          |
+==============+=======+===========+===========+=====+==========+==========+
| Local        | PCIE  |NVLink-C2C0|NVLink-C2C1| SCF | SCF PMU  | CNVLink  |
| SYSRAM/CMEM  | PMU   |PMU        |PMU        | PMU |          | PMU      |
+--------------+-------+-----------+-----------+-----+----------+----------+
| Local GMEM   | PCIE  |    N/A    |NVLink-C2C1| SCF | SCF PMU  | CNVLink  |
|              | PMU   |           |PMU        | PMU |          | PMU      |
+--------------+-------+-----------+-----------+-----+----------+----------+
| Remote       | PCIE  |NVLink-C2C0|NVLink-C2C1| SCF |          |          |
| SYSRAM/CMEM  | PMU   |PMU        |PMU        | PMU |   N/A    |   N/A    |
| over CNVLink |       |           |           |     |          |          |
+--------------+-------+-----------+-----------+-----+----------+----------+
| Remote GMEM  | PCIE  |NVLink-C2C0|NVLink-C2C1| SCF |          |          |
| over CNVLink | PMU   |PMU        |PMU        | PMU |   N/A    |   N/A    |
+--------------+-------+-----------+-----------+-----+----------+----------+

PCIE1 traffic represents strongly ordered (SO) writes.
PCIE2 traffic represents reads and relaxed ordered (RO) writes.
</pre></div>
</div>
</li>
<li><p><strong>NVIDIA Grace CPU Superchip</strong>: two Grace CPU SoCs are connected.</p>
<p>Example configuration with two Grace SoCs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>*******************             *******************
* SOCKET-A        *             * SOCKET-B        *
*                 *             *                 *
*    ::::::::     *             *    ::::::::     *
*    : PCIE :     *             *    : PCIE :     *
*    ::::::::     *             *    ::::::::     *
*        |        *             *        |        *
*        |        *             *        |        *
*    :::::::::    *             *    :::::::::    *
*    :       :    *             *    :       :    *
*    : Grace :&lt;--------NVLink-------&gt;: Grace :    *
*    :  SoC  :    *     C2C     *    :  SoC  :    *
*    :::::::::    *             *    :::::::::    *
*        |        *             *        |        *
*        |        *             *        |        *
*     &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;    *             *     &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;    *
*     &amp; CMEM &amp;    *             *     &amp; CMEM &amp;    *
*     &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;    *             *     &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;    *
*                 *             *                 *
*******************             *******************

GMEM = GPU Memory (e.g. HBM)
CMEM = CPU Memory (e.g. LPDDR5X)
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">Following table contains traffic coverage of Grace SoC PMU in socket-A:</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+-----------------+-----------+---------+----------+-------------+
|                 |                      Source                  |
+                 +-----------+---------+----------+-------------+
| Destination     |           |         | Socket-B | Socket-B    |
|                 |  PCI R/W  |   CPU   | CPU/PCIE1| PCIE2       |
|                 |           |         |          |             |
+=================+===========+=========+==========+=============+
| Local           |  PCIE PMU | SCF PMU | SCF PMU  | NVLink-C2C0 |
| SYSRAM/CMEM     |           |         |          | PMU         |
+-----------------+-----------+---------+----------+-------------+
| Remote          |           |         |          |             |
| SYSRAM/CMEM     |  PCIE PMU | SCF PMU |   N/A    |     N/A     |
| over NVLink-C2C |           |         |          |             |
+-----------------+-----------+---------+----------+-------------+

PCIE1 traffic represents strongly ordered (SO) writes.
PCIE2 traffic represents reads and relaxed ordered (RO) writes.
</pre></div>
</div>
</li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">NVIDIA Tegra SoC Uncore Performance Monitoring Unit (PMU)</a><ul>
<li><a class="reference internal" href="#pmu-driver">PMU Driver</a></li>
<li><a class="reference internal" href="#scf-pmu">SCF PMU</a></li>
<li><a class="reference internal" href="#nvlink-c2c0-pmu">NVLink-C2C0 PMU</a></li>
<li><a class="reference internal" href="#nvlink-c2c1-pmu">NVLink-C2C1 PMU</a></li>
<li><a class="reference internal" href="#cnvlink-pmu">CNVLink PMU</a></li>
<li><a class="reference internal" href="#pcie-pmu">PCIE PMU</a></li>
<li><a class="reference internal" href="#traffic-coverage">Traffic Coverage</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/perf/nvidia-pmu.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/perf/nvidia-pmu.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>