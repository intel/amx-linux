
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>amd-pstate CPU Performance Scaling Driver &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Legacy Documentation of CPU Performance Scaling Drivers" href="cpufreq_drivers.html" />
    <link rel="prev" title="intel_pstate CPU Performance Scaling Driver" href="intel_pstate.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="amd-pstate-cpu-performance-scaling-driver">
<h1><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> CPU Performance Scaling Driver<a class="headerlink" href="#amd-pstate-cpu-performance-scaling-driver" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Copyright</dt>
<dd class="field-odd"><p>© 2021 Advanced Micro Devices, Inc.</p>
</dd>
<dt class="field-even">Author</dt>
<dd class="field-even"><p>Huang Rui &lt;<a class="reference external" href="mailto:ray&#46;huang&#37;&#52;&#48;amd&#46;com">ray<span>&#46;</span>huang<span>&#64;</span>amd<span>&#46;</span>com</a>&gt;</p>
</dd>
</dl>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> is the AMD CPU performance scaling driver that introduces a
new CPU frequency control mechanism on modern AMD APU and CPU series in
Linux kernel. The new mechanism is based on Collaborative Processor
Performance Control (CPPC) which provides finer grain frequency management
than legacy ACPI hardware P-States. Current AMD CPU/APU platforms are using
the ACPI P-states driver to manage CPU frequency and clocks with switching
only in 3 P-states. CPPC replaces the ACPI P-states controls and allows a
flexible, low-latency interface for the Linux kernel to directly
communicate the performance hints to hardware.</p>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> leverages the Linux kernel governors such as <code class="docutils literal notranslate"><span class="pre">schedutil</span></code>,
<code class="docutils literal notranslate"><span class="pre">ondemand</span></code>, etc. to manage the performance hints which are provided by
CPPC hardware functionality that internally follows the hardware
specification (for details refer to AMD64 Architecture Programmer’s Manual
Volume 2: System Programming <a class="footnote-reference brackets" href="#id6" id="id1">1</a>). Currently, <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> supports basic
frequency control function according to kernel governors on some of the
Zen2 and Zen3 processors, and we will implement more AMD specific functions
in future after we verify them on the hardware and SBIOS.</p>
</section>
<section id="amd-cppc-overview">
<h2>AMD CPPC Overview<a class="headerlink" href="#amd-cppc-overview" title="Permalink to this headline">¶</a></h2>
<p>Collaborative Processor Performance Control (CPPC) interface enumerates a
continuous, abstract, and unit-less performance value in a scale that is
not tied to a specific performance state / frequency. This is an ACPI
standard <a class="footnote-reference brackets" href="#id7" id="id2">2</a> which software can specify application performance goals and
hints as a relative target to the infrastructure limits. AMD processors
provide the low latency register model (MSR) instead of an AML code
interpreter for performance adjustments. <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> will initialize a
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">cpufreq_driver</span></code> instance, <code class="docutils literal notranslate"><span class="pre">amd_pstate_driver</span></code>, with the callbacks
to manage each performance update behavior.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Highest Perf ------&gt;+-----------------------+                         +-----------------------+
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |          Max Perf  ----&gt;|                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
Nominal Perf ------&gt;+-----------------------+                         +-----------------------+
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |      Desired Perf  ----&gt;|                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
 Lowest non-        |                       |                         |                       |
 linear perf ------&gt;+-----------------------+                         +-----------------------+
                    |                       |                         |                       |
                    |                       |       Lowest perf  ----&gt;|                       |
                    |                       |                         |                       |
 Lowest perf ------&gt;+-----------------------+                         +-----------------------+
                    |                       |                         |                       |
                    |                       |                         |                       |
                    |                       |                         |                       |
         0   ------&gt;+-----------------------+                         +-----------------------+

                                    AMD P-States Performance Scale
</pre></div>
</div>
<section id="amd-cppc-performance-capability">
<span id="perf-cap"></span><h3>AMD CPPC Performance Capability<a class="headerlink" href="#amd-cppc-performance-capability" title="Permalink to this headline">¶</a></h3>
<section id="highest-performance-ro">
<h4>Highest Performance (RO)<a class="headerlink" href="#highest-performance-ro" title="Permalink to this headline">¶</a></h4>
<p>This is the absolute maximum performance an individual processor may reach,
assuming ideal conditions. This performance level may not be sustainable
for long durations and may only be achievable if other platform components
are in a specific state; for example, it may require other processors to be in
an idle state. This would be equivalent to the highest frequencies
supported by the processor.</p>
</section>
<section id="nominal-guaranteed-performance-ro">
<h4>Nominal (Guaranteed) Performance (RO)<a class="headerlink" href="#nominal-guaranteed-performance-ro" title="Permalink to this headline">¶</a></h4>
<p>This is the maximum sustained performance level of the processor, assuming
ideal operating conditions. In the absence of an external constraint (power,
thermal, etc.), this is the performance level the processor is expected to
be able to maintain continuously. All cores/processors are expected to be
able to sustain their nominal performance state simultaneously.</p>
</section>
<section id="lowest-non-linear-performance-ro">
<h4>Lowest non-linear Performance (RO)<a class="headerlink" href="#lowest-non-linear-performance-ro" title="Permalink to this headline">¶</a></h4>
<p>This is the lowest performance level at which nonlinear power savings are
achieved, for example, due to the combined effects of voltage and frequency
scaling. Above this threshold, lower performance levels should be generally
more energy efficient than higher performance levels. This register
effectively conveys the most efficient performance level to <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code>.</p>
</section>
<section id="lowest-performance-ro">
<h4>Lowest Performance (RO)<a class="headerlink" href="#lowest-performance-ro" title="Permalink to this headline">¶</a></h4>
<p>This is the absolute lowest performance level of the processor. Selecting a
performance level lower than the lowest nonlinear performance level may
cause an efficiency penalty but should reduce the instantaneous power
consumption of the processor.</p>
</section>
</section>
<section id="amd-cppc-performance-control">
<h3>AMD CPPC Performance Control<a class="headerlink" href="#amd-cppc-performance-control" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> passes performance goals through these registers. The
register drives the behavior of the desired performance target.</p>
<section id="minimum-requested-performance-rw">
<h4>Minimum requested performance (RW)<a class="headerlink" href="#minimum-requested-performance-rw" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> specifies the minimum allowed performance level.</p>
</section>
<section id="maximum-requested-performance-rw">
<h4>Maximum requested performance (RW)<a class="headerlink" href="#maximum-requested-performance-rw" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> specifies a limit the maximum performance that is expected
to be supplied by the hardware.</p>
</section>
<section id="desired-performance-target-rw">
<h4>Desired performance target (RW)<a class="headerlink" href="#desired-performance-target-rw" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> specifies a desired target in the CPPC performance scale as
a relative number. This can be expressed as percentage of nominal
performance (infrastructure max). Below the nominal sustained performance
level, desired performance expresses the average performance level of the
processor subject to hardware. Above the nominal performance level,
the processor must provide at least nominal performance requested and go higher
if current operating conditions allow.</p>
</section>
<section id="energy-performance-preference-epp-rw">
<h4>Energy Performance Preference (EPP) (RW)<a class="headerlink" href="#energy-performance-preference-epp-rw" title="Permalink to this headline">¶</a></h4>
<p>This attribute provides a hint to the hardware if software wants to bias
toward performance (0x0) or energy efficiency (0xff).</p>
</section>
</section>
</section>
<section id="key-governors-support">
<h2>Key Governors Support<a class="headerlink" href="#key-governors-support" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> can be used with all the (generic) scaling governors listed
by the <code class="docutils literal notranslate"><span class="pre">scaling_available_governors</span></code> policy attribute in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code>. Then,
it is responsible for the configuration of policy objects corresponding to
CPUs and provides the <code class="docutils literal notranslate"><span class="pre">CPUFreq</span></code> core (and the scaling governors attached
to the policy objects) with accurate information on the maximum and minimum
operating frequencies supported by the hardware. Users can check the
<code class="docutils literal notranslate"><span class="pre">scaling_cur_freq</span></code> information comes from the <code class="docutils literal notranslate"><span class="pre">CPUFreq</span></code> core.</p>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> mainly supports <code class="docutils literal notranslate"><span class="pre">schedutil</span></code> and <code class="docutils literal notranslate"><span class="pre">ondemand</span></code> for dynamic
frequency control. It is to fine tune the processor configuration on
<code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> to the <code class="docutils literal notranslate"><span class="pre">schedutil</span></code> with CPU CFS scheduler. <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code>
registers the adjust_perf callback to implement performance update behavior
similar to CPPC. It is initialized by <code class="docutils literal notranslate"><span class="pre">sugov_start</span></code> and then populates the
CPU’s update_util_data pointer to assign <code class="docutils literal notranslate"><span class="pre">sugov_update_single_perf</span></code> as the
utilization update callback function in the CPU scheduler. The CPU scheduler
will call <code class="docutils literal notranslate"><span class="pre">cpufreq_update_util</span></code> and assigns the target performance according
to the <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sugov_cpu</span></code> that the utilization update belongs to.
Then, <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> updates the desired performance according to the CPU
scheduler assigned.</p>
</section>
<section id="processor-support">
<span id="id3"></span><h2>Processor Support<a class="headerlink" href="#processor-support" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> initialization will fail if the <code class="docutils literal notranslate"><span class="pre">_CPC</span></code> entry in the ACPI
SBIOS does not exist in the detected processor. It uses <code class="docutils literal notranslate"><span class="pre">acpi_cpc_valid</span></code>
to check the existence of <code class="docutils literal notranslate"><span class="pre">_CPC</span></code>. All Zen based processors support the legacy
ACPI hardware P-States function, so when <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> fails initialization,
the kernel will fall back to initialize the <code class="docutils literal notranslate"><span class="pre">acpi-cpufreq</span></code> driver.</p>
<p>There are two types of hardware implementations for <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code>: one is
<a class="reference internal" href="#perf-cap">Full MSR Support</a> and another is <a class="reference internal" href="#perf-cap">Shared Memory Support</a>. It can use the <code class="xref c c-macro docutils literal notranslate"><span class="pre">X86_FEATURE_CPPC</span></code> feature flag to
indicate the different types. (For details, refer to the Processor Programming
Reference (PPR) for AMD Family 19h Model 51h, Revision A1 Processors <a class="footnote-reference brackets" href="#id8" id="id4">3</a>.)
<code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> is to register different <code class="docutils literal notranslate"><span class="pre">static_call</span></code> instances for different
hardware implementations.</p>
<p>Currently, some of the Zen2 and Zen3 processors support <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code>. In the
future, it will be supported on more and more AMD processors.</p>
<section id="full-msr-support">
<h3>Full MSR Support<a class="headerlink" href="#full-msr-support" title="Permalink to this headline">¶</a></h3>
<p>Some new Zen3 processors such as Cezanne provide the MSR registers directly
while the <code class="xref c c-macro docutils literal notranslate"><span class="pre">X86_FEATURE_CPPC</span></code> CPU feature flag is set.
<code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> can handle the MSR register to implement the fast switch
function in <code class="docutils literal notranslate"><span class="pre">CPUFreq</span></code> that can reduce the latency of frequency control in
interrupt context. The functions with a <code class="docutils literal notranslate"><span class="pre">pstate_xxx</span></code> prefix represent the
operations on MSR registers.</p>
</section>
<section id="shared-memory-support">
<h3>Shared Memory Support<a class="headerlink" href="#shared-memory-support" title="Permalink to this headline">¶</a></h3>
<p>If the <code class="xref c c-macro docutils literal notranslate"><span class="pre">X86_FEATURE_CPPC</span></code> CPU feature flag is not set, the
processor supports the shared memory solution. In this case, <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code>
uses the <code class="docutils literal notranslate"><span class="pre">cppc_acpi</span></code> helper methods to implement the callback functions
that are defined on <code class="docutils literal notranslate"><span class="pre">static_call</span></code>. The functions with the <code class="docutils literal notranslate"><span class="pre">cppc_xxx</span></code> prefix
represent the operations of ACPI CPPC helpers for the shared memory solution.</p>
<p>AMD P-States and ACPI hardware P-States always can be supported in one
processor. But AMD P-States has the higher priority and if it is enabled
with <code class="xref c c-macro docutils literal notranslate"><span class="pre">MSR_AMD_CPPC_ENABLE</span></code> or <code class="docutils literal notranslate"><span class="pre">cppc_set_enable</span></code>, it will respond
to the request from AMD P-States.</p>
</section>
</section>
<section id="user-space-interface-in-sysfs">
<h2>User Space Interface in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code><a class="headerlink" href="#user-space-interface-in-sysfs" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> exposes several global attributes (files) in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code> to
control its functionality at the system level. They are located in the
<code class="docutils literal notranslate"><span class="pre">/sys/devices/system/cpu/cpufreq/policyX/</span></code> directory and affect all CPUs.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>root@hr-test1:/home/ray# ls /sys/devices/system/cpu/cpufreq/policy0/*amd*
/sys/devices/system/cpu/cpufreq/policy0/amd_pstate_highest_perf
/sys/devices/system/cpu/cpufreq/policy0/amd_pstate_lowest_nonlinear_freq
/sys/devices/system/cpu/cpufreq/policy0/amd_pstate_max_freq
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">amd_pstate_highest_perf</span> <span class="pre">/</span> <span class="pre">amd_pstate_max_freq</span></code></p>
<p>Maximum CPPC performance and CPU frequency that the driver is allowed to
set, in percent of the maximum supported CPPC performance level (the highest
performance supported in <a class="reference internal" href="#perf-cap">AMD CPPC Performance Capability</a>).
In some ASICs, the highest CPPC performance is not the one in the <code class="docutils literal notranslate"><span class="pre">_CPC</span></code>
table, so we need to expose it to sysfs. If boost is not active, but
still supported, this maximum frequency will be larger than the one in
<code class="docutils literal notranslate"><span class="pre">cpuinfo</span></code>.
This attribute is read-only.</p>
<p><code class="docutils literal notranslate"><span class="pre">amd_pstate_lowest_nonlinear_freq</span></code></p>
<p>The lowest non-linear CPPC CPU frequency that the driver is allowed to set,
in percent of the maximum supported CPPC performance level. (Please see the
lowest non-linear performance in <a class="reference internal" href="#perf-cap">AMD CPPC Performance Capability</a>.)
This attribute is read-only.</p>
<p>Other performance and frequency values can be read back from
<code class="docutils literal notranslate"><span class="pre">/sys/devices/system/cpu/cpuX/acpi_cppc/</span></code>, see <a class="reference internal" href="../acpi/cppc_sysfs.html#cppc-sysfs"><span class="std std-ref">CPPC</span></a>.</p>
</section>
<section id="amd-pstate-vs-acpi-cpufreq">
<h2><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> vs <code class="docutils literal notranslate"><span class="pre">acpi-cpufreq</span></code><a class="headerlink" href="#amd-pstate-vs-acpi-cpufreq" title="Permalink to this headline">¶</a></h2>
<p>On the majority of AMD platforms supported by <code class="docutils literal notranslate"><span class="pre">acpi-cpufreq</span></code>, the ACPI tables
provided by the platform firmware are used for CPU performance scaling, but
only provide 3 P-states on AMD processors.
However, on modern AMD APU and CPU series, hardware provides the Collaborative
Processor Performance Control according to the ACPI protocol and customizes this
for AMD platforms. That is, fine-grained and continuous frequency ranges
instead of the legacy hardware P-states. <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> is the kernel
module which supports the new AMD P-States mechanism on most of the future AMD
platforms. The AMD P-States mechanism is the more performance and energy
efficiency frequency management method on AMD processors.</p>
</section>
<section id="kernel-module-options-for-amd-pstate">
<h2>Kernel Module Options for <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code><a class="headerlink" href="#kernel-module-options-for-amd-pstate" title="Permalink to this headline">¶</a></h2>
<section id="passive-mode">
<h3>Passive Mode<a class="headerlink" href="#passive-mode" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">amd_pstate=passive</span></code></p>
<p>It will be enabled if the <code class="docutils literal notranslate"><span class="pre">amd_pstate=passive</span></code> is passed to the kernel in the command line.
In this mode, <code class="docutils literal notranslate"><span class="pre">amd_pstate</span></code> driver software specifies a desired QoS target in the CPPC
performance scale as a relative number. This can be expressed as percentage of nominal
performance (infrastructure max). Below the nominal sustained performance level,
desired performance expresses the average performance level of the processor subject
to the Performance Reduction Tolerance register. Above the nominal performance level,
processor must provide at least nominal performance requested and go higher if current
operating conditions allow.</p>
</section>
</section>
<section id="cpupower-tool-support-for-amd-pstate">
<h2><code class="docutils literal notranslate"><span class="pre">cpupower</span></code> tool support for <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code><a class="headerlink" href="#cpupower-tool-support-for-amd-pstate" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> is supported by the <code class="docutils literal notranslate"><span class="pre">cpupower</span></code> tool, which can be used to dump
frequency information. Development is in progress to support more and more
operations for the new <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> module with this tool.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>root@hr-test1:/home/ray# cpupower frequency-info
analyzing CPU 0:
  driver: amd-pstate
  CPUs which run at the same hardware frequency: 0
  CPUs which need to have their frequency coordinated by software: 0
  maximum transition latency: 131 us
  hardware limits: 400 MHz - 4.68 GHz
  available cpufreq governors: ondemand conservative powersave userspace performance schedutil
  current policy: frequency should be within 400 MHz and 4.68 GHz.
                  The governor &quot;schedutil&quot; may decide which speed to use
                  within this range.
  current CPU frequency: Unable to call hardware
  current CPU frequency: 4.02 GHz (asserted by call to kernel)
  boost state support:
    Supported: yes
    Active: yes
    AMD PSTATE Highest Performance: 166. Maximum Frequency: 4.68 GHz.
    AMD PSTATE Nominal Performance: 117. Nominal Frequency: 3.30 GHz.
    AMD PSTATE Lowest Non-linear Performance: 39. Lowest Non-linear Frequency: 1.10 GHz.
    AMD PSTATE Lowest Performance: 15. Lowest Frequency: 400 MHz.
</pre></div>
</div>
</section>
<section id="diagnostics-and-tuning">
<h2>Diagnostics and Tuning<a class="headerlink" href="#diagnostics-and-tuning" title="Permalink to this headline">¶</a></h2>
<section id="trace-events">
<h3>Trace Events<a class="headerlink" href="#trace-events" title="Permalink to this headline">¶</a></h3>
<p>There are two static trace events that can be used for <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code>
diagnostics. One of them is the <code class="docutils literal notranslate"><span class="pre">cpu_frequency</span></code> trace event generally used
by <code class="docutils literal notranslate"><span class="pre">CPUFreq</span></code>, and the other one is the <code class="docutils literal notranslate"><span class="pre">amd_pstate_perf</span></code> trace event
specific to <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code>.  The following sequence of shell commands can
be used to enable them and see their output (if the kernel is
configured to support event tracing).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>root@hr-test1:/home/ray# cd /sys/kernel/tracing/
root@hr-test1:/sys/kernel/tracing# echo 1 &gt; events/amd_cpu/enable
root@hr-test1:/sys/kernel/tracing# cat trace
# tracer: nop
#
# entries-in-buffer/entries-written: 47827/42233061   #P:2
#
#                                _-----=&gt; irqs-off
#                               / _----=&gt; need-resched
#                              | / _---=&gt; hardirq/softirq
#                              || / _--=&gt; preempt-depth
#                              ||| /     delay
#           TASK-PID     CPU#  ||||   TIMESTAMP  FUNCTION
#              | |         |   ||||      |         |
         &lt;idle&gt;-0       [015] dN...  4995.979886: amd_pstate_perf: amd_min_perf=85 amd_des_perf=85 amd_max_perf=166 cpu_id=15 changed=false fast_switch=true
         &lt;idle&gt;-0       [007] d.h..  4995.979893: amd_pstate_perf: amd_min_perf=85 amd_des_perf=85 amd_max_perf=166 cpu_id=7 changed=false fast_switch=true
            cat-2161    [000] d....  4995.980841: amd_pstate_perf: amd_min_perf=85 amd_des_perf=85 amd_max_perf=166 cpu_id=0 changed=false fast_switch=true
           sshd-2125    [004] d.s..  4995.980968: amd_pstate_perf: amd_min_perf=85 amd_des_perf=85 amd_max_perf=166 cpu_id=4 changed=false fast_switch=true
         &lt;idle&gt;-0       [007] d.s..  4995.980968: amd_pstate_perf: amd_min_perf=85 amd_des_perf=85 amd_max_perf=166 cpu_id=7 changed=false fast_switch=true
         &lt;idle&gt;-0       [003] d.s..  4995.980971: amd_pstate_perf: amd_min_perf=85 amd_des_perf=85 amd_max_perf=166 cpu_id=3 changed=false fast_switch=true
         &lt;idle&gt;-0       [011] d.s..  4995.980996: amd_pstate_perf: amd_min_perf=85 amd_des_perf=85 amd_max_perf=166 cpu_id=11 changed=false fast_switch=true
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cpu_frequency</span></code> trace event will be triggered either by the <code class="docutils literal notranslate"><span class="pre">schedutil</span></code> scaling
governor (for the policies it is attached to), or by the <code class="docutils literal notranslate"><span class="pre">CPUFreq</span></code> core (for the
policies with other scaling governors).</p>
</section>
<section id="tracer-tool">
<h3>Tracer Tool<a class="headerlink" href="#tracer-tool" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">amd_pstate_tracer.py</span></code> can record and parse <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> trace log, then
generate performance plots. This utility can be used to debug and tune the
performance of <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> driver. The tracer tool needs to import intel
pstate tracer.</p>
<p>Tracer tool located in <code class="docutils literal notranslate"><span class="pre">linux/tools/power/x86/amd_pstate_tracer</span></code>. It can be
used in two ways. If trace file is available, then directly parse the file
with command</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./amd_pstate_trace.py [-c cpus] -t &lt;trace_file&gt; -n &lt;test_name&gt;
</pre></div>
</div>
<p>Or generate trace file with root privilege, then parse and plot with command</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo ./amd_pstate_trace.py [-c cpus] -n &lt;test_name&gt; -i &lt;interval&gt; [-m kbytes]
</pre></div>
</div>
<p>The test result can be found in <code class="docutils literal notranslate"><span class="pre">results/test_name</span></code>. Following is the example
about part of the output.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>common_cpu  common_secs  common_usecs  min_perf  des_perf  max_perf  freq    mperf   apef    tsc       load   duration_ms  sample_num  elapsed_time  common_comm
CPU_005     712          116384        39        49        166       0.7565  9645075 2214891 38431470  25.1   11.646       469         2.496         kworker/5:0-40
CPU_006     712          116408        39        49        166       0.6769  8950227 1839034 37192089  24.06  11.272       470         2.496         kworker/6:0-1264
</pre></div>
</div>
</section>
<section id="unit-tests-for-amd-pstate">
<h3>Unit Tests for amd-pstate<a class="headerlink" href="#unit-tests-for-amd-pstate" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">amd-pstate-ut</span></code> is a test module for testing the <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> driver.</p>
<blockquote>
<div><ul class="simple">
<li><p>It can help all users to verify their processor support (SBIOS/Firmware or Hardware).</p></li>
<li><p>Kernel can have a basic function test to avoid the kernel regression during the update.</p></li>
<li><p>We can introduce more functional or performance tests to align the result together, it will benefit power and performance scale optimization.</p></li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p>Test case decriptions</p>
<blockquote>
<div><p>1). Basic tests</p>
<blockquote>
<div><p>Test prerequisite and basic functions for the <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> driver.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 7%" />
<col style="width: 26%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Functions</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>amd_pstate_ut_acpi_cpc_valid</p></td>
<td><div class="line-block">
<div class="line">Check whether the _CPC object is present in SBIOS.</div>
<div class="line"><br /></div>
<div class="line">The detail refer to <a class="reference internal" href="#processor-support">Processor Support</a>.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>amd_pstate_ut_check_enabled</p></td>
<td><div class="line-block">
<div class="line">Check whether AMD P-State is enabled.</div>
<div class="line"><br /></div>
<div class="line">AMD P-States and ACPI hardware P-States always can be supported in one processor.
But AMD P-States has the higher priority and if it is enabled with
<code class="xref c c-macro docutils literal notranslate"><span class="pre">MSR_AMD_CPPC_ENABLE</span></code> or <code class="docutils literal notranslate"><span class="pre">cppc_set_enable</span></code>, it will respond to the
request from AMD P-States.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>amd_pstate_ut_check_perf</p></td>
<td><div class="line-block">
<div class="line">Check if the each performance values are reasonable.</div>
<div class="line">highest_perf &gt;= nominal_perf &gt; lowest_nonlinear_perf &gt; lowest_perf &gt; 0.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>amd_pstate_ut_check_freq</p></td>
<td><div class="line-block">
<div class="line">Check if the each frequency values and max freq when set support boost mode
are reasonable.</div>
<div class="line">max_freq &gt;= nominal_freq &gt; lowest_nonlinear_freq &gt; min_freq &gt; 0</div>
<div class="line">If boost is not active but supported, this maximum frequency will be larger than
the one in <code class="docutils literal notranslate"><span class="pre">cpuinfo</span></code>.</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>2). Tbench test</p>
<blockquote>
<div><p>Test and monitor the cpu changes when running tbench benchmark under the specified governor.
These changes include desire performance, frequency, load, performance, energy etc.
The specified governor is ondemand or schedutil.
Tbench can also be tested on the <code class="docutils literal notranslate"><span class="pre">acpi-cpufreq</span></code> kernel driver for comparison.</p>
</div></blockquote>
<p>3). Gitsource test</p>
<blockquote>
<div><p>Test and monitor the cpu changes when running gitsource benchmark under the specified governor.
These changes include desire performance, frequency, load, time, energy etc.
The specified governor is ondemand or schedutil.
Gitsource can also be tested on the <code class="docutils literal notranslate"><span class="pre">acpi-cpufreq</span></code> kernel driver for comparison.</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p>How to execute the tests</p>
<p>We use test module in the kselftest frameworks to implement it.
We create <code class="docutils literal notranslate"><span class="pre">amd-pstate-ut</span></code> module and tie it into kselftest.(for
details refer to Linux Kernel Selftests <a class="footnote-reference brackets" href="#id9" id="id5">4</a>).</p>
<blockquote>
<div><p>1). Build</p>
<blockquote>
<div><ul>
<li><p>open the <code class="xref c c-macro docutils literal notranslate"><span class="pre">CONFIG_X86_AMD_PSTATE</span></code> configuration option.</p></li>
<li><p>set the <code class="xref c c-macro docutils literal notranslate"><span class="pre">CONFIG_X86_AMD_PSTATE_UT</span></code> configuration option to M.</p></li>
<li><p>make project</p></li>
<li><p>make selftest</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd linux
$ make -C tools/testing/selftests
</pre></div>
</div>
</li>
<li><p>make perf</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd tools/perf/
$ make
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>2). Installation &amp; Steps</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ make -C tools/testing/selftests install INSTALL_PATH=~/kselftest
$ cp tools/perf/perf /usr/bin/perf
$ sudo ./kselftest/run_kselftest.sh -c amd-pstate
</pre></div>
</div>
<p>3). Specified test case</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd ~/kselftest/amd-pstate
$ sudo ./run.sh -t basic
$ sudo ./run.sh -t tbench
$ sudo ./run.sh -t tbench -m acpi-cpufreq
$ sudo ./run.sh -t gitsource
$ sudo ./run.sh -t gitsource -m acpi-cpufreq
$ ./run.sh --help
./run.sh: illegal option -- -
Usage: ./run.sh [OPTION...]
        [-h &lt;help&gt;]
        [-o &lt;output-file-for-dump&gt;]
        [-c &lt;all: All testing,
             basic: Basic testing,
             tbench: Tbench testing,
             gitsource: Gitsource testing.&gt;]
        [-t &lt;tbench time limit&gt;]
        [-p &lt;tbench process number&gt;]
        [-l &lt;loop times for tbench&gt;]
        [-i &lt;amd tracer interval&gt;]
        [-m &lt;comparative test: acpi-cpufreq&gt;]
</pre></div>
</div>
<p>4). Results</p>
<blockquote>
<div><ul class="simple">
<li><p>basic</p></li>
</ul>
<blockquote>
<div><p>When you finish test, you will get the following log info</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ dmesg | grep &quot;amd_pstate_ut&quot; | tee log.txt
[12977.570663] amd_pstate_ut: 1    amd_pstate_ut_acpi_cpc_valid  success!
[12977.570673] amd_pstate_ut: 2    amd_pstate_ut_check_enabled   success!
[12977.571207] amd_pstate_ut: 3    amd_pstate_ut_check_perf      success!
[12977.571212] amd_pstate_ut: 4    amd_pstate_ut_check_freq      success!
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>tbench</p></li>
</ul>
<blockquote>
<div><p>When you finish test, you will get selftest.tbench.csv and png images.
The selftest.tbench.csv file contains the raw data and the drop of the comparative test.
The png images shows the performance, energy and performan per watt of each test.
Open selftest.tbench.csv :</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 10%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 10%" />
<col style="width: 7%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Governor</p></th>
<th class="head" rowspan="2"><p>Round</p></th>
<th class="head" rowspan="2"><p>Des-perf</p></th>
<th class="head" rowspan="2"><p>Freq</p></th>
<th class="head" rowspan="2"><p>Load</p></th>
<th class="head" rowspan="2"><p>Performance</p></th>
<th class="head" rowspan="2"><p>Energy</p></th>
<th class="head" rowspan="2"><p>Performance Per Watt</p></th>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><th class="head" rowspan="2"><p>Unit</p></th>
<th class="head" rowspan="2"></th>
<th class="head" rowspan="2"></th>
<th class="head" rowspan="2"><p>GHz</p></th>
<th class="head" rowspan="2"></th>
<th class="head" rowspan="2"><p>MB/s</p></th>
<th class="head" rowspan="2"><p>J</p></th>
<th class="head" rowspan="2"><p>MB/J</p></th>
</tr>
<tr class="row-even"></tr>
</thead>
<tbody>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand</p></td>
<td rowspan="2"><p>1</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2504.05</p></td>
<td rowspan="2"><p>1563.67</p></td>
<td rowspan="2"><p>158.5378</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2243.64</p></td>
<td rowspan="2"><p>1430.32</p></td>
<td rowspan="2"><p>155.2941</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand</p></td>
<td rowspan="2"><p>3</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2183.88</p></td>
<td rowspan="2"><p>1401.32</p></td>
<td rowspan="2"><p>154.2860</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand</p></td>
<td rowspan="2"><p>Average</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2310.52</p></td>
<td rowspan="2"><p>1465.1</p></td>
<td rowspan="2"><p>156.1268</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-schedutil</p></td>
<td rowspan="2"><p>1</p></td>
<td rowspan="2"><p>165.329</p></td>
<td rowspan="2"><p>1.62257</p></td>
<td rowspan="2"><p>99.798</p></td>
<td rowspan="2"><p>2136.54</p></td>
<td rowspan="2"><p>1395.26</p></td>
<td rowspan="2"><p>151.5971</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-schedutil</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>166</p></td>
<td rowspan="2"><p>1.49761</p></td>
<td rowspan="2"><p>99.9993</p></td>
<td rowspan="2"><p>2100.56</p></td>
<td rowspan="2"><p>1380.5</p></td>
<td rowspan="2"><p>150.6377</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-schedutil</p></td>
<td rowspan="2"><p>3</p></td>
<td rowspan="2"><p>166</p></td>
<td rowspan="2"><p>1.47806</p></td>
<td rowspan="2"><p>99.9993</p></td>
<td rowspan="2"><p>2084.12</p></td>
<td rowspan="2"><p>1375.76</p></td>
<td rowspan="2"><p>149.9737</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-schedutil</p></td>
<td rowspan="2"><p>Average</p></td>
<td rowspan="2"><p>165.776</p></td>
<td rowspan="2"><p>1.53275</p></td>
<td rowspan="2"><p>99.9322</p></td>
<td rowspan="2"><p>2107.07</p></td>
<td rowspan="2"><p>1383.84</p></td>
<td rowspan="2"><p>150.7399</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand</p></td>
<td rowspan="2"><p>1</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2529.9</p></td>
<td rowspan="2"><p>1564.4</p></td>
<td rowspan="2"><p>160.0997</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2249.76</p></td>
<td rowspan="2"><p>1432.97</p></td>
<td rowspan="2"><p>155.4297</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand</p></td>
<td rowspan="2"><p>3</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2181.46</p></td>
<td rowspan="2"><p>1406.88</p></td>
<td rowspan="2"><p>153.5060</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand</p></td>
<td rowspan="2"><p>Average</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2320.37</p></td>
<td rowspan="2"><p>1468.08</p></td>
<td rowspan="2"><p>156.4741</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>1</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2137.64</p></td>
<td rowspan="2"><p>1385.24</p></td>
<td rowspan="2"><p>152.7723</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2107.05</p></td>
<td rowspan="2"><p>1372.23</p></td>
<td rowspan="2"><p>152.0138</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>3</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2085.86</p></td>
<td rowspan="2"><p>1365.35</p></td>
<td rowspan="2"><p>151.2433</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>Average</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2110.18</p></td>
<td rowspan="2"><p>1374.27</p></td>
<td rowspan="2"><p>152.0136</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand VS acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>Comprison(%)</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>-9.0584</p></td>
<td rowspan="2"><p>-6.3899</p></td>
<td rowspan="2"><p>-2.8506</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand VS amd-pstate-schedutil</p></td>
<td rowspan="2"><p>Comprison(%)</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>8.8053</p></td>
<td rowspan="2"><p>-5.5463</p></td>
<td rowspan="2"><p>-3.4503</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand VS amd-pstate-ondemand</p></td>
<td rowspan="2"><p>Comprison(%)</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>-0.4245</p></td>
<td rowspan="2"><p>-0.2029</p></td>
<td rowspan="2"><p>-0.2219</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil VS amd-pstate-schedutil</p></td>
<td rowspan="2"><p>Comprison(%)</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>-0.1473</p></td>
<td rowspan="2"><p>0.6963</p></td>
<td rowspan="2"><p>-0.8378</p></td>
</tr>
<tr class="row-even"></tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li><p>gitsource</p></li>
</ul>
<blockquote>
<div><p>When you finish test, you will get selftest.gitsource.csv and png images.
The selftest.gitsource.csv file contains the raw data and the drop of the comparative test.
The png images shows the performance, energy and performan per watt of each test.
Open selftest.gitsource.csv :</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 10%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 9%" />
<col style="width: 7%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Governor</p></th>
<th class="head" rowspan="2"><p>Round</p></th>
<th class="head" rowspan="2"><p>Des-perf</p></th>
<th class="head" rowspan="2"><p>Freq</p></th>
<th class="head" rowspan="2"><p>Load</p></th>
<th class="head" rowspan="2"><p>Time</p></th>
<th class="head" rowspan="2"><p>Energy</p></th>
<th class="head" rowspan="2"><p>Performance Per Watt</p></th>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><th class="head" rowspan="2"><p>Unit</p></th>
<th class="head" rowspan="2"></th>
<th class="head" rowspan="2"></th>
<th class="head" rowspan="2"><p>GHz</p></th>
<th class="head" rowspan="2"></th>
<th class="head" rowspan="2"><p>s</p></th>
<th class="head" rowspan="2"><p>J</p></th>
<th class="head" rowspan="2"><p>1/J</p></th>
</tr>
<tr class="row-even"></tr>
</thead>
<tbody>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand</p></td>
<td rowspan="2"><p>1</p></td>
<td rowspan="2"><p>50.119</p></td>
<td rowspan="2"><p>2.10509</p></td>
<td rowspan="2"><p>23.3076</p></td>
<td rowspan="2"><p>475.69</p></td>
<td rowspan="2"><p>865.78</p></td>
<td rowspan="2"><p>0.001155027</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>94.8006</p></td>
<td rowspan="2"><p>1.98771</p></td>
<td rowspan="2"><p>56.6533</p></td>
<td rowspan="2"><p>467.1</p></td>
<td rowspan="2"><p>839.67</p></td>
<td rowspan="2"><p>0.001190944</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand</p></td>
<td rowspan="2"><p>3</p></td>
<td rowspan="2"><p>76.6091</p></td>
<td rowspan="2"><p>2.53251</p></td>
<td rowspan="2"><p>43.7791</p></td>
<td rowspan="2"><p>467.69</p></td>
<td rowspan="2"><p>855.85</p></td>
<td rowspan="2"><p>0.001168429</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand</p></td>
<td rowspan="2"><p>Average</p></td>
<td rowspan="2"><p>73.8429</p></td>
<td rowspan="2"><p>2.20844</p></td>
<td rowspan="2"><p>41.2467</p></td>
<td rowspan="2"><p>470.16</p></td>
<td rowspan="2"><p>853.767</p></td>
<td rowspan="2"><p>0.001171279</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-schedutil</p></td>
<td rowspan="2"><p>1</p></td>
<td rowspan="2"><p>165.919</p></td>
<td rowspan="2"><p>1.62319</p></td>
<td rowspan="2"><p>98.3868</p></td>
<td rowspan="2"><p>464.17</p></td>
<td rowspan="2"><p>866.8</p></td>
<td rowspan="2"><p>0.001153668</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-schedutil</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"><p>165.97</p></td>
<td rowspan="2"><p>1.31309</p></td>
<td rowspan="2"><p>99.5712</p></td>
<td rowspan="2"><p>480.15</p></td>
<td rowspan="2"><p>880.4</p></td>
<td rowspan="2"><p>0.001135847</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-schedutil</p></td>
<td rowspan="2"><p>3</p></td>
<td rowspan="2"><p>165.973</p></td>
<td rowspan="2"><p>1.28448</p></td>
<td rowspan="2"><p>99.9252</p></td>
<td rowspan="2"><p>481.79</p></td>
<td rowspan="2"><p>867.02</p></td>
<td rowspan="2"><p>0.001153375</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-schedutil</p></td>
<td rowspan="2"><p>Average</p></td>
<td rowspan="2"><p>165.954</p></td>
<td rowspan="2"><p>1.40692</p></td>
<td rowspan="2"><p>99.2944</p></td>
<td rowspan="2"><p>475.37</p></td>
<td rowspan="2"><p>871.407</p></td>
<td rowspan="2"><p>0.001147569</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand</p></td>
<td rowspan="2"><p>1</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2379.62</p></td>
<td rowspan="2"><p>742.96</p></td>
<td rowspan="2"><p>0.001345967</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>441.74</p></td>
<td rowspan="2"><p>817.49</p></td>
<td rowspan="2"><p>0.001223256</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand</p></td>
<td rowspan="2"><p>3</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>455.48</p></td>
<td rowspan="2"><p>820.01</p></td>
<td rowspan="2"><p>0.001219497</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand</p></td>
<td rowspan="2"><p>Average</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>425.613</p></td>
<td rowspan="2"><p>793.487</p></td>
<td rowspan="2"><p>0.001260260</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>1</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>459.69</p></td>
<td rowspan="2"><p>838.54</p></td>
<td rowspan="2"><p>0.001192548</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>2</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>466.55</p></td>
<td rowspan="2"><p>830.89</p></td>
<td rowspan="2"><p>0.001203528</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>3</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>470.38</p></td>
<td rowspan="2"><p>837.32</p></td>
<td rowspan="2"><p>0.001194286</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>Average</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>465.54</p></td>
<td rowspan="2"><p>835.583</p></td>
<td rowspan="2"><p>0.001196769</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand VS acpi-cpufreq-schedutil</p></td>
<td rowspan="2"><p>Comprison(%)</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>9.3810</p></td>
<td rowspan="2"><p>5.3051</p></td>
<td rowspan="2"><p>-5.0379</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>amd-pstate-ondemand VS amd-pstate-schedutil</p></td>
<td rowspan="2"><p>Comprison(%)</p></td>
<td rowspan="2"><p>124.7392</p></td>
<td rowspan="2"><p>-36.2934</p></td>
<td rowspan="2"><p>140.7329</p></td>
<td rowspan="2"><p>1.1081</p></td>
<td rowspan="2"><p>2.0661</p></td>
<td rowspan="2"><p>-2.0242</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-ondemand VS amd-pstate-ondemand</p></td>
<td rowspan="2"><p>Comprison(%)</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>10.4665</p></td>
<td rowspan="2"><p>7.5968</p></td>
<td rowspan="2"><p>-7.0605</p></td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2"><p>acpi-cpufreq-schedutil VS amd-pstate-schedutil</p></td>
<td rowspan="2"><p>Comprison(%)</p></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"></td>
<td rowspan="2"><p>2.1115</p></td>
<td rowspan="2"><p>4.2873</p></td>
<td rowspan="2"><p>-4.1110</p></td>
</tr>
<tr class="row-even"></tr>
</tbody>
</table>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</li>
</ol>
</section>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>AMD64 Architecture Programmer’s Manual Volume 2: System Programming,
<a class="reference external" href="https://www.amd.com/system/files/TechDocs/24593.pdf">https://www.amd.com/system/files/TechDocs/24593.pdf</a></p>
</dd>
<dt class="label" id="id7"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Advanced Configuration and Power Interface Specification,
<a class="reference external" href="https://uefi.org/sites/default/files/resources/ACPI_Spec_6_4_Jan22.pdf">https://uefi.org/sites/default/files/resources/ACPI_Spec_6_4_Jan22.pdf</a></p>
</dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Processor Programming Reference (PPR) for AMD Family 19h Model 51h, Revision A1 Processors
<a class="reference external" href="https://www.amd.com/system/files/TechDocs/56569-A1-PUB.zip">https://www.amd.com/system/files/TechDocs/56569-A1-PUB.zip</a></p>
</dd>
<dt class="label" id="id9"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Linux Kernel Selftests,
<a class="reference external" href="https://www.kernel.org/doc/html/latest/dev-tools/kselftest.html">https://www.kernel.org/doc/html/latest/dev-tools/kselftest.html</a></p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> CPU Performance Scaling Driver</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#amd-cppc-overview">AMD CPPC Overview</a><ul>
<li><a class="reference internal" href="#amd-cppc-performance-capability">AMD CPPC Performance Capability</a><ul>
<li><a class="reference internal" href="#highest-performance-ro">Highest Performance (RO)</a></li>
<li><a class="reference internal" href="#nominal-guaranteed-performance-ro">Nominal (Guaranteed) Performance (RO)</a></li>
<li><a class="reference internal" href="#lowest-non-linear-performance-ro">Lowest non-linear Performance (RO)</a></li>
<li><a class="reference internal" href="#lowest-performance-ro">Lowest Performance (RO)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#amd-cppc-performance-control">AMD CPPC Performance Control</a><ul>
<li><a class="reference internal" href="#minimum-requested-performance-rw">Minimum requested performance (RW)</a></li>
<li><a class="reference internal" href="#maximum-requested-performance-rw">Maximum requested performance (RW)</a></li>
<li><a class="reference internal" href="#desired-performance-target-rw">Desired performance target (RW)</a></li>
<li><a class="reference internal" href="#energy-performance-preference-epp-rw">Energy Performance Preference (EPP) (RW)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#key-governors-support">Key Governors Support</a></li>
<li><a class="reference internal" href="#processor-support">Processor Support</a><ul>
<li><a class="reference internal" href="#full-msr-support">Full MSR Support</a></li>
<li><a class="reference internal" href="#shared-memory-support">Shared Memory Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user-space-interface-in-sysfs">User Space Interface in <code class="docutils literal notranslate"><span class="pre">sysfs</span></code></a></li>
<li><a class="reference internal" href="#amd-pstate-vs-acpi-cpufreq"><code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code> vs <code class="docutils literal notranslate"><span class="pre">acpi-cpufreq</span></code></a></li>
<li><a class="reference internal" href="#kernel-module-options-for-amd-pstate">Kernel Module Options for <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code></a><ul>
<li><a class="reference internal" href="#passive-mode">Passive Mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cpupower-tool-support-for-amd-pstate"><code class="docutils literal notranslate"><span class="pre">cpupower</span></code> tool support for <code class="docutils literal notranslate"><span class="pre">amd-pstate</span></code></a></li>
<li><a class="reference internal" href="#diagnostics-and-tuning">Diagnostics and Tuning</a><ul>
<li><a class="reference internal" href="#trace-events">Trace Events</a></li>
<li><a class="reference internal" href="#tracer-tool">Tracer Tool</a></li>
<li><a class="reference internal" href="#unit-tests-for-amd-pstate">Unit Tests for amd-pstate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference">Reference</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/pm/amd-pstate.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/pm/amd-pstate.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>