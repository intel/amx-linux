
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>SRBDS - Special Register Buffer Data Sampling &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Core Scheduling" href="core-scheduling.html" />
    <link rel="prev" title="iTLB multihit" href="multihit.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="srbds-special-register-buffer-data-sampling">
<h1>SRBDS - Special Register Buffer Data Sampling<a class="headerlink" href="#srbds-special-register-buffer-data-sampling" title="Permalink to this headline">¶</a></h1>
<p>SRBDS is a hardware vulnerability that allows MDS
<a class="reference internal" href="mds.html"><span class="doc">MDS - Microarchitectural Data Sampling</span></a> techniques to
infer values returned from special register accesses.  Special register
accesses are accesses to off core registers.  According to Intel’s evaluation,
the special register reads that have a security expectation of privacy are
RDRAND, RDSEED and SGX EGETKEY.</p>
<p>When RDRAND, RDSEED and EGETKEY instructions are used, the data is moved
to the core through the special register mechanism that is susceptible
to MDS attacks.</p>
<section id="affected-processors">
<h2>Affected processors<a class="headerlink" href="#affected-processors" title="Permalink to this headline">¶</a></h2>
<p>Core models (desktop, mobile, Xeon-E3) that implement RDRAND and/or RDSEED may
be affected.</p>
<p>A processor is affected by SRBDS if its Family_Model and stepping is
in the following list, with the exception of the listed processors
exporting MDS_NO while Intel TSX is available yet not enabled. The
latter class of processors are only affected when Intel TSX is enabled
by software using TSX_CTRL_MSR otherwise they are not affected.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 36%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>common name</p></th>
<th class="head"><p>Family_Model</p></th>
<th class="head"><p>Stepping</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IvyBridge</p></td>
<td><p>06_3AH</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>Haswell</p></td>
<td><p>06_3CH</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>Haswell_L</p></td>
<td><p>06_45H</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>Haswell_G</p></td>
<td><p>06_46H</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>Broadwell_G</p></td>
<td><p>06_47H</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>Broadwell</p></td>
<td><p>06_3DH</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>Skylake_L</p></td>
<td><p>06_4EH</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-odd"><td><p>Skylake</p></td>
<td><p>06_5EH</p></td>
<td><p>All</p></td>
</tr>
<tr class="row-even"><td><p>Kabylake_L</p></td>
<td><p>06_8EH</p></td>
<td><p>&lt;= 0xC</p></td>
</tr>
<tr class="row-odd"><td><p>Kabylake</p></td>
<td><p>06_9EH</p></td>
<td><p>&lt;= 0xD</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="related-cves">
<h2>Related CVEs<a class="headerlink" href="#related-cves" title="Permalink to this headline">¶</a></h2>
<p>The following CVE entry is related to this SRBDS issue:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 9%" />
<col style="width: 66%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>CVE-2020-0543</p></td>
<td><p>SRBDS</p></td>
<td><p>Special Register Buffer Data Sampling</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="attack-scenarios">
<h2>Attack scenarios<a class="headerlink" href="#attack-scenarios" title="Permalink to this headline">¶</a></h2>
<p>An unprivileged user can extract values returned from RDRAND and RDSEED
executed on another core or sibling thread using MDS techniques.</p>
</section>
<section id="mitigation-mechanism">
<h2>Mitigation mechanism<a class="headerlink" href="#mitigation-mechanism" title="Permalink to this headline">¶</a></h2>
<p>Intel will release microcode updates that modify the RDRAND, RDSEED, and
EGETKEY instructions to overwrite secret special register data in the shared
staging buffer before the secret data can be accessed by another logical
processor.</p>
<p>During execution of the RDRAND, RDSEED, or EGETKEY instructions, off-core
accesses from other logical processors will be delayed until the special
register read is complete and the secret data in the shared staging buffer is
overwritten.</p>
<p>This has three effects on performance:</p>
<ol class="arabic simple">
<li><p>RDRAND, RDSEED, or EGETKEY instructions have higher latency.</p></li>
<li><p>Executing RDRAND at the same time on multiple logical processors will be
serialized, resulting in an overall reduction in the maximum RDRAND
bandwidth.</p></li>
<li><p>Executing RDRAND, RDSEED or EGETKEY will delay memory accesses from other
logical processors that miss their core caches, with an impact similar to
legacy locked cache-line-split accesses.</p></li>
</ol>
<p>The microcode updates provide an opt-out mechanism (RNGDS_MITG_DIS) to disable
the mitigation for RDRAND and RDSEED instructions executed outside of Intel
Software Guard Extensions (Intel SGX) enclaves. On logical processors that
disable the mitigation using this opt-out mechanism, RDRAND and RDSEED do not
take longer to execute and do not impact performance of sibling logical
processors memory accesses. The opt-out mechanism does not affect Intel SGX
enclaves (including execution of RDRAND or RDSEED inside an enclave, as well
as EGETKEY execution).</p>
</section>
<section id="ia32-mcu-opt-ctrl-msr-definition">
<h2>IA32_MCU_OPT_CTRL MSR Definition<a class="headerlink" href="#ia32-mcu-opt-ctrl-msr-definition" title="Permalink to this headline">¶</a></h2>
<p>Along with the mitigation for this issue, Intel added a new thread-scope
IA32_MCU_OPT_CTRL MSR, (address 0x123). The presence of this MSR and
RNGDS_MITG_DIS (bit 0) is enumerated by CPUID.(EAX=07H,ECX=0).EDX[SRBDS_CTRL =
9]==1. This MSR is introduced through the microcode update.</p>
<p>Setting IA32_MCU_OPT_CTRL[0] (RNGDS_MITG_DIS) to 1 for a logical processor
disables the mitigation for RDRAND and RDSEED executed outside of an Intel SGX
enclave on that logical processor. Opting out of the mitigation for a
particular logical processor does not affect the RDRAND and RDSEED mitigations
for other logical processors.</p>
<p>Note that inside of an Intel SGX enclave, the mitigation is applied regardless
of the value of RNGDS_MITG_DS.</p>
</section>
<section id="mitigation-control-on-the-kernel-command-line">
<h2>Mitigation control on the kernel command line<a class="headerlink" href="#mitigation-control-on-the-kernel-command-line" title="Permalink to this headline">¶</a></h2>
<p>The kernel command line allows control over the SRBDS mitigation at boot time
with the option “srbds=”.  The option for this is:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>off</p></td>
<td><p>This option disables SRBDS mitigation for RDRAND and RDSEED on
affected platforms.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="srbds-system-information">
<h2>SRBDS System Information<a class="headerlink" href="#srbds-system-information" title="Permalink to this headline">¶</a></h2>
<p>The Linux kernel provides vulnerability status information through sysfs.  For
SRBDS this can be accessed by the following sysfs file:
/sys/devices/system/cpu/vulnerabilities/srbds</p>
<p>The possible values contained in this file are:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Not affected</p></td>
<td><p>Processor not vulnerable</p></td>
</tr>
<tr class="row-even"><td><p>Vulnerable</p></td>
<td><p>Processor vulnerable and mitigation disabled</p></td>
</tr>
<tr class="row-odd"><td><p>Vulnerable: No microcode</p></td>
<td><p>Processor vulnerable and microcode is missing
mitigation</p></td>
</tr>
<tr class="row-even"><td><p>Mitigation: Microcode</p></td>
<td><p>Processor is vulnerable and mitigation is in
effect.</p></td>
</tr>
<tr class="row-odd"><td><p>Mitigation: TSX disabled</p></td>
<td><p>Processor is only vulnerable when TSX is
enabled while this system was booted with TSX
disabled.</p></td>
</tr>
<tr class="row-even"><td><p>Unknown: Dependent on</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>hypervisor status</p></td>
<td><p>Running on virtual guest processor that is
affected but with no way to know if host
processor is mitigated or vulnerable.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="srbds-default-mitigation">
<h2>SRBDS Default mitigation<a class="headerlink" href="#srbds-default-mitigation" title="Permalink to this headline">¶</a></h2>
<p>This new microcode serializes processor access during execution of RDRAND,
RDSEED ensures that the shared buffer is overwritten before it is released for
reuse.  Use the “srbds=off” kernel command line to disable the mitigation for
RDRAND and RDSEED.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">SRBDS - Special Register Buffer Data Sampling</a><ul>
<li><a class="reference internal" href="#affected-processors">Affected processors</a></li>
<li><a class="reference internal" href="#related-cves">Related CVEs</a></li>
<li><a class="reference internal" href="#attack-scenarios">Attack scenarios</a></li>
<li><a class="reference internal" href="#mitigation-mechanism">Mitigation mechanism</a></li>
<li><a class="reference internal" href="#ia32-mcu-opt-ctrl-msr-definition">IA32_MCU_OPT_CTRL MSR Definition</a></li>
<li><a class="reference internal" href="#mitigation-control-on-the-kernel-command-line">Mitigation control on the kernel command line</a></li>
<li><a class="reference internal" href="#srbds-system-information">SRBDS System Information</a></li>
<li><a class="reference internal" href="#srbds-default-mitigation">SRBDS Default mitigation</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/hw-vuln/special-register-buffer-data-sampling.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/hw-vuln/special-register-buffer-data-sampling.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>