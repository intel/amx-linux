
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ThinkPad ACPI Extras Driver &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Toshiba HDD Active Protection Sensor" href="toshiba_haps.html" />
    <link rel="prev" title="Sony Programmable I/O Control Device Driver Readme" href="sonypi.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="thinkpad-acpi-extras-driver">
<h1>ThinkPad ACPI Extras Driver<a class="headerlink" href="#thinkpad-acpi-extras-driver" title="Permalink to this headline">¶</a></h1>
<p>Version 0.25</p>
<p>October 16th,  2013</p>
<ul class="simple">
<li><p>Borislav Deianov &lt;<a class="reference external" href="mailto:borislav&#37;&#52;&#48;users&#46;sf&#46;net">borislav<span>&#64;</span>users<span>&#46;</span>sf<span>&#46;</span>net</a>&gt;</p></li>
<li><p>Henrique de Moraes Holschuh &lt;<a class="reference external" href="mailto:hmh&#37;&#52;&#48;hmh&#46;eng&#46;br">hmh<span>&#64;</span>hmh<span>&#46;</span>eng<span>&#46;</span>br</a>&gt;</p></li>
</ul>
<p><a class="reference external" href="http://ibm-acpi.sf.net/">http://ibm-acpi.sf.net/</a></p>
<p>This is a Linux driver for the IBM and Lenovo ThinkPad laptops. It
supports various features of these laptops which are accessible
through the ACPI and ACPI EC framework, but not otherwise fully
supported by the generic Linux ACPI drivers.</p>
<p>This driver used to be named ibm-acpi until kernel 2.6.21 and release
0.13-20070314.  It used to be in the drivers/acpi tree, but it was
moved to the drivers/misc tree and renamed to thinkpad-acpi for kernel
2.6.22, and release 0.14.  It was moved to drivers/platform/x86 for
kernel 2.6.29 and release 0.22.</p>
<p>The driver is named “thinkpad-acpi”.  In some places, like module
names and log messages, “thinkpad_acpi” is used because of userspace
issues.</p>
<p>“tpacpi” is used as a shorthand where “thinkpad-acpi” would be too
long due to length limitations on some Linux kernel versions.</p>
<section id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>The features currently supported are the following (see below for
detailed description):</p>
<blockquote>
<div><ul class="simple">
<li><p>Fn key combinations</p></li>
<li><p>Bluetooth enable and disable</p></li>
<li><p>video output switching, expansion control</p></li>
<li><p>ThinkLight on and off</p></li>
<li><p>CMOS/UCMS control</p></li>
<li><p>LED control</p></li>
<li><p>ACPI sounds</p></li>
<li><p>temperature sensors</p></li>
<li><p>Experimental: embedded controller register dump</p></li>
<li><p>LCD brightness control</p></li>
<li><p>Volume control</p></li>
<li><p>Fan control and monitoring: fan speed, fan enable/disable</p></li>
<li><p>WAN enable and disable</p></li>
<li><p>UWB enable and disable</p></li>
<li><p>LCD Shadow (PrivacyGuard) enable and disable</p></li>
<li><p>Lap mode sensor</p></li>
<li><p>Setting keyboard language</p></li>
<li><p>WWAN Antenna type</p></li>
</ul>
</div></blockquote>
<p>A compatibility table by model and feature is maintained on the web
site, <a class="reference external" href="http://ibm-acpi.sf.net/">http://ibm-acpi.sf.net/</a>. I appreciate any success or failure
reports, especially if they add to or correct the compatibility table.
Please include the following information in your report:</p>
<blockquote>
<div><ul class="simple">
<li><p>ThinkPad model name</p></li>
<li><p>a copy of your ACPI tables, using the “acpidump” utility</p></li>
<li><p>a copy of the output of dmidecode, with serial numbers
and UUIDs masked off</p></li>
<li><p>which driver features work and which don’t</p></li>
<li><p>the observed behavior of non-working features</p></li>
</ul>
</div></blockquote>
<p>Any other comments or patches are also more than welcome.</p>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>If you are compiling this driver as included in the Linux kernel
sources, look for the CONFIG_THINKPAD_ACPI Kconfig option.
It is located on the menu path: “Device Drivers” -&gt; “X86 Platform
Specific Device Drivers” -&gt; “ThinkPad ACPI Laptop Extras”.</p>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<p>The driver exports two different interfaces to userspace, which can be
used to access the features it provides.  One is a legacy procfs-based
interface, which will be removed at some time in the future.  The other
is a new sysfs-based interface which is not complete yet.</p>
<p>The procfs interface creates the /proc/acpi/ibm directory.  There is a
file under that directory for each feature it supports.  The procfs
interface is mostly frozen, and will change very little if at all: it
will not be extended to add any new functionality in the driver, instead
all new functionality will be implemented on the sysfs interface.</p>
<p>The sysfs interface tries to blend in the generic Linux sysfs subsystems
and classes as much as possible.  Since some of these subsystems are not
yet ready or stabilized, it is expected that this interface will change,
and any and all userspace programs must deal with it.</p>
<section id="notes-about-the-sysfs-interface">
<h3>Notes about the sysfs interface<a class="headerlink" href="#notes-about-the-sysfs-interface" title="Permalink to this headline">¶</a></h3>
<p>Unlike what was done with the procfs interface, correctness when talking
to the sysfs interfaces will be enforced, as will correctness in the
thinkpad-acpi’s implementation of sysfs interfaces.</p>
<p>Also, any bugs in the thinkpad-acpi sysfs driver code or in the
thinkpad-acpi’s implementation of the sysfs interfaces will be fixed for
maximum correctness, even if that means changing an interface in
non-compatible ways.  As these interfaces mature both in the kernel and
in thinkpad-acpi, such changes should become quite rare.</p>
<p>Applications interfacing to the thinkpad-acpi sysfs interfaces must
follow all sysfs guidelines and correctly process all errors (the sysfs
interface makes extensive use of errors).  File descriptors and open /
close operations to the sysfs inodes must also be properly implemented.</p>
<p>The version of thinkpad-acpi’s sysfs interface is exported by the driver
as a driver attribute (see below).</p>
<p>Sysfs driver attributes are on the driver’s sysfs attribute space,
for 2.6.23+ this is /sys/bus/platform/drivers/thinkpad_acpi/ and
/sys/bus/platform/drivers/thinkpad_hwmon/</p>
<p>Sysfs device attributes are on the thinkpad_acpi device sysfs attribute
space, for 2.6.23+ this is /sys/devices/platform/thinkpad_acpi/.</p>
<p>Sysfs device attributes for the sensors and fan are on the
thinkpad_hwmon device’s sysfs attribute space, but you should locate it
looking for a hwmon device with the name attribute of “thinkpad”, or
better yet, through libsensors. For 4.14+ sysfs attributes were moved to the
hwmon device (/sys/bus/platform/devices/thinkpad_hwmon/hwmon/hwmon? or
/sys/class/hwmon/hwmon?).</p>
</section>
</section>
<section id="driver-version">
<h2>Driver version<a class="headerlink" href="#driver-version" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/driver</p>
<p>sysfs driver attribute: version</p>
<p>The driver name and version. No commands can be written to this file.</p>
</section>
<section id="sysfs-interface-version">
<h2>Sysfs interface version<a class="headerlink" href="#sysfs-interface-version" title="Permalink to this headline">¶</a></h2>
<p>sysfs driver attribute: interface_version</p>
<p>Version of the thinkpad-acpi sysfs interface, as an unsigned long
(output in hex format: 0xAAAABBCC), where:</p>
<blockquote>
<div><dl class="simple">
<dt>AAAA</dt><dd><ul class="simple">
<li><p>major revision</p></li>
</ul>
</dd>
<dt>BB</dt><dd><ul class="simple">
<li><p>minor revision</p></li>
</ul>
</dd>
<dt>CC</dt><dd><ul class="simple">
<li><p>bugfix revision</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
<p>The sysfs interface version changelog for the driver can be found at the
end of this document.  Changes to the sysfs interface done by the kernel
subsystems are not documented here, nor are they tracked by this
attribute.</p>
<p>Changes to the thinkpad-acpi sysfs interface are only considered
non-experimental when they are submitted to Linux mainline, at which
point the changes in this interface are documented and interface_version
may be updated.  If you are using any thinkpad-acpi features not yet
sent to mainline for merging, you do so on your own risk: these features
may disappear, or be implemented in a different and incompatible way by
the time they are merged in Linux mainline.</p>
<p>Changes that are backwards-compatible by nature (e.g. the addition of
attributes that do not change the way the other attributes work) do not
always warrant an update of interface_version.  Therefore, one must
expect that an attribute might not be there, and deal with it properly
(an attribute not being there <em>is</em> a valid way to make it clear that a
feature is not available in sysfs).</p>
</section>
<section id="hot-keys">
<h2>Hot keys<a class="headerlink" href="#hot-keys" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/hotkey</p>
<p>sysfs device attribute: hotkey_*</p>
<p>In a ThinkPad, the ACPI HKEY handler is responsible for communicating
some important events and also keyboard hot key presses to the operating
system.  Enabling the hotkey functionality of thinkpad-acpi signals the
firmware that such a driver is present, and modifies how the ThinkPad
firmware will behave in many situations.</p>
<p>The driver enables the HKEY (“hot key”) event reporting automatically
when loaded, and disables it when it is removed.</p>
<p>The driver will report HKEY events in the following format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ibm/hotkey HKEY 00000080 0000xxxx
</pre></div>
</div>
<p>Some of these events refer to hot key presses, but not all of them.</p>
<p>The driver will generate events over the input layer for hot keys and
radio switches, and over the ACPI netlink layer for other events.  The
input layer support accepts the standard IOCTLs to remap the keycodes
assigned to each hot key.</p>
<p>The hot key bit mask allows some control over which hot keys generate
events.  If a key is “masked” (bit set to 0 in the mask), the firmware
will handle it.  If it is “unmasked”, it signals the firmware that
thinkpad-acpi would prefer to handle it, if the firmware would be so
kind to allow it (and it often doesn’t!).</p>
<p>Not all bits in the mask can be modified.  Not all bits that can be
modified do anything.  Not all hot keys can be individually controlled
by the mask.  Some models do not support the mask at all.  The behaviour
of the mask is, therefore, highly dependent on the ThinkPad model.</p>
<p>The driver will filter out any unmasked hotkeys, so even if the firmware
doesn’t allow disabling an specific hotkey, the driver will not report
events for unmasked hotkeys.</p>
<p>Note that unmasking some keys prevents their default behavior.  For
example, if Fn+F5 is unmasked, that key will no longer enable/disable
Bluetooth by itself in firmware.</p>
<p>Note also that not all Fn key combinations are supported through ACPI
depending on the ThinkPad model and firmware version.  On those
ThinkPads, it is still possible to support some extra hotkeys by
polling the “CMOS NVRAM” at least 10 times per second.  The driver
attempts to enables this functionality automatically when required.</p>
<section id="procfs-notes">
<h3>procfs notes<a class="headerlink" href="#procfs-notes" title="Permalink to this headline">¶</a></h3>
<p>The following commands can be written to the /proc/acpi/ibm/hotkey file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 0xffffffff &gt; /proc/acpi/ibm/hotkey -- enable all hot keys
echo 0 &gt; /proc/acpi/ibm/hotkey -- disable all possible hot keys
... any other 8-hex-digit mask ...
echo reset &gt; /proc/acpi/ibm/hotkey -- restore the recommended mask
</pre></div>
</div>
<p>The following commands have been deprecated and will cause the kernel
to log a warning:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo enable &gt; /proc/acpi/ibm/hotkey -- does nothing
echo disable &gt; /proc/acpi/ibm/hotkey -- returns an error
</pre></div>
</div>
<p>The procfs interface does not support NVRAM polling control.  So as to
maintain maximum bug-to-bug compatibility, it does not report any masks,
nor does it allow one to manipulate the hot key mask when the firmware
does not support masks at all, even if NVRAM polling is in use.</p>
</section>
<section id="sysfs-notes">
<h3>sysfs notes<a class="headerlink" href="#sysfs-notes" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl>
<dt>hotkey_bios_enabled:</dt><dd><p>DEPRECATED, WILL BE REMOVED SOON.</p>
<p>Returns 0.</p>
</dd>
<dt>hotkey_bios_mask:</dt><dd><p>DEPRECATED, DON’T USE, WILL BE REMOVED IN THE FUTURE.</p>
<p>Returns the hot keys mask when thinkpad-acpi was loaded.
Upon module unload, the hot keys mask will be restored
to this value.   This is always 0x80c, because those are
the hotkeys that were supported by ancient firmware
without mask support.</p>
</dd>
<dt>hotkey_enable:</dt><dd><p>DEPRECATED, WILL BE REMOVED SOON.</p>
<p>0: returns -EPERM
1: does nothing</p>
</dd>
<dt>hotkey_mask:</dt><dd><p>bit mask to enable reporting (and depending on
the firmware, ACPI event generation) for each hot key
(see above).  Returns the current status of the hot keys
mask, and allows one to modify it.</p>
</dd>
<dt>hotkey_all_mask:</dt><dd><p>bit mask that should enable event reporting for all
supported hot keys, when echoed to hotkey_mask above.
Unless you know which events need to be handled
passively (because the firmware <em>will</em> handle them
anyway), do <em>not</em> use hotkey_all_mask.  Use
hotkey_recommended_mask, instead. You have been warned.</p>
</dd>
<dt>hotkey_recommended_mask:</dt><dd><p>bit mask that should enable event reporting for all
supported hot keys, except those which are always
handled by the firmware anyway.  Echo it to
hotkey_mask above, to use.  This is the default mask
used by the driver.</p>
</dd>
<dt>hotkey_source_mask:</dt><dd><p>bit mask that selects which hot keys will the driver
poll the NVRAM for.  This is auto-detected by the driver
based on the capabilities reported by the ACPI firmware,
but it can be overridden at runtime.</p>
<p>Hot keys whose bits are set in hotkey_source_mask are
polled for in NVRAM, and reported as hotkey events if
enabled in hotkey_mask.  Only a few hot keys are
available through CMOS NVRAM polling.</p>
<p>Warning: when in NVRAM mode, the volume up/down/mute
keys are synthesized according to changes in the mixer,
which uses a single volume up or volume down hotkey
press to unmute, as per the ThinkPad volume mixer user
interface.  When in ACPI event mode, volume up/down/mute
events are reported by the firmware and can behave
differently (and that behaviour changes with firmware
version – not just with firmware models – as well as
OSI(Linux) state).</p>
</dd>
<dt>hotkey_poll_freq:</dt><dd><p>frequency in Hz for hot key polling. It must be between
0 and 25 Hz.  Polling is only carried out when strictly
needed.</p>
<p>Setting hotkey_poll_freq to zero disables polling, and
will cause hot key presses that require NVRAM polling
to never be reported.</p>
<p>Setting hotkey_poll_freq too low may cause repeated
pressings of the same hot key to be misreported as a
single key press, or to not even be detected at all.
The recommended polling frequency is 10Hz.</p>
</dd>
<dt>hotkey_radio_sw:</dt><dd><p>If the ThinkPad has a hardware radio switch, this
attribute will read 0 if the switch is in the “radios
disabled” position, and 1 if the switch is in the
“radios enabled” position.</p>
<p>This attribute has poll()/select() support.</p>
</dd>
<dt>hotkey_tablet_mode:</dt><dd><p>If the ThinkPad has tablet capabilities, this attribute
will read 0 if the ThinkPad is in normal mode, and
1 if the ThinkPad is in tablet mode.</p>
<p>This attribute has poll()/select() support.</p>
</dd>
<dt>wakeup_reason:</dt><dd><p>Set to 1 if the system is waking up because the user
requested a bay ejection.  Set to 2 if the system is
waking up because the user requested the system to
undock.  Set to zero for normal wake-ups or wake-ups
due to unknown reasons.</p>
<p>This attribute has poll()/select() support.</p>
</dd>
<dt>wakeup_hotunplug_complete:</dt><dd><p>Set to 1 if the system was waken up because of an
undock or bay ejection request, and that request
was successfully completed.  At this point, it might
be useful to send the system back to sleep, at the
user’s choice.  Refer to HKEY events 0x4003 and
0x3003, below.</p>
<p>This attribute has poll()/select() support.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="input-layer-notes">
<h3>input layer notes<a class="headerlink" href="#input-layer-notes" title="Permalink to this headline">¶</a></h3>
<p>A Hot key is mapped to a single input layer EV_KEY event, possibly
followed by an EV_MSC MSC_SCAN event that shall contain that key’s scan
code.  An EV_SYN event will always be generated to mark the end of the
event block.</p>
<p>Do not use the EV_MSC MSC_SCAN events to process keys.  They are to be
used as a helper to remap keys, only.  They are particularly useful when
remapping KEY_UNKNOWN keys.</p>
<p>The events are available in an input device, with the following id:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Bus</p></td>
<td><p>BUS_HOST</p></td>
</tr>
<tr class="row-even"><td><p>vendor</p></td>
<td><p>0x1014 (PCI_VENDOR_ID_IBM)  or
0x17aa (PCI_VENDOR_ID_LENOVO)</p></td>
</tr>
<tr class="row-odd"><td><p>product</p></td>
<td><p>0x5054 (“TP”)</p></td>
</tr>
<tr class="row-even"><td><p>version</p></td>
<td><p>0x4101</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The version will have its LSB incremented if the keymap changes in a
backwards-compatible way.  The MSB shall always be 0x41 for this input
device.  If the MSB is not 0x41, do not use the device as described in
this section, as it is either something else (e.g. another input device
exported by a thinkpad driver, such as HDAPS) or its functionality has
been changed in a non-backwards compatible way.</p>
<p>Adding other event types for other functionalities shall be considered a
backwards-compatible change for this input device.</p>
<p>Thinkpad-acpi Hot Key event map (version 0x4101):</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 19%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ACPI</p></th>
<th class="head"><p>Scan</p></th>
<th class="head"></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"><p>event</p></th>
<th class="head"><p>code</p></th>
<th class="head"><p>Key</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>0x1001</p></td>
<td><p>0x00</p></td>
<td><p>FN+F1</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>0x1002</p></td>
<td><p>0x01</p></td>
<td><p>FN+F2</p></td>
<td><p>IBM: battery (rare)
Lenovo: Screen lock</p></td>
</tr>
<tr class="row-odd"><td><p>0x1003</p></td>
<td><p>0x02</p></td>
<td><p>FN+F3</p></td>
<td><p>Many IBM models always report
this hot key, even with hot keys
disabled or with Fn+F3 masked
off
IBM: screen lock, often turns
off the ThinkLight as side-effect
Lenovo: battery</p></td>
</tr>
<tr class="row-even"><td><p>0x1004</p></td>
<td><p>0x03</p></td>
<td><p>FN+F4</p></td>
<td><p>Sleep button (ACPI sleep button
semantics, i.e. sleep-to-RAM).
It always generates some kind
of event, either the hot key
event or an ACPI sleep button
event. The firmware may
refuse to generate further FN+F4
key presses until a S3 or S4 ACPI
sleep cycle is performed or some
time passes.</p></td>
</tr>
<tr class="row-odd"><td><p>0x1005</p></td>
<td><p>0x04</p></td>
<td><p>FN+F5</p></td>
<td><p>Radio.  Enables/disables
the internal Bluetooth hardware
and W-WAN card if left in control
of the firmware.  Does not affect
the WLAN card.
Should be used to turn on/off all
radios (Bluetooth+W-WAN+WLAN),
really.</p></td>
</tr>
<tr class="row-even"><td><p>0x1006</p></td>
<td><p>0x05</p></td>
<td><p>FN+F6</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>0x1007</p></td>
<td><p>0x06</p></td>
<td><p>FN+F7</p></td>
<td><p>Video output cycle.
Do you feel lucky today?</p></td>
</tr>
<tr class="row-even"><td><p>0x1008</p></td>
<td><p>0x07</p></td>
<td><p>FN+F8</p></td>
<td><p>IBM: toggle screen expand
Lenovo: configure UltraNav,
or toggle screen expand</p></td>
</tr>
<tr class="row-odd"><td><p>0x1009</p></td>
<td><p>0x08</p></td>
<td><p>FN+F9</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>0x100B</p></td>
<td><p>0x0A</p></td>
<td><p>FN+F11</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>0x100C</p></td>
<td><p>0x0B</p></td>
<td><p>FN+F12</p></td>
<td><p>Sleep to disk.  You are always
supposed to handle it yourself,
either through the ACPI event,
or through a hotkey event.
The firmware may refuse to
generate further FN+F12 key
press events until a S3 or S4
ACPI sleep cycle is performed,
or some time passes.</p></td>
</tr>
<tr class="row-odd"><td><p>0x100D</p></td>
<td><p>0x0C</p></td>
<td><p>FN+BACKSPACE</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>0x100E</p></td>
<td><p>0x0D</p></td>
<td><p>FN+INSERT</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>0x100F</p></td>
<td><p>0x0E</p></td>
<td><p>FN+DELETE</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>0x1010</p></td>
<td><p>0x0F</p></td>
<td><p>FN+HOME</p></td>
<td><p>Brightness up.  This key is
always handled by the firmware
in IBM ThinkPads, even when
unmasked.  Just leave it alone.
For Lenovo ThinkPads with a new
BIOS, it has to be handled either
by the ACPI OSI, or by userspace.
The driver does the right thing,
never mess with this.</p></td>
</tr>
<tr class="row-odd"><td><p>0x1011</p></td>
<td><p>0x10</p></td>
<td><p>FN+END</p></td>
<td><p>Brightness down.  See brightness
up for details.</p></td>
</tr>
<tr class="row-even"><td><p>0x1012</p></td>
<td><p>0x11</p></td>
<td><p>FN+PGUP</p></td>
<td><p>ThinkLight toggle.  This key is
always handled by the firmware,
even when unmasked.</p></td>
</tr>
<tr class="row-odd"><td><p>0x1013</p></td>
<td><p>0x12</p></td>
<td><p>FN+PGDOWN</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>0x1014</p></td>
<td><p>0x13</p></td>
<td><p>FN+SPACE</p></td>
<td><p>Zoom key</p></td>
</tr>
<tr class="row-odd"><td><p>0x1015</p></td>
<td><p>0x14</p></td>
<td><p>VOLUME UP</p></td>
<td><p>Internal mixer volume up. This
key is always handled by the
firmware, even when unmasked.
NOTE: Lenovo seems to be changing
this.</p></td>
</tr>
<tr class="row-even"><td><p>0x1016</p></td>
<td><p>0x15</p></td>
<td><p>VOLUME DOWN</p></td>
<td><p>Internal mixer volume up. This
key is always handled by the
firmware, even when unmasked.
NOTE: Lenovo seems to be changing
this.</p></td>
</tr>
<tr class="row-odd"><td><p>0x1017</p></td>
<td><p>0x16</p></td>
<td><p>MUTE</p></td>
<td><p>Mute internal mixer. This
key is always handled by the
firmware, even when unmasked.</p></td>
</tr>
<tr class="row-even"><td><p>0x1018</p></td>
<td><p>0x17</p></td>
<td><p>THINKPAD</p></td>
<td><p>ThinkPad/Access IBM/Lenovo key</p></td>
</tr>
<tr class="row-odd"><td><p>0x1019</p></td>
<td><p>0x18</p></td>
<td><p>unknown</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>0x1020</p></td>
<td><p>0x1F</p></td>
<td><p>unknown</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>The ThinkPad firmware does not allow one to differentiate when most hot
keys are pressed or released (either that, or we don’t know how to, yet).
For these keys, the driver generates a set of events for a key press and
immediately issues the same set of events for a key release.  It is
unknown by the driver if the ThinkPad firmware triggered these events on
hot key press or release, but the firmware will do it for either one, not
both.</p>
<p>If a key is mapped to KEY_RESERVED, it generates no input events at all.
If a key is mapped to KEY_UNKNOWN, it generates an input event that
includes an scan code.  If a key is mapped to anything else, it will
generate input device EV_KEY events.</p>
<p>In addition to the EV_KEY events, thinkpad-acpi may also issue EV_SW
events for switches:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>SW_RFKILL_ALL</p></td>
<td><p>T60 and later hardware rfkill rocker switch</p></td>
</tr>
<tr class="row-even"><td><p>SW_TABLET_MODE</p></td>
<td><p>Tablet ThinkPads HKEY events 0x5009 and 0x500A</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="non-hotkey-acpi-hkey-event-map">
<h2>Non hotkey ACPI HKEY event map<a class="headerlink" href="#non-hotkey-acpi-hkey-event-map" title="Permalink to this headline">¶</a></h2>
<p>Events that are never propagated by the driver:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>0x2304</p></td>
<td><p>System is waking up from suspend to undock</p></td>
</tr>
<tr class="row-even"><td><p>0x2305</p></td>
<td><p>System is waking up from suspend to eject bay</p></td>
</tr>
<tr class="row-odd"><td><p>0x2404</p></td>
<td><p>System is waking up from hibernation to undock</p></td>
</tr>
<tr class="row-even"><td><p>0x2405</p></td>
<td><p>System is waking up from hibernation to eject bay</p></td>
</tr>
<tr class="row-odd"><td><p>0x5001</p></td>
<td><p>Lid closed</p></td>
</tr>
<tr class="row-even"><td><p>0x5002</p></td>
<td><p>Lid opened</p></td>
</tr>
<tr class="row-odd"><td><p>0x5009</p></td>
<td><p>Tablet swivel: switched to tablet mode</p></td>
</tr>
<tr class="row-even"><td><p>0x500A</p></td>
<td><p>Tablet swivel: switched to normal mode</p></td>
</tr>
<tr class="row-odd"><td><p>0x5010</p></td>
<td><p>Brightness level changed/control event</p></td>
</tr>
<tr class="row-even"><td><p>0x6000</p></td>
<td><p>KEYBOARD: Numlock key pressed</p></td>
</tr>
<tr class="row-odd"><td><p>0x6005</p></td>
<td><p>KEYBOARD: Fn key pressed (TO BE VERIFIED)</p></td>
</tr>
<tr class="row-even"><td><p>0x7000</p></td>
<td><p>Radio Switch may have changed state</p></td>
</tr>
</tbody>
</table>
<p>Events that are propagated by the driver to userspace:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>0x2313</p></td>
<td><p>ALARM: System is waking up from suspend because
the battery is nearly empty</p></td>
</tr>
<tr class="row-even"><td><p>0x2413</p></td>
<td><p>ALARM: System is waking up from hibernation because
the battery is nearly empty</p></td>
</tr>
<tr class="row-odd"><td><p>0x3003</p></td>
<td><p>Bay ejection (see 0x2x05) complete, can sleep again</p></td>
</tr>
<tr class="row-even"><td><p>0x3006</p></td>
<td><p>Bay hotplug request (hint to power up SATA link when
the optical drive tray is ejected)</p></td>
</tr>
<tr class="row-odd"><td><p>0x4003</p></td>
<td><p>Undocked (see 0x2x04), can sleep again</p></td>
</tr>
<tr class="row-even"><td><p>0x4010</p></td>
<td><p>Docked into hotplug port replicator (non-ACPI dock)</p></td>
</tr>
<tr class="row-odd"><td><p>0x4011</p></td>
<td><p>Undocked from hotplug port replicator (non-ACPI dock)</p></td>
</tr>
<tr class="row-even"><td><p>0x500B</p></td>
<td><p>Tablet pen inserted into its storage bay</p></td>
</tr>
<tr class="row-odd"><td><p>0x500C</p></td>
<td><p>Tablet pen removed from its storage bay</p></td>
</tr>
<tr class="row-even"><td><p>0x6011</p></td>
<td><p>ALARM: battery is too hot</p></td>
</tr>
<tr class="row-odd"><td><p>0x6012</p></td>
<td><p>ALARM: battery is extremely hot</p></td>
</tr>
<tr class="row-even"><td><p>0x6021</p></td>
<td><p>ALARM: a sensor is too hot</p></td>
</tr>
<tr class="row-odd"><td><p>0x6022</p></td>
<td><p>ALARM: a sensor is extremely hot</p></td>
</tr>
<tr class="row-even"><td><p>0x6030</p></td>
<td><p>System thermal table changed</p></td>
</tr>
<tr class="row-odd"><td><p>0x6032</p></td>
<td><p>Thermal Control command set completion  (DYTC, Windows)</p></td>
</tr>
<tr class="row-even"><td><p>0x6040</p></td>
<td><p>Nvidia Optimus/AC adapter related (TO BE VERIFIED)</p></td>
</tr>
<tr class="row-odd"><td><p>0x60C0</p></td>
<td><p>X1 Yoga 2016, Tablet mode status changed</p></td>
</tr>
<tr class="row-even"><td><p>0x60F0</p></td>
<td><p>Thermal Transformation changed (GMTS, Windows)</p></td>
</tr>
</tbody>
</table>
<p>Battery nearly empty alarms are a last resort attempt to get the
operating system to hibernate or shutdown cleanly (0x2313), or shutdown
cleanly (0x2413) before power is lost.  They must be acted upon, as the
wake up caused by the firmware will have negated most safety nets…</p>
<p>When any of the “too hot” alarms happen, according to Lenovo the user
should suspend or hibernate the laptop (and in the case of battery
alarms, unplug the AC adapter) to let it cool down.  These alarms do
signal that something is wrong, they should never happen on normal
operating conditions.</p>
<p>The “extremely hot” alarms are emergencies.  According to Lenovo, the
operating system is to force either an immediate suspend or hibernate
cycle, or a system shutdown.  Obviously, something is very wrong if this
happens.</p>
<section id="brightness-hotkey-notes">
<h3>Brightness hotkey notes<a class="headerlink" href="#brightness-hotkey-notes" title="Permalink to this headline">¶</a></h3>
<p>Don’t mess with the brightness hotkeys in a Thinkpad.  If you want
notifications for OSD, use the sysfs backlight class event support.</p>
<p>The driver will issue KEY_BRIGHTNESS_UP and KEY_BRIGHTNESS_DOWN events
automatically for the cases were userspace has to do something to
implement brightness changes.  When you override these events, you will
either fail to handle properly the ThinkPads that require explicit
action to change backlight brightness, or the ThinkPads that require
that no action be taken to work properly.</p>
</section>
</section>
<section id="bluetooth">
<h2>Bluetooth<a class="headerlink" href="#bluetooth" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/bluetooth</p>
<p>sysfs device attribute: bluetooth_enable (deprecated)</p>
<p>sysfs rfkill class: switch “tpacpi_bluetooth_sw”</p>
<p>This feature shows the presence and current state of a ThinkPad
Bluetooth device in the internal ThinkPad CDC slot.</p>
<p>If the ThinkPad supports it, the Bluetooth state is stored in NVRAM,
so it is kept across reboots and power-off.</p>
<section id="id1">
<h3>Procfs notes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>If Bluetooth is installed, the following commands can be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo enable &gt; /proc/acpi/ibm/bluetooth
echo disable &gt; /proc/acpi/ibm/bluetooth
</pre></div>
</div>
</section>
<section id="id2">
<h3>Sysfs notes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>If the Bluetooth CDC card is installed, it can be enabled /
disabled through the “bluetooth_enable” thinkpad-acpi device
attribute, and its current status can also be queried.</p>
<p>enable:</p>
<blockquote>
<div><ul class="simple">
<li><p>0: disables Bluetooth / Bluetooth is disabled</p></li>
<li><p>1: enables Bluetooth / Bluetooth is enabled.</p></li>
</ul>
</div></blockquote>
<p>Note: this interface has been superseded by the generic rfkill
class.  It has been deprecated, and it will be removed in year
2010.</p>
<p>rfkill controller switch “tpacpi_bluetooth_sw”: refer to
<a class="reference internal" href="../../driver-api/rfkill.html"><span class="doc">rfkill - RF kill switch support</span></a> for details.</p>
</div></blockquote>
</section>
</section>
<section id="video-output-control-proc-acpi-ibm-video">
<h2>Video output control – /proc/acpi/ibm/video<a class="headerlink" href="#video-output-control-proc-acpi-ibm-video" title="Permalink to this headline">¶</a></h2>
<p>This feature allows control over the devices used for video output -
LCD, CRT or DVI (if available). The following commands are available:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo lcd_enable &gt; /proc/acpi/ibm/video
echo lcd_disable &gt; /proc/acpi/ibm/video
echo crt_enable &gt; /proc/acpi/ibm/video
echo crt_disable &gt; /proc/acpi/ibm/video
echo dvi_enable &gt; /proc/acpi/ibm/video
echo dvi_disable &gt; /proc/acpi/ibm/video
echo auto_enable &gt; /proc/acpi/ibm/video
echo auto_disable &gt; /proc/acpi/ibm/video
echo expand_toggle &gt; /proc/acpi/ibm/video
echo video_switch &gt; /proc/acpi/ibm/video
</pre></div>
</div>
<dl class="simple">
<dt>NOTE:</dt><dd><p>Access to this feature is restricted to processes owning the
CAP_SYS_ADMIN capability for safety reasons, as it can interact badly
enough with some versions of X.org to crash it.</p>
</dd>
</dl>
<p>Each video output device can be enabled or disabled individually.
Reading /proc/acpi/ibm/video shows the status of each device.</p>
<p>Automatic video switching can be enabled or disabled.  When automatic
video switching is enabled, certain events (e.g. opening the lid,
docking or undocking) cause the video output device to change
automatically. While this can be useful, it also causes flickering
and, on the X40, video corruption. By disabling automatic switching,
the flickering or video corruption can be avoided.</p>
<p>The video_switch command cycles through the available video outputs
(it simulates the behavior of Fn-F7).</p>
<p>Video expansion can be toggled through this feature. This controls
whether the display is expanded to fill the entire LCD screen when a
mode with less than full resolution is used. Note that the current
video expansion status cannot be determined through this feature.</p>
<p>Note that on many models (particularly those using Radeon graphics
chips) the X driver configures the video card in a way which prevents
Fn-F7 from working. This also disables the video output switching
features of this driver, as it uses the same ACPI methods as
Fn-F7. Video switching on the console should still work.</p>
<p>UPDATE: refer to <a class="reference external" href="https://bugs.freedesktop.org/show_bug.cgi?id=2000">https://bugs.freedesktop.org/show_bug.cgi?id=2000</a></p>
</section>
<section id="thinklight-control">
<h2>ThinkLight control<a class="headerlink" href="#thinklight-control" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/light</p>
<p>sysfs attributes: as per LED class, for the “tpacpi::thinklight” LED</p>
<section id="id3">
<h3>procfs notes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The ThinkLight status can be read and set through the procfs interface.  A
few models which do not make the status available will show the ThinkLight
status as “unknown”. The available commands are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo on  &gt; /proc/acpi/ibm/light
echo off &gt; /proc/acpi/ibm/light
</pre></div>
</div>
</section>
<section id="id4">
<h3>sysfs notes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The ThinkLight sysfs interface is documented by the LED class
documentation, in <a class="reference internal" href="../../leds/leds-class.html"><span class="doc">LED handling under Linux</span></a>.  The ThinkLight LED name
is “tpacpi::thinklight”.</p>
<p>Due to limitations in the sysfs LED class, if the status of the ThinkLight
cannot be read or if it is unknown, thinkpad-acpi will report it as “off”.
It is impossible to know if the status returned through sysfs is valid.</p>
</section>
</section>
<section id="cmos-ucms-control">
<h2>CMOS/UCMS control<a class="headerlink" href="#cmos-ucms-control" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/cmos</p>
<p>sysfs device attribute: cmos_command</p>
<p>This feature is mostly used internally by the ACPI firmware to keep the legacy
CMOS NVRAM bits in sync with the current machine state, and to record this
state so that the ThinkPad will retain such settings across reboots.</p>
<p>Some of these commands actually perform actions in some ThinkPad models, but
this is expected to disappear more and more in newer models.  As an example, in
a T43 and in a X40, commands 12 and 13 still control the ThinkLight state for
real, but commands 0 to 2 don’t control the mixer anymore (they have been
phased out) and just update the NVRAM.</p>
<p>The range of valid cmos command numbers is 0 to 21, but not all have an
effect and the behavior varies from model to model.  Here is the behavior
on the X40 (tpb is the ThinkPad Buttons utility):</p>
<blockquote>
<div><ul class="simple">
<li><p>0 - Related to “Volume down” key press</p></li>
<li><p>1 - Related to “Volume up” key press</p></li>
<li><p>2 - Related to “Mute on” key press</p></li>
<li><p>3 - Related to “Access IBM” key press</p></li>
<li><p>4 - Related to “LCD brightness up” key press</p></li>
<li><p>5 - Related to “LCD brightness down” key press</p></li>
<li><p>11 - Related to “toggle screen expansion” key press/function</p></li>
<li><p>12 - Related to “ThinkLight on”</p></li>
<li><p>13 - Related to “ThinkLight off”</p></li>
<li><p>14 - Related to “ThinkLight” key press (toggle ThinkLight)</p></li>
</ul>
</div></blockquote>
<p>The cmos command interface is prone to firmware split-brain problems, as
in newer ThinkPads it is just a compatibility layer.  Do not use it, it is
exported just as a debug tool.</p>
</section>
<section id="led-control">
<h2>LED control<a class="headerlink" href="#led-control" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/led
sysfs attributes: as per LED class, see below for names</p>
<p>Some of the LED indicators can be controlled through this feature.  On
some older ThinkPad models, it is possible to query the status of the
LED indicators as well.  Newer ThinkPads cannot query the real status
of the LED indicators.</p>
<p>Because misuse of the LEDs could induce an unaware user to perform
dangerous actions (like undocking or ejecting a bay device while the
buses are still active), or mask an important alarm (such as a nearly
empty battery, or a broken battery), access to most LEDs is
restricted.</p>
<p>Unrestricted access to all LEDs requires that thinkpad-acpi be
compiled with the CONFIG_THINKPAD_ACPI_UNSAFE_LEDS option enabled.
Distributions must never enable this option.  Individual users that
are aware of the consequences are welcome to enabling it.</p>
<p>Audio mute and microphone mute LEDs are supported, but currently not
visible to userspace. They are used by the snd-hda-intel audio driver.</p>
<section id="id5">
<h3>procfs notes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The available commands are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;&lt;LED number&gt; on&#39; &gt;/proc/acpi/ibm/led
echo &#39;&lt;LED number&gt; off&#39; &gt;/proc/acpi/ibm/led
echo &#39;&lt;LED number&gt; blink&#39; &gt;/proc/acpi/ibm/led
</pre></div>
</div>
<p>The &lt;LED number&gt; range is 0 to 15. The set of LEDs that can be
controlled varies from model to model. Here is the common ThinkPad
mapping:</p>
<blockquote>
<div><ul class="simple">
<li><p>0 - power</p></li>
<li><p>1 - battery (orange)</p></li>
<li><p>2 - battery (green)</p></li>
<li><p>3 - UltraBase/dock</p></li>
<li><p>4 - UltraBay</p></li>
<li><p>5 - UltraBase battery slot</p></li>
<li><p>6 - (unknown)</p></li>
<li><p>7 - standby</p></li>
<li><p>8 - dock status 1</p></li>
<li><p>9 - dock status 2</p></li>
<li><p>10, 11 - (unknown)</p></li>
<li><p>12 - thinkvantage</p></li>
<li><p>13, 14, 15 - (unknown)</p></li>
</ul>
</div></blockquote>
<p>All of the above can be turned on and off and can be made to blink.</p>
</section>
<section id="id6">
<h3>sysfs notes<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The ThinkPad LED sysfs interface is described in detail by the LED class
documentation, in <a class="reference internal" href="../../leds/leds-class.html"><span class="doc">LED handling under Linux</span></a>.</p>
<p>The LEDs are named (in LED ID order, from 0 to 12):
“tpacpi::power”, “tpacpi:orange:batt”, “tpacpi:green:batt”,
“tpacpi::dock_active”, “tpacpi::bay_active”, “tpacpi::dock_batt”,
“tpacpi::unknown_led”, “tpacpi::standby”, “tpacpi::dock_status1”,
“tpacpi::dock_status2”, “tpacpi::unknown_led2”, “tpacpi::unknown_led3”,
“tpacpi::thinkvantage”.</p>
<p>Due to limitations in the sysfs LED class, if the status of the LED
indicators cannot be read due to an error, thinkpad-acpi will report it as
a brightness of zero (same as LED off).</p>
<p>If the thinkpad firmware doesn’t support reading the current status,
trying to read the current LED brightness will just return whatever
brightness was last written to that attribute.</p>
<p>These LEDs can blink using hardware acceleration.  To request that a
ThinkPad indicator LED should blink in hardware accelerated mode, use the
“timer” trigger, and leave the delay_on and delay_off parameters set to
zero (to request hardware acceleration autodetection).</p>
<p>LEDs that are known not to exist in a given ThinkPad model are not
made available through the sysfs interface.  If you have a dock and you
notice there are LEDs listed for your ThinkPad that do not exist (and
are not in the dock), or if you notice that there are missing LEDs,
a report to <a class="reference external" href="mailto:ibm-acpi-devel&#37;&#52;&#48;lists&#46;sourceforge&#46;net">ibm-acpi-devel<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a> is appreciated.</p>
</section>
</section>
<section id="acpi-sounds-proc-acpi-ibm-beep">
<h2>ACPI sounds – /proc/acpi/ibm/beep<a class="headerlink" href="#acpi-sounds-proc-acpi-ibm-beep" title="Permalink to this headline">¶</a></h2>
<p>The BEEP method is used internally by the ACPI firmware to provide
audible alerts in various situations. This feature allows the same
sounds to be triggered manually.</p>
<p>The commands are non-negative integer numbers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &lt;number&gt; &gt;/proc/acpi/ibm/beep
</pre></div>
</div>
<p>The valid &lt;number&gt; range is 0 to 17. Not all numbers trigger sounds
and the sounds vary from model to model. Here is the behavior on the
X40:</p>
<blockquote>
<div><ul class="simple">
<li><p>0 - stop a sound in progress (but use 17 to stop 16)</p></li>
<li><p>2 - two beeps, pause, third beep (“low battery”)</p></li>
<li><p>3 - single beep</p></li>
<li><p>4 - high, followed by low-pitched beep (“unable”)</p></li>
<li><p>5 - single beep</p></li>
<li><p>6 - very high, followed by high-pitched beep (“AC/DC”)</p></li>
<li><p>7 - high-pitched beep</p></li>
<li><p>9 - three short beeps</p></li>
<li><p>10 - very long beep</p></li>
<li><p>12 - low-pitched beep</p></li>
<li><p>15 - three high-pitched beeps repeating constantly, stop with 0</p></li>
<li><p>16 - one medium-pitched beep repeating constantly, stop with 17</p></li>
<li><p>17 - stop 16</p></li>
</ul>
</div></blockquote>
</section>
<section id="temperature-sensors">
<h2>Temperature sensors<a class="headerlink" href="#temperature-sensors" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/thermal</p>
<p>sysfs device attributes: (hwmon “thinkpad”) temp*_input</p>
<p>Most ThinkPads include six or more separate temperature sensors but only
expose the CPU temperature through the standard ACPI methods.  This
feature shows readings from up to eight different sensors on older
ThinkPads, and up to sixteen different sensors on newer ThinkPads.</p>
<p>For example, on the X40, a typical output may be:</p>
<dl class="simple">
<dt>temperatures:</dt><dd><p>42 42 45 41 36 -128 33 -128</p>
</dd>
</dl>
<p>On the T43/p, a typical output may be:</p>
<dl class="simple">
<dt>temperatures:</dt><dd><p>48 48 36 52 38 -128 31 -128 48 52 48 -128 -128 -128 -128 -128</p>
</dd>
</dl>
<p>The mapping of thermal sensors to physical locations varies depending on
system-board model (and thus, on ThinkPad model).</p>
<p><a class="reference external" href="https://thinkwiki.org/wiki/Thermal_Sensors">https://thinkwiki.org/wiki/Thermal_Sensors</a> is a public wiki page that
tries to track down these locations for various models.</p>
<p>Most (newer?) models seem to follow this pattern:</p>
<ul class="simple">
<li><p>1:  CPU</p></li>
<li><p>2:  (depends on model)</p></li>
<li><p>3:  (depends on model)</p></li>
<li><p>4:  GPU</p></li>
<li><p>5:  Main battery: main sensor</p></li>
<li><p>6:  Bay battery: main sensor</p></li>
<li><p>7:  Main battery: secondary sensor</p></li>
<li><p>8:  Bay battery: secondary sensor</p></li>
<li><p>9-15: (depends on model)</p></li>
</ul>
<p>For the R51 (source: Thomas Gruber):</p>
<ul class="simple">
<li><p>2:  Mini-PCI</p></li>
<li><p>3:  Internal HDD</p></li>
</ul>
<p>For the T43, T43/p (source: Shmidoax/Thinkwiki.org)
<a class="reference external" href="https://thinkwiki.org/wiki/Thermal_Sensors#ThinkPad_T43.2C_T43p">https://thinkwiki.org/wiki/Thermal_Sensors#ThinkPad_T43.2C_T43p</a></p>
<ul class="simple">
<li><p>2:  System board, left side (near PCMCIA slot), reported as HDAPS temp</p></li>
<li><p>3:  PCMCIA slot</p></li>
<li><p>9:  MCH (northbridge) to DRAM Bus</p></li>
<li><dl class="simple">
<dt>10: Clock-generator, mini-pci card and ICH (southbridge), under Mini-PCI</dt><dd><p>card, under touchpad</p>
</dd>
</dl>
</li>
<li><p>11: Power regulator, underside of system board, below F2 key</p></li>
</ul>
<p>The A31 has a very atypical layout for the thermal sensors
(source: Milos Popovic, <a class="reference external" href="https://thinkwiki.org/wiki/Thermal_Sensors#ThinkPad_A31">https://thinkwiki.org/wiki/Thermal_Sensors#ThinkPad_A31</a>)</p>
<ul class="simple">
<li><p>1:  CPU</p></li>
<li><p>2:  Main Battery: main sensor</p></li>
<li><p>3:  Power Converter</p></li>
<li><p>4:  Bay Battery: main sensor</p></li>
<li><p>5:  MCH (northbridge)</p></li>
<li><p>6:  PCMCIA/ambient</p></li>
<li><p>7:  Main Battery: secondary sensor</p></li>
<li><p>8:  Bay Battery: secondary sensor</p></li>
</ul>
<section id="id7">
<h3>Procfs notes<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Readings from sensors that are not available return -128.
No commands can be written to this file.</p>
</div></blockquote>
</section>
<section id="id8">
<h3>Sysfs notes<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Sensors that are not available return the ENXIO error.  This
status may change at runtime, as there are hotplug thermal
sensors, like those inside the batteries and docks.</p>
<p>thinkpad-acpi thermal sensors are reported through the hwmon
subsystem, and follow all of the hwmon guidelines at
Documentation/hwmon.</p>
</div></blockquote>
</section>
</section>
<section id="experimental-embedded-controller-register-dump">
<h2>EXPERIMENTAL: Embedded controller register dump<a class="headerlink" href="#experimental-embedded-controller-register-dump" title="Permalink to this headline">¶</a></h2>
<p>This feature is not included in the thinkpad driver anymore.
Instead the EC can be accessed through /sys/kernel/debug/ec with
a userspace tool which can be found here:
<a class="reference external" href="ftp://ftp.suse.com/pub/people/trenn/sources/ec">ftp://ftp.suse.com/pub/people/trenn/sources/ec</a></p>
<p>Use it to determine the register holding the fan
speed on some models. To do that, do the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>make sure the battery is fully charged</p></li>
<li><p>make sure the fan is running</p></li>
<li><p>use above mentioned tool to read out the EC</p></li>
</ul>
</div></blockquote>
<p>Often fan and temperature values vary between
readings. Since temperatures don’t change vary fast, you can take
several quick dumps to eliminate them.</p>
<p>You can use a similar method to figure out the meaning of other
embedded controller registers - e.g. make sure nothing else changes
except the charging or discharging battery to determine which
registers contain the current battery capacity, etc. If you experiment
with this, do send me your results (including some complete dumps with
a description of the conditions when they were taken.)</p>
</section>
<section id="lcd-brightness-control">
<h2>LCD brightness control<a class="headerlink" href="#lcd-brightness-control" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/brightness</p>
<p>sysfs backlight device “thinkpad_screen”</p>
<p>This feature allows software control of the LCD brightness on ThinkPad
models which don’t have a hardware brightness slider.</p>
<p>It has some limitations: the LCD backlight cannot be actually turned
on or off by this interface, it just controls the backlight brightness
level.</p>
<p>On IBM (and some of the earlier Lenovo) ThinkPads, the backlight control
has eight brightness levels, ranging from 0 to 7.  Some of the levels
may not be distinct.  Later Lenovo models that implement the ACPI
display backlight brightness control methods have 16 levels, ranging
from 0 to 15.</p>
<p>For IBM ThinkPads, there are two interfaces to the firmware for direct
brightness control, EC and UCMS (or CMOS).  To select which one should be
used, use the brightness_mode module parameter: brightness_mode=1 selects
EC mode, brightness_mode=2 selects UCMS mode, brightness_mode=3 selects EC
mode with NVRAM backing (so that brightness changes are remembered across
shutdown/reboot).</p>
<p>The driver tries to select which interface to use from a table of
defaults for each ThinkPad model.  If it makes a wrong choice, please
report this as a bug, so that we can fix it.</p>
<p>Lenovo ThinkPads only support brightness_mode=2 (UCMS).</p>
<p>When display backlight brightness controls are available through the
standard ACPI interface, it is best to use it instead of this direct
ThinkPad-specific interface.  The driver will disable its native
backlight brightness control interface if it detects that the standard
ACPI interface is available in the ThinkPad.</p>
<p>If you want to use the thinkpad-acpi backlight brightness control
instead of the generic ACPI video backlight brightness control for some
reason, you should use the acpi_backlight=vendor kernel parameter.</p>
<p>The brightness_enable module parameter can be used to control whether
the LCD brightness control feature will be enabled when available.
brightness_enable=0 forces it to be disabled.  brightness_enable=1
forces it to be enabled when available, even if the standard ACPI
interface is also available.</p>
<section id="id9">
<h3>Procfs notes<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>The available commands are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo up   &gt;/proc/acpi/ibm/brightness
echo down &gt;/proc/acpi/ibm/brightness
echo &#39;level &lt;level&gt;&#39; &gt;/proc/acpi/ibm/brightness
</pre></div>
</div>
</section>
<section id="id10">
<h3>Sysfs notes<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>The interface is implemented through the backlight sysfs class, which is
poorly documented at this time.</p>
<p>Locate the thinkpad_screen device under /sys/class/backlight, and inside
it there will be the following attributes:</p>
<blockquote>
<div><dl class="simple">
<dt>max_brightness:</dt><dd><p>Reads the maximum brightness the hardware can be set to.
The minimum is always zero.</p>
</dd>
<dt>actual_brightness:</dt><dd><p>Reads what brightness the screen is set to at this instant.</p>
</dd>
<dt>brightness:</dt><dd><p>Writes request the driver to change brightness to the
given value.  Reads will tell you what brightness the
driver is trying to set the display to when “power” is set
to zero and the display has not been dimmed by a kernel
power management event.</p>
</dd>
<dt>power:</dt><dd><p>power management mode, where 0 is “display on”, and 1 to 3
will dim the display backlight to brightness level 0
because thinkpad-acpi cannot really turn the backlight
off.  Kernel power management events can temporarily
increase the current power management level, i.e. they can
dim the display.</p>
</dd>
</dl>
</div></blockquote>
<p>WARNING:</p>
<blockquote>
<div><p>Whatever you do, do NOT ever call thinkpad-acpi backlight-level change
interface and the ACPI-based backlight level change interface
(available on newer BIOSes, and driven by the Linux ACPI video driver)
at the same time.  The two will interact in bad ways, do funny things,
and maybe reduce the life of the backlight lamps by needlessly kicking
its level up and down at every change.</p>
</div></blockquote>
</section>
</section>
<section id="volume-control-console-audio-control">
<h2>Volume control (Console Audio control)<a class="headerlink" href="#volume-control-console-audio-control" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/volume</p>
<p>ALSA: “ThinkPad Console Audio Control”, default ID: “ThinkPadEC”</p>
<p>NOTE: by default, the volume control interface operates in read-only
mode, as it is supposed to be used for on-screen-display purposes.
The read/write mode can be enabled through the use of the
“volume_control=1” module parameter.</p>
<p>NOTE: distros are urged to not enable volume_control by default, this
should be done by the local admin only.  The ThinkPad UI is for the
console audio control to be done through the volume keys only, and for
the desktop environment to just provide on-screen-display feedback.
Software volume control should be done only in the main AC97/HDA
mixer.</p>
<section id="about-the-thinkpad-console-audio-control">
<h3>About the ThinkPad Console Audio control<a class="headerlink" href="#about-the-thinkpad-console-audio-control" title="Permalink to this headline">¶</a></h3>
<p>ThinkPads have a built-in amplifier and muting circuit that drives the
console headphone and speakers.  This circuit is after the main AC97
or HDA mixer in the audio path, and under exclusive control of the
firmware.</p>
<p>ThinkPads have three special hotkeys to interact with the console
audio control: volume up, volume down and mute.</p>
<p>It is worth noting that the normal way the mute function works (on
ThinkPads that do not have a “mute LED”) is:</p>
<ol class="arabic simple">
<li><p>Press mute to mute.  It will <em>always</em> mute, you can press it as
many times as you want, and the sound will remain mute.</p></li>
<li><p>Press either volume key to unmute the ThinkPad (it will _not_
change the volume, it will just unmute).</p></li>
</ol>
<p>This is a very superior design when compared to the cheap software-only
mute-toggle solution found on normal consumer laptops:  you can be
absolutely sure the ThinkPad will not make noise if you press the mute
button, no matter the previous state.</p>
<p>The IBM ThinkPads, and the earlier Lenovo ThinkPads have variable-gain
amplifiers driving the speakers and headphone output, and the firmware
also handles volume control for the headphone and speakers on these
ThinkPads without any help from the operating system (this volume
control stage exists after the main AC97 or HDA mixer in the audio
path).</p>
<p>The newer Lenovo models only have firmware mute control, and depend on
the main HDA mixer to do volume control (which is done by the operating
system).  In this case, the volume keys are filtered out for unmute
key press (there are some firmware bugs in this area) and delivered as
normal key presses to the operating system (thinkpad-acpi is not
involved).</p>
</section>
<section id="the-thinkpad-acpi-volume-control">
<h3>The ThinkPad-ACPI volume control<a class="headerlink" href="#the-thinkpad-acpi-volume-control" title="Permalink to this headline">¶</a></h3>
<p>The preferred way to interact with the Console Audio control is the
ALSA interface.</p>
<p>The legacy procfs interface allows one to read the current state,
and if volume control is enabled, accepts the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo up   &gt;/proc/acpi/ibm/volume
echo down &gt;/proc/acpi/ibm/volume
echo mute &gt;/proc/acpi/ibm/volume
echo unmute &gt;/proc/acpi/ibm/volume
echo &#39;level &lt;level&gt;&#39; &gt;/proc/acpi/ibm/volume
</pre></div>
</div>
<p>The &lt;level&gt; number range is 0 to 14 although not all of them may be
distinct. To unmute the volume after the mute command, use either the
up or down command (the level command will not unmute the volume), or
the unmute command.</p>
<p>You can use the volume_capabilities parameter to tell the driver
whether your thinkpad has volume control or mute-only control:
volume_capabilities=1 for mixers with mute and volume control,
volume_capabilities=2 for mixers with only mute control.</p>
<p>If the driver misdetects the capabilities for your ThinkPad model,
please report this to <a class="reference external" href="mailto:ibm-acpi-devel&#37;&#52;&#48;lists&#46;sourceforge&#46;net">ibm-acpi-devel<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a>, so that we
can update the driver.</p>
<p>There are two strategies for volume control.  To select which one
should be used, use the volume_mode module parameter: volume_mode=1
selects EC mode, and volume_mode=3 selects EC mode with NVRAM backing
(so that volume/mute changes are remembered across shutdown/reboot).</p>
<p>The driver will operate in volume_mode=3 by default. If that does not
work well on your ThinkPad model, please report this to
<a class="reference external" href="mailto:ibm-acpi-devel&#37;&#52;&#48;lists&#46;sourceforge&#46;net">ibm-acpi-devel<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a>.</p>
<p>The driver supports the standard ALSA module parameters.  If the ALSA
mixer is disabled, the driver will disable all volume functionality.</p>
</section>
</section>
<section id="fan-control-and-monitoring-fan-speed-fan-enable-disable">
<h2>Fan control and monitoring: fan speed, fan enable/disable<a class="headerlink" href="#fan-control-and-monitoring-fan-speed-fan-enable-disable" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/fan</p>
<p>sysfs device attributes: (hwmon “thinkpad”) fan1_input, pwm1, pwm1_enable, fan2_input</p>
<p>sysfs hwmon driver attributes: fan_watchdog</p>
<dl class="simple">
<dt>NOTE NOTE NOTE:</dt><dd><p>fan control operations are disabled by default for
safety reasons.  To enable them, the module parameter “fan_control=1”
must be given to thinkpad-acpi.</p>
</dd>
</dl>
<p>This feature attempts to show the current fan speed, control mode and
other fan data that might be available.  The speed is read directly
from the hardware registers of the embedded controller.  This is known
to work on later R, T, X and Z series ThinkPads but may show a bogus
value on other models.</p>
<p>Some Lenovo ThinkPads support a secondary fan.  This fan cannot be
controlled separately, it shares the main fan control.</p>
<section id="fan-levels">
<h3>Fan levels<a class="headerlink" href="#fan-levels" title="Permalink to this headline">¶</a></h3>
<p>Most ThinkPad fans work in “levels” at the firmware interface.  Level 0
stops the fan.  The higher the level, the higher the fan speed, although
adjacent levels often map to the same fan speed.  7 is the highest
level, where the fan reaches the maximum recommended speed.</p>
<p>Level “auto” means the EC changes the fan level according to some
internal algorithm, usually based on readings from the thermal sensors.</p>
<p>There is also a “full-speed” level, also known as “disengaged” level.
In this level, the EC disables the speed-locked closed-loop fan control,
and drives the fan as fast as it can go, which might exceed hardware
limits, so use this level with caution.</p>
<p>The fan usually ramps up or down slowly from one speed to another, and
it is normal for the EC to take several seconds to react to fan
commands.  The full-speed level may take up to two minutes to ramp up to
maximum speed, and in some ThinkPads, the tachometer readings go stale
while the EC is transitioning to the full-speed level.</p>
<p>WARNING WARNING WARNING: do not leave the fan disabled unless you are
monitoring all of the temperature sensor readings and you are ready to
enable it if necessary to avoid overheating.</p>
<p>An enabled fan in level “auto” may stop spinning if the EC decides the
ThinkPad is cool enough and doesn’t need the extra airflow.  This is
normal, and the EC will spin the fan up if the various thermal readings
rise too much.</p>
<p>On the X40, this seems to depend on the CPU and HDD temperatures.
Specifically, the fan is turned on when either the CPU temperature
climbs to 56 degrees or the HDD temperature climbs to 46 degrees.  The
fan is turned off when the CPU temperature drops to 49 degrees and the
HDD temperature drops to 41 degrees.  These thresholds cannot
currently be controlled.</p>
<p>The ThinkPad’s ACPI DSDT code will reprogram the fan on its own when
certain conditions are met.  It will override any fan programming done
through thinkpad-acpi.</p>
<p>The thinkpad-acpi kernel driver can be programmed to revert the fan
level to a safe setting if userspace does not issue one of the procfs
fan commands: “enable”, “disable”, “level” or “watchdog”, or if there
are no writes to pwm1_enable (or to pwm1 <em>if and only if</em> pwm1_enable is
set to 1, manual mode) within a configurable amount of time of up to
120 seconds.  This functionality is called fan safety watchdog.</p>
<p>Note that the watchdog timer stops after it enables the fan.  It will be
rearmed again automatically (using the same interval) when one of the
above mentioned fan commands is received.  The fan watchdog is,
therefore, not suitable to protect against fan mode changes made through
means other than the “enable”, “disable”, and “level” procfs fan
commands, or the hwmon fan control sysfs interface.</p>
</section>
<section id="id11">
<h3>Procfs notes<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>The fan may be enabled or disabled with the following commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo enable  &gt;/proc/acpi/ibm/fan
echo disable &gt;/proc/acpi/ibm/fan
</pre></div>
</div>
<p>Placing a fan on level 0 is the same as disabling it.  Enabling a fan
will try to place it in a safe level if it is too slow or disabled.</p>
<p>The fan level can be controlled with the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;level &lt;level&gt;&#39; &gt; /proc/acpi/ibm/fan
</pre></div>
</div>
<p>Where &lt;level&gt; is an integer from 0 to 7, or one of the words “auto” or
“full-speed” (without the quotes).  Not all ThinkPads support the “auto”
and “full-speed” levels.  The driver accepts “disengaged” as an alias for
“full-speed”, and reports it as “disengaged” for backwards
compatibility.</p>
<p>On the X31 and X40 (and ONLY on those models), the fan speed can be
controlled to a certain degree.  Once the fan is running, it can be
forced to run faster or slower with the following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;speed &lt;speed&gt;&#39; &gt; /proc/acpi/ibm/fan
</pre></div>
</div>
<p>The sustainable range of fan speeds on the X40 appears to be from about
3700 to about 7350. Values outside this range either do not have any
effect or the fan speed eventually settles somewhere in that range.  The
fan cannot be stopped or started with this command.  This functionality
is incomplete, and not available through the sysfs interface.</p>
<p>To program the safety watchdog, use the “watchdog” command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;watchdog &lt;interval in seconds&gt;&#39; &gt; /proc/acpi/ibm/fan
</pre></div>
</div>
<p>If you want to disable the watchdog, use 0 as the interval.</p>
</section>
<section id="id12">
<h3>Sysfs notes<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The sysfs interface follows the hwmon subsystem guidelines for the most
part, and the exception is the fan safety watchdog.</p>
<p>Writes to any of the sysfs attributes may return the EINVAL error if
that operation is not supported in a given ThinkPad or if the parameter
is out-of-bounds, and EPERM if it is forbidden.  They may also return
EINTR (interrupted system call), and EIO (I/O error while trying to talk
to the firmware).</p>
<p>Features not yet implemented by the driver return ENOSYS.</p>
<dl>
<dt>hwmon device attribute pwm1_enable:</dt><dd><ul class="simple">
<li><p>0: PWM offline (fan is set to full-speed mode)</p></li>
<li><p>1: Manual PWM control (use pwm1 to set fan level)</p></li>
<li><p>2: Hardware PWM control (EC “auto” mode)</p></li>
<li><p>3: reserved (Software PWM control, not implemented yet)</p></li>
</ul>
<p>Modes 0 and 2 are not supported by all ThinkPads, and the
driver is not always able to detect this.  If it does know a
mode is unsupported, it will return -EINVAL.</p>
</dd>
<dt>hwmon device attribute pwm1:</dt><dd><p>Fan level, scaled from the firmware values of 0-7 to the hwmon
scale of 0-255.  0 means fan stopped, 255 means highest normal
speed (level 7).</p>
<p>This attribute only commands the fan if pmw1_enable is set to 1
(manual PWM control).</p>
</dd>
<dt>hwmon device attribute fan1_input:</dt><dd><p>Fan tachometer reading, in RPM.  May go stale on certain
ThinkPads while the EC transitions the PWM to offline mode,
which can take up to two minutes.  May return rubbish on older
ThinkPads.</p>
</dd>
<dt>hwmon device attribute fan2_input:</dt><dd><p>Fan tachometer reading, in RPM, for the secondary fan.
Available only on some ThinkPads.  If the secondary fan is
not installed, will always read 0.</p>
</dd>
<dt>hwmon driver attribute fan_watchdog:</dt><dd><p>Fan safety watchdog timer interval, in seconds.  Minimum is
1 second, maximum is 120 seconds.  0 disables the watchdog.</p>
</dd>
</dl>
<p>To stop the fan: set pwm1 to zero, and pwm1_enable to 1.</p>
<p>To start the fan in a safe mode: set pwm1_enable to 2.  If that fails
with EINVAL, try to set pwm1_enable to 1 and pwm1 to at least 128 (255
would be the safest choice, though).</p>
</section>
</section>
<section id="wan">
<h2>WAN<a class="headerlink" href="#wan" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/wan</p>
<p>sysfs device attribute: wwan_enable (deprecated)</p>
<p>sysfs rfkill class: switch “tpacpi_wwan_sw”</p>
<p>This feature shows the presence and current state of the built-in
Wireless WAN device.</p>
<p>If the ThinkPad supports it, the WWAN state is stored in NVRAM,
so it is kept across reboots and power-off.</p>
<p>It was tested on a Lenovo ThinkPad X60. It should probably work on other
ThinkPad models which come with this module installed.</p>
<section id="id13">
<h3>Procfs notes<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>If the W-WAN card is installed, the following commands can be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo enable &gt; /proc/acpi/ibm/wan
echo disable &gt; /proc/acpi/ibm/wan
</pre></div>
</div>
</section>
<section id="id14">
<h3>Sysfs notes<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>If the W-WAN card is installed, it can be enabled /
disabled through the “wwan_enable” thinkpad-acpi device
attribute, and its current status can also be queried.</p>
<dl class="simple">
<dt>enable:</dt><dd><ul class="simple">
<li><p>0: disables WWAN card / WWAN card is disabled</p></li>
<li><p>1: enables WWAN card / WWAN card is enabled.</p></li>
</ul>
</dd>
</dl>
<p>Note: this interface has been superseded by the generic rfkill
class.  It has been deprecated, and it will be removed in year
2010.</p>
<p>rfkill controller switch “tpacpi_wwan_sw”: refer to
<a class="reference internal" href="../../driver-api/rfkill.html"><span class="doc">rfkill - RF kill switch support</span></a> for details.</p>
</div></blockquote>
</section>
</section>
<section id="lcd-shadow-control">
<h2>LCD Shadow control<a class="headerlink" href="#lcd-shadow-control" title="Permalink to this headline">¶</a></h2>
<p>procfs: /proc/acpi/ibm/lcdshadow</p>
<p>Some newer T480s and T490s ThinkPads provide a feature called
PrivacyGuard. By turning this feature on, the usable vertical and
horizontal viewing angles of the LCD can be limited (as if some privacy
screen was applied manually in front of the display).</p>
<section id="id15">
<h3>procfs notes<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>The available commands are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;0&#39; &gt;/proc/acpi/ibm/lcdshadow
echo &#39;1&#39; &gt;/proc/acpi/ibm/lcdshadow
</pre></div>
</div>
<p>The first command ensures the best viewing angle and the latter one turns
on the feature, restricting the viewing angles.</p>
</section>
</section>
<section id="dytc-lapmode-sensor">
<h2>DYTC Lapmode sensor<a class="headerlink" href="#dytc-lapmode-sensor" title="Permalink to this headline">¶</a></h2>
<p>sysfs: dytc_lapmode</p>
<p>Newer thinkpads and mobile workstations have the ability to determine if
the device is in deskmode or lapmode. This feature is used by user space
to decide if WWAN transmission can be increased to maximum power and is
also useful for understanding the different thermal modes available as
they differ between desk and lap mode.</p>
<p>The property is read-only. If the platform doesn’t have support the sysfs
class is not created.</p>
</section>
<section id="experimental-uwb">
<h2>EXPERIMENTAL: UWB<a class="headerlink" href="#experimental-uwb" title="Permalink to this headline">¶</a></h2>
<p>This feature is considered EXPERIMENTAL because it has not been extensively
tested and validated in various ThinkPad models yet.  The feature may not
work as expected. USE WITH CAUTION! To use this feature, you need to supply
the experimental=1 parameter when loading the module.</p>
<p>sysfs rfkill class: switch “tpacpi_uwb_sw”</p>
<p>This feature exports an rfkill controller for the UWB device, if one is
present and enabled in the BIOS.</p>
<section id="id16">
<h3>Sysfs notes<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>rfkill controller switch “tpacpi_uwb_sw”: refer to
<a class="reference internal" href="../../driver-api/rfkill.html"><span class="doc">rfkill - RF kill switch support</span></a> for details.</p>
</div></blockquote>
</section>
</section>
<section id="setting-keyboard-language">
<h2>Setting keyboard language<a class="headerlink" href="#setting-keyboard-language" title="Permalink to this headline">¶</a></h2>
<p>sysfs: keyboard_lang</p>
<p>This feature is used to set keyboard language to ECFW using ASL interface.
Fewer thinkpads models like T580 , T590 , T15 Gen 1 etc.. has “=”, “(‘,
“)” numeric keys, which are not displaying correctly, when keyboard language
is other than “english”. This is because the default keyboard language in ECFW
is set as “english”. Hence using this sysfs, user can set the correct keyboard
language to ECFW and then these key’s will work correctly.</p>
<p>Example of command to set keyboard language is mentioned below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo jp &gt; /sys/devices/platform/thinkpad_acpi/keyboard_lang
</pre></div>
</div>
<p>Text corresponding to keyboard layout to be set in sysfs are: be(Belgian),
cz(Czech), da(Danish), de(German), en(English), es(Spain), et(Estonian),
fr(French), fr-ch(French(Switzerland)), hu(Hungarian), it(Italy), jp (Japan),
nl(Dutch), nn(Norway), pl(Polish), pt(portugese), sl(Slovenian), sv(Sweden),
tr(Turkey)</p>
</section>
<section id="wwan-antenna-type">
<h2>WWAN Antenna type<a class="headerlink" href="#wwan-antenna-type" title="Permalink to this headline">¶</a></h2>
<p>sysfs: wwan_antenna_type</p>
<p>On some newer Thinkpads we need to set SAR value based on the antenna
type. This interface will be used by userspace to get the antenna type
and set the corresponding SAR value, as is required for FCC certification.</p>
<p>The available commands are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /sys/devices/platform/thinkpad_acpi/wwan_antenna_type
</pre></div>
</div>
<p>Currently 2 antenna types are supported as mentioned below:
- type a
- type b</p>
<p>The property is read-only. If the platform doesn’t have support the sysfs
class is not created.</p>
</section>
<section id="adaptive-keyboard">
<h2>Adaptive keyboard<a class="headerlink" href="#adaptive-keyboard" title="Permalink to this headline">¶</a></h2>
<p>sysfs device attribute: adaptive_kbd_mode</p>
<p>This sysfs attribute controls the keyboard “face” that will be shown on the
Lenovo X1 Carbon 2nd gen (2014)’s adaptive keyboard. The value can be read
and set.</p>
<ul class="simple">
<li><p>0 = Home mode</p></li>
<li><p>1 = Web-browser mode</p></li>
<li><p>2 = Web-conference mode</p></li>
<li><p>3 = Function mode</p></li>
<li><p>4 = Layflat mode</p></li>
</ul>
<p>For more details about which buttons will appear depending on the mode, please
review the laptop’s user guide:
<a class="reference external" href="https://download.lenovo.com/ibmdl/pub/pc/pccbbs/mobiles_pdf/x1carbon_2_ug_en.pdf">https://download.lenovo.com/ibmdl/pub/pc/pccbbs/mobiles_pdf/x1carbon_2_ug_en.pdf</a></p>
</section>
<section id="battery-charge-control">
<h2>Battery charge control<a class="headerlink" href="#battery-charge-control" title="Permalink to this headline">¶</a></h2>
<p>sysfs attributes:
/sys/class/power_supply/BAT*/charge_control_{start,end}_threshold</p>
<p>These two attributes are created for those batteries that are supported by the
driver. They enable the user to control the battery charge thresholds of the
given battery. Both values may be read and set. <cite>charge_control_start_threshold</cite>
accepts an integer between 0 and 99 (inclusive); this value represents a battery
percentage level, below which charging will begin. <cite>charge_control_end_threshold</cite>
accepts an integer between 1 and 100 (inclusive); this value represents a battery
percentage level, above which charging will stop.</p>
<p>The exact semantics of the attributes may be found in
Documentation/ABI/testing/sysfs-class-power.</p>
</section>
<section id="multiple-commands-module-parameters">
<h2>Multiple Commands, Module Parameters<a class="headerlink" href="#multiple-commands-module-parameters" title="Permalink to this headline">¶</a></h2>
<p>Multiple commands can be written to the proc files in one shot by
separating them with commas, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo enable,0xffff &gt; /proc/acpi/ibm/hotkey
echo lcd_disable,crt_enable &gt; /proc/acpi/ibm/video
</pre></div>
</div>
<p>Commands can also be specified when loading the thinkpad-acpi module,
for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>modprobe thinkpad_acpi hotkey=enable,0xffff video=auto_disable
</pre></div>
</div>
</section>
<section id="enabling-debugging-output">
<h2>Enabling debugging output<a class="headerlink" href="#enabling-debugging-output" title="Permalink to this headline">¶</a></h2>
<p>The module takes a debug parameter which can be used to selectively
enable various classes of debugging output, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>modprobe thinkpad_acpi debug=0xffff
</pre></div>
</div>
<p>will enable all debugging output classes.  It takes a bitmask, so
to enable more than one output class, just add their values.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Debug bitmask</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0x8000</p></td>
<td><p>Disclose PID of userspace programs
accessing some functions of the driver</p></td>
</tr>
<tr class="row-odd"><td><p>0x0001</p></td>
<td><p>Initialization and probing</p></td>
</tr>
<tr class="row-even"><td><p>0x0002</p></td>
<td><p>Removal</p></td>
</tr>
<tr class="row-odd"><td><p>0x0004</p></td>
<td><p>RF Transmitter control (RFKILL)
(bluetooth, WWAN, UWB…)</p></td>
</tr>
<tr class="row-even"><td><p>0x0008</p></td>
<td><p>HKEY event interface, hotkeys</p></td>
</tr>
<tr class="row-odd"><td><p>0x0010</p></td>
<td><p>Fan control</p></td>
</tr>
<tr class="row-even"><td><p>0x0020</p></td>
<td><p>Backlight brightness</p></td>
</tr>
<tr class="row-odd"><td><p>0x0040</p></td>
<td><p>Audio mixer/volume control</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>There is also a kernel build option to enable more debugging
information, which may be necessary to debug driver problems.</p>
<p>The level of debugging information output by the driver can be changed
at runtime through sysfs, using the driver attribute debug_level.  The
attribute takes the same bitmask as the debug module parameter above.</p>
</section>
<section id="force-loading-of-module">
<h2>Force loading of module<a class="headerlink" href="#force-loading-of-module" title="Permalink to this headline">¶</a></h2>
<p>If thinkpad-acpi refuses to detect your ThinkPad, you can try to specify
the module parameter force_load=1.  Regardless of whether this works or
not, please contact <a class="reference external" href="mailto:ibm-acpi-devel&#37;&#52;&#48;lists&#46;sourceforge&#46;net">ibm-acpi-devel<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a> with a report.</p>
<section id="sysfs-interface-changelog">
<h3>Sysfs interface changelog<a class="headerlink" href="#sysfs-interface-changelog" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 88%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>0x000100:</p></td>
<td><p>Initial sysfs support, as a single platform driver and
device.</p></td>
</tr>
<tr class="row-even"><td><p>0x000200:</p></td>
<td><p>Hot key support for 32 hot keys, and radio slider switch
support.</p></td>
</tr>
<tr class="row-odd"><td><p>0x010000:</p></td>
<td><p>Hot keys are now handled by default over the input
layer, the radio switch generates input event EV_RADIO,
and the driver enables hot key handling by default in
the firmware.</p></td>
</tr>
<tr class="row-even"><td><p>0x020000:</p></td>
<td><p>ABI fix: added a separate hwmon platform device and
driver, which must be located by name (thinkpad)
and the hwmon class for libsensors4 (lm-sensors 3)
compatibility.  Moved all hwmon attributes to this
new platform device.</p></td>
</tr>
<tr class="row-odd"><td><p>0x020100:</p></td>
<td><p>Marker for thinkpad-acpi with hot key NVRAM polling
support.  If you must, use it to know you should not
start a userspace NVRAM poller (allows to detect when
NVRAM is compiled out by the user because it is
unneeded/undesired in the first place).</p></td>
</tr>
<tr class="row-even"><td><p>0x020101:</p></td>
<td><p>Marker for thinkpad-acpi with hot key NVRAM polling
and proper hotkey_mask semantics (version 8 of the
NVRAM polling patch).  Some development snapshots of
0.18 had an earlier version that did strange things
to hotkey_mask.</p></td>
</tr>
<tr class="row-odd"><td><p>0x020200:</p></td>
<td><p>Add poll()/select() support to the following attributes:
hotkey_radio_sw, wakeup_hotunplug_complete, wakeup_reason</p></td>
</tr>
<tr class="row-even"><td><p>0x020300:</p></td>
<td><p>hotkey enable/disable support removed, attributes
hotkey_bios_enabled and hotkey_enable deprecated and
marked for removal.</p></td>
</tr>
<tr class="row-odd"><td><p>0x020400:</p></td>
<td><p>Marker for 16 LEDs support.  Also, LEDs that are known
to not exist in a given model are not registered with
the LED sysfs class anymore.</p></td>
</tr>
<tr class="row-even"><td><p>0x020500:</p></td>
<td><p>Updated hotkey driver, hotkey_mask is always available
and it is always able to disable hot keys.  Very old
thinkpads are properly supported.  hotkey_bios_mask
is deprecated and marked for removal.</p></td>
</tr>
<tr class="row-odd"><td><p>0x020600:</p></td>
<td><p>Marker for backlight change event support.</p></td>
</tr>
<tr class="row-even"><td><p>0x020700:</p></td>
<td><p>Support for mute-only mixers.
Volume control in read-only mode by default.
Marker for ALSA mixer support.</p></td>
</tr>
<tr class="row-odd"><td><p>0x030000:</p></td>
<td><p>Thermal and fan sysfs attributes were moved to the hwmon
device instead of being attached to the backing platform
device.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ThinkPad ACPI Extras Driver</a><ul>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#features">Features</a><ul>
<li><a class="reference internal" href="#notes-about-the-sysfs-interface">Notes about the sysfs interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#driver-version">Driver version</a></li>
<li><a class="reference internal" href="#sysfs-interface-version">Sysfs interface version</a></li>
<li><a class="reference internal" href="#hot-keys">Hot keys</a><ul>
<li><a class="reference internal" href="#procfs-notes">procfs notes</a></li>
<li><a class="reference internal" href="#sysfs-notes">sysfs notes</a></li>
<li><a class="reference internal" href="#input-layer-notes">input layer notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#non-hotkey-acpi-hkey-event-map">Non hotkey ACPI HKEY event map</a><ul>
<li><a class="reference internal" href="#brightness-hotkey-notes">Brightness hotkey notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bluetooth">Bluetooth</a><ul>
<li><a class="reference internal" href="#id1">Procfs notes</a></li>
<li><a class="reference internal" href="#id2">Sysfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#video-output-control-proc-acpi-ibm-video">Video output control – /proc/acpi/ibm/video</a></li>
<li><a class="reference internal" href="#thinklight-control">ThinkLight control</a><ul>
<li><a class="reference internal" href="#id3">procfs notes</a></li>
<li><a class="reference internal" href="#id4">sysfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cmos-ucms-control">CMOS/UCMS control</a></li>
<li><a class="reference internal" href="#led-control">LED control</a><ul>
<li><a class="reference internal" href="#id5">procfs notes</a></li>
<li><a class="reference internal" href="#id6">sysfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#acpi-sounds-proc-acpi-ibm-beep">ACPI sounds – /proc/acpi/ibm/beep</a></li>
<li><a class="reference internal" href="#temperature-sensors">Temperature sensors</a><ul>
<li><a class="reference internal" href="#id7">Procfs notes</a></li>
<li><a class="reference internal" href="#id8">Sysfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#experimental-embedded-controller-register-dump">EXPERIMENTAL: Embedded controller register dump</a></li>
<li><a class="reference internal" href="#lcd-brightness-control">LCD brightness control</a><ul>
<li><a class="reference internal" href="#id9">Procfs notes</a></li>
<li><a class="reference internal" href="#id10">Sysfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#volume-control-console-audio-control">Volume control (Console Audio control)</a><ul>
<li><a class="reference internal" href="#about-the-thinkpad-console-audio-control">About the ThinkPad Console Audio control</a></li>
<li><a class="reference internal" href="#the-thinkpad-acpi-volume-control">The ThinkPad-ACPI volume control</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fan-control-and-monitoring-fan-speed-fan-enable-disable">Fan control and monitoring: fan speed, fan enable/disable</a><ul>
<li><a class="reference internal" href="#fan-levels">Fan levels</a></li>
<li><a class="reference internal" href="#id11">Procfs notes</a></li>
<li><a class="reference internal" href="#id12">Sysfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wan">WAN</a><ul>
<li><a class="reference internal" href="#id13">Procfs notes</a></li>
<li><a class="reference internal" href="#id14">Sysfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lcd-shadow-control">LCD Shadow control</a><ul>
<li><a class="reference internal" href="#id15">procfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dytc-lapmode-sensor">DYTC Lapmode sensor</a></li>
<li><a class="reference internal" href="#experimental-uwb">EXPERIMENTAL: UWB</a><ul>
<li><a class="reference internal" href="#id16">Sysfs notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-keyboard-language">Setting keyboard language</a></li>
<li><a class="reference internal" href="#wwan-antenna-type">WWAN Antenna type</a></li>
<li><a class="reference internal" href="#adaptive-keyboard">Adaptive keyboard</a></li>
<li><a class="reference internal" href="#battery-charge-control">Battery charge control</a></li>
<li><a class="reference internal" href="#multiple-commands-module-parameters">Multiple Commands, Module Parameters</a></li>
<li><a class="reference internal" href="#enabling-debugging-output">Enabling debugging output</a></li>
<li><a class="reference internal" href="#force-loading-of-module">Force loading of module</a><ul>
<li><a class="reference internal" href="#sysfs-interface-changelog">Sysfs interface changelog</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/laptops/thinkpad-acpi.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/laptops/thinkpad-acpi.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>