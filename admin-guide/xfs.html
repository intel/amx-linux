
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>The SGI XFS Filesystem &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kernel Build System" href="../kbuild/index.html" />
    <link rel="prev" title="Video Output Switcher Control" href="video-output.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="the-sgi-xfs-filesystem">
<h1>The SGI XFS Filesystem<a class="headerlink" href="#the-sgi-xfs-filesystem" title="Permalink to this headline">¶</a></h1>
<p>XFS is a high performance journaling filesystem which originated
on the SGI IRIX platform.  It is completely multi-threaded, can
support large files and large filesystems, extended attributes,
variable block sizes, is extent based, and makes extensive use of
Btrees (directories, extents, free space) to aid both performance
and scalability.</p>
<p>Refer to the documentation at <a class="reference external" href="https://xfs.wiki.kernel.org/">https://xfs.wiki.kernel.org/</a>
for further details.  This implementation is on-disk compatible
with the IRIX version of XFS.</p>
<section id="mount-options">
<h2>Mount Options<a class="headerlink" href="#mount-options" title="Permalink to this headline">¶</a></h2>
<p>When mounting an XFS filesystem, the following options are accepted.</p>
<blockquote>
<div><dl>
<dt>allocsize=size</dt><dd><p>Sets the buffered I/O end-of-file preallocation size when
doing delayed allocation writeout (default size is 64KiB).
Valid values for this option are page size (typically 4KiB)
through to 1GiB, inclusive, in power-of-2 increments.</p>
<p>The default behaviour is for dynamic end-of-file
preallocation size, which uses a set of heuristics to
optimise the preallocation size based on the current
allocation patterns within the file and the access patterns
to the file. Specifying a fixed <code class="docutils literal notranslate"><span class="pre">allocsize</span></code> value turns off
the dynamic behaviour.</p>
</dd>
<dt>attr2 or noattr2</dt><dd><p>The options enable/disable an “opportunistic” improvement to
be made in the way inline extended attributes are stored
on-disk.  When the new form is used for the first time when
<code class="docutils literal notranslate"><span class="pre">attr2</span></code> is selected (either when setting or removing extended
attributes) the on-disk superblock feature bit field will be
updated to reflect this format being in use.</p>
<p>The default behaviour is determined by the on-disk feature
bit indicating that <code class="docutils literal notranslate"><span class="pre">attr2</span></code> behaviour is active. If either
mount option is set, then that becomes the new default used
by the filesystem.</p>
<p>CRC enabled filesystems always use the <code class="docutils literal notranslate"><span class="pre">attr2</span></code> format, and so
will reject the <code class="docutils literal notranslate"><span class="pre">noattr2</span></code> mount option if it is set.</p>
</dd>
<dt>discard or nodiscard (default)</dt><dd><p>Enable/disable the issuing of commands to let the block
device reclaim space freed by the filesystem.  This is
useful for SSD devices, thinly provisioned LUNs and virtual
machine images, but may have a performance impact.</p>
<p>Note: It is currently recommended that you use the <code class="docutils literal notranslate"><span class="pre">fstrim</span></code>
application to <code class="docutils literal notranslate"><span class="pre">discard</span></code> unused blocks rather than the <code class="docutils literal notranslate"><span class="pre">discard</span></code>
mount option because the performance impact of this option
is quite severe.</p>
</dd>
<dt>grpid/bsdgroups or nogrpid/sysvgroups (default)</dt><dd><p>These options define what group ID a newly created file
gets.  When <code class="docutils literal notranslate"><span class="pre">grpid</span></code> is set, it takes the group ID of the
directory in which it is created; otherwise it takes the
<code class="docutils literal notranslate"><span class="pre">fsgid</span></code> of the current process, unless the directory has the
<code class="docutils literal notranslate"><span class="pre">setgid</span></code> bit set, in which case it takes the <code class="docutils literal notranslate"><span class="pre">gid</span></code> from the
parent directory, and also gets the <code class="docutils literal notranslate"><span class="pre">setgid</span></code> bit set if it is
a directory itself.</p>
</dd>
<dt>filestreams</dt><dd><p>Make the data allocator use the filestreams allocation mode
across the entire filesystem rather than just on directories
configured to use it.</p>
</dd>
<dt>ikeep or noikeep (default)</dt><dd><p>When <code class="docutils literal notranslate"><span class="pre">ikeep</span></code> is specified, XFS does not delete empty inode
clusters and keeps them around on disk.  When <code class="docutils literal notranslate"><span class="pre">noikeep</span></code> is
specified, empty inode clusters are returned to the free
space pool.</p>
</dd>
<dt>inode32 or inode64 (default)</dt><dd><p>When <code class="docutils literal notranslate"><span class="pre">inode32</span></code> is specified, it indicates that XFS limits
inode creation to locations which will not result in inode
numbers with more than 32 bits of significance.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">inode64</span></code> is specified, it indicates that XFS is allowed
to create inodes at any location in the filesystem,
including those which will result in inode numbers occupying
more than 32 bits of significance.</p>
<p><code class="docutils literal notranslate"><span class="pre">inode32</span></code> is provided for backwards compatibility with older
systems and applications, since 64 bits inode numbers might
cause problems for some applications that cannot handle
large inode numbers.  If applications are in use which do
not handle inode numbers bigger than 32 bits, the <code class="docutils literal notranslate"><span class="pre">inode32</span></code>
option should be specified.</p>
</dd>
<dt>largeio or nolargeio (default)</dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">nolargeio</span></code> is specified, the optimal I/O reported in
<code class="docutils literal notranslate"><span class="pre">st_blksize</span></code> by <strong>stat(2)</strong> will be as small as possible to allow
user applications to avoid inefficient read/modify/write
I/O.  This is typically the page size of the machine, as
this is the granularity of the page cache.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">largeio</span></code> is specified, a filesystem that was created with a
<code class="docutils literal notranslate"><span class="pre">swidth</span></code> specified will return the <code class="docutils literal notranslate"><span class="pre">swidth</span></code> value (in bytes)
in <code class="docutils literal notranslate"><span class="pre">st_blksize</span></code>. If the filesystem does not have a <code class="docutils literal notranslate"><span class="pre">swidth</span></code>
specified but does specify an <code class="docutils literal notranslate"><span class="pre">allocsize</span></code> then <code class="docutils literal notranslate"><span class="pre">allocsize</span></code>
(in bytes) will be returned instead. Otherwise the behaviour
is the same as if <code class="docutils literal notranslate"><span class="pre">nolargeio</span></code> was specified.</p>
</dd>
<dt>logbufs=value</dt><dd><p>Set the number of in-memory log buffers.  Valid numbers
range from 2-8 inclusive.</p>
<p>The default value is 8 buffers.</p>
<p>If the memory cost of 8 log buffers is too high on small
systems, then it may be reduced at some cost to performance
on metadata intensive workloads. The <code class="docutils literal notranslate"><span class="pre">logbsize</span></code> option below
controls the size of each buffer and so is also relevant to
this case.</p>
</dd>
<dt>logbsize=value</dt><dd><p>Set the size of each in-memory log buffer.  The size may be
specified in bytes, or in kilobytes with a “k” suffix.
Valid sizes for version 1 and version 2 logs are 16384 (16k)
and 32768 (32k).  Valid sizes for version 2 logs also
include 65536 (64k), 131072 (128k) and 262144 (256k). The
logbsize must be an integer multiple of the log
stripe unit configured at <strong>mkfs(8)</strong> time.</p>
<p>The default value for version 1 logs is 32768, while the
default value for version 2 logs is MAX(32768, log_sunit).</p>
</dd>
<dt>logdev=device and rtdev=device</dt><dd><p>Use an external log (metadata journal) and/or real-time device.
An XFS filesystem has up to three parts: a data section, a log
section, and a real-time section.  The real-time section is
optional, and the log section can be separate from the data
section or contained within it.</p>
</dd>
<dt>noalign</dt><dd><p>Data allocations will not be aligned at stripe unit
boundaries. This is only relevant to filesystems created
with non-zero data alignment parameters (<code class="docutils literal notranslate"><span class="pre">sunit</span></code>, <code class="docutils literal notranslate"><span class="pre">swidth</span></code>) by
<strong>mkfs(8)</strong>.</p>
</dd>
<dt>norecovery</dt><dd><p>The filesystem will be mounted without running log recovery.
If the filesystem was not cleanly unmounted, it is likely to
be inconsistent when mounted in <code class="docutils literal notranslate"><span class="pre">norecovery</span></code> mode.
Some files or directories may not be accessible because of this.
Filesystems mounted <code class="docutils literal notranslate"><span class="pre">norecovery</span></code> must be mounted read-only or
the mount will fail.</p>
</dd>
<dt>nouuid</dt><dd><p>Don’t check for double mounted file systems using the file
system <code class="docutils literal notranslate"><span class="pre">uuid</span></code>.  This is useful to mount LVM snapshot volumes,
and often used in combination with <code class="docutils literal notranslate"><span class="pre">norecovery</span></code> for mounting
read-only snapshots.</p>
</dd>
<dt>noquota</dt><dd><p>Forcibly turns off all quota accounting and enforcement
within the filesystem.</p>
</dd>
<dt>uquota/usrquota/uqnoenforce/quota</dt><dd><p>User disk quota accounting enabled, and limits (optionally)
enforced.  Refer to <strong>xfs_quota(8)</strong> for further details.</p>
</dd>
<dt>gquota/grpquota/gqnoenforce</dt><dd><p>Group disk quota accounting enabled and limits (optionally)
enforced.  Refer to <strong>xfs_quota(8)</strong> for further details.</p>
</dd>
<dt>pquota/prjquota/pqnoenforce</dt><dd><p>Project disk quota accounting enabled and limits (optionally)
enforced.  Refer to <strong>xfs_quota(8)</strong> for further details.</p>
</dd>
<dt>sunit=value and swidth=value</dt><dd><p>Used to specify the stripe unit and width for a RAID device
or a stripe volume.  “value” must be specified in 512-byte
block units. These options are only relevant to filesystems
that were created with non-zero data alignment parameters.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sunit</span></code> and <code class="docutils literal notranslate"><span class="pre">swidth</span></code> parameters specified must be compatible
with the existing filesystem alignment characteristics.  In
general, that means the only valid changes to <code class="docutils literal notranslate"><span class="pre">sunit</span></code> are
increasing it by a power-of-2 multiple. Valid <code class="docutils literal notranslate"><span class="pre">swidth</span></code> values
are any integer multiple of a valid <code class="docutils literal notranslate"><span class="pre">sunit</span></code> value.</p>
<p>Typically the only time these mount options are necessary if
after an underlying RAID device has had it’s geometry
modified, such as adding a new disk to a RAID5 lun and
reshaping it.</p>
</dd>
<dt>swalloc</dt><dd><p>Data allocations will be rounded up to stripe width boundaries
when the current end of file is being extended and the file
size is larger than the stripe width size.</p>
</dd>
<dt>wsync</dt><dd><p>When specified, all filesystem namespace operations are
executed synchronously. This ensures that when the namespace
operation (create, unlink, etc) completes, the change to the
namespace is on stable storage. This is useful in HA setups
where failover must not result in clients seeing
inconsistent namespace presentation during or after a
failover event.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="deprecation-of-v4-format">
<h2>Deprecation of V4 Format<a class="headerlink" href="#deprecation-of-v4-format" title="Permalink to this headline">¶</a></h2>
<p>The V4 filesystem format lacks certain features that are supported by
the V5 format, such as metadata checksumming, strengthened metadata
verification, and the ability to store timestamps past the year 2038.
Because of this, the V4 format is deprecated.  All users should upgrade
by backing up their files, reformatting, and restoring from the backup.</p>
<p>Administrators and users can detect a V4 filesystem by running xfs_info
against a filesystem mountpoint and checking for a string containing
“crc=”.  If no such string is found, please upgrade xfsprogs to the
latest version and try again.</p>
<p>The deprecation will take place in two parts.  Support for mounting V4
filesystems can now be disabled at kernel build time via Kconfig option.
The option will default to yes until September 2025, at which time it
will be changed to default to no.  In September 2030, support will be
removed from the codebase entirely.</p>
<p>Note: Distributors may choose to withdraw V4 format support earlier than
the dates listed above.</p>
</section>
<section id="deprecated-mount-options">
<h2>Deprecated Mount Options<a class="headerlink" href="#deprecated-mount-options" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 63%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Removal Schedule</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Mounting with V4 filesystem</p></td>
<td><p>September 2030</p></td>
</tr>
<tr class="row-odd"><td><p>ikeep/noikeep</p></td>
<td><p>September 2025</p></td>
</tr>
<tr class="row-even"><td><p>attr2/noattr2</p></td>
<td><p>September 2025</p></td>
</tr>
</tbody>
</table>
</section>
<section id="removed-mount-options">
<h2>Removed Mount Options<a class="headerlink" href="#removed-mount-options" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 79%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Removed</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>delaylog/nodelaylog</p></td>
<td><p>v4.0</p></td>
</tr>
<tr class="row-odd"><td><p>ihashsize</p></td>
<td><p>v4.0</p></td>
</tr>
<tr class="row-even"><td><p>irixsgid</p></td>
<td><p>v4.0</p></td>
</tr>
<tr class="row-odd"><td><p>osyncisdsync/osyncisosync</p></td>
<td><p>v4.0</p></td>
</tr>
<tr class="row-even"><td><p>barrier</p></td>
<td><p>v4.19</p></td>
</tr>
<tr class="row-odd"><td><p>nobarrier</p></td>
<td><p>v4.19</p></td>
</tr>
</tbody>
</table>
</section>
<section id="sysctls">
<h2>sysctls<a class="headerlink" href="#sysctls" title="Permalink to this headline">¶</a></h2>
<p>The following sysctls are available for the XFS filesystem:</p>
<blockquote>
<div><dl>
<dt>fs.xfs.stats_clear            (Min: 0  Default: 0  Max: 1)</dt><dd><p>Setting this to “1” clears accumulated XFS statistics
in /proc/fs/xfs/stat.  It then immediately resets to “0”.</p>
</dd>
<dt>fs.xfs.xfssyncd_centisecs     (Min: 100  Default: 3000  Max: 720000)</dt><dd><p>The interval at which the filesystem flushes metadata
out to disk and runs internal cache cleanup routines.</p>
</dd>
<dt>fs.xfs.filestream_centisecs   (Min: 1  Default: 3000  Max: 360000)</dt><dd><p>The interval at which the filesystem ages filestreams cache
references and returns timed-out AGs back to the free stream
pool.</p>
</dd>
<dt>fs.xfs.speculative_prealloc_lifetime</dt><dd><p>(Units: seconds   Min: 1  Default: 300  Max: 86400)
The interval at which the background scanning for inodes
with unused speculative preallocation runs. The scan
removes unused preallocation from clean inodes and releases
the unused space back to the free pool.</p>
</dd>
<dt>fs.xfs.speculative_cow_prealloc_lifetime</dt><dd><p>This is an alias for speculative_prealloc_lifetime.</p>
</dd>
<dt>fs.xfs.error_level            (Min: 0  Default: 3  Max: 11)</dt><dd><p>A volume knob for error reporting when internal errors occur.
This will generate detailed messages &amp; backtraces for filesystem
shutdowns, for example.  Current threshold values are:</p>
<blockquote>
<div><p>XFS_ERRLEVEL_OFF:       0
XFS_ERRLEVEL_LOW:       1
XFS_ERRLEVEL_HIGH:      5</p>
</div></blockquote>
</dd>
<dt>fs.xfs.panic_mask             (Min: 0  Default: 0  Max: 256)</dt><dd><p>Causes certain error conditions to call BUG(). Value is a bitmask;
OR together the tags which represent errors which should cause panics:</p>
<blockquote>
<div><p>XFS_NO_PTAG                     0
XFS_PTAG_IFLUSH                 0x00000001
XFS_PTAG_LOGRES                 0x00000002
XFS_PTAG_AILDELETE              0x00000004
XFS_PTAG_ERROR_REPORT           0x00000008
XFS_PTAG_SHUTDOWN_CORRUPT       0x00000010
XFS_PTAG_SHUTDOWN_IOERROR       0x00000020
XFS_PTAG_SHUTDOWN_LOGERROR      0x00000040
XFS_PTAG_FSBLOCK_ZERO           0x00000080
XFS_PTAG_VERIFIER_ERROR         0x00000100</p>
</div></blockquote>
<p>This option is intended for debugging only.</p>
</dd>
<dt>fs.xfs.irix_symlink_mode      (Min: 0  Default: 0  Max: 1)</dt><dd><p>Controls whether symlinks are created with mode 0777 (default)
or whether their mode is affected by the umask (irix mode).</p>
</dd>
<dt>fs.xfs.irix_sgid_inherit      (Min: 0  Default: 0  Max: 1)</dt><dd><p>Controls files created in SGID directories.
If the group ID of the new file does not match the effective group
ID or one of the supplementary group IDs of the parent dir, the
ISGID bit is cleared if the irix_sgid_inherit compatibility sysctl
is set.</p>
</dd>
<dt>fs.xfs.inherit_sync           (Min: 0  Default: 1  Max: 1)</dt><dd><p>Setting this to “1” will cause the “sync” flag set
by the <strong>xfs_io(8)</strong> chattr command on a directory to be
inherited by files in that directory.</p>
</dd>
<dt>fs.xfs.inherit_nodump         (Min: 0  Default: 1  Max: 1)</dt><dd><p>Setting this to “1” will cause the “nodump” flag set
by the <strong>xfs_io(8)</strong> chattr command on a directory to be
inherited by files in that directory.</p>
</dd>
<dt>fs.xfs.inherit_noatime        (Min: 0  Default: 1  Max: 1)</dt><dd><p>Setting this to “1” will cause the “noatime” flag set
by the <strong>xfs_io(8)</strong> chattr command on a directory to be
inherited by files in that directory.</p>
</dd>
<dt>fs.xfs.inherit_nosymlinks     (Min: 0  Default: 1  Max: 1)</dt><dd><p>Setting this to “1” will cause the “nosymlinks” flag set
by the <strong>xfs_io(8)</strong> chattr command on a directory to be
inherited by files in that directory.</p>
</dd>
<dt>fs.xfs.inherit_nodefrag       (Min: 0  Default: 1  Max: 1)</dt><dd><p>Setting this to “1” will cause the “nodefrag” flag set
by the <strong>xfs_io(8)</strong> chattr command on a directory to be
inherited by files in that directory.</p>
</dd>
<dt>fs.xfs.rotorstep              (Min: 1  Default: 1  Max: 256)</dt><dd><p>In “inode32” allocation mode, this option determines how many
files the allocator attempts to allocate in the same allocation
group before moving to the next allocation group.  The intent
is to control the rate at which the allocator moves between
allocation groups when allocating extents for new files.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="deprecated-sysctls">
<h2>Deprecated Sysctls<a class="headerlink" href="#deprecated-sysctls" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 73%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Removal Schedule</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fs.xfs.irix_sgid_inherit</p></td>
<td><p>September 2025</p></td>
</tr>
<tr class="row-odd"><td><p>fs.xfs.irix_symlink_mode</p></td>
<td><p>September 2025</p></td>
</tr>
<tr class="row-even"><td><p>fs.xfs.speculative_cow_prealloc_lifetime</p></td>
<td><p>September 2025</p></td>
</tr>
</tbody>
</table>
</section>
<section id="removed-sysctls">
<h2>Removed Sysctls<a class="headerlink" href="#removed-sysctls" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 81%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Removed</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fs.xfs.xfsbufd_centisec</p></td>
<td><p>v4.0</p></td>
</tr>
<tr class="row-odd"><td><p>fs.xfs.age_buffer_centisecs</p></td>
<td><p>v4.0</p></td>
</tr>
</tbody>
</table>
</section>
<section id="error-handling">
<h2>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h2>
<p>XFS can act differently according to the type of error found during its
operation. The implementation introduces the following concepts to the error
handler:</p>
<blockquote>
<div><dl class="simple">
<dt>-failure speed:</dt><dd><p>Defines how fast XFS should propagate an error upwards when a specific
error is found during the filesystem operation. It can propagate
immediately, after a defined number of retries, after a set time period,
or simply retry forever.</p>
</dd>
<dt>-error classes:</dt><dd><p>Specifies the subsystem the error configuration will apply to, such as
metadata IO or memory allocation. Different subsystems will have
different error handlers for which behaviour can be configured.</p>
</dd>
<dt>-error handlers:</dt><dd><p>Defines the behavior for a specific error.</p>
</dd>
</dl>
</div></blockquote>
<p>The filesystem behavior during an error can be set via <code class="docutils literal notranslate"><span class="pre">sysfs</span></code> files. Each
error handler works independently - the first condition met by an error handler
for a specific class will cause the error to be propagated rather than reset and
retried.</p>
<p>The action taken by the filesystem when the error is propagated is context
dependent - it may cause a shut down in the case of an unrecoverable error,
it may be reported back to userspace, or it may even be ignored because
there’s nothing useful we can with the error or anyone we can report it to (e.g.
during unmount).</p>
<p>The configuration files are organized into the following hierarchy for each
mounted filesystem:</p>
<blockquote>
<div><p>/sys/fs/xfs/&lt;dev&gt;/error/&lt;class&gt;/&lt;error&gt;/</p>
</div></blockquote>
<dl>
<dt>Where:</dt><dd><dl>
<dt>&lt;dev&gt;</dt><dd><p>The short device name of the mounted filesystem. This is the same device
name that shows up in XFS kernel error messages as “XFS(&lt;dev&gt;): …”</p>
</dd>
<dt>&lt;class&gt;</dt><dd><p>The subsystem the error configuration belongs to. As of 4.9, the defined
classes are:</p>
<blockquote>
<div><ul class="simple">
<li><p>“metadata”: applies metadata buffer write IO</p></li>
</ul>
</div></blockquote>
</dd>
<dt>&lt;error&gt;</dt><dd><p>The individual error handler configurations.</p>
</dd>
</dl>
</dd>
</dl>
<p>Each filesystem has “global” error configuration options defined in their top
level directory:</p>
<blockquote>
<div><p>/sys/fs/xfs/&lt;dev&gt;/error/</p>
<dl>
<dt>fail_at_unmount               (Min:  0  Default:  1  Max: 1)</dt><dd><p>Defines the filesystem error behavior at unmount time.</p>
<p>If set to a value of 1, XFS will override all other error configurations
during unmount and replace them with “immediate fail” characteristics.
i.e. no retries, no retry timeout. This will always allow unmount to
succeed when there are persistent errors present.</p>
<p>If set to 0, the configured retry behaviour will continue until all
retries and/or timeouts have been exhausted. This will delay unmount
completion when there are persistent errors, and it may prevent the
filesystem from ever unmounting fully in the case of “retry forever”
handler configurations.</p>
<p>Note: there is no guarantee that fail_at_unmount can be set while an
unmount is in progress. It is possible that the <code class="docutils literal notranslate"><span class="pre">sysfs</span></code> entries are
removed by the unmounting filesystem before a “retry forever” error
handler configuration causes unmount to hang, and hence the filesystem
must be configured appropriately before unmount begins to prevent
unmount hangs.</p>
</dd>
</dl>
</div></blockquote>
<p>Each filesystem has specific error class handlers that define the error
propagation behaviour for specific errors. There is also a “default” error
handler defined, which defines the behaviour for all errors that don’t have
specific handlers defined. Where multiple retry constraints are configured for
a single error, the first retry configuration that expires will cause the error
to be propagated. The handler configurations are found in the directory:</p>
<blockquote>
<div><p>/sys/fs/xfs/&lt;dev&gt;/error/&lt;class&gt;/&lt;error&gt;/</p>
<dl>
<dt>max_retries                   (Min: -1  Default: Varies  Max: INTMAX)</dt><dd><p>Defines the allowed number of retries of a specific error before
the filesystem will propagate the error. The retry count for a given
error context (e.g. a specific metadata buffer) is reset every time
there is a successful completion of the operation.</p>
<p>Setting the value to “-1” will cause XFS to retry forever for this
specific error.</p>
<p>Setting the value to “0” will cause XFS to fail immediately when the
specific error is reported.</p>
<p>Setting the value to “N” (where 0 &lt; N &lt; Max) will make XFS retry the
operation “N” times before propagating the error.</p>
</dd>
<dt>retry_timeout_seconds         (Min:  -1  Default:  Varies  Max: 1 day)</dt><dd><p>Define the amount of time (in seconds) that the filesystem is
allowed to retry its operations when the specific error is
found.</p>
<p>Setting the value to “-1” will allow XFS to retry forever for this
specific error.</p>
<p>Setting the value to “0” will cause XFS to fail immediately when the
specific error is reported.</p>
<p>Setting the value to “N” (where 0 &lt; N &lt; Max) will allow XFS to retry the
operation for up to “N” seconds before propagating the error.</p>
</dd>
</dl>
</div></blockquote>
<p><strong>Note:</strong> The default behaviour for a specific error handler is dependent on both
the class and error context. For example, the default values for
“metadata/ENODEV” are “0” rather than “-1” so that this error handler defaults
to “fail immediately” behaviour. This is done because ENODEV is a fatal,
unrecoverable error no matter how many times the metadata IO is retried.</p>
</section>
<section id="workqueue-concurrency">
<h2>Workqueue Concurrency<a class="headerlink" href="#workqueue-concurrency" title="Permalink to this headline">¶</a></h2>
<p>XFS uses kernel workqueues to parallelize metadata update processes.  This
enables it to take advantage of storage hardware that can service many IO
operations simultaneously.  This interface exposes internal implementation
details of XFS, and as such is explicitly not part of any userspace API/ABI
guarantee the kernel may give userspace.  These are undocumented features of
the generic workqueue implementation XFS uses for concurrency, and they are
provided here purely for diagnostic and tuning purposes and may change at any
time in the future.</p>
<p>The control knobs for a filesystem’s workqueues are organized by task at hand
and the short name of the data device.  They all can be found in:</p>
<blockquote>
<div><p>/sys/bus/workqueue/devices/${task}!${device}</p>
</div></blockquote>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Task</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xfs_iwalk-$pid</p></td>
<td><p>Inode scans of the entire filesystem. Currently limited to
mount time quotacheck.</p></td>
</tr>
<tr class="row-odd"><td><p>xfs-gc</p></td>
<td><p>Background garbage collection of disk space that have been
speculatively allocated beyond EOF or for staging copy on
write operations.</p></td>
</tr>
</tbody>
</table>
<p>For example, the knobs for the quotacheck workqueue for /dev/nvme0n1 would be
found in /sys/bus/workqueue/devices/xfs_iwalk-1111!nvme0n1/.</p>
<p>The interesting knobs for XFS workqueues are as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Knob</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>max_active</p></td>
<td><p>Maximum number of background threads that can be started to
run the work.</p></td>
</tr>
<tr class="row-odd"><td><p>cpumask</p></td>
<td><p>CPUs upon which the threads are allowed to run.</p></td>
</tr>
<tr class="row-even"><td><p>nice</p></td>
<td><p>Relative priority of scheduling the threads.  These are the
same nice levels that can be applied to userspace processes.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The SGI XFS Filesystem</a><ul>
<li><a class="reference internal" href="#mount-options">Mount Options</a></li>
<li><a class="reference internal" href="#deprecation-of-v4-format">Deprecation of V4 Format</a></li>
<li><a class="reference internal" href="#deprecated-mount-options">Deprecated Mount Options</a></li>
<li><a class="reference internal" href="#removed-mount-options">Removed Mount Options</a></li>
<li><a class="reference internal" href="#sysctls">sysctls</a></li>
<li><a class="reference internal" href="#deprecated-sysctls">Deprecated Sysctls</a></li>
<li><a class="reference internal" href="#removed-sysctls">Removed Sysctls</a></li>
<li><a class="reference internal" href="#error-handling">Error handling</a></li>
<li><a class="reference internal" href="#workqueue-concurrency">Workqueue Concurrency</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/admin-guide/xfs.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/admin-guide/xfs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>