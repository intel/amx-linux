
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Device Whitelist Controller &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Cgroup Freezer" href="freezer-subsystem.html" />
    <link rel="prev" title="CPUSETS" href="cpusets.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="device-whitelist-controller">
<h1>Device Whitelist Controller<a class="headerlink" href="#device-whitelist-controller" title="Permalink to this headline">¶</a></h1>
<section id="description">
<h2>1. Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Implement a cgroup to track and enforce open and mknod restrictions
on device files.  A device cgroup associates a device access
whitelist with each cgroup.  A whitelist entry has 4 fields.
‘type’ is a (all), c (char), or b (block).  ‘all’ means it applies
to all types and all major and minor numbers.  Major and minor are
either an integer or * for all.  Access is a composition of r
(read), w (write), and m (mknod).</p>
<p>The root device cgroup starts with rwm to ‘all’.  A child device
cgroup gets a copy of the parent.  Administrators can then remove
devices from the whitelist or add new entries.  A child cgroup can
never receive a device access which is denied by its parent.</p>
</section>
<section id="user-interface">
<h2>2. User Interface<a class="headerlink" href="#user-interface" title="Permalink to this headline">¶</a></h2>
<p>An entry is added using devices.allow, and removed using
devices.deny.  For instance:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &#39;c 1:3 mr&#39; &gt; /sys/fs/cgroup/1/devices.allow
</pre></div>
</div>
<p>allows cgroup 1 to read and mknod the device usually known as
/dev/null.  Doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo a &gt; /sys/fs/cgroup/1/devices.deny
</pre></div>
</div>
<p>will remove the default ‘a <em>:</em> rwm’ entry. Doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo a &gt; /sys/fs/cgroup/1/devices.allow
</pre></div>
</div>
<p>will add the ‘a <em>:</em> rwm’ entry to the whitelist.</p>
</section>
<section id="security">
<h2>3. Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p>Any task can move itself between cgroups.  This clearly won’t
suffice, but we can decide the best way to adequately restrict
movement as people get some experience with this.  We may just want
to require CAP_SYS_ADMIN, which at least is a separate bit from
CAP_MKNOD.  We may want to just refuse moving to a cgroup which
isn’t a descendant of the current one.  Or we may want to use
CAP_MAC_ADMIN, since we really are trying to lock down root.</p>
<p>CAP_SYS_ADMIN is needed to modify the whitelist or move another
task to a new cgroup.  (Again we’ll probably want to change that).</p>
<p>A cgroup may not be granted more permissions than the cgroup’s
parent has.</p>
</section>
<section id="hierarchy">
<h2>4. Hierarchy<a class="headerlink" href="#hierarchy" title="Permalink to this headline">¶</a></h2>
<p>device cgroups maintain hierarchy by making sure a cgroup never has more
access permissions than its parent.  Every time an entry is written to
a cgroup’s devices.deny file, all its children will have that entry removed
from their whitelist and all the locally set whitelist entries will be
re-evaluated.  In case one of the locally set whitelist entries would provide
more access than the cgroup’s parent, it’ll be removed from the whitelist.</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  A
 / \
    B

group        behavior       exceptions
A            allow          &quot;b 8:* rwm&quot;, &quot;c 116:1 rw&quot;
B            deny           &quot;c 1:3 rwm&quot;, &quot;c 116:2 rwm&quot;, &quot;b 3:* rwm&quot;
</pre></div>
</div>
<p>If a device is denied in group A:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c 116:* r&quot; &gt; A/devices.deny
</pre></div>
</div>
<p>it’ll propagate down and after revalidating B’s entries, the whitelist entry
“c 116:2 rwm” will be removed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>group        whitelist entries                        denied devices
A            all                                      &quot;b 8:* rwm&quot;, &quot;c 116:* rw&quot;
B            &quot;c 1:3 rwm&quot;, &quot;b 3:* rwm&quot;                 all the rest
</pre></div>
</div>
<p>In case parent’s exceptions change and local exceptions are not allowed
anymore, they’ll be deleted.</p>
<p>Notice that new whitelist entries will not be propagated:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  A
 / \
    B

group        whitelist entries                        denied devices
A            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
B            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
</pre></div>
</div>
<p>when adding <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">*:3</span> <span class="pre">rwm</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c *:3 rwm&quot; &gt;A/devices.allow
</pre></div>
</div>
<p>the result:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>group        whitelist entries                        denied devices
A            &quot;c *:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
B            &quot;c 1:3 rwm&quot;, &quot;c 1:5 r&quot;                   all the rest
</pre></div>
</div>
<p>but now it’ll be possible to add new entries to B:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c 2:3 rwm&quot; &gt;B/devices.allow
# echo &quot;c 50:3 r&quot; &gt;B/devices.allow
</pre></div>
</div>
<p>or even:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo &quot;c *:3 rwm&quot; &gt;B/devices.allow
</pre></div>
</div>
<p>Allowing or denying all by writing ‘a’ to devices.allow or devices.deny will
not be possible once the device cgroups has children.</p>
<section id="hierarchy-internal-implementation">
<h3>4.1 Hierarchy (internal implementation)<a class="headerlink" href="#hierarchy-internal-implementation" title="Permalink to this headline">¶</a></h3>
<p>device cgroups is implemented internally using a behavior (ALLOW, DENY) and a
list of exceptions.  The internal state is controlled using the same user
interface to preserve compatibility with the previous whitelist-only
implementation.  Removal or addition of exceptions that will reduce the access
to devices will be propagated down the hierarchy.
For every propagated exception, the effective rules will be re-evaluated based
on current parent’s access rules.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Device Whitelist Controller</a><ul>
<li><a class="reference internal" href="#description">1. Description</a></li>
<li><a class="reference internal" href="#user-interface">2. User Interface</a></li>
<li><a class="reference internal" href="#security">3. Security</a></li>
<li><a class="reference internal" href="#hierarchy">4. Hierarchy</a><ul>
<li><a class="reference internal" href="#hierarchy-internal-implementation">4.1 Hierarchy (internal implementation)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/admin-guide/cgroup-v1/devices.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/cgroup-v1/devices.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>