
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Linux Driver for the Synopsys(R) Ethernet Controllers “stmmac” &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Texas Instruments CPSW ethernet driver" href="../ti/cpsw.html" />
    <link rel="prev" title="SMC 9xxxx Driver" href="../smsc/smc9.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="linux-driver-for-the-synopsys-r-ethernet-controllers-stmmac">
<h1>Linux Driver for the Synopsys(R) Ethernet Controllers “stmmac”<a class="headerlink" href="#linux-driver-for-the-synopsys-r-ethernet-controllers-stmmac" title="Permalink to this headline">¶</a></h1>
<p>Authors: Giuseppe Cavallaro &lt;<a class="reference external" href="mailto:peppe&#46;cavallaro&#37;&#52;&#48;st&#46;com">peppe<span>&#46;</span>cavallaro<span>&#64;</span>st<span>&#46;</span>com</a>&gt;,
Alexandre Torgue &lt;<a class="reference external" href="mailto:alexandre&#46;torgue&#37;&#52;&#48;st&#46;com">alexandre<span>&#46;</span>torgue<span>&#64;</span>st<span>&#46;</span>com</a>&gt;, Jose Abreu &lt;<a class="reference external" href="mailto:joabreu&#37;&#52;&#48;synopsys&#46;com">joabreu<span>&#64;</span>synopsys<span>&#46;</span>com</a>&gt;</p>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>In This Release</p></li>
<li><p>Feature List</p></li>
<li><p>Kernel Configuration</p></li>
<li><p>Command Line Parameters</p></li>
<li><p>Driver Information and Notes</p></li>
<li><p>Debug Information</p></li>
<li><p>Support</p></li>
</ul>
</section>
<section id="in-this-release">
<h2>In This Release<a class="headerlink" href="#in-this-release" title="Permalink to this headline">¶</a></h2>
<p>This file describes the stmmac Linux Driver for all the Synopsys(R) Ethernet
Controllers.</p>
<p>Currently, this network device driver is for all STi embedded MAC/GMAC
(i.e. 7xxx/5xxx SoCs), SPEAr (arm), Loongson1B (mips) and XILINX XC2V3000
FF1152AMT0221 D1215994A VIRTEX FPGA board. The Synopsys Ethernet QoS 5.0 IPK
is also supported.</p>
<p>DesignWare(R) Cores Ethernet MAC 10/100/1000 Universal version 3.70a
(and older) and DesignWare(R) Cores Ethernet Quality-of-Service version 4.0
(and upper) have been used for developing this driver as well as
DesignWare(R) Cores XGMAC - 10G Ethernet MAC and DesignWare(R) Cores
Enterprise MAC - 100G Ethernet MAC.</p>
<p>This driver supports both the platform bus and PCI.</p>
<p>This driver includes support for the following Synopsys(R) DesignWare(R)
Cores Ethernet Controllers and corresponding minimum and maximum versions:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Controller Name</p></th>
<th class="head"><p>Min. Version</p></th>
<th class="head"><p>Max. Version</p></th>
<th class="head"><p>Abbrev. Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ethernet MAC Universal</p></td>
<td><p>N/A</p></td>
<td><p>3.73a</p></td>
<td><p>GMAC</p></td>
</tr>
<tr class="row-odd"><td><p>Ethernet Quality-of-Service</p></td>
<td><p>4.00a</p></td>
<td><p>N/A</p></td>
<td><p>GMAC4+</p></td>
</tr>
<tr class="row-even"><td><p>XGMAC - 10G Ethernet MAC</p></td>
<td><p>2.10a</p></td>
<td><p>N/A</p></td>
<td><p>XGMAC2+</p></td>
</tr>
<tr class="row-odd"><td><p>XLGMAC - 100G Ethernet MAC</p></td>
<td><p>2.00a</p></td>
<td><p>N/A</p></td>
<td><p>XLGMAC2+</p></td>
</tr>
</tbody>
</table>
<p>For questions related to hardware requirements, refer to the documentation
supplied with your Ethernet adapter. All hardware requirements listed apply
to use with Linux.</p>
</section>
<section id="feature-list">
<h2>Feature List<a class="headerlink" href="#feature-list" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>The following features are available in this driver:</dt><dd><ul class="simple">
<li><p>GMII/MII/RGMII/SGMII/RMII/XGMII/XLGMII Interface</p></li>
<li><p>Half-Duplex / Full-Duplex Operation</p></li>
<li><p>Energy Efficient Ethernet (EEE)</p></li>
<li><p>IEEE 802.3x PAUSE Packets (Flow Control)</p></li>
<li><p>RMON/MIB Counters</p></li>
<li><p>IEEE 1588 Timestamping (PTP)</p></li>
<li><p>Pulse-Per-Second Output (PPS)</p></li>
<li><p>MDIO Clause 22 / Clause 45 Interface</p></li>
<li><p>MAC Loopback</p></li>
<li><p>ARP Offloading</p></li>
<li><p>Automatic CRC / PAD Insertion and Checking</p></li>
<li><p>Checksum Offload for Received and Transmitted Packets</p></li>
<li><p>Standard or Jumbo Ethernet Packets</p></li>
<li><p>Source Address Insertion / Replacement</p></li>
<li><p>VLAN TAG Insertion / Replacement / Deletion / Filtering (HASH and PERFECT)</p></li>
<li><p>Programmable TX and RX Watchdog and Coalesce Settings</p></li>
<li><p>Destination Address Filtering (PERFECT)</p></li>
<li><p>HASH Filtering (Multicast)</p></li>
<li><p>Layer 3 / Layer 4 Filtering</p></li>
<li><p>Remote Wake-Up Detection</p></li>
<li><p>Receive Side Scaling (RSS)</p></li>
<li><p>Frame Preemption for TX and RX</p></li>
<li><p>Programmable Burst Length, Threshold, Queue Size</p></li>
<li><p>Multiple Queues (up to 8)</p></li>
<li><p>Multiple Scheduling Algorithms (TX: WRR, DWRR, WFQ, SP, CBS, EST, TBS;
RX: WRR, SP)</p></li>
<li><p>Flexible RX Parser</p></li>
<li><p>TCP / UDP Segmentation Offload (TSO, USO)</p></li>
<li><p>Split Header (SPH)</p></li>
<li><p>Safety Features (ECC Protection, Data Parity Protection)</p></li>
<li><p>Selftests using Ethtool</p></li>
</ul>
</dd>
</dl>
</section>
<section id="kernel-configuration">
<h2>Kernel Configuration<a class="headerlink" href="#kernel-configuration" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>The kernel configuration option is <code class="docutils literal notranslate"><span class="pre">CONFIG_STMMAC_ETH</span></code>:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_STMMAC_PLATFORM</span></code>: is to enable the platform driver.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_STMMAC_PCI</span></code>: is to enable the pci driver.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="command-line-parameters">
<h2>Command Line Parameters<a class="headerlink" href="#command-line-parameters" title="Permalink to this headline">¶</a></h2>
<p>If the driver is built as a module the following optional parameters are used
by entering them on the command line with the modprobe command using this
syntax (e.g. for PCI module):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>modprobe stmmac_pci [&lt;option&gt;=&lt;VAL1&gt;,&lt;VAL2&gt;,...]
</pre></div>
</div>
<p>Driver parameters can be also passed in command line by using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>stmmaceth=watchdog:100,chain_mode=1
</pre></div>
</div>
<p>The default value for each parameter is generally the recommended setting,
unless otherwise noted.</p>
<section id="watchdog">
<h3>watchdog<a class="headerlink" href="#watchdog" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>5000-None</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>5000</p>
</dd>
</dl>
<p>This parameter overrides the transmit timeout in milliseconds.</p>
</section>
<section id="debug">
<h3>debug<a class="headerlink" href="#debug" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>0-16 (0=none,…,16=all)</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>0</p>
</dd>
</dl>
<p>This parameter adjusts the level of debug messages displayed in the system
logs.</p>
</section>
<section id="phyaddr">
<h3>phyaddr<a class="headerlink" href="#phyaddr" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>0-31</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>-1</p>
</dd>
</dl>
<p>This parameter overrides the physical address of the PHY device.</p>
</section>
<section id="flow-ctrl">
<h3>flow_ctrl<a class="headerlink" href="#flow-ctrl" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>0-3 (0=off,1=rx,2=tx,3=rx/tx)</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>3</p>
</dd>
</dl>
<p>This parameter changes the default Flow Control ability.</p>
</section>
<section id="pause">
<h3>pause<a class="headerlink" href="#pause" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>0-65535</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>65535</p>
</dd>
</dl>
<p>This parameter changes the default Flow Control Pause time.</p>
</section>
<section id="tc">
<h3>tc<a class="headerlink" href="#tc" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>64-256</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>64</p>
</dd>
</dl>
<p>This parameter changes the default HW FIFO Threshold control value.</p>
</section>
<section id="buf-sz">
<h3>buf_sz<a class="headerlink" href="#buf-sz" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>1536-16384</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>1536</p>
</dd>
</dl>
<p>This parameter changes the default RX DMA packet buffer size.</p>
</section>
<section id="eee-timer">
<h3>eee_timer<a class="headerlink" href="#eee-timer" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>0-None</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>1000</p>
</dd>
</dl>
<p>This parameter changes the default LPI TX Expiration time in milliseconds.</p>
</section>
<section id="chain-mode">
<h3>chain_mode<a class="headerlink" href="#chain-mode" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Valid Range</dt>
<dd class="field-odd"><p>0-1 (0=off,1=on)</p>
</dd>
<dt class="field-even">Default Value</dt>
<dd class="field-even"><p>0</p>
</dd>
</dl>
<p>This parameter changes the default mode of operation from Ring Mode to
Chain Mode.</p>
</section>
</section>
<section id="driver-information-and-notes">
<h2>Driver Information and Notes<a class="headerlink" href="#driver-information-and-notes" title="Permalink to this headline">¶</a></h2>
<section id="transmit-process">
<h3>Transmit Process<a class="headerlink" href="#transmit-process" title="Permalink to this headline">¶</a></h3>
<p>The xmit method is invoked when the kernel needs to transmit a packet; it sets
the descriptors in the ring and informs the DMA engine that there is a packet
ready to be transmitted.</p>
<p>By default, the driver sets the <code class="docutils literal notranslate"><span class="pre">NETIF_F_SG</span></code> bit in the features field of
the <code class="docutils literal notranslate"><span class="pre">net_device</span></code> structure, enabling the scatter-gather feature. This is
true on chips and configurations where the checksum can be done in hardware.</p>
<p>Once the controller has finished transmitting the packet, timer will be
scheduled to release the transmit resources.</p>
</section>
<section id="receive-process">
<h3>Receive Process<a class="headerlink" href="#receive-process" title="Permalink to this headline">¶</a></h3>
<p>When one or more packets are received, an interrupt happens. The interrupts
are not queued, so the driver has to scan all the descriptors in the ring
during the receive process.</p>
<p>This is based on NAPI, so the interrupt handler signals only if there is work
to be done, and it exits. Then the poll method will be scheduled at some
future point.</p>
<p>The incoming packets are stored, by the DMA, in a list of pre-allocated socket
buffers in order to avoid the memcpy (zero-copy).</p>
</section>
<section id="interrupt-mitigation">
<h3>Interrupt Mitigation<a class="headerlink" href="#interrupt-mitigation" title="Permalink to this headline">¶</a></h3>
<p>The driver is able to mitigate the number of its DMA interrupts using NAPI for
the reception on chips older than the 3.50. New chips have an HW RX Watchdog
used for this mitigation.</p>
<p>Mitigation parameters can be tuned by ethtool.</p>
</section>
<section id="wol">
<h3>WoL<a class="headerlink" href="#wol" title="Permalink to this headline">¶</a></h3>
<p>Wake up on Lan feature through Magic and Unicast frames are supported for the
GMAC, GMAC4/5 and XGMAC core.</p>
</section>
<section id="dma-descriptors">
<h3>DMA Descriptors<a class="headerlink" href="#dma-descriptors" title="Permalink to this headline">¶</a></h3>
<p>Driver handles both normal and alternate descriptors. The latter has been only
tested on DesignWare(R) Cores Ethernet MAC Universal version 3.41a and later.</p>
<p>stmmac supports DMA descriptor to operate both in dual buffer (RING) and
linked-list(CHAINED) mode. In RING each descriptor points to two data buffer
pointers whereas in CHAINED mode they point to only one data buffer pointer.
RING mode is the default.</p>
<p>In CHAINED mode each descriptor will have pointer to next descriptor in the
list, hence creating the explicit chaining in the descriptor itself, whereas
such explicit chaining is not possible in RING mode.</p>
</section>
<section id="extended-descriptors">
<h3>Extended Descriptors<a class="headerlink" href="#extended-descriptors" title="Permalink to this headline">¶</a></h3>
<p>The extended descriptors give us information about the Ethernet payload when
it is carrying PTP packets or TCP/UDP/ICMP over IP. These are not available on
GMAC Synopsys(R) chips older than the 3.50. At probe time the driver will
decide if these can be actually used. This support also is mandatory for PTPv2
because the extra descriptors are used for saving the hardware timestamps and
Extended Status.</p>
</section>
<section id="ethtool-support">
<h3>Ethtool Support<a class="headerlink" href="#ethtool-support" title="Permalink to this headline">¶</a></h3>
<p>Ethtool is supported. For example, driver statistics (including RMON),
internal errors can be taken using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -S ethX
</pre></div>
</div>
<p>Ethtool selftests are also supported. This allows to do some early sanity
checks to the HW using MAC and PHY loopback mechanisms:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -t ethX
</pre></div>
</div>
</section>
<section id="jumbo-and-segmentation-offloading">
<h3>Jumbo and Segmentation Offloading<a class="headerlink" href="#jumbo-and-segmentation-offloading" title="Permalink to this headline">¶</a></h3>
<p>Jumbo frames are supported and tested for the GMAC. The GSO has been also
added but it’s performed in software. LRO is not supported.</p>
</section>
<section id="tso-support">
<h3>TSO Support<a class="headerlink" href="#tso-support" title="Permalink to this headline">¶</a></h3>
<p>TSO (TCP Segmentation Offload) feature is supported by GMAC &gt; 4.x and XGMAC
chip family. When a packet is sent through TCP protocol, the TCP stack ensures
that the SKB provided to the low level driver (stmmac in our case) matches
with the maximum frame len (IP header + TCP header + payload &lt;= 1500 bytes
(for MTU set to 1500)). It means that if an application using TCP want to send
a packet which will have a length (after adding headers) &gt; 1514 the packet
will be split in several TCP packets: The data payload is split and headers
(TCP/IP ..) are added. It is done by software.</p>
<p>When TSO is enabled, the TCP stack doesn’t care about the maximum frame length
and provide SKB packet to stmmac as it is. The GMAC IP will have to perform
the segmentation by it self to match with maximum frame length.</p>
<p>This feature can be enabled in device tree through <code class="docutils literal notranslate"><span class="pre">snps,tso</span></code> entry.</p>
</section>
<section id="energy-efficient-ethernet">
<h3>Energy Efficient Ethernet<a class="headerlink" href="#energy-efficient-ethernet" title="Permalink to this headline">¶</a></h3>
<p>Energy Efficient Ethernet (EEE) enables IEEE 802.3 MAC sublayer along with a
family of Physical layer to operate in the Low Power Idle (LPI) mode. The EEE
mode supports the IEEE 802.3 MAC operation at 100Mbps, 1000Mbps and 1Gbps.</p>
<p>The LPI mode allows power saving by switching off parts of the communication
device functionality when there is no data to be transmitted &amp; received.
The system on both the side of the link can disable some functionalities and
save power during the period of low-link utilization. The MAC controls whether
the system should enter or exit the LPI mode and communicate this to PHY.</p>
<p>As soon as the interface is opened, the driver verifies if the EEE can be
supported. This is done by looking at both the DMA HW capability register and
the PHY devices MCD registers.</p>
<p>To enter in TX LPI mode the driver needs to have a software timer that enable
and disable the LPI mode when there is nothing to be transmitted.</p>
</section>
<section id="precision-time-protocol-ptp">
<h3>Precision Time Protocol (PTP)<a class="headerlink" href="#precision-time-protocol-ptp" title="Permalink to this headline">¶</a></h3>
<p>The driver supports the IEEE 1588-2002, Precision Time Protocol (PTP), which
enables precise synchronization of clocks in measurement and control systems
implemented with technologies such as network communication.</p>
<p>In addition to the basic timestamp features mentioned in IEEE 1588-2002
Timestamps, new GMAC cores support the advanced timestamp features.
IEEE 1588-2008 can be enabled when configuring the Kernel.</p>
</section>
<section id="sgmii-rgmii-support">
<h3>SGMII/RGMII Support<a class="headerlink" href="#sgmii-rgmii-support" title="Permalink to this headline">¶</a></h3>
<p>New GMAC devices provide own way to manage RGMII/SGMII. This information is
available at run-time by looking at the HW capability register. This means
that the stmmac can manage auto-negotiation and link status w/o using the
PHYLIB stuff. In fact, the HW provides a subset of extended registers to
restart the ANE, verify Full/Half duplex mode and Speed. Thanks to these
registers, it is possible to look at the Auto-negotiated Link Parter Ability.</p>
</section>
<section id="physical">
<h3>Physical<a class="headerlink" href="#physical" title="Permalink to this headline">¶</a></h3>
<p>The driver is compatible with Physical Abstraction Layer to be connected with
PHY and GPHY devices.</p>
</section>
<section id="platform-information">
<h3>Platform Information<a class="headerlink" href="#platform-information" title="Permalink to this headline">¶</a></h3>
<p>Several information can be passed through the platform and device-tree.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct plat_stmmacenet_data {
</pre></div>
</div>
<ol class="arabic">
<li><p>Bus identifier:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int bus_id;
</pre></div>
</div>
</li>
</ol>
<p>2) PHY Physical Address. If set to -1 the driver will pick the first PHY it
finds:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int phy_addr;
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p>PHY Device Interface:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int interface;
</pre></div>
</div>
</li>
<li><p>Specific platform fields for the MDIO bus:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_mdio_bus_data *mdio_bus_data;
</pre></div>
</div>
</li>
<li><p>Internal DMA parameters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_dma_cfg *dma_cfg;
</pre></div>
</div>
</li>
<li><p>Fixed CSR Clock Range selection:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int clk_csr;
</pre></div>
</div>
</li>
<li><p>HW uses the GMAC core:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int has_gmac;
</pre></div>
</div>
</li>
<li><p>If set the MAC will use Enhanced Descriptors:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int enh_desc;
</pre></div>
</div>
</li>
<li><p>Core is able to perform TX Checksum and/or RX Checksum in HW:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int tx_coe;
int rx_coe;
</pre></div>
</div>
</li>
</ol>
<p>11) Some HWs are not able to perform the csum in HW for over-sized frames due
to limited buffer sizes. Setting this flag the csum will be done in SW on
JUMBO frames:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int bugged_jumbo;
</pre></div>
</div>
<ol class="arabic" start="12">
<li><p>Core has the embedded power module:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int pmt;
</pre></div>
</div>
</li>
<li><p>Force DMA to use the Store and Forward mode or Threshold mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int force_sf_dma_mode;
int force_thresh_dma_mode;
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="15">
<li><p>Force to disable the RX Watchdog feature and switch to NAPI mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int riwt_off;
</pre></div>
</div>
</li>
<li><p>Limit the maximum operating speed and MTU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int max_speed;
int maxmtu;
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="18">
<li><p>Number of Multicast/Unicast filters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int multicast_filter_bins;
int unicast_filter_entries;
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="20">
<li><p>Limit the maximum TX and RX FIFO size:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int tx_fifo_size;
int rx_fifo_size;
</pre></div>
</div>
</li>
<li><p>Use the specified number of TX and RX Queues:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u32 rx_queues_to_use;
u32 tx_queues_to_use;
</pre></div>
</div>
</li>
<li><p>Use the specified TX and RX scheduling algorithm:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u8 rx_sched_algorithm;
u8 tx_sched_algorithm;
</pre></div>
</div>
</li>
<li><p>Internal TX and RX Queue parameters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_rxq_cfg rx_queues_cfg[MTL_MAX_RX_QUEUES];
struct stmmac_txq_cfg tx_queues_cfg[MTL_MAX_TX_QUEUES];
</pre></div>
</div>
</li>
</ol>
<p>24) This callback is used for modifying some syscfg registers (on ST SoCs)
according to the link speed negotiated by the physical layer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void (*fix_mac_speed)(void *priv, unsigned int speed);
</pre></div>
</div>
<p>25) Callbacks used for calling a custom initialization; This is sometimes
necessary on some platforms (e.g. ST boxes) where the HW needs to have set
some PIO lines or system cfg registers. init/exit callbacks should not use
or modify platform data:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int (*init)(struct platform_device *pdev, void *priv);
void (*exit)(struct platform_device *pdev, void *priv);
</pre></div>
</div>
<p>26) Perform HW setup of the bus. For example, on some ST platforms this field
is used to configure the AMBA bridge to generate more efficient STBus traffic:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mac_device_info *(*setup)(void *priv);
void *bsp_priv;
</pre></div>
</div>
<ol class="arabic" start="27">
<li><p>Internal clocks and rates:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct clk *stmmac_clk;
struct clk *pclk;
struct clk *clk_ptp_ref;
unsigned int clk_ptp_rate;
unsigned int clk_ref_rate;
s32 ptp_max_adj;
</pre></div>
</div>
</li>
<li><p>Main reset:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct reset_control *stmmac_rst;
</pre></div>
</div>
</li>
<li><p>AXI Internal Parameters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_axi *axi;
</pre></div>
</div>
</li>
<li><p>HW uses GMAC&gt;4 cores:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int has_gmac4;
</pre></div>
</div>
</li>
<li><p>HW is sun8i based:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool has_sun8i;
</pre></div>
</div>
</li>
<li><p>Enables TSO feature:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool tso_en;
</pre></div>
</div>
</li>
<li><p>Enables Receive Side Scaling (RSS) feature:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int rss_en;
</pre></div>
</div>
</li>
<li><p>MAC Port selection:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int mac_port_sel_speed;
</pre></div>
</div>
</li>
<li><p>Enables TX LPI Clock Gating:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool en_tx_lpi_clockgating;
</pre></div>
</div>
</li>
<li><p>HW uses XGMAC&gt;2.10 cores:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int has_xgmac;
</pre></div>
</div>
</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>}
</pre></div>
</div>
<p>For MDIO bus data, we have:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_mdio_bus_data {
</pre></div>
</div>
<ol class="arabic">
<li><p>PHY mask passed when MDIO bus is registered:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>unsigned int phy_mask;
</pre></div>
</div>
</li>
<li><p>List of IRQs, one per PHY:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int *irqs;
</pre></div>
</div>
</li>
<li><p>If IRQs is NULL, use this for probed PHY:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int probed_phy_irq;
</pre></div>
</div>
</li>
<li><p>Set to true if PHY needs reset:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool needs_reset;
</pre></div>
</div>
</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>}
</pre></div>
</div>
<p>For DMA engine configuration, we have:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_dma_cfg {
</pre></div>
</div>
<ol class="arabic">
<li><p>Programmable Burst Length (TX and RX):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int pbl;
</pre></div>
</div>
</li>
<li><p>If set, DMA TX / RX will use this value rather than pbl:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int txpbl;
int rxpbl;
</pre></div>
</div>
</li>
<li><p>Enable 8xPBL:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool pblx8;
</pre></div>
</div>
</li>
<li><p>Enable Fixed or Mixed burst:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int fixed_burst;
int mixed_burst;
</pre></div>
</div>
</li>
<li><p>Enable Address Aligned Beats:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool aal;
</pre></div>
</div>
</li>
<li><p>Enable Enhanced Addressing (&gt; 32 bits):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool eame;
</pre></div>
</div>
</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>}
</pre></div>
</div>
<p>For DMA AXI parameters, we have:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_axi {
</pre></div>
</div>
<ol class="arabic">
<li><p>Enable AXI LPI:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool axi_lpi_en;
bool axi_xit_frm;
</pre></div>
</div>
</li>
<li><p>Set AXI Write / Read maximum outstanding requests:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u32 axi_wr_osr_lmt;
u32 axi_rd_osr_lmt;
</pre></div>
</div>
</li>
<li><p>Set AXI 4KB bursts:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool axi_kbbe;
</pre></div>
</div>
</li>
<li><p>Set AXI maximum burst length map:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u32 axi_blen[AXI_BLEN];
</pre></div>
</div>
</li>
<li><p>Set AXI Fixed burst / mixed burst:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool axi_fb;
bool axi_mb;
</pre></div>
</div>
</li>
<li><p>Set AXI rebuild incrx mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool axi_rb;
</pre></div>
</div>
</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>}
</pre></div>
</div>
<p>For the RX Queues configuration, we have:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_rxq_cfg {
</pre></div>
</div>
<ol class="arabic">
<li><p>Mode to use (DCB or AVB):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u8 mode_to_use;
</pre></div>
</div>
</li>
<li><p>DMA channel to use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u32 chan;
</pre></div>
</div>
</li>
<li><p>Packet routing, if applicable:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u8 pkt_route;
</pre></div>
</div>
</li>
<li><p>Use priority routing, and priority to route:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool use_prio;
u32 prio;
</pre></div>
</div>
</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>}
</pre></div>
</div>
<p>For the TX Queues configuration, we have:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct stmmac_txq_cfg {
</pre></div>
</div>
<ol class="arabic">
<li><p>Queue weight in scheduler:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u32 weight;
</pre></div>
</div>
</li>
<li><p>Mode to use (DCB or AVB):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u8 mode_to_use;
</pre></div>
</div>
</li>
<li><p>Credit Base Shaper Parameters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>u32 send_slope;
u32 idle_slope;
u32 high_credit;
u32 low_credit;
</pre></div>
</div>
</li>
<li><p>Use priority scheduling, and priority:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bool use_prio;
u32 prio;
</pre></div>
</div>
</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>}
</pre></div>
</div>
</section>
<section id="device-tree-information">
<h3>Device Tree Information<a class="headerlink" href="#device-tree-information" title="Permalink to this headline">¶</a></h3>
<p>Please refer to the following document:
Documentation/devicetree/bindings/net/snps,dwmac.yaml</p>
</section>
<section id="hw-capabilities">
<h3>HW Capabilities<a class="headerlink" href="#hw-capabilities" title="Permalink to this headline">¶</a></h3>
<p>Note that, starting from new chips, where it is available the HW capability
register, many configurations are discovered at run-time for example to
understand if EEE, HW csum, PTP, enhanced descriptor etc are actually
available. As strategy adopted in this driver, the information from the HW
capability register can replace what has been passed from the platform.</p>
</section>
</section>
<section id="debug-information">
<h2>Debug Information<a class="headerlink" href="#debug-information" title="Permalink to this headline">¶</a></h2>
<p>The driver exports many information i.e. internal statistics, debug
information, MAC and DMA registers etc.</p>
<p>These can be read in several ways depending on the type of the information
actually needed.</p>
<p>For example a user can be use the ethtool support to get statistics: e.g.
using: <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-S</span> <span class="pre">ethX</span></code> (that shows the Management counters (MMC) if
supported) or sees the MAC/DMA registers: e.g. using: <code class="docutils literal notranslate"><span class="pre">ethtool</span> <span class="pre">-d</span> <span class="pre">ethX</span></code></p>
<p>Compiling the Kernel with <code class="docutils literal notranslate"><span class="pre">CONFIG_DEBUG_FS</span></code> the driver will export the
following debugfs entries:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">descriptors_status</span></code>: To show the DMA TX/RX descriptor rings</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dma_cap</span></code>: To show the HW Capabilities</p></li>
</ul>
</div></blockquote>
<p>Developer can also use the <code class="docutils literal notranslate"><span class="pre">debug</span></code> module parameter to get further debug
information (please see: NETIF Msg Level).</p>
</section>
<section id="support">
<h2>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<p>If an issue is identified with the released source code on a supported kernel
with a supported adapter, email the specific information related to the
issue to <a class="reference external" href="mailto:netdev&#37;&#52;&#48;vger&#46;kernel&#46;org">netdev<span>&#64;</span>vger<span>&#46;</span>kernel<span>&#46;</span>org</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Linux Driver for the Synopsys(R) Ethernet Controllers “stmmac”</a><ul>
<li><a class="reference internal" href="#contents">Contents</a></li>
<li><a class="reference internal" href="#in-this-release">In This Release</a></li>
<li><a class="reference internal" href="#feature-list">Feature List</a></li>
<li><a class="reference internal" href="#kernel-configuration">Kernel Configuration</a></li>
<li><a class="reference internal" href="#command-line-parameters">Command Line Parameters</a><ul>
<li><a class="reference internal" href="#watchdog">watchdog</a></li>
<li><a class="reference internal" href="#debug">debug</a></li>
<li><a class="reference internal" href="#phyaddr">phyaddr</a></li>
<li><a class="reference internal" href="#flow-ctrl">flow_ctrl</a></li>
<li><a class="reference internal" href="#pause">pause</a></li>
<li><a class="reference internal" href="#tc">tc</a></li>
<li><a class="reference internal" href="#buf-sz">buf_sz</a></li>
<li><a class="reference internal" href="#eee-timer">eee_timer</a></li>
<li><a class="reference internal" href="#chain-mode">chain_mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="#driver-information-and-notes">Driver Information and Notes</a><ul>
<li><a class="reference internal" href="#transmit-process">Transmit Process</a></li>
<li><a class="reference internal" href="#receive-process">Receive Process</a></li>
<li><a class="reference internal" href="#interrupt-mitigation">Interrupt Mitigation</a></li>
<li><a class="reference internal" href="#wol">WoL</a></li>
<li><a class="reference internal" href="#dma-descriptors">DMA Descriptors</a></li>
<li><a class="reference internal" href="#extended-descriptors">Extended Descriptors</a></li>
<li><a class="reference internal" href="#ethtool-support">Ethtool Support</a></li>
<li><a class="reference internal" href="#jumbo-and-segmentation-offloading">Jumbo and Segmentation Offloading</a></li>
<li><a class="reference internal" href="#tso-support">TSO Support</a></li>
<li><a class="reference internal" href="#energy-efficient-ethernet">Energy Efficient Ethernet</a></li>
<li><a class="reference internal" href="#precision-time-protocol-ptp">Precision Time Protocol (PTP)</a></li>
<li><a class="reference internal" href="#sgmii-rgmii-support">SGMII/RGMII Support</a></li>
<li><a class="reference internal" href="#physical">Physical</a></li>
<li><a class="reference internal" href="#platform-information">Platform Information</a></li>
<li><a class="reference internal" href="#device-tree-information">Device Tree Information</a></li>
<li><a class="reference internal" href="#hw-capabilities">HW Capabilities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debug-information">Debug Information</a></li>
<li><a class="reference internal" href="#support">Support</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/networking/device_drivers/ethernet/stmicro/stmmac.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../../_sources/networking/device_drivers/ethernet/stmicro/stmmac.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>