
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Chelsio N210 10Gb Ethernet Network Controller &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Cirrus Logic LAN CS8900/CS8920 Ethernet Adapters" href="../cirrus/cs89x0.html" />
    <link rel="prev" title="Marvell(Aquantia) AQtion Driver" href="../aquantia/atlantic.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="chelsio-n210-10gb-ethernet-network-controller">
<h1>Chelsio N210 10Gb Ethernet Network Controller<a class="headerlink" href="#chelsio-n210-10gb-ethernet-network-controller" title="Permalink to this headline">¶</a></h1>
<p>Driver Release Notes for Linux</p>
<p>Version 2.1.1</p>
<p>June 20, 2005</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>This document describes the Linux driver for Chelsio 10Gb Ethernet Network
Controller. This driver supports the Chelsio N210 NIC and is backward
compatible with the Chelsio N110 model 10Gb NICs.</p>
</div></blockquote>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<section id="adaptive-interrupts-adaptive-rx">
<h3>Adaptive Interrupts (adaptive-rx)<a class="headerlink" href="#adaptive-interrupts-adaptive-rx" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>This feature provides an adaptive algorithm that adjusts the interrupt
coalescing parameters, allowing the driver to dynamically adapt the latency
settings to achieve the highest performance during various types of network
load.</p>
<p>The interface used to control this feature is ethtool. Please see the
ethtool manpage for additional usage information.</p>
<p>By default, adaptive-rx is disabled.
To enable adaptive-rx:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -C &lt;interface&gt; adaptive-rx on
</pre></div>
</div>
<p>To disable adaptive-rx, use ethtool:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -C &lt;interface&gt; adaptive-rx off
</pre></div>
</div>
<p>After disabling adaptive-rx, the timer latency value will be set to 50us.
You may set the timer latency after disabling adaptive-rx:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -C &lt;interface&gt; rx-usecs &lt;microseconds&gt;
</pre></div>
</div>
<p>An example to set the timer latency value to 100us on eth0:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -C eth0 rx-usecs 100
</pre></div>
</div>
<p>You may also provide a timer latency value while disabling adaptive-rx:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -C &lt;interface&gt; adaptive-rx off rx-usecs &lt;microseconds&gt;
</pre></div>
</div>
<p>If adaptive-rx is disabled and a timer latency value is specified, the timer
will be set to the specified value until changed by the user or until
adaptive-rx is enabled.</p>
<p>To view the status of the adaptive-rx and timer latency values:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -c &lt;interface&gt;
</pre></div>
</div>
</div></blockquote>
</section>
<section id="tcp-segmentation-offloading-tso-support">
<h3>TCP Segmentation Offloading (TSO) Support<a class="headerlink" href="#tcp-segmentation-offloading-tso-support" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>This feature, also known as “large send”, enables a system’s protocol stack
to offload portions of outbound TCP processing to a network interface card
thereby reducing system CPU utilization and enhancing performance.</p>
<p>The interface used to control this feature is ethtool version 1.8 or higher.
Please see the ethtool manpage for additional usage information.</p>
<p>By default, TSO is enabled.
To disable TSO:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -K &lt;interface&gt; tso off
</pre></div>
</div>
<p>To enable TSO:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -K &lt;interface&gt; tso on
</pre></div>
</div>
<p>To view the status of TSO:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ethtool -k &lt;interface&gt;
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The following information is provided as an example of how to change system
parameters for “performance tuning” an what value to use. You may or may not
want to change these system parameters, depending on your server/workstation
application. Doing so is not warranted in any way by Chelsio Communications,
and is done at “YOUR OWN RISK”. Chelsio will not be held responsible for loss
of data or damage to equipment.</p>
<p>Your distribution may have a different way of doing things, or you may prefer
a different method. These commands are shown only to provide an example of
what to do and are by no means definitive.</p>
<p>Making any of the following system changes will only last until you reboot
your system. You may want to write a script that runs at boot-up which
includes the optimal settings for your system.</p>
<blockquote>
<div><p>Setting PCI Latency Timer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>setpci -d 1425::
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<ul>
<li><p>0x0c.l=0x0000F800</p>
<p>Disabling TCP timestamp:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.ipv4.tcp_timestamps=0
</pre></div>
</div>
<p>Disabling SACK:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.ipv4.tcp_sack=0
</pre></div>
</div>
<p>Setting large number of incoming connection requests:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.ipv4.tcp_max_syn_backlog=3000
</pre></div>
</div>
<p>Setting maximum receive socket buffer size:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.core.rmem_max=1024000
</pre></div>
</div>
<p>Setting maximum send socket buffer size:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.core.wmem_max=1024000
</pre></div>
</div>
<p>Set smp_affinity (on a multiprocessor system) to a single CPU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 1 &gt; /proc/irq/&lt;interrupt_number&gt;/smp_affinity
</pre></div>
</div>
<p>Setting default receive socket buffer size:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.core.rmem_default=524287
</pre></div>
</div>
<p>Setting default send socket buffer size:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.core.wmem_default=524287
</pre></div>
</div>
<p>Setting maximum option memory buffers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.core.optmem_max=524287
</pre></div>
</div>
<p>Setting maximum backlog (# of unprocessed packets before kernel drops):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.core.netdev_max_backlog=300000
</pre></div>
</div>
<p>Setting TCP read buffers (min/default/max):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.ipv4.tcp_rmem=&quot;10000000 10000000 10000000&quot;
</pre></div>
</div>
<p>Setting TCP write buffers (min/pressure/max):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.ipv4.tcp_wmem=&quot;10000000 10000000 10000000&quot;
</pre></div>
</div>
<p>Setting TCP buffer space (min/pressure/max):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.ipv4.tcp_mem=&quot;10000000 10000000 10000000&quot;
</pre></div>
</div>
<p>TCP window size for single connections:</p>
<blockquote>
<div><p>The receive buffer (RX_WINDOW) size must be at least as large as the
Bandwidth-Delay Product of the communication link between the sender and
receiver. Due to the variations of RTT, you may want to increase the buffer
size up to 2 times the Bandwidth-Delay Product. Reference page 289 of
“TCP/IP Illustrated, Volume 1, The Protocols” by W. Richard Stevens.</p>
<p>At 10Gb speeds, use the following formula:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>RX_WINDOW &gt;= 1.25MBytes * RTT(in milliseconds)
Example for RTT with 100us: RX_WINDOW = (1,250,000 * 0.1) = 125,000
</pre></div>
</div>
<p>RX_WINDOW sizes of 256KB - 512KB should be sufficient.</p>
<p>Setting the min, max, and default receive buffer (RX_WINDOW) size:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sysctl -w net.ipv4.tcp_rmem=&quot;&lt;min&gt; &lt;default&gt; &lt;max&gt;&quot;
</pre></div>
</div>
</div></blockquote>
<dl>
<dt>TCP window size for multiple connections:</dt><dd><p>The receive buffer (RX_WINDOW) size may be calculated the same as single
connections, but should be divided by the number of connections. The
smaller window prevents congestion and facilitates better pacing,
especially if/when MAC level flow control does not work well or when it is
not supported on the machine. Experimentation may be necessary to attain
the correct value. This method is provided as a starting point for the
correct receive buffer size.</p>
<p>Setting the min, max, and default receive buffer (RX_WINDOW) size is
performed in the same manner as single connection.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="driver-messages">
<h2>Driver Messages<a class="headerlink" href="#driver-messages" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>The following messages are the most common messages logged by syslog. These
may be found in /var/log/messages.</p>
<blockquote>
<div><p>Driver up:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Chelsio Network Driver - version 2.1.1
</pre></div>
</div>
<p>NIC detected:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>eth#: Chelsio N210 1x10GBaseX NIC (rev #), PCIX 133MHz/64-bit
</pre></div>
</div>
<p>Link up:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>eth#: link is up at 10 Gbps, full duplex
</pre></div>
</div>
<p>Link down:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>eth#: link is down
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
</section>
<section id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>These issues have been identified during testing. The following information
is provided as a workaround to the problem. In some cases, this problem is
inherent to Linux or to a particular Linux Distribution and/or hardware
platform.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Large number of TCP retransmits on a multiprocessor (SMP) system.</p>
<blockquote>
<div><p>On a system with multiple CPUs, the interrupt (IRQ) for the network
controller may be bound to more than one CPU. This will cause TCP
retransmits if the packet data were to be split across different CPUs
and re-assembled in a different order than expected.</p>
<p>To eliminate the TCP retransmits, set smp_affinity on the particular
interrupt to a single CPU. You can locate the interrupt (IRQ) used on
the N110/N210 by using ifconfig:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ifconfig &lt;dev_name&gt; | grep Interrupt
</pre></div>
</div>
<p>Set the smp_affinity to a single CPU:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 1 &gt; /proc/irq/&lt;interrupt_number&gt;/smp_affinity
</pre></div>
</div>
<p>It is highly suggested that you do not run the irqbalance daemon on your
system, as this will change any smp_affinity setting you have applied.
The irqbalance daemon runs on a 10 second interval and binds interrupts
to the least loaded CPU determined by the daemon. To disable this daemon:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>chkconfig --level 2345 irqbalance off
</pre></div>
</div>
<p>By default, some Linux distributions enable the kernel feature,
irqbalance, which performs the same function as the daemon. To disable
this feature, add the following line to your bootloader:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>noirqbalance

Example using the Grub bootloader::

    title Red Hat Enterprise Linux AS (2.4.21-27.ELsmp)
    root (hd0,0)
    kernel /vmlinuz-2.4.21-27.ELsmp ro root=/dev/hda3 noirqbalance
    initrd /initrd-2.4.21-27.ELsmp.img
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>After running insmod, the driver is loaded and the incorrect network
interface is brought up without running ifup.</p>
<blockquote>
<div><p>When using 2.4.x kernels, including RHEL kernels, the Linux kernel
invokes a script named “hotplug”. This script is primarily used to
automatically bring up USB devices when they are plugged in, however,
the script also attempts to automatically bring up a network interface
after loading the kernel module. The hotplug script does this by scanning
the ifcfg-eth# config files in /etc/sysconfig/network-scripts, looking
for HWADDR=&lt;mac_address&gt;.</p>
<p>If the hotplug script does not find the HWADDRR within any of the
ifcfg-eth# files, it will bring up the device with the next available
interface name. If this interface is already configured for a different
network card, your new interface will have incorrect IP address and
network settings.</p>
<p>To solve this issue, you can add the HWADDR=&lt;mac_address&gt; key to the
interface config file of your network controller.</p>
<p>To disable this “hotplug” feature, you may add the driver (module name)
to the “blacklist” file located in /etc/hotplug. It has been noted that
this does not work for network devices because the net.agent script
does not use the blacklist file. Simply remove, or rename, the net.agent
script located in /etc/hotplug to disable this feature.</p>
</div></blockquote>
</li>
<li><p>Transport Protocol (TP) hangs when running heavy multi-connection traffic
on an AMD Opteron system with HyperTransport PCI-X Tunnel chipset.</p>
<blockquote>
<div><p>If your AMD Opteron system uses the AMD-8131 HyperTransport PCI-X Tunnel
chipset, you may experience the “133-Mhz Mode Split Completion Data
Corruption” bug identified by AMD while using a 133Mhz PCI-X card on the
bus PCI-X bus.</p>
<p>AMD states, “Under highly specific conditions, the AMD-8131 PCI-X Tunnel
can provide stale data via split completion cycles to a PCI-X card that
is operating at 133 Mhz”, causing data corruption.</p>
<p>AMD’s provides three workarounds for this problem, however, Chelsio
recommends the first option for best performance with this bug:</p>
<blockquote>
<div><p>For 133Mhz secondary bus operation, limit the transaction length and
the number of outstanding transactions, via BIOS configuration
programming of the PCI-X card, to the following:</p>
<blockquote>
<div><p>Data Length (bytes): 1k</p>
<p>Total allowed outstanding transactions: 2</p>
</div></blockquote>
</div></blockquote>
<p>Please refer to AMD 8131-HT/PCI-X Errata 26310 Rev 3.08 August 2004,
section 56, “133-MHz Mode Split Completion Data Corruption” for more
details with this bug and workarounds suggested by AMD.</p>
<p>It may be possible to work outside AMD’s recommended PCI-X settings, try
increasing the Data Length to 2k bytes for increased performance. If you
have issues with these settings, please revert to the “safe” settings
and duplicate the problem before submitting a bug or asking for support.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default setting on most systems is 8 outstanding transactions
and 2k bytes data length.</p>
</div>
</div></blockquote>
</li>
<li><p>On multiprocessor systems, it has been noted that an application which
is handling 10Gb networking can switch between CPUs causing degraded
and/or unstable performance.</p>
<blockquote>
<div><p>If running on an SMP system and taking performance measurements, it
is suggested you either run the latest netperf-2.4.0+ or use a binding
tool such as Tim Hockin’s procstate utilities (runon)
&lt;<a class="reference external" href="http://www.hockin.org/~thockin/procstate/">http://www.hockin.org/~thockin/procstate/</a>&gt;.</p>
<p>Binding netserver and netperf (or other applications) to particular
CPUs will have a significant difference in performance measurements.
You may need to experiment which CPU to bind the application to in
order to achieve the best performance for your system.</p>
<p>If you are developing an application designed for 10Gb networking,
please keep in mind you may want to look at kernel functions
sched_setaffinity &amp; sched_getaffinity to bind your application.</p>
<p>If you are just running user-space applications such as ftp, telnet,
etc., you may want to try the runon tool provided by Tim Hockin’s
procstate utility. You could also try binding the interface to a
particular CPU: runon 0 ifup eth0</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</div></blockquote>
</section>
<section id="support">
<h2>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>If you have problems with the software or hardware, please contact our
customer support team via email at <a class="reference external" href="mailto:support&#37;&#52;&#48;chelsio&#46;com">support<span>&#64;</span>chelsio<span>&#46;</span>com</a> or check our website
at <a class="reference external" href="http://www.chelsio.com">http://www.chelsio.com</a></p>
</div></blockquote>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Chelsio Communications
370 San Aleso Ave.
Suite 100
Sunnyvale, CA 94085
http://www.chelsio.com
</pre></div>
</div>
<p>This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License, version 2, as
published by the Free Software Foundation.</p>
<p>You should have received a copy of the GNU General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</p>
<p>THIS SOFTWARE IS PROVIDED <code class="docutils literal notranslate"><span class="pre">AS</span> <span class="pre">IS</span></code> AND WITHOUT ANY EXPRESS OR IMPLIED
WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</p>
<p>Copyright © 2003-2005 Chelsio Communications. All rights reserved.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Chelsio N210 10Gb Ethernet Network Controller</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#features">Features</a><ul>
<li><a class="reference internal" href="#adaptive-interrupts-adaptive-rx">Adaptive Interrupts (adaptive-rx)</a></li>
<li><a class="reference internal" href="#tcp-segmentation-offloading-tso-support">TCP Segmentation Offloading (TSO) Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance">Performance</a></li>
<li><a class="reference internal" href="#driver-messages">Driver Messages</a></li>
<li><a class="reference internal" href="#known-issues">Known Issues</a></li>
<li><a class="reference internal" href="#support">Support</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/networking/device_drivers/ethernet/chelsio/cxgb.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../../_sources/networking/device_drivers/ethernet/chelsio/cxgb.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>