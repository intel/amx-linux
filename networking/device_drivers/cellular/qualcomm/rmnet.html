
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Rmnet Driver &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Ethernet Device Drivers" href="../../ethernet/index.html" />
    <link rel="prev" title="Cellular Modem Device Drivers" href="../index.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="rmnet-driver">
<h1>Rmnet Driver<a class="headerlink" href="#rmnet-driver" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>rmnet driver is used for supporting the Multiplexing and aggregation
Protocol (MAP). This protocol is used by all recent chipsets using Qualcomm
Technologies, Inc. modems.</p>
<p>This driver can be used to register onto any physical network device in
IP mode. Physical transports include USB, HSIC, PCIe and IP accelerator.</p>
<p>Multiplexing allows for creation of logical netdevices (rmnet devices) to
handle multiple private data networks (PDN) like a default internet, tethering,
multimedia messaging service (MMS) or IP media subsystem (IMS). Hardware sends
packets with MAP headers to rmnet. Based on the multiplexer id, rmnet
routes to the appropriate PDN after removing the MAP header.</p>
<p>Aggregation is required to achieve high data rates. This involves hardware
sending aggregated bunch of MAP frames. rmnet driver will de-aggregate
these MAP frames and send them to appropriate PDN’s.</p>
</section>
<section id="packet-format">
<h2>2. Packet format<a class="headerlink" href="#packet-format" title="Permalink to this headline">¶</a></h2>
<ol class="loweralpha simple">
<li><p>MAP packet v1 (data / control)</p></li>
</ol>
<p>MAP header fields are in big endian format.</p>
<p>Packet format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bit             0             1           2-7      8-15           16-31
Function   Command / Data   Reserved     Pad   Multiplexer ID    Payload length

Bit            32-x
Function      Raw bytes
</pre></div>
</div>
<p>Command (1)/ Data (0) bit value is to indicate if the packet is a MAP command
or data packet. Command packet is used for transport level flow control. Data
packets are standard IP packets.</p>
<p>Reserved bits must be zero when sent and ignored when received.</p>
<p>Padding is the number of bytes to be appended to the payload to
ensure 4 byte alignment.</p>
<p>Multiplexer ID is to indicate the PDN on which data has to be sent.</p>
<p>Payload length includes the padding length but does not include MAP header
length.</p>
<ol class="loweralpha simple" start="2">
<li><p>Map packet v4 (data / control)</p></li>
</ol>
<p>MAP header fields are in big endian format.</p>
<p>Packet format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bit             0             1           2-7      8-15           16-31
Function   Command / Data   Reserved     Pad   Multiplexer ID    Payload length

Bit            32-(x-33)      (x-32)-x
Function      Raw bytes      Checksum offload header
</pre></div>
</div>
<p>Command (1)/ Data (0) bit value is to indicate if the packet is a MAP command
or data packet. Command packet is used for transport level flow control. Data
packets are standard IP packets.</p>
<p>Reserved bits must be zero when sent and ignored when received.</p>
<p>Padding is the number of bytes to be appended to the payload to
ensure 4 byte alignment.</p>
<p>Multiplexer ID is to indicate the PDN on which data has to be sent.</p>
<p>Payload length includes the padding length but does not include MAP header
length.</p>
<p>Checksum offload header, has the information about the checksum processing done
by the hardware.Checksum offload header fields are in big endian format.</p>
<p>Packet format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bit             0-14        15              16-31
Function      Reserved   Valid     Checksum start offset

Bit                31-47                    48-64
Function      Checksum length           Checksum value
</pre></div>
</div>
<p>Reserved bits must be zero when sent and ignored when received.</p>
<p>Valid bit indicates whether the partial checksum is calculated and is valid.
Set to 1, if its is valid. Set to 0 otherwise.</p>
<p>Padding is the number of bytes to be appended to the payload to
ensure 4 byte alignment.</p>
<p>Checksum start offset, Indicates the offset in bytes from the beginning of the
IP header, from which modem computed checksum.</p>
<p>Checksum length is the Length in bytes starting from CKSUM_START_OFFSET,
over which checksum is computed.</p>
<p>Checksum value, indicates the checksum computed.</p>
<ol class="loweralpha simple" start="3">
<li><p>MAP packet v5 (data / control)</p></li>
</ol>
<p>MAP header fields are in big endian format.</p>
<p>Packet format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bit             0             1         2-7      8-15           16-31
Function   Command / Data  Next header  Pad   Multiplexer ID   Payload length

Bit            32-x
Function      Raw bytes
</pre></div>
</div>
<p>Command (1)/ Data (0) bit value is to indicate if the packet is a MAP command
or data packet. Command packet is used for transport level flow control. Data
packets are standard IP packets.</p>
<p>Next header is used to indicate the presence of another header, currently is
limited to checksum header.</p>
<p>Padding is the number of bytes to be appended to the payload to
ensure 4 byte alignment.</p>
<p>Multiplexer ID is to indicate the PDN on which data has to be sent.</p>
<p>Payload length includes the padding length but does not include MAP header
length.</p>
<ol class="loweralpha simple" start="4">
<li><p>Checksum offload header v5</p></li>
</ol>
<p>Checksum offload header fields are in big endian format.</p>
<blockquote>
<div><p>Bit            0 - 6          7               8-15              16-31
Function     Header Type    Next Header     Checksum Valid    Reserved</p>
</div></blockquote>
<p>Header Type is to indicate the type of header, this usually is set to CHECKSUM</p>
<p>Header types
= ==========================================
0 Reserved
1 Reserved
2 checksum header</p>
<p>Checksum Valid is to indicate whether the header checksum is valid. Value of 1
implies that checksum is calculated on this packet and is valid, value of 0
indicates that the calculated packet checksum is invalid.</p>
<p>Reserved bits must be zero when sent and ignored when received.</p>
<ol class="loweralpha" start="5">
<li><p>MAP packet v1/v5 (command specific):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bit             0             1         2-7      8 - 15           16 - 31
Function   Command         Reserved     Pad   Multiplexer ID    Payload length
Bit          32 - 39        40 - 45    46 - 47       48 - 63
Function   Command name    Reserved   Command Type   Reserved
Bit          64 - 95
Function   Transaction ID
Bit          96 - 127
Function   Command data
</pre></div>
</div>
</li>
</ol>
<p>Command 1 indicates disabling flow while 2 is enabling flow</p>
<p>Command types</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 2%" />
<col style="width: 98%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>0</p></td>
<td><p>for MAP command request</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>is to acknowledge the receipt of a command</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>is for unsupported commands</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>is for error during processing of commands</p></td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="6">
<li><p>Aggregation</p></li>
</ol>
<p>Aggregation is multiple MAP packets (can be data or command) delivered to
rmnet in a single linear skb. rmnet will process the individual
packets and either ACK the MAP command or deliver the IP packet to the
network stack as needed</p>
<p>MAP header|IP Packet|Optional padding|MAP header|IP Packet|Optional padding….</p>
<p>MAP header|IP Packet|Optional padding|MAP header|Command Packet|Optional pad…</p>
</section>
<section id="userspace-configuration">
<h2>3. Userspace configuration<a class="headerlink" href="#userspace-configuration" title="Permalink to this headline">¶</a></h2>
<p>rmnet userspace configuration is done through netlink library librmnetctl
and command line utility rmnetcli. Utility is hosted in codeaurora forum git.
The driver uses rtnl_link_ops for communication.</p>
<p><a class="reference external" href="https://source.codeaurora.org/quic/la/platform/vendor/qcom-opensource/dataservices/tree/rmnetctl">https://source.codeaurora.org/quic/la/platform/vendor/qcom-opensource/dataservices/tree/rmnetctl</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Rmnet Driver</a><ul>
<li><a class="reference internal" href="#introduction">1. Introduction</a></li>
<li><a class="reference internal" href="#packet-format">2. Packet format</a></li>
<li><a class="reference internal" href="#userspace-configuration">3. Userspace configuration</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/networking/device_drivers/cellular/qualcomm/rmnet.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../../_sources/networking/device_drivers/cellular/qualcomm/rmnet.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>