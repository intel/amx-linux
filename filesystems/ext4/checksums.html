
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Checksums &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="checksums">
<h1>Checksums<a class="headerlink" href="#checksums" title="Permalink to this headline">Â¶</a></h1>
<p>Starting in early 2012, metadata checksums were added to all major ext4
and jbd2 data structures. The associated feature flag is metadata_csum.
The desired checksum algorithm is indicated in the superblock, though as
of October 2012 the only supported algorithm is crc32c. Some data
structures did not have space to fit a full 32-bit checksum, so only the
lower 16 bits are stored. Enabling the 64bit feature increases the data
structure size so that full 32-bit checksums can be stored for many data
structures. However, existing 32-bit filesystems cannot be extended to
enable 64bit mode, at least not without the experimental resize2fs
patches to do so.</p>
<p>Existing filesystems can have checksumming added by running
<code class="docutils literal notranslate"><span class="pre">tune2fs</span> <span class="pre">-O</span> <span class="pre">metadata_csum</span></code> against the underlying device. If tune2fs
encounters directory blocks that lack sufficient empty space to add a
checksum, it will request that you run <code class="docutils literal notranslate"><span class="pre">e2fsck</span> <span class="pre">-D</span></code> to have the
directories rebuilt with checksums. This has the added benefit of
removing slack space from the directory files and rebalancing the htree
indexes. If you _ignore_ this step, your directories will not be
protected by a checksum!</p>
<p>The following table describes the data elements that go into each type
of checksum. The checksum function is whatever the superblock describes
(crc32c as of October 2013) unless noted otherwise.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 10%" />
<col style="width: 64%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Metadata</p></th>
<th class="head"><p>Length</p></th>
<th class="head"><p>Ingredients</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Superblock</p></td>
<td><p>__le32</p></td>
<td><p>The entire superblock up to the checksum field. The UUID lives inside
the superblock.</p></td>
</tr>
<tr class="row-odd"><td><p>MMP</p></td>
<td><p>__le32</p></td>
<td><p>UUID + the entire MMP block up to the checksum field.</p></td>
</tr>
<tr class="row-even"><td><p>Extended Attributes</p></td>
<td><p>__le32</p></td>
<td><p>UUID + the entire extended attribute block. The checksum field is set to
zero.</p></td>
</tr>
<tr class="row-odd"><td><p>Directory Entries</p></td>
<td><p>__le32</p></td>
<td><p>UUID + inode number + inode generation + the directory block up to the
fake entry enclosing the checksum field.</p></td>
</tr>
<tr class="row-even"><td><p>HTREE Nodes</p></td>
<td><p>__le32</p></td>
<td><p>UUID + inode number + inode generation + all valid extents + HTREE tail.
The checksum field is set to zero.</p></td>
</tr>
<tr class="row-odd"><td><p>Extents</p></td>
<td><p>__le32</p></td>
<td><p>UUID + inode number + inode generation + the entire extent block up to
the checksum field.</p></td>
</tr>
<tr class="row-even"><td><p>Bitmaps</p></td>
<td><p>__le32 or __le16</p></td>
<td><p>UUID + the entire bitmap. Checksums are stored in the group descriptor,
and truncated if the group descriptor size is 32 bytes (i.e. ^64bit)</p></td>
</tr>
<tr class="row-odd"><td><p>Inodes</p></td>
<td><p>__le32</p></td>
<td><p>UUID + inode number + inode generation + the entire inode. The checksum
field is set to zero. Each inode has its own checksum.</p></td>
</tr>
<tr class="row-even"><td><p>Group Descriptors</p></td>
<td><p>__le16</p></td>
<td><p>If metadata_csum, then UUID + group number + the entire descriptor;
else if gdt_csum, then crc16(UUID + group number + the entire
descriptor). In all cases, only the lower 16 bits are stored.</p></td>
</tr>
</tbody>
</table>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/filesystems/ext4/checksums.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/filesystems/ext4/checksums.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>