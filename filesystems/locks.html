
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>File Locking Release Notes &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Filesystem Mount API" href="mount_api.html" />
    <link rel="prev" title="File management in the Linux kernel" href="files.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="file-locking-release-notes">
<h1>File Locking Release Notes<a class="headerlink" href="#file-locking-release-notes" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Andy Walker &lt;<a class="reference external" href="mailto:andy&#37;&#52;&#48;lysaker&#46;kvaerner&#46;no">andy<span>&#64;</span>lysaker<span>&#46;</span>kvaerner<span>&#46;</span>no</a>&gt;</p>
<blockquote>
<div><p>12 May 1997</p>
</div></blockquote>
</div></blockquote>
<section id="what-s-new">
<h2>1. What’s New?<a class="headerlink" href="#what-s-new" title="Permalink to this headline">¶</a></h2>
<section id="broken-flock-emulation">
<h3>1.1 Broken Flock Emulation<a class="headerlink" href="#broken-flock-emulation" title="Permalink to this headline">¶</a></h3>
<p>The old flock(2) emulation in the kernel was swapped for proper BSD
compatible flock(2) support in the 1.3.x series of kernels. With the
release of the 2.1.x kernel series, support for the old emulation has
been totally removed, so that we don’t need to carry this baggage
forever.</p>
<p>This should not cause problems for anybody, since everybody using a
2.1.x kernel should have updated their C library to a suitable version
anyway (see the file “<a class="reference internal" href="../process/changes.html"><span class="doc">Minimal requirements to compile the Kernel</span></a>”.)</p>
</section>
<section id="allow-mixed-locks-again">
<h3>1.2 Allow Mixed Locks Again<a class="headerlink" href="#allow-mixed-locks-again" title="Permalink to this headline">¶</a></h3>
<section id="typical-problems-sendmail">
<h4>1.2.1 Typical Problems - Sendmail<a class="headerlink" href="#typical-problems-sendmail" title="Permalink to this headline">¶</a></h4>
<p>Because sendmail was unable to use the old flock() emulation, many sendmail
installations use fcntl() instead of flock(). This is true of Slackware 3.0
for example. This gave rise to some other subtle problems if sendmail was
configured to rebuild the alias file. Sendmail tried to lock the aliases.dir
file with fcntl() at the same time as the GDBM routines tried to lock this
file with flock(). With pre 1.3.96 kernels this could result in deadlocks that,
over time, or under a very heavy mail load, would eventually cause the kernel
to lock solid with deadlocked processes.</p>
</section>
<section id="the-solution">
<h4>1.2.2 The Solution<a class="headerlink" href="#the-solution" title="Permalink to this headline">¶</a></h4>
<p>The solution I have chosen, after much experimentation and discussion,
is to make flock() and fcntl() locks oblivious to each other. Both can
exists, and neither will have any effect on the other.</p>
<p>I wanted the two lock styles to be cooperative, but there were so many
race and deadlock conditions that the current solution was the only
practical one. It puts us in the same position as, for example, SunOS
4.1.x and several other commercial Unices. The only OS’s that support
cooperative flock()/fcntl() are those that emulate flock() using
fcntl(), with all the problems that implies.</p>
</section>
</section>
<section id="mandatory-locking-as-a-mount-option">
<h3>1.3 Mandatory Locking As A Mount Option<a class="headerlink" href="#mandatory-locking-as-a-mount-option" title="Permalink to this headline">¶</a></h3>
<p>Mandatory locking was prior to this release a general configuration option
that was valid for all mounted filesystems.  This had a number of inherent
dangers, not the least of which was the ability to freeze an NFS server by
asking it to read a file for which a mandatory lock existed.</p>
<p>Such option was dropped in Kernel v5.14.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">File Locking Release Notes</a><ul>
<li><a class="reference internal" href="#what-s-new">1. What’s New?</a><ul>
<li><a class="reference internal" href="#broken-flock-emulation">1.1 Broken Flock Emulation</a></li>
<li><a class="reference internal" href="#allow-mixed-locks-again">1.2 Allow Mixed Locks Again</a><ul>
<li><a class="reference internal" href="#typical-problems-sendmail">1.2.1 Typical Problems - Sendmail</a></li>
<li><a class="reference internal" href="#the-solution">1.2.2 The Solution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mandatory-locking-as-a-mount-option">1.3 Mandatory Locking As A Mount Option</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/filesystems/locks.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/filesystems/locks.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>