
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>BPF maps &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="BPF_MAP_TYPE_ARRAY and BPF_MAP_TYPE_PERCPU_ARRAY" href="map_array.html" />
    <link rel="prev" title="BPF sk_lookup program" href="prog_sk_lookup.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="bpf-maps">
<h1>BPF maps<a class="headerlink" href="#bpf-maps" title="Permalink to this headline">¶</a></h1>
<p>BPF ‘maps’ provide generic storage of different types for sharing data between
kernel and user space. There are several storage types available, including
hash, array, bloom filter and radix-tree. Several of the map types exist to
support specific BPF helpers that perform actions based on the map contents. The
maps are accessed from BPF programs via BPF helpers which are documented in the
<a class="reference external" href="https://www.kernel.org/doc/man-pages/">man-pages</a> for <a class="reference external" href="https://man7.org/linux/man-pages/man7/bpf-helpers.7.html">bpf-helpers(7)</a>.</p>
<p>BPF maps are accessed from user space via the <code class="docutils literal notranslate"><span class="pre">bpf</span></code> syscall, which provides
commands to create maps, lookup elements, update elements and delete
elements. More details of the BPF syscall are available in
<a class="reference internal" href="../userspace-api/ebpf/syscall.html"><span class="doc">eBPF Syscall</span></a> and in the <a class="reference external" href="https://www.kernel.org/doc/man-pages/">man-pages</a> for <a class="reference external" href="https://man7.org/linux/man-pages/man2/bpf.2.html">bpf(2)</a>.</p>
<section id="map-types">
<h2>Map Types<a class="headerlink" href="#map-types" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="map_array.html">BPF_MAP_TYPE_ARRAY and BPF_MAP_TYPE_PERCPU_ARRAY</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_bloom_filter.html">BPF_MAP_TYPE_BLOOM_FILTER</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_cgroup_storage.html">BPF_MAP_TYPE_CGROUP_STORAGE</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_cgrp_storage.html">BPF_MAP_TYPE_CGRP_STORAGE</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_cpumap.html">BPF_MAP_TYPE_CPUMAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_devmap.html">BPF_MAP_TYPE_DEVMAP and BPF_MAP_TYPE_DEVMAP_HASH</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_hash.html">BPF_MAP_TYPE_HASH, with PERCPU and LRU Variants</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_lpm_trie.html">BPF_MAP_TYPE_LPM_TRIE</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_of_maps.html">BPF_MAP_TYPE_ARRAY_OF_MAPS and BPF_MAP_TYPE_HASH_OF_MAPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_queue_stack.html">BPF_MAP_TYPE_QUEUE and BPF_MAP_TYPE_STACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_sk_storage.html">BPF_MAP_TYPE_SK_STORAGE</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_xskmap.html">BPF_MAP_TYPE_XSKMAP</a></li>
</ul>
</div>
</section>
<section id="usage-notes">
<h2>Usage Notes<a class="headerlink" href="#usage-notes" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.bpf">
int <code class="sig-name descname">bpf</code><span class="sig-paren">(</span>int<em> command</em>, union bpf_attr<em> *attr</em>, u32<em> size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.bpf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Use the <code class="docutils literal notranslate"><span class="pre">bpf()</span></code> system call to perform the operation specified by
<code class="docutils literal notranslate"><span class="pre">command</span></code>. The operation takes parameters provided in <code class="docutils literal notranslate"><span class="pre">attr</span></code>. The <code class="docutils literal notranslate"><span class="pre">size</span></code>
argument is the size of the <code class="docutils literal notranslate"><span class="pre">union</span> <span class="pre">bpf_attr</span></code> in <code class="docutils literal notranslate"><span class="pre">attr</span></code>.</p>
<p><strong>BPF_MAP_CREATE</strong></p>
<p>Create a map with the desired type and attributes in <code class="docutils literal notranslate"><span class="pre">attr</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">;</span><span class="w"></span>
<span class="k">union</span> <span class="nc">bpf_attr</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BPF_MAP_TYPE_ARRAY</span><span class="p">;</span><span class="w">  </span><span class="cm">/* mandatory */</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">key_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">__u32</span><span class="p">);</span><span class="w">       </span><span class="cm">/* mandatory */</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">value_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">__u32</span><span class="p">);</span><span class="w">     </span><span class="cm">/* mandatory */</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">max_entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span><span class="w">              </span><span class="cm">/* mandatory */</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BPF_F_MMAPABLE</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">.</span><span class="n">map_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;example_array&quot;</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bpf</span><span class="p">(</span><span class="n">BPF_MAP_CREATE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">attr</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>Returns a process-local file descriptor on success, or negative error in case of
failure. The map can be deleted by calling <code class="docutils literal notranslate"><span class="pre">close(fd)</span></code>. Maps held by open
file descriptors will be deleted automatically when a process exits.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Valid characters for <code class="docutils literal notranslate"><span class="pre">map_name</span></code> are <code class="docutils literal notranslate"><span class="pre">A-Z</span></code>, <code class="docutils literal notranslate"><span class="pre">a-z</span></code>, <code class="docutils literal notranslate"><span class="pre">0-9</span></code>,
<code class="docutils literal notranslate"><span class="pre">'_'</span></code> and <code class="docutils literal notranslate"><span class="pre">'.'</span></code>.</p>
</div>
<p><strong>BPF_MAP_LOOKUP_ELEM</strong></p>
<p>Lookup key in a given map using <code class="docutils literal notranslate"><span class="pre">attr-&gt;map_fd</span></code>, <code class="docutils literal notranslate"><span class="pre">attr-&gt;key</span></code>,
<code class="docutils literal notranslate"><span class="pre">attr-&gt;value</span></code>. Returns zero and stores found elem into <code class="docutils literal notranslate"><span class="pre">attr-&gt;value</span></code> on
success, or negative error on failure.</p>
<p><strong>BPF_MAP_UPDATE_ELEM</strong></p>
<p>Create or update key/value pair in a given map using <code class="docutils literal notranslate"><span class="pre">attr-&gt;map_fd</span></code>, <code class="docutils literal notranslate"><span class="pre">attr-&gt;key</span></code>,
<code class="docutils literal notranslate"><span class="pre">attr-&gt;value</span></code>. Returns zero on success or negative error on failure.</p>
<p><strong>BPF_MAP_DELETE_ELEM</strong></p>
<p>Find and delete element by key in a given map using <code class="docutils literal notranslate"><span class="pre">attr-&gt;map_fd</span></code>,
<code class="docutils literal notranslate"><span class="pre">attr-&gt;key</span></code>. Returns zero on success or negative error on failure.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">BPF maps</a><ul>
<li><a class="reference internal" href="#map-types">Map Types</a></li>
<li><a class="reference internal" href="#usage-notes">Usage Notes</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/bpf/maps.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/bpf/maps.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>