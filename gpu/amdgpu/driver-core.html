
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Core Driver Infrastructure &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="drm/amd/display - Display Core (DC)" href="display/index.html" />
    <link rel="prev" title="Module Parameters" href="module-parameters.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="core-driver-infrastructure">
<h1>Core Driver Infrastructure<a class="headerlink" href="#core-driver-infrastructure" title="Permalink to this headline">¶</a></h1>
<section id="gpu-hardware-structure">
<h2>GPU Hardware Structure<a class="headerlink" href="#gpu-hardware-structure" title="Permalink to this headline">¶</a></h2>
<p>Each ASIC is a collection of hardware blocks.  We refer to them as
“IPs” (Intellectual Property blocks).  Each IP encapsulates certain
functionality. IPs are versioned and can also be mixed and matched.
E.g., you might have two different ASICs that both have System DMA (SDMA) 5.x IPs.
The driver is arranged by IPs.  There are driver components to handle
the initialization and operation of each IP.  There are also a bunch
of smaller IPs that don’t really need much if any driver interaction.
Those end up getting lumped into the common stuff in the soc files.
The soc files (e.g., vi.c, soc15.c nv.c) contain code for aspects of
the SoC itself rather than specific IPs.  E.g., things like GPU resets
and register access functions are SoC dependent.</p>
<p>An APU contains more than just CPU and GPU, it also contains all of
the platform stuff (audio, usb, gpio, etc.).  Also, a lot of
components are shared between the CPU, platform, and the GPU (e.g.,
SMU, PSP, etc.).  Specific components (CPU, GPU, etc.) usually have
their interface to interact with those common components.  For things
like S0i3 there is a ton of coordination required across all the
components, but that is probably a bit beyond the scope of this
section.</p>
<p>With respect to the GPU, we have the following major IPs:</p>
<dl class="simple">
<dt>GMC (Graphics Memory Controller)</dt><dd><p>This was a dedicated IP on older pre-vega chips, but has since
become somewhat decentralized on vega and newer chips.  They now
have dedicated memory hubs for specific IPs or groups of IPs.  We
still treat it as a single component in the driver however since
the programming model is still pretty similar.  This is how the
different IPs on the GPU get the memory (VRAM or system memory).
It also provides the support for per process GPU virtual address
spaces.</p>
</dd>
<dt>IH (Interrupt Handler)</dt><dd><p>This is the interrupt controller on the GPU.  All of the IPs feed
their interrupts into this IP and it aggregates them into a set of
ring buffers that the driver can parse to handle interrupts from
different IPs.</p>
</dd>
<dt>PSP (Platform Security Processor)</dt><dd><p>This handles security policy for the SoC and executes trusted
applications, and validates and loads firmwares for other blocks.</p>
</dd>
<dt>SMU (System Management Unit)</dt><dd><p>This is the power management microcontroller.  It manages the entire
SoC.  The driver interacts with it to control power management
features like clocks, voltages, power rails, etc.</p>
</dd>
<dt>DCN (Display Controller Next)</dt><dd><p>This is the display controller.  It handles the display hardware.
It is described in more details in <a class="reference internal" href="display/index.html#amdgpu-display-core"><span class="std std-ref">Display Core</span></a>.</p>
</dd>
<dt>SDMA (System DMA)</dt><dd><p>This is a multi-purpose DMA engine.  The kernel driver uses it for
various things including paging and GPU page table updates.  It’s also
exposed to userspace for use by user mode drivers (OpenGL, Vulkan,
etc.)</p>
</dd>
<dt>GC (Graphics and Compute)</dt><dd><p>This is the graphics and compute engine, i.e., the block that
encompasses the 3D pipeline and and shader blocks.  This is by far the
largest block on the GPU.  The 3D pipeline has tons of sub-blocks.  In
addition to that, it also contains the CP microcontrollers (ME, PFP,
CE, MEC) and the RLC microcontroller.  It’s exposed to userspace for
user mode drivers (OpenGL, Vulkan, OpenCL, etc.)</p>
</dd>
<dt>VCN (Video Core Next)</dt><dd><p>This is the multi-media engine.  It handles video and image encode and
decode.  It’s exposed to userspace for user mode drivers (VA-API,
OpenMAX, etc.)</p>
</dd>
</dl>
<section id="graphics-and-compute-microcontrollers">
<h3>Graphics and Compute Microcontrollers<a class="headerlink" href="#graphics-and-compute-microcontrollers" title="Permalink to this headline">¶</a></h3>
<dl>
<dt>CP (Command Processor)</dt><dd><p>The name for the hardware block that encompasses the front end of the
GFX/Compute pipeline.  Consists mainly of a bunch of microcontrollers
(PFP, ME, CE, MEC).  The firmware that runs on these microcontrollers
provides the driver interface to interact with the GFX/Compute engine.</p>
<dl class="simple">
<dt>MEC (MicroEngine Compute)</dt><dd><p>This is the microcontroller that controls the compute queues on the
GFX/compute engine.</p>
</dd>
<dt>MES (MicroEngine Scheduler)</dt><dd><p>This is a new engine for managing queues.  This is currently unused.</p>
</dd>
</dl>
</dd>
<dt>RLC (RunList Controller)</dt><dd><p>This is another microcontroller in the GFX/Compute engine.  It handles
power management related functionality within the GFX/Compute engine.
The name is a vestige of old hardware where it was originally added
and doesn’t really have much relation to what the engine does now.</p>
</dd>
</dl>
</section>
</section>
<section id="driver-structure">
<h2>Driver Structure<a class="headerlink" href="#driver-structure" title="Permalink to this headline">¶</a></h2>
<p>In general, the driver has a list of all of the IPs on a particular
SoC and for things like init/fini/suspend/resume, more or less just
walks the list and handles each IP.</p>
<p>Some useful constructs:</p>
<dl class="simple">
<dt>KIQ (Kernel Interface Queue)</dt><dd><p>This is a control queue used by the kernel driver to manage other gfx
and compute queues on the GFX/compute engine.  You can use it to
map/unmap additional queues, etc.</p>
</dd>
<dt>IB (Indirect Buffer)</dt><dd><p>A command buffer for a particular engine.  Rather than writing
commands directly to the queue, you can write the commands into a
piece of memory and then put a pointer to the memory into the queue.
The hardware will then follow the pointer and execute the commands in
the memory, then returning to the rest of the commands in the ring.</p>
</dd>
</dl>
</section>
<section id="memory-domains">
<span id="amdgpu-memory-domains"></span><h2>Memory Domains<a class="headerlink" href="#memory-domains" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">AMDGPU_GEM_DOMAIN_CPU</span></code>       System memory that is not GPU accessible.
Memory in this pool could be swapped out to disk if there is pressure.</p>
<p><code class="docutils literal notranslate"><span class="pre">AMDGPU_GEM_DOMAIN_GTT</span></code>       GPU accessible system memory, mapped into the
GPU’s virtual address space via gart. Gart memory linearizes non-contiguous
pages of system memory, allows GPU access system memory in a linearized
fashion.</p>
<p><code class="docutils literal notranslate"><span class="pre">AMDGPU_GEM_DOMAIN_VRAM</span></code>      Local video memory. For APUs, it is memory
carved out by the BIOS.</p>
<p><code class="docutils literal notranslate"><span class="pre">AMDGPU_GEM_DOMAIN_GDS</span></code>       Global on-chip data storage used to share data
across shader threads.</p>
<p><code class="docutils literal notranslate"><span class="pre">AMDGPU_GEM_DOMAIN_GWS</span></code>       Global wave sync, used to synchronize the
execution of all the waves on a device.</p>
<p><code class="docutils literal notranslate"><span class="pre">AMDGPU_GEM_DOMAIN_OA</span></code>        Ordered append, used by 3D or Compute engines
for appending data.</p>
</section>
<section id="buffer-objects">
<h2>Buffer Objects<a class="headerlink" href="#buffer-objects" title="Permalink to this headline">¶</a></h2>
<p>This defines the interfaces to operate on an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object which
represents memory used by driver (VRAM, system memory, etc.). The driver
provides DRM/GEM APIs to userspace. DRM/GEM APIs then use these interfaces
to create/destroy/set buffer object which are then managed by the kernel TTM
memory manager.
The interfaces are also used internally by kernel clients, including gfx,
uvd, etc. for kernel managed allocations used by the GPU.</p>
<dl class="function">
<dt id="c.amdgpu_bo_is_amdgpu_bo">
bool <code class="sig-name descname">amdgpu_bo_is_amdgpu_bo</code><span class="sig-paren">(</span>struct ttm_buffer_object<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_is_amdgpu_bo" title="Permalink to this definition">¶</a></dt>
<dd><p>check if the buffer object is an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code></p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ttm_buffer_object</span> <span class="pre">*bo</span></code></dt><dd><p>buffer object to be checked</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Uses destroy function associated with the object to determine if this is
an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code>.</p>
<p><strong>Return</strong></p>
<p>true if the object belongs to <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code>, false if not.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_placement_from_domain">
void <code class="sig-name descname">amdgpu_bo_placement_from_domain</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *abo</em>, u32<em> domain</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_placement_from_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>set buffer’s placement</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*abo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object whose placement is to be set</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">domain</span></code></dt><dd><p>requested domain</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Sets buffer’s placement according to requested domain and the buffer’s
flags.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_create_reserved">
int <code class="sig-name descname">amdgpu_bo_create_reserved</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, unsigned long<em> size</em>, int<em> align</em>, u32<em> domain</em>, struct amdgpu_bo<em> **bo_ptr</em>, u64<em> *gpu_addr</em>, void<em> **cpu_addr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_create_reserved" title="Permalink to this definition">¶</a></dt>
<dd><p>create reserved BO for kernel use</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">size</span></code></dt><dd><p>size for the new BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">align</span></code></dt><dd><p>alignment for the new BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">domain</span></code></dt><dd><p>where to place it</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">**bo_ptr</span></code></dt><dd><p>used to initialize BOs in structures</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">*gpu_addr</span></code></dt><dd><p>GPU addr of the pinned BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**cpu_addr</span></code></dt><dd><p>optional CPU address mapping</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allocates and pins a BO for kernel internal use, and returns it still
reserved.</p>
<p><strong>Note</strong></p>
<p>For bo_ptr new BO is only created if bo_ptr points to NULL.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code otherwise.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_create_kernel">
int <code class="sig-name descname">amdgpu_bo_create_kernel</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, unsigned long<em> size</em>, int<em> align</em>, u32<em> domain</em>, struct amdgpu_bo<em> **bo_ptr</em>, u64<em> *gpu_addr</em>, void<em> **cpu_addr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_create_kernel" title="Permalink to this definition">¶</a></dt>
<dd><p>create BO for kernel use</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">size</span></code></dt><dd><p>size for the new BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">align</span></code></dt><dd><p>alignment for the new BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">domain</span></code></dt><dd><p>where to place it</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">**bo_ptr</span></code></dt><dd><p>used to initialize BOs in structures</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">*gpu_addr</span></code></dt><dd><p>GPU addr of the pinned BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**cpu_addr</span></code></dt><dd><p>optional CPU address mapping</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allocates and pins a BO for kernel internal use.</p>
<p><strong>Note</strong></p>
<p>For bo_ptr new BO is only created if bo_ptr points to NULL.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code otherwise.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_create_kernel_at">
int <code class="sig-name descname">amdgpu_bo_create_kernel_at</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, uint64_t<em> offset</em>, uint64_t<em> size</em>, struct amdgpu_bo<em> **bo_ptr</em>, void<em> **cpu_addr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_create_kernel_at" title="Permalink to this definition">¶</a></dt>
<dd><p>create BO for kernel use at specific location</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">offset</span></code></dt><dd><p>offset of the BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">size</span></code></dt><dd><p>size of the BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">**bo_ptr</span></code></dt><dd><p>used to initialize BOs in structures</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**cpu_addr</span></code></dt><dd><p>optional CPU address mapping</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates a kernel BO at a specific offset in VRAM.</p>
<p><strong>Return</strong></p>
<p>0 on success, negative error code otherwise.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_free_kernel">
void <code class="sig-name descname">amdgpu_bo_free_kernel</code><span class="sig-paren">(</span>struct amdgpu_bo<em> **bo</em>, u64<em> *gpu_addr</em>, void<em> **cpu_addr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_free_kernel" title="Permalink to this definition">¶</a></dt>
<dd><p>free BO for kernel use</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">**bo</span></code></dt><dd><p>amdgpu BO to free</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">*gpu_addr</span></code></dt><dd><p>pointer to where the BO’s GPU memory space address was stored</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**cpu_addr</span></code></dt><dd><p>pointer to where the BO’s CPU memory space address was stored</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>unmaps and unpin a BO for kernel internal use.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_create">
int <code class="sig-name descname">amdgpu_bo_create</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_param<em> *bp</em>, struct amdgpu_bo<em> **bo_ptr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_create" title="Permalink to this definition">¶</a></dt>
<dd><p>create an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_param</span> <span class="pre">*bp</span></code></dt><dd><p>parameters to be used for the buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">**bo_ptr</span></code></dt><dd><p>pointer to the buffer object pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_create_user">
int <code class="sig-name descname">amdgpu_bo_create_user</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_param<em> *bp</em>, struct amdgpu_bo_user<em> **ubo_ptr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_create_user" title="Permalink to this definition">¶</a></dt>
<dd><p>create an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo_user</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_param</span> <span class="pre">*bp</span></code></dt><dd><p>parameters to be used for the buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_user</span> <span class="pre">**ubo_ptr</span></code></dt><dd><p>pointer to the buffer object pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Create a BO to be used by user application;</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_create_vm">
int <code class="sig-name descname">amdgpu_bo_create_vm</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_param<em> *bp</em>, struct amdgpu_bo_vm<em> **vmbo_ptr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_create_vm" title="Permalink to this definition">¶</a></dt>
<dd><p>create an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo_vm</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_param</span> <span class="pre">*bp</span></code></dt><dd><p>parameters to be used for the buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_vm</span> <span class="pre">**vmbo_ptr</span></code></dt><dd><p>pointer to the buffer object pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Create a BO to be for GPUVM.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_add_to_shadow_list">
void <code class="sig-name descname">amdgpu_bo_add_to_shadow_list</code><span class="sig-paren">(</span>struct amdgpu_bo_vm<em> *vmbo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_add_to_shadow_list" title="Permalink to this definition">¶</a></dt>
<dd><p>add a BO to the shadow list</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_vm</span> <span class="pre">*vmbo</span></code></dt><dd><p>BO that will be inserted into the shadow list</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Insert a BO to the shadow list.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_restore_shadow">
int <code class="sig-name descname">amdgpu_bo_restore_shadow</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *shadow</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence" title="dma_fence">dma_fence</a><em> **fence</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_restore_shadow" title="Permalink to this definition">¶</a></dt>
<dd><p>restore an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> shadow</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*shadow</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> shadow to be restored</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence</span> <span class="pre">**fence</span></code></dt><dd><p>dma_fence associated with the operation</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Copies a buffer object’s shadow content back to the object.
This is used for recovering a buffer from its shadow in case of a gpu
reset where vram context may be lost.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_kmap">
int <code class="sig-name descname">amdgpu_bo_kmap</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, void<em> **ptr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_kmap" title="Permalink to this definition">¶</a></dt>
<dd><p>map an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object to be mapped</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**ptr</span></code></dt><dd><p>kernel virtual address to be returned</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Calls ttm_bo_kmap() to set up the kernel virtual mapping; calls
<a class="reference internal" href="#c.amdgpu_bo_kptr" title="amdgpu_bo_kptr"><code class="xref c c-func docutils literal notranslate"><span class="pre">amdgpu_bo_kptr()</span></code></a> to get the kernel virtual address.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_kptr">
void * <code class="sig-name descname">amdgpu_bo_kptr</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_kptr" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a kernel virtual address of the buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Calls ttm_kmap_obj_virtual() to get the kernel virtual address</p>
<p><strong>Return</strong></p>
<p>the virtual address of a buffer object area.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_kunmap">
void <code class="sig-name descname">amdgpu_bo_kunmap</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_kunmap" title="Permalink to this definition">¶</a></dt>
<dd><p>unmap an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object to be unmapped</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Unmaps a kernel map set up by <a class="reference internal" href="#c.amdgpu_bo_kmap" title="amdgpu_bo_kmap"><code class="xref c c-func docutils literal notranslate"><span class="pre">amdgpu_bo_kmap()</span></code></a>.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_ref">
struct amdgpu_bo * <code class="sig-name descname">amdgpu_bo_ref</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_ref" title="Permalink to this definition">¶</a></dt>
<dd><p>reference an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>References the contained <code class="xref c c-type docutils literal notranslate"><span class="pre">ttm_buffer_object</span></code>.</p>
<p><strong>Return</strong></p>
<p>a refcounted pointer to the <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_unref">
void <code class="sig-name descname">amdgpu_bo_unref</code><span class="sig-paren">(</span>struct amdgpu_bo<em> **bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_unref" title="Permalink to this definition">¶</a></dt>
<dd><p>unreference an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">**bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Unreferences the contained <code class="xref c c-type docutils literal notranslate"><span class="pre">ttm_buffer_object</span></code> and clear the pointer</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_pin_restricted">
int <code class="sig-name descname">amdgpu_bo_pin_restricted</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, u32<em> domain</em>, u64<em> min_offset</em>, u64<em> max_offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_pin_restricted" title="Permalink to this definition">¶</a></dt>
<dd><p>pin an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object to be pinned</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">domain</span></code></dt><dd><p>domain to be pinned to</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">min_offset</span></code></dt><dd><p>the start of requested address range</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">max_offset</span></code></dt><dd><p>the end of requested address range</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Pins the buffer object according to requested domain and address range. If
the memory is unbound gart memory, binds the pages into gart table. Adjusts
pin_count and pin_size accordingly.</p>
<p>Pinning means to lock pages in memory along with keeping them at a fixed
offset. It is required when a buffer can not be moved, for example, when
a display buffer is being scanned out.</p>
<p>Compared with <a class="reference internal" href="#c.amdgpu_bo_pin" title="amdgpu_bo_pin"><code class="xref c c-func docutils literal notranslate"><span class="pre">amdgpu_bo_pin()</span></code></a>, this function gives more flexibility on
where to pin a buffer if there are specific restrictions on where a buffer
must be located.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_pin">
int <code class="sig-name descname">amdgpu_bo_pin</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, u32<em> domain</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_pin" title="Permalink to this definition">¶</a></dt>
<dd><p>pin an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object to be pinned</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">domain</span></code></dt><dd><p>domain to be pinned to</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>A simple wrapper to <a class="reference internal" href="#c.amdgpu_bo_pin_restricted" title="amdgpu_bo_pin_restricted"><code class="xref c c-func docutils literal notranslate"><span class="pre">amdgpu_bo_pin_restricted()</span></code></a>.
Provides a simpler API for buffers that do not have any strict restrictions
on where a buffer must be located.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_unpin">
void <code class="sig-name descname">amdgpu_bo_unpin</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_unpin" title="Permalink to this definition">¶</a></dt>
<dd><p>unpin an <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object to be unpinned</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Decreases the pin_count, and clears the flags if pin_count reaches 0.
Changes placement and pin size accordingly.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_init">
int <code class="sig-name descname">amdgpu_bo_init</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_init" title="Permalink to this definition">¶</a></dt>
<dd><p>initialize memory manager</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Calls amdgpu_ttm_init() to initialize amdgpu memory manager.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_fini">
void <code class="sig-name descname">amdgpu_bo_fini</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_fini" title="Permalink to this definition">¶</a></dt>
<dd><p>tear down memory manager</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Reverses <a class="reference internal" href="#c.amdgpu_bo_init" title="amdgpu_bo_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">amdgpu_bo_init()</span></code></a> to tear down memory manager.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_set_tiling_flags">
int <code class="sig-name descname">amdgpu_bo_set_tiling_flags</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, u64<em> tiling_flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_set_tiling_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>set tiling flags</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">tiling_flags</span></code></dt><dd><p>new flags</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Sets buffer object’s tiling flags with the new one. Used by GEM ioctl or
kernel driver to set the tiling flags on a buffer.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_get_tiling_flags">
void <code class="sig-name descname">amdgpu_bo_get_tiling_flags</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, u64<em> *tiling_flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_get_tiling_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>get tiling flags</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u64</span> <span class="pre">*tiling_flags</span></code></dt><dd><p>returned flags</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Gets buffer object’s tiling flags. Used by GEM ioctl or kernel driver to
set the tiling flags on a buffer.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_set_metadata">
int <code class="sig-name descname">amdgpu_bo_set_metadata</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, void<em> *metadata</em>, uint32_t<em> metadata_size</em>, uint64_t<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_set_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>set metadata</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*metadata</span></code></dt><dd><p>new metadata</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">metadata_size</span></code></dt><dd><p>size of the new metadata</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">flags</span></code></dt><dd><p>flags of the new metadata</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Sets buffer object’s metadata, its size and flags.
Used via GEM ioctl.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_get_metadata">
int <code class="sig-name descname">amdgpu_bo_get_metadata</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, void<em> *buffer</em>, size_t<em> buffer_size</em>, uint32_t<em> *metadata_size</em>, uint64_t<em> *flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_get_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>get metadata</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*buffer</span></code></dt><dd><p>returned metadata</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">buffer_size</span></code></dt><dd><p>size of the buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">*metadata_size</span></code></dt><dd><p>size of the returned metadata</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">*flags</span></code></dt><dd><p>flags of the returned metadata</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Gets buffer object’s metadata, its size and flags. buffer_size shall not be
less than metadata_size.
Used via GEM ioctl.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_move_notify">
void <code class="sig-name descname">amdgpu_bo_move_notify</code><span class="sig-paren">(</span>struct ttm_buffer_object<em> *bo</em>, bool<em> evict</em>, struct <a class="reference internal" href="../drm-mm.html#c.ttm_resource" title="ttm_resource">ttm_resource</a><em> *new_mem</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_move_notify" title="Permalink to this definition">¶</a></dt>
<dd><p>notification about a memory move</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ttm_buffer_object</span> <span class="pre">*bo</span></code></dt><dd><p>pointer to a buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">evict</span></code></dt><dd><p>if this move is evicting the buffer from the graphics address space</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ttm_resource</span> <span class="pre">*new_mem</span></code></dt><dd><p>new information of the bufer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Marks the corresponding <code class="xref c c-type docutils literal notranslate"><span class="pre">amdgpu_bo</span></code> buffer object as invalid, also performs
bookkeeping.
TTM driver callback which is called when ttm moves a buffer.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_release_notify">
void <code class="sig-name descname">amdgpu_bo_release_notify</code><span class="sig-paren">(</span>struct ttm_buffer_object<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_release_notify" title="Permalink to this definition">¶</a></dt>
<dd><p>notification about a BO being released</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ttm_buffer_object</span> <span class="pre">*bo</span></code></dt><dd><p>pointer to a buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Wipes VRAM buffers whose contents should not be leaked before the
memory is released.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_fault_reserve_notify">
<a class="reference internal" href="../../core-api/mm-api.html#c.vm_fault_t" title="vm_fault_t">vm_fault_t</a> <code class="sig-name descname">amdgpu_bo_fault_reserve_notify</code><span class="sig-paren">(</span>struct ttm_buffer_object<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_fault_reserve_notify" title="Permalink to this definition">¶</a></dt>
<dd><p>notification about a memory fault</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ttm_buffer_object</span> <span class="pre">*bo</span></code></dt><dd><p>pointer to a buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Notifies the driver we are taking a fault on this BO and have reserved it,
also performs bookkeeping.
TTM driver callback for dealing with vm faults.</p>
<p><strong>Return</strong></p>
<p>0 for success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_fence">
void <code class="sig-name descname">amdgpu_bo_fence</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence" title="dma_fence">dma_fence</a><em> *fence</em>, bool<em> shared</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_fence" title="Permalink to this definition">¶</a></dt>
<dd><p>add fence to buffer object</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>buffer object in question</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence</span> <span class="pre">*fence</span></code></dt><dd><p>fence to add</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">shared</span></code></dt><dd><p>true if fence should be added shared</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_sync_wait_resv">
int <code class="sig-name descname">amdgpu_bo_sync_wait_resv</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_resv" title="dma_resv">dma_resv</a><em> *resv</em>, enum amdgpu_sync_mode<em> sync_mode</em>, void<em> *owner</em>, bool<em> intr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_sync_wait_resv" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for BO reservation fences</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_resv</span> <span class="pre">*resv</span></code></dt><dd><p>reservation object to sync to</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">amdgpu_sync_mode</span> <span class="pre">sync_mode</span></code></dt><dd><p>synchronization mode</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*owner</span></code></dt><dd><p>fence owner</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">intr</span></code></dt><dd><p>Whether the wait is interruptible</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Extract the fences from the reservation object and waits for them to finish.</p>
<p><strong>Return</strong></p>
<p>0 on success, errno otherwise.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_sync_wait">
int <code class="sig-name descname">amdgpu_bo_sync_wait</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, void<em> *owner</em>, bool<em> intr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_sync_wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper for amdgpu_bo_sync_wait_resv</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>buffer object to wait for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*owner</span></code></dt><dd><p>fence owner</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">intr</span></code></dt><dd><p>Whether the wait is interruptible</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Wrapper to wait for fences in a BO.</p>
<p><strong>Return</strong></p>
<p>0 on success, errno otherwise.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_gpu_offset">
u64 <code class="sig-name descname">amdgpu_bo_gpu_offset</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_gpu_offset" title="Permalink to this definition">¶</a></dt>
<dd><p>return GPU offset of bo</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>amdgpu object for which we query the offset</p>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>object should either be pinned or reserved when calling this
function, it might be useful to add check for this for debugging.</p>
<p><strong>Return</strong></p>
<p>current GPU offset of the object.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_gpu_offset_no_check">
u64 <code class="sig-name descname">amdgpu_bo_gpu_offset_no_check</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_gpu_offset_no_check" title="Permalink to this definition">¶</a></dt>
<dd><p>return GPU offset of bo</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>amdgpu object for which we query the offset</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>current GPU offset of the object without raising warnings.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_get_preferred_domain">
uint32_t <code class="sig-name descname">amdgpu_bo_get_preferred_domain</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, uint32_t<em> domain</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_get_preferred_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>get preferred domain</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">domain</span></code></dt><dd><p>allowed <a class="reference internal" href="#amdgpu-memory-domains"><span class="std std-ref">memory domains</span></a></p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>Which of the allowed domains is preferred for allocating the BO.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_bo_print_info">
u64 <code class="sig-name descname">amdgpu_bo_print_info</code><span class="sig-paren">(</span>int<em> id</em>, struct amdgpu_bo<em> *bo</em>, struct seq_file<em> *m</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_bo_print_info" title="Permalink to this definition">¶</a></dt>
<dd><p>print BO info in debugfs file</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">id</span></code></dt><dd><p>Index or Id of the BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>Requested BO for printing info</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">seq_file</span> <span class="pre">*m</span></code></dt><dd><p>debugfs file</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Print BO information in debugfs file</p>
<p><strong>Return</strong></p>
<p>Size of the BO in bytes.</p>
</div>
</section>
<section id="prime-buffer-sharing">
<h2>PRIME Buffer Sharing<a class="headerlink" href="#prime-buffer-sharing" title="Permalink to this headline">¶</a></h2>
<p>The following callback implementations are used for <a class="reference internal" href="../drm-mm.html#prime-buffer-sharing"><span class="std std-ref">sharing GEM buffer
objects between different devices via PRIME</span></a>.</p>
<dl class="function">
<dt id="c.amdgpu_dma_buf_attach">
int <code class="sig-name descname">amdgpu_dma_buf_attach</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf" title="dma_buf">dma_buf</a><em> *dmabuf</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_attachment" title="dma_buf_attachment">dma_buf_attachment</a><em> *attach</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_attach" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_ops" title="dma_buf_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">dma_buf_ops.attach</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf</span> <span class="pre">*dmabuf</span></code></dt><dd><p>DMA-buf where we attach to</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf_attachment</span> <span class="pre">*attach</span></code></dt><dd><p>attachment to add</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add the attachment as user to the exported DMA-buf.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dma_buf_detach">
void <code class="sig-name descname">amdgpu_dma_buf_detach</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf" title="dma_buf">dma_buf</a><em> *dmabuf</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_attachment" title="dma_buf_attachment">dma_buf_attachment</a><em> *attach</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_detach" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_ops" title="dma_buf_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">dma_buf_ops.detach</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf</span> <span class="pre">*dmabuf</span></code></dt><dd><p>DMA-buf where we remove the attachment from</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf_attachment</span> <span class="pre">*attach</span></code></dt><dd><p>the attachment to remove</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when an attachment is removed from the DMA-buf.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dma_buf_pin">
int <code class="sig-name descname">amdgpu_dma_buf_pin</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_attachment" title="dma_buf_attachment">dma_buf_attachment</a><em> *attach</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_pin" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_ops" title="dma_buf_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">dma_buf_ops.pin</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf_attachment</span> <span class="pre">*attach</span></code></dt><dd><p>attachment to pin down</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Pin the BO which is backing the DMA-buf so that it can’t move any more.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dma_buf_unpin">
void <code class="sig-name descname">amdgpu_dma_buf_unpin</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_attachment" title="dma_buf_attachment">dma_buf_attachment</a><em> *attach</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_unpin" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_ops" title="dma_buf_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">dma_buf_ops.unpin</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf_attachment</span> <span class="pre">*attach</span></code></dt><dd><p>attachment to unpin</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Unpin a previously pinned BO to make it movable again.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dma_buf_map">
struct sg_table * <code class="sig-name descname">amdgpu_dma_buf_map</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_attachment" title="dma_buf_attachment">dma_buf_attachment</a><em> *attach</em>, enum dma_data_direction<em> dir</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_map" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_ops" title="dma_buf_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">dma_buf_ops.map_dma_buf</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf_attachment</span> <span class="pre">*attach</span></code></dt><dd><p>DMA-buf attachment</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">dma_data_direction</span> <span class="pre">dir</span></code></dt><dd><p>DMA direction</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Makes sure that the shared DMA buffer can be accessed by the target device.
For now, simply pins it to the GTT domain, where it should be accessible by
all DMA devices.</p>
<p><strong>Return</strong></p>
<p>sg_table filled with the DMA addresses to use or ERR_PRT with negative error
code.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dma_buf_unmap">
void <code class="sig-name descname">amdgpu_dma_buf_unmap</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_attachment" title="dma_buf_attachment">dma_buf_attachment</a><em> *attach</em>, struct sg_table<em> *sgt</em>, enum dma_data_direction<em> dir</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_unmap" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_ops" title="dma_buf_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">dma_buf_ops.unmap_dma_buf</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf_attachment</span> <span class="pre">*attach</span></code></dt><dd><p>DMA-buf attachment</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sg_table</span> <span class="pre">*sgt</span></code></dt><dd><p>sg_table to unmap</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">dma_data_direction</span> <span class="pre">dir</span></code></dt><dd><p>DMA direction</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is called when a shared DMA buffer no longer needs to be accessible by
another device. For now, simply unpins the buffer from GTT.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dma_buf_begin_cpu_access">
int <code class="sig-name descname">amdgpu_dma_buf_begin_cpu_access</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf" title="dma_buf">dma_buf</a><em> *dma_buf</em>, enum dma_data_direction<em> direction</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_begin_cpu_access" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_ops" title="dma_buf_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">dma_buf_ops.begin_cpu_access</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf</span> <span class="pre">*dma_buf</span></code></dt><dd><p>Shared DMA buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">dma_data_direction</span> <span class="pre">direction</span></code></dt><dd><p>Direction of DMA transfer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is called before CPU access to the shared DMA buffer’s memory. If it’s
a read access, the buffer is moved to the GTT domain if possible, for optimal
CPU read performance.</p>
<p><strong>Return</strong></p>
<p>0 on success or a negative error code on failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_gem_prime_export">
struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf" title="dma_buf">dma_buf</a> * <code class="sig-name descname">amdgpu_gem_prime_export</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../drm-mm.html#c.drm_gem_object" title="drm_gem_object">drm_gem_object</a><em> *gobj</em>, int<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_gem_prime_export" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../drm-internals.html#c.drm_driver" title="drm_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_driver.gem_prime_export</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_gem_object</span> <span class="pre">*gobj</span></code></dt><dd><p>GEM BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">flags</span></code></dt><dd><p>Flags such as DRM_CLOEXEC and DRM_RDWR.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The main work is done by the <a class="reference internal" href="../drm-mm.html#c.drm_gem_prime_export" title="drm_gem_prime_export"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_gem_prime_export</span></code></a> helper.</p>
<p><strong>Return</strong></p>
<p>Shared DMA buffer representing the GEM BO from the given device.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dma_buf_create_obj">
struct <a class="reference internal" href="../drm-mm.html#c.drm_gem_object" title="drm_gem_object">drm_gem_object</a> * <code class="sig-name descname">amdgpu_dma_buf_create_obj</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../drm-internals.html#c.drm_device" title="drm_device">drm_device</a><em> *dev</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf" title="dma_buf">dma_buf</a><em> *dma_buf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_create_obj" title="Permalink to this definition">¶</a></dt>
<dd><p>create BO for DMA-buf import</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_device</span> <span class="pre">*dev</span></code></dt><dd><p>DRM device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf</span> <span class="pre">*dma_buf</span></code></dt><dd><p>DMA-buf</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates an empty SG BO for DMA-buf import.</p>
<p><strong>Return</strong></p>
<p>A new GEM BO of the given DRM device, representing the memory
described by the given DMA-buf attachment and scatter/gather table.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dma_buf_move_notify">
void <code class="sig-name descname">amdgpu_dma_buf_move_notify</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf_attachment" title="dma_buf_attachment">dma_buf_attachment</a><em> *attach</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dma_buf_move_notify" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="xref c c-type docutils literal notranslate"><span class="pre">attach.move_notify</span></code> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf_attachment</span> <span class="pre">*attach</span></code></dt><dd><p>the DMA-buf attachment</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Invalidate the DMA-buf attachment, making sure that the we re-create the
mapping before the next use.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_gem_prime_import">
struct <a class="reference internal" href="../drm-mm.html#c.drm_gem_object" title="drm_gem_object">drm_gem_object</a> * <code class="sig-name descname">amdgpu_gem_prime_import</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../drm-internals.html#c.drm_device" title="drm_device">drm_device</a><em> *dev</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_buf" title="dma_buf">dma_buf</a><em> *dma_buf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_gem_prime_import" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../drm-internals.html#c.drm_driver" title="drm_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_driver.gem_prime_import</span></code></a> implementation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_device</span> <span class="pre">*dev</span></code></dt><dd><p>DRM device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_buf</span> <span class="pre">*dma_buf</span></code></dt><dd><p>Shared DMA buffer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Import a dma_buf into a the driver and potentially create a new GEM object.</p>
<p><strong>Return</strong></p>
<p>GEM BO representing the shared DMA buffer for the given device.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_dmabuf_is_xgmi_accessible">
bool <code class="sig-name descname">amdgpu_dmabuf_is_xgmi_accessible</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_dmabuf_is_xgmi_accessible" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if xgmi available for P2P transfer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer of the importer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>amdgpu buffer object</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>True if dmabuf accessible over xgmi, false otherwise.</p>
</div>
</section>
<section id="mmu-notifier">
<h2>MMU Notifier<a class="headerlink" href="#mmu-notifier" title="Permalink to this headline">¶</a></h2>
<p>For coherent userptr handling registers an MMU notifier to inform the driver
about updates on the page tables of a process.</p>
<p>When somebody tries to invalidate the page tables we block the update until
all operations on the pages in question are completed, then those pages are
marked as accessed and also dirty if it wasn’t a read only access.</p>
<p>New command submissions using the userptrs in question are delayed until all
page table invalidation are completed and we once more see a coherent process
address space.</p>
<dl class="function">
<dt id="c.amdgpu_hmm_invalidate_gfx">
bool <code class="sig-name descname">amdgpu_hmm_invalidate_gfx</code><span class="sig-paren">(</span>struct mmu_interval_notifier<em> *mni</em>, const struct mmu_notifier_range<em> *range</em>, unsigned long<em> cur_seq</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_hmm_invalidate_gfx" title="Permalink to this definition">¶</a></dt>
<dd><p>callback to notify about mm change</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mmu_interval_notifier</span> <span class="pre">*mni</span></code></dt><dd><p>the range (mm) is about to update</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">mmu_notifier_range</span> <span class="pre">*range</span></code></dt><dd><p>details on the invalidation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">cur_seq</span></code></dt><dd><p>Value to pass to mmu_interval_set_seq()</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Block for operations on BOs to finish and mark pages as accessed and
potentially dirty.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_hmm_invalidate_hsa">
bool <code class="sig-name descname">amdgpu_hmm_invalidate_hsa</code><span class="sig-paren">(</span>struct mmu_interval_notifier<em> *mni</em>, const struct mmu_notifier_range<em> *range</em>, unsigned long<em> cur_seq</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_hmm_invalidate_hsa" title="Permalink to this definition">¶</a></dt>
<dd><p>callback to notify about mm change</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">mmu_interval_notifier</span> <span class="pre">*mni</span></code></dt><dd><p>the range (mm) is about to update</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">mmu_notifier_range</span> <span class="pre">*range</span></code></dt><dd><p>details on the invalidation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">cur_seq</span></code></dt><dd><p>Value to pass to mmu_interval_set_seq()</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>We temporarily evict the BO attached to this range. This necessitates
evicting all user-mode queues of the process.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_hmm_register">
int <code class="sig-name descname">amdgpu_hmm_register</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em>, unsigned long<em> addr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_hmm_register" title="Permalink to this definition">¶</a></dt>
<dd><p>register a BO for notifier updates</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>amdgpu buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">addr</span></code></dt><dd><p>userptr addr we should monitor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Registers a mmu_notifier for the given BO at the specified address.
Returns 0 on success, -ERRNO if anything goes wrong.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_hmm_unregister">
void <code class="sig-name descname">amdgpu_hmm_unregister</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_hmm_unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>unregister a BO for notifier updates</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>amdgpu buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Remove any registration of mmu notifier updates from the buffer object.</p>
</div>
</section>
<section id="amdgpu-virtual-memory">
<h2>AMDGPU Virtual Memory<a class="headerlink" href="#amdgpu-virtual-memory" title="Permalink to this headline">¶</a></h2>
<p>GPUVM is the MMU functionality provided on the GPU.
GPUVM is similar to the legacy GART on older asics, however
rather than there being a single global GART table
for the entire GPU, there can be multiple GPUVM page tables active
at any given time.  The GPUVM page tables can contain a mix
VRAM pages and system pages (both memory and MMIO) and system pages
can be mapped as snooped (cached system pages) or unsnooped
(uncached system pages).</p>
<p>Each active GPUVM has an ID associated with it and there is a page table
linked with each VMID.  When executing a command buffer,
the kernel tells the engine what VMID to use for that command
buffer.  VMIDs are allocated dynamically as commands are submitted.
The userspace drivers maintain their own address space and the kernel
sets up their pages tables accordingly when they submit their
command buffers and a VMID is assigned.
The hardware supports up to 16 active GPUVMs at any given time.</p>
<p>Each GPUVM is represented by a 1-2 or 1-5 level page table, depending
on the ASIC family.  GPUVM supports RWX attributes on each page as well
as other features such as encryption and caching attributes.</p>
<p>VMID 0 is special.  It is the GPUVM used for the kernel driver.  In
addition to an aperture managed by a page table, VMID 0 also has
several other apertures.  There is an aperture for direct access to VRAM
and there is a legacy AGP aperture which just forwards accesses directly
to the matching system physical addresses (or IOVAs when an IOMMU is
present).  These apertures provide direct access to these memories without
incurring the overhead of a page table.  VMID 0 is used by the kernel
driver for tasks like memory management.</p>
<p>GPU clients (i.e., engines on the GPU) use GPUVM VMIDs to access memory.
For user applications, each application can have their own unique GPUVM
address space.  The application manages the address space and the kernel
driver manages the GPUVM page tables for each process.  If an GPU client
accesses an invalid page, it will generate a GPU page fault, similar to
accessing an invalid page on a CPU.</p>
<dl class="type">
<dt id="c.amdgpu_prt_cb">
struct <code class="sig-name descname">amdgpu_prt_cb</code><a class="headerlink" href="#c.amdgpu_prt_cb" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to disable partial resident texture feature from a fence callback</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct amdgpu_prt_cb {
    struct amdgpu_device *adev;
    struct dma_fence_cb cb;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">adev</span></code></dt><dd><p>amdgpu device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cb</span></code></dt><dd><p>callback</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.amdgpu_vm_tlb_seq_cb">
struct <code class="sig-name descname">amdgpu_vm_tlb_seq_cb</code><a class="headerlink" href="#c.amdgpu_vm_tlb_seq_cb" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper to increment the TLB flush sequence</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct amdgpu_vm_tlb_seq_cb {
    struct amdgpu_vm *vm;
    struct dma_fence_cb cb;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">vm</span></code></dt><dd><p>pointer to the amdgpu_vm structure to set the fence sequence on</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cb</span></code></dt><dd><p>callback</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_set_pasid">
int <code class="sig-name descname">amdgpu_vm_set_pasid</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em>, u32<em> pasid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_set_pasid" title="Permalink to this definition">¶</a></dt>
<dd><p>manage pasid and vm ptr mapping</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>amdgpu_vm pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">pasid</span></code></dt><dd><p>the pasid the VM is using on this GPU</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Set the pasid this VM is using on this GPU, can also be used to remove the
pasid by passing in zero.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_evicted">
void <code class="sig-name descname">amdgpu_vm_bo_evicted</code><span class="sig-paren">(</span>struct amdgpu_vm_bo_base<em> *vm_bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_evicted" title="Permalink to this definition">¶</a></dt>
<dd><p>vm_bo is evicted</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm_bo_base</span> <span class="pre">*vm_bo</span></code></dt><dd><p>vm_bo which is evicted</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>State for PDs/PTs and per VM BOs which are not at the location they should
be.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_moved">
void <code class="sig-name descname">amdgpu_vm_bo_moved</code><span class="sig-paren">(</span>struct amdgpu_vm_bo_base<em> *vm_bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_moved" title="Permalink to this definition">¶</a></dt>
<dd><p>vm_bo is moved</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm_bo_base</span> <span class="pre">*vm_bo</span></code></dt><dd><p>vm_bo which is moved</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>State for per VM BOs which are moved, but that change is not yet reflected
in the page tables.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_idle">
void <code class="sig-name descname">amdgpu_vm_bo_idle</code><span class="sig-paren">(</span>struct amdgpu_vm_bo_base<em> *vm_bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_idle" title="Permalink to this definition">¶</a></dt>
<dd><p>vm_bo is idle</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm_bo_base</span> <span class="pre">*vm_bo</span></code></dt><dd><p>vm_bo which is now idle</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>State for PDs/PTs and per VM BOs which have gone through the state machine
and are now idle.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_invalidated">
void <code class="sig-name descname">amdgpu_vm_bo_invalidated</code><span class="sig-paren">(</span>struct amdgpu_vm_bo_base<em> *vm_bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_invalidated" title="Permalink to this definition">¶</a></dt>
<dd><p>vm_bo is invalidated</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm_bo_base</span> <span class="pre">*vm_bo</span></code></dt><dd><p>vm_bo which is now invalidated</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>State for normal BOs which are invalidated and that change not yet reflected
in the PTs.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_relocated">
void <code class="sig-name descname">amdgpu_vm_bo_relocated</code><span class="sig-paren">(</span>struct amdgpu_vm_bo_base<em> *vm_bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_relocated" title="Permalink to this definition">¶</a></dt>
<dd><p>vm_bo is reloacted</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm_bo_base</span> <span class="pre">*vm_bo</span></code></dt><dd><p>vm_bo which is relocated</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>State for PDs/PTs which needs to update their parent PD.
For the root PD, just move to idle state.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_done">
void <code class="sig-name descname">amdgpu_vm_bo_done</code><span class="sig-paren">(</span>struct amdgpu_vm_bo_base<em> *vm_bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_done" title="Permalink to this definition">¶</a></dt>
<dd><p>vm_bo is done</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm_bo_base</span> <span class="pre">*vm_bo</span></code></dt><dd><p>vm_bo which is now done</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>State for normal BOs which are invalidated and that change has been updated
in the PTs.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_base_init">
void <code class="sig-name descname">amdgpu_vm_bo_base_init</code><span class="sig-paren">(</span>struct amdgpu_vm_bo_base<em> *base</em>, struct amdgpu_vm<em> *vm</em>, struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_base_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds bo to the list of bos associated with the vm</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm_bo_base</span> <span class="pre">*base</span></code></dt><dd><p>base structure for tracking BO usage in a VM</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>vm to which bo is to be added</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>amdgpu buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Initialize a bo_va_base structure and add it to the appropriate lists</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_get_pd_bo">
void <code class="sig-name descname">amdgpu_vm_get_pd_bo</code><span class="sig-paren">(</span>struct amdgpu_vm<em> *vm</em>, struct list_head<em> *validated</em>, struct amdgpu_bo_list_entry<em> *entry</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_get_pd_bo" title="Permalink to this definition">¶</a></dt>
<dd><p>add the VM PD to a validation list</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>vm providing the BOs</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">list_head</span> <span class="pre">*validated</span></code></dt><dd><p>head of validation list</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_list_entry</span> <span class="pre">*entry</span></code></dt><dd><p>entry to add</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add the page directory to the list of BOs to
validate for command submission.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_move_to_lru_tail">
void <code class="sig-name descname">amdgpu_vm_move_to_lru_tail</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_move_to_lru_tail" title="Permalink to this definition">¶</a></dt>
<dd><p>move all BOs to the end of LRU</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>vm providing the BOs</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Move all BOs to the end of LRU and remember their positions to put them
together.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_validate_pt_bos">
int <code class="sig-name descname">amdgpu_vm_validate_pt_bos</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em>, int (<em>*validate</em>)(void *p, struct amdgpu_bo *bo), void<em> *param</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_validate_pt_bos" title="Permalink to this definition">¶</a></dt>
<dd><p>validate the page table BOs</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>vm providing the BOs</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">(*validate)(void</span> <span class="pre">*p,</span> <span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo)</span></code></dt><dd><p>callback to do the validation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*param</span></code></dt><dd><p>parameter for the validation callback</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Validate the page table BOs on command submission if neccessary.</p>
<p><strong>Return</strong></p>
<p>Validation result.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_ready">
bool <code class="sig-name descname">amdgpu_vm_ready</code><span class="sig-paren">(</span>struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_ready" title="Permalink to this definition">¶</a></dt>
<dd><p>check VM is ready for updates</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>VM to check</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Check if all VM PDs/PTs are ready for updates</p>
<p><strong>Return</strong></p>
<p>True if VM is not evicting.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_check_compute_bug">
void <code class="sig-name descname">amdgpu_vm_check_compute_bug</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_check_compute_bug" title="Permalink to this definition">¶</a></dt>
<dd><p>check whether asic has compute vm bug</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_need_pipeline_sync">
bool <code class="sig-name descname">amdgpu_vm_need_pipeline_sync</code><span class="sig-paren">(</span>struct amdgpu_ring<em> *ring</em>, struct amdgpu_job<em> *job</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_need_pipeline_sync" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if pipe sync is needed for job.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_ring</span> <span class="pre">*ring</span></code></dt><dd><p>ring on which the job will be submitted</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_job</span> <span class="pre">*job</span></code></dt><dd><p>job to submit</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>True if sync is needed.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_flush">
int <code class="sig-name descname">amdgpu_vm_flush</code><span class="sig-paren">(</span>struct amdgpu_ring<em> *ring</em>, struct amdgpu_job<em> *job</em>, bool<em> need_pipe_sync</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_flush" title="Permalink to this definition">¶</a></dt>
<dd><p>hardware flush the vm</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_ring</span> <span class="pre">*ring</span></code></dt><dd><p>ring to use for flush</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_job</span> <span class="pre">*job</span></code></dt><dd><p>related job</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">need_pipe_sync</span></code></dt><dd><p>is pipe sync needed</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Emit a VM flush when it is necessary.</p>
<p><strong>Return</strong></p>
<p>0 on success, errno otherwise.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_find">
struct amdgpu_bo_va * <code class="sig-name descname">amdgpu_vm_bo_find</code><span class="sig-paren">(</span>struct amdgpu_vm<em> *vm</em>, struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_find" title="Permalink to this definition">¶</a></dt>
<dd><p>find the bo_va for a specific vm &amp; bo</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>requested buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Find <strong>bo</strong> inside the requested vm.
Search inside the <strong>bos</strong> vm list for the requested vm
Returns the found bo_va or NULL if none is found</p>
<p>Object has to be reserved!</p>
<p><strong>Return</strong></p>
<p>Found bo_va or NULL.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_map_gart">
uint64_t <code class="sig-name descname">amdgpu_vm_map_gart</code><span class="sig-paren">(</span>const dma_addr_t<em> *pages_addr</em>, uint64_t<em> addr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_map_gart" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve gart mapping of addr</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">dma_addr_t</span> <span class="pre">*pages_addr</span></code></dt><dd><p>optional DMA address to use for lookup</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">addr</span></code></dt><dd><p>the unmapped addr</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Look up the physical address of the page that the pte resolves
to.</p>
<p><strong>Return</strong></p>
<p>The pointer for the page table entry.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_update_pdes">
int <code class="sig-name descname">amdgpu_vm_update_pdes</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em>, bool<em> immediate</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_update_pdes" title="Permalink to this definition">¶</a></dt>
<dd><p>make sure that all directories are valid</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">immediate</span></code></dt><dd><p>submit immediately to the paging queue</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Makes sure all directories are up to date.</p>
<p><strong>Return</strong></p>
<p>0 for success, error for failure.</p>
</div>
<dl class="function">
<dt>
void <code class="sig-name descname">amdgpu_vm_tlb_seq_cb</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence" title="dma_fence">dma_fence</a><em> *fence</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence_cb" title="dma_fence_cb">dma_fence_cb</a><em> *cb</em><span class="sig-paren">)</span></dt>
<dd><p>make sure to increment tlb sequence</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence</span> <span class="pre">*fence</span></code></dt><dd><p>unused</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence_cb</span> <span class="pre">*cb</span></code></dt><dd><p>the callback structure</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Increments the tlb sequence to make sure that future CS execute a VM flush.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_update_range">
int <code class="sig-name descname">amdgpu_vm_update_range</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em>, bool<em> immediate</em>, bool<em> unlocked</em>, bool<em> flush_tlb</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_resv" title="dma_resv">dma_resv</a><em> *resv</em>, uint64_t<em> start</em>, uint64_t<em> last</em>, uint64_t<em> flags</em>, uint64_t<em> offset</em>, uint64_t<em> vram_base</em>, struct <a class="reference internal" href="../drm-mm.html#c.ttm_resource" title="ttm_resource">ttm_resource</a><em> *res</em>, dma_addr_t<em> *pages_addr</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence" title="dma_fence">dma_fence</a><em> **fence</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_update_range" title="Permalink to this definition">¶</a></dt>
<dd><p>update a range in the vm page table</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer to use for commands</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>the VM to update the range</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">immediate</span></code></dt><dd><p>immediate submission in a page fault</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">unlocked</span></code></dt><dd><p>unlocked invalidation during MM callback</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">flush_tlb</span></code></dt><dd><p>trigger tlb invalidation after update completed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_resv</span> <span class="pre">*resv</span></code></dt><dd><p>fences we need to sync to</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">start</span></code></dt><dd><p>start of mapped range</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">last</span></code></dt><dd><p>last mapped entry</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">flags</span></code></dt><dd><p>flags for the entries</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">offset</span></code></dt><dd><p>offset into nodes and pages_addr</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">vram_base</span></code></dt><dd><p>base for vram mappings</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ttm_resource</span> <span class="pre">*res</span></code></dt><dd><p>ttm_resource to map</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dma_addr_t</span> <span class="pre">*pages_addr</span></code></dt><dd><p>DMA addresses to use for mapping</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence</span> <span class="pre">**fence</span></code></dt><dd><p>optional resulting fence</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Fill in the page table entries between <strong>start</strong> and <strong>last</strong>.</p>
<p><strong>Return</strong></p>
<p>0 for success, negative erro code for failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_update">
int <code class="sig-name descname">amdgpu_vm_bo_update</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_va<em> *bo_va</em>, bool<em> clear</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_update" title="Permalink to this definition">¶</a></dt>
<dd><p>update all BO mappings in the vm page table</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_va</span> <span class="pre">*bo_va</span></code></dt><dd><p>requested BO and VM object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">clear</span></code></dt><dd><p>if true clear the entries</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Fill in the page table entries for <strong>bo_va</strong>.</p>
<p><strong>Return</strong></p>
<p>0 for success, -EINVAL for failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_update_prt_state">
void <code class="sig-name descname">amdgpu_vm_update_prt_state</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_update_prt_state" title="Permalink to this definition">¶</a></dt>
<dd><p>update the global PRT state</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_prt_get">
void <code class="sig-name descname">amdgpu_vm_prt_get</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_prt_get" title="Permalink to this definition">¶</a></dt>
<dd><p>add a PRT user</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_prt_put">
void <code class="sig-name descname">amdgpu_vm_prt_put</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_prt_put" title="Permalink to this definition">¶</a></dt>
<dd><p>drop a PRT user</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_prt_cb">
void <code class="sig-name descname">amdgpu_vm_prt_cb</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence" title="dma_fence">dma_fence</a><em> *fence</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence_cb" title="dma_fence_cb">dma_fence_cb</a><em> *_cb</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_prt_cb" title="Permalink to this definition">¶</a></dt>
<dd><p>callback for updating the PRT status</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence</span> <span class="pre">*fence</span></code></dt><dd><p>fence for the callback</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence_cb</span> <span class="pre">*_cb</span></code></dt><dd><p>the callback function</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_add_prt_cb">
void <code class="sig-name descname">amdgpu_vm_add_prt_cb</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence" title="dma_fence">dma_fence</a><em> *fence</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_add_prt_cb" title="Permalink to this definition">¶</a></dt>
<dd><p>add callback for updating the PRT status</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence</span> <span class="pre">*fence</span></code></dt><dd><p>fence for the callback</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_free_mapping">
void <code class="sig-name descname">amdgpu_vm_free_mapping</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em>, struct amdgpu_bo_va_mapping<em> *mapping</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence" title="dma_fence">dma_fence</a><em> *fence</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_free_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>free a mapping</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_va_mapping</span> <span class="pre">*mapping</span></code></dt><dd><p>mapping to be freed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence</span> <span class="pre">*fence</span></code></dt><dd><p>fence of the unmap operation</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Free a mapping and make sure we decrease the PRT usage count if applicable.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_prt_fini">
void <code class="sig-name descname">amdgpu_vm_prt_fini</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_prt_fini" title="Permalink to this definition">¶</a></dt>
<dd><p>finish all prt mappings</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Register a cleanup callback to disable PRT support after VM dies.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_clear_freed">
int <code class="sig-name descname">amdgpu_vm_clear_freed</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em>, struct <a class="reference internal" href="../../driver-api/dma-buf.html#c.dma_fence" title="dma_fence">dma_fence</a><em> **fence</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_clear_freed" title="Permalink to this definition">¶</a></dt>
<dd><p>clear freed BOs in the PT</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">dma_fence</span> <span class="pre">**fence</span></code></dt><dd><p>optional resulting fence (unchanged if no work needed to be done
or if an error occurred)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Make sure all freed BOs are cleared in the PT.
PTs have to be reserved and mutex must be locked!</p>
<p><strong>Return</strong></p>
<p>0 for success.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_handle_moved">
int <code class="sig-name descname">amdgpu_vm_handle_moved</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_handle_moved" title="Permalink to this definition">¶</a></dt>
<dd><p>handle moved BOs in the PT</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Make sure all BOs which are moved are updated in the PTs.</p>
<p>PTs have to be reserved!</p>
<p><strong>Return</strong></p>
<p>0 for success.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_add">
struct amdgpu_bo_va * <code class="sig-name descname">amdgpu_vm_bo_add</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em>, struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_add" title="Permalink to this definition">¶</a></dt>
<dd><p>add a bo to a specific vm</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>amdgpu buffer object</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add <strong>bo</strong> into the requested vm.
Add <strong>bo</strong> to the list of bos associated with the vm</p>
<p>Object has to be reserved!</p>
<p><strong>Return</strong></p>
<p>Newly added bo_va or NULL for failure</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_insert_map">
void <code class="sig-name descname">amdgpu_vm_bo_insert_map</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_va<em> *bo_va</em>, struct amdgpu_bo_va_mapping<em> *mapping</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_insert_map" title="Permalink to this definition">¶</a></dt>
<dd><p>insert a new mapping</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_va</span> <span class="pre">*bo_va</span></code></dt><dd><p>bo_va to store the address</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_va_mapping</span> <span class="pre">*mapping</span></code></dt><dd><p>the mapping to insert</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Insert a new mapping into all structures.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_map">
int <code class="sig-name descname">amdgpu_vm_bo_map</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_va<em> *bo_va</em>, uint64_t<em> saddr</em>, uint64_t<em> offset</em>, uint64_t<em> size</em>, uint64_t<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_map" title="Permalink to this definition">¶</a></dt>
<dd><p>map bo inside a vm</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_va</span> <span class="pre">*bo_va</span></code></dt><dd><p>bo_va to store the address</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">saddr</span></code></dt><dd><p>where to map the BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">offset</span></code></dt><dd><p>requested offset in the BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">size</span></code></dt><dd><p>BO size in bytes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">flags</span></code></dt><dd><p>attributes of pages (read/write/valid/etc.)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a mapping of the BO at the specefied addr into the VM.</p>
<p>Object has to be reserved and unreserved outside!</p>
<p><strong>Return</strong></p>
<p>0 for success, error for failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_replace_map">
int <code class="sig-name descname">amdgpu_vm_bo_replace_map</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_va<em> *bo_va</em>, uint64_t<em> saddr</em>, uint64_t<em> offset</em>, uint64_t<em> size</em>, uint64_t<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_replace_map" title="Permalink to this definition">¶</a></dt>
<dd><p>map bo inside a vm, replacing existing mappings</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_va</span> <span class="pre">*bo_va</span></code></dt><dd><p>bo_va to store the address</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">saddr</span></code></dt><dd><p>where to map the BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">offset</span></code></dt><dd><p>requested offset in the BO</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">size</span></code></dt><dd><p>BO size in bytes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">flags</span></code></dt><dd><p>attributes of pages (read/write/valid/etc.)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a mapping of the BO at the specefied addr into the VM. Replace existing
mappings as we do so.</p>
<p>Object has to be reserved and unreserved outside!</p>
<p><strong>Return</strong></p>
<p>0 for success, error for failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_unmap">
int <code class="sig-name descname">amdgpu_vm_bo_unmap</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_va<em> *bo_va</em>, uint64_t<em> saddr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_unmap" title="Permalink to this definition">¶</a></dt>
<dd><p>remove bo mapping from vm</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_va</span> <span class="pre">*bo_va</span></code></dt><dd><p>bo_va to remove the address from</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">saddr</span></code></dt><dd><p>where to the BO is mapped</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Remove a mapping of the BO at the specefied addr from the VM.</p>
<p>Object has to be reserved and unreserved outside!</p>
<p><strong>Return</strong></p>
<p>0 for success, error for failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_clear_mappings">
int <code class="sig-name descname">amdgpu_vm_bo_clear_mappings</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em>, uint64_t<em> saddr</em>, uint64_t<em> size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_clear_mappings" title="Permalink to this definition">¶</a></dt>
<dd><p>remove all mappings in a specific range</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>VM structure to use</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">saddr</span></code></dt><dd><p>start of the range</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">size</span></code></dt><dd><p>size of the range</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Remove all mappings in a range, split them as appropriate.</p>
<p><strong>Return</strong></p>
<p>0 for success, error for failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_lookup_mapping">
struct amdgpu_bo_va_mapping * <code class="sig-name descname">amdgpu_vm_bo_lookup_mapping</code><span class="sig-paren">(</span>struct amdgpu_vm<em> *vm</em>, uint64_t<em> addr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_lookup_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>find mapping by address</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>the requested VM</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">addr</span></code></dt><dd><p>the address</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Find a mapping by it’s address.</p>
<p><strong>Return</strong></p>
<p>The amdgpu_bo_va_mapping matching for addr or NULL</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_trace_cs">
void <code class="sig-name descname">amdgpu_vm_bo_trace_cs</code><span class="sig-paren">(</span>struct amdgpu_vm<em> *vm</em>, struct ww_acquire_ctx<em> *ticket</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_trace_cs" title="Permalink to this definition">¶</a></dt>
<dd><p>trace all reserved mappings</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>the requested vm</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ww_acquire_ctx</span> <span class="pre">*ticket</span></code></dt><dd><p>CS ticket</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Trace all mappings of BOs reserved during a command submission.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_del">
void <code class="sig-name descname">amdgpu_vm_bo_del</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo_va<em> *bo_va</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_del" title="Permalink to this definition">¶</a></dt>
<dd><p>remove a bo from a specific vm</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo_va</span> <span class="pre">*bo_va</span></code></dt><dd><p>requested bo_va</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Remove <strong>bo_va-&gt;bo</strong> from the requested vm.</p>
<p>Object have to be reserved!</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_evictable">
bool <code class="sig-name descname">amdgpu_vm_evictable</code><span class="sig-paren">(</span>struct amdgpu_bo<em> *bo</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_evictable" title="Permalink to this definition">¶</a></dt>
<dd><p>check if we can evict a VM</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>A page table of the VM.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Check if it is possible to evict a VM.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_bo_invalidate">
void <code class="sig-name descname">amdgpu_vm_bo_invalidate</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_bo<em> *bo</em>, bool<em> evicted</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_bo_invalidate" title="Permalink to this definition">¶</a></dt>
<dd><p>mark the bo as invalid</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_bo</span> <span class="pre">*bo</span></code></dt><dd><p>amdgpu buffer object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">evicted</span></code></dt><dd><p>is the BO evicted</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Mark <strong>bo</strong> as invalid.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_get_block_size">
uint32_t <code class="sig-name descname">amdgpu_vm_get_block_size</code><span class="sig-paren">(</span>uint64_t<em> vm_size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_get_block_size" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate VM page table size as power of two</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">vm_size</span></code></dt><dd><p>VM size</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>VM page table as power of two</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_adjust_size">
void <code class="sig-name descname">amdgpu_vm_adjust_size</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, uint32_t<em> min_vm_size</em>, uint32_t<em> fragment_size_default</em>, unsigned<em> max_level</em>, unsigned<em> max_bits</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_adjust_size" title="Permalink to this definition">¶</a></dt>
<dd><p>adjust vm size, block size and fragment size</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">min_vm_size</span></code></dt><dd><p>the minimum vm size in GB if it’s set auto</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">fragment_size_default</span></code></dt><dd><p>Default PTE fragment size</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">max_level</span></code></dt><dd><p>max VMPT level</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">max_bits</span></code></dt><dd><p>max address space size in bits</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_wait_idle">
long <code class="sig-name descname">amdgpu_vm_wait_idle</code><span class="sig-paren">(</span>struct amdgpu_vm<em> *vm</em>, long<em> timeout</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_wait_idle" title="Permalink to this definition">¶</a></dt>
<dd><p>wait for the VM to become idle</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>VM object to wait for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">timeout</span></code></dt><dd><p>timeout to wait for VM to become idle</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_init">
int <code class="sig-name descname">amdgpu_vm_init</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_init" title="Permalink to this definition">¶</a></dt>
<dd><p>initialize a vm instance</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Init <strong>vm</strong> fields.</p>
<p><strong>Return</strong></p>
<p>0 for success, error for failure.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_make_compute">
int <code class="sig-name descname">amdgpu_vm_make_compute</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_make_compute" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn a GFX VM into a compute VM</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This only works on GFX VMs that don’t have any BOs added and no
page tables allocated yet.</p>
<p>Changes the following VM parameters:
- use_cpu_for_update
- pte_supports_ats</p>
<p>Reinitializes the page directory to reflect the changed ATS
setting.</p>
<p><strong>Return</strong></p>
<p>0 for success, -errno for errors.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_release_compute">
void <code class="sig-name descname">amdgpu_vm_release_compute</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_release_compute" title="Permalink to this definition">¶</a></dt>
<dd><p>release a compute vm</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>a vm turned into compute vm by calling amdgpu_vm_make_compute</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a correspondant of amdgpu_vm_make_compute. It decouples compute
pasid from vm. Compute should stop use of vm after this call.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_fini">
void <code class="sig-name descname">amdgpu_vm_fini</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_fini" title="Permalink to this definition">¶</a></dt>
<dd><p>tear down a vm instance</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>requested vm</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Tear down <strong>vm</strong>.
Unbind the VM and remove all bos from the vm bo list</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_manager_init">
void <code class="sig-name descname">amdgpu_vm_manager_init</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_manager_init" title="Permalink to this definition">¶</a></dt>
<dd><p>init the VM manager</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Initialize the VM manager structures</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_manager_fini">
void <code class="sig-name descname">amdgpu_vm_manager_fini</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_manager_fini" title="Permalink to this definition">¶</a></dt>
<dd><p>cleanup VM manager</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu_device pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Cleanup the VM manager and free resources.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_ioctl">
int <code class="sig-name descname">amdgpu_vm_ioctl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../drm-internals.html#c.drm_device" title="drm_device">drm_device</a><em> *dev</em>, void<em> *data</em>, struct <a class="reference internal" href="../drm-internals.html#c.drm_file" title="drm_file">drm_file</a><em> *filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_ioctl" title="Permalink to this definition">¶</a></dt>
<dd><p>Manages VMID reservation for vm hubs.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_device</span> <span class="pre">*dev</span></code></dt><dd><p>drm device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*data</span></code></dt><dd><p>drm_amdgpu_vm</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_file</span> <span class="pre">*filp</span></code></dt><dd><p>drm file pointer</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>0 for success, -errno for errors.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_get_task_info">
void <code class="sig-name descname">amdgpu_vm_get_task_info</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, u32<em> pasid</em>, struct amdgpu_task_info<em> *task_info</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_get_task_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts task info for a PASID.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>drm device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">pasid</span></code></dt><dd><p>PASID identifier for VM</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_task_info</span> <span class="pre">*task_info</span></code></dt><dd><p>task_info to fill.</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_set_task_info">
void <code class="sig-name descname">amdgpu_vm_set_task_info</code><span class="sig-paren">(</span>struct amdgpu_vm<em> *vm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_set_task_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets VMs task info.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>vm for which to set the info</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.amdgpu_vm_handle_fault">
bool <code class="sig-name descname">amdgpu_vm_handle_fault</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, u32<em> pasid</em>, uint64_t<em> addr</em>, bool<em> write_fault</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_vm_handle_fault" title="Permalink to this definition">¶</a></dt>
<dd><p>graceful handling of VM faults.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">pasid</span></code></dt><dd><p>PASID of the VM</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">addr</span></code></dt><dd><p>Address of the fault</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">write_fault</span></code></dt><dd><p>true is write fault, false is read fault</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Try to gracefully handle a VM fault. Return true if the fault was handled and
shouldn’t be reported any more.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_debugfs_vm_bo_info">
void <code class="sig-name descname">amdgpu_debugfs_vm_bo_info</code><span class="sig-paren">(</span>struct amdgpu_vm<em> *vm</em>, struct seq_file<em> *m</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_debugfs_vm_bo_info" title="Permalink to this definition">¶</a></dt>
<dd><p>print BO info for the VM</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_vm</span> <span class="pre">*vm</span></code></dt><dd><p>Requested VM for printing BO info</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">seq_file</span> <span class="pre">*m</span></code></dt><dd><p>debugfs file</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Print BO information in debugfs file for the VM</p>
</div>
</section>
<section id="interrupt-handling">
<h2>Interrupt Handling<a class="headerlink" href="#interrupt-handling" title="Permalink to this headline">¶</a></h2>
<p>Interrupts generated within GPU hardware raise interrupt requests that are
passed to amdgpu IRQ handler which is responsible for detecting source and
type of the interrupt and dispatching matching handlers. If handling an
interrupt requires calling kernel functions that may sleep processing is
dispatched to work handlers.</p>
<p>If MSI functionality is not disabled by module parameter then MSI
support will be enabled.</p>
<p>For GPU interrupt sources that may be driven by another driver, IRQ domain
support is used (with mapping between virtual and hardware IRQs).</p>
<dl class="function">
<dt id="c.amdgpu_irq_disable_all">
void <code class="sig-name descname">amdgpu_irq_disable_all</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_disable_all" title="Permalink to this definition">¶</a></dt>
<dd><p>disable <em>all</em> interrupts</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Disable all types of interrupts from all sources.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_handler">
irqreturn_t <code class="sig-name descname">amdgpu_irq_handler</code><span class="sig-paren">(</span>int<em> irq</em>, void<em> *arg</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>IRQ handler</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">irq</span></code></dt><dd><p>IRQ number (unused)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*arg</span></code></dt><dd><p>pointer to DRM device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>IRQ handler for amdgpu driver (all ASICs).</p>
<p><strong>Return</strong></p>
<p>result of handling the IRQ, as defined by <code class="xref c c-type docutils literal notranslate"><span class="pre">irqreturn_t</span></code></p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_handle_ih1">
void <code class="sig-name descname">amdgpu_irq_handle_ih1</code><span class="sig-paren">(</span>struct work_struct<em> *work</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_handle_ih1" title="Permalink to this definition">¶</a></dt>
<dd><p>kick of processing for IH1</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">work_struct</span> <span class="pre">*work</span></code></dt><dd><p>work structure in struct amdgpu_irq</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Kick of processing IH ring 1.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_handle_ih2">
void <code class="sig-name descname">amdgpu_irq_handle_ih2</code><span class="sig-paren">(</span>struct work_struct<em> *work</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_handle_ih2" title="Permalink to this definition">¶</a></dt>
<dd><p>kick of processing for IH2</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">work_struct</span> <span class="pre">*work</span></code></dt><dd><p>work structure in struct amdgpu_irq</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Kick of processing IH ring 2.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_handle_ih_soft">
void <code class="sig-name descname">amdgpu_irq_handle_ih_soft</code><span class="sig-paren">(</span>struct work_struct<em> *work</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_handle_ih_soft" title="Permalink to this definition">¶</a></dt>
<dd><p>kick of processing for ih_soft</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">work_struct</span> <span class="pre">*work</span></code></dt><dd><p>work structure in struct amdgpu_irq</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Kick of processing IH soft ring.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_msi_ok">
bool <code class="sig-name descname">amdgpu_msi_ok</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_msi_ok" title="Permalink to this definition">¶</a></dt>
<dd><p>check whether MSI functionality is enabled</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer (unused)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Checks whether MSI functionality has been disabled via module parameter
(all ASICs).</p>
<p><strong>Return</strong></p>
<p><em>true</em> if MSIs are allowed to be enabled or <em>false</em> otherwise</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_init">
int <code class="sig-name descname">amdgpu_irq_init</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_init" title="Permalink to this definition">¶</a></dt>
<dd><p>initialize interrupt handling</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Sets up work functions for hotplug and reset interrupts, enables MSI
functionality, initializes vblank, hotplug and reset interrupt handling.</p>
<p><strong>Return</strong></p>
<p>0 on success or error code on failure</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_fini_sw">
void <code class="sig-name descname">amdgpu_irq_fini_sw</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_fini_sw" title="Permalink to this definition">¶</a></dt>
<dd><p>shut down interrupt handling</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Tears down work functions for hotplug and reset interrupts, disables MSI
functionality, shuts down vblank, hotplug and reset interrupt handling,
turns off interrupts from all sources (all ASICs).</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_add_id">
int <code class="sig-name descname">amdgpu_irq_add_id</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, unsigned<em> client_id</em>, unsigned<em> src_id</em>, struct amdgpu_irq_src<em> *source</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_add_id" title="Permalink to this definition">¶</a></dt>
<dd><p>register IRQ source</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">client_id</span></code></dt><dd><p>client id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">src_id</span></code></dt><dd><p>source id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_irq_src</span> <span class="pre">*source</span></code></dt><dd><p>IRQ source pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Registers IRQ source on a client.</p>
<p><strong>Return</strong></p>
<p>0 on success or error code otherwise</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_dispatch">
void <code class="sig-name descname">amdgpu_irq_dispatch</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_ih_ring<em> *ih</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_dispatch" title="Permalink to this definition">¶</a></dt>
<dd><p>dispatch IRQ to IP blocks</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_ih_ring</span> <span class="pre">*ih</span></code></dt><dd><p>interrupt ring instance</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Dispatches IRQ to IP blocks.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_delegate">
void <code class="sig-name descname">amdgpu_irq_delegate</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_iv_entry<em> *entry</em>, unsigned int<em> num_dw</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_delegate" title="Permalink to this definition">¶</a></dt>
<dd><p>delegate IV to soft IH ring</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_iv_entry</span> <span class="pre">*entry</span></code></dt><dd><p>IV entry</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">num_dw</span></code></dt><dd><p>size of IV</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Delegate the IV to the soft IH ring and schedule processing of it. Used
if the hardware delegation to IH1 or IH2 doesn’t work for some reason.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_update">
int <code class="sig-name descname">amdgpu_irq_update</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_irq_src<em> *src</em>, unsigned<em> type</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_update" title="Permalink to this definition">¶</a></dt>
<dd><p>update hardware interrupt state</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_irq_src</span> <span class="pre">*src</span></code></dt><dd><p>interrupt source pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">type</span></code></dt><dd><p>type of interrupt</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Updates interrupt state for the specific source (all ASICs).</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_gpu_reset_resume_helper">
void <code class="sig-name descname">amdgpu_irq_gpu_reset_resume_helper</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_gpu_reset_resume_helper" title="Permalink to this definition">¶</a></dt>
<dd><p>update interrupt states on all sources</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Updates state of all types of interrupts on all sources on resume after
reset.</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_get">
int <code class="sig-name descname">amdgpu_irq_get</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_irq_src<em> *src</em>, unsigned<em> type</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_get" title="Permalink to this definition">¶</a></dt>
<dd><p>enable interrupt</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_irq_src</span> <span class="pre">*src</span></code></dt><dd><p>interrupt source pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">type</span></code></dt><dd><p>type of interrupt</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Enables specified type of interrupt on the specified source (all ASICs).</p>
<p><strong>Return</strong></p>
<p>0 on success or error code otherwise</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_put">
int <code class="sig-name descname">amdgpu_irq_put</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_irq_src<em> *src</em>, unsigned<em> type</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_put" title="Permalink to this definition">¶</a></dt>
<dd><p>disable interrupt</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_irq_src</span> <span class="pre">*src</span></code></dt><dd><p>interrupt source pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">type</span></code></dt><dd><p>type of interrupt</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Enables specified type of interrupt on the specified source (all ASICs).</p>
<p><strong>Return</strong></p>
<p>0 on success or error code otherwise</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_enabled">
bool <code class="sig-name descname">amdgpu_irq_enabled</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, struct amdgpu_irq_src<em> *src</em>, unsigned<em> type</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_enabled" title="Permalink to this definition">¶</a></dt>
<dd><p>check whether interrupt is enabled or not</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_irq_src</span> <span class="pre">*src</span></code></dt><dd><p>interrupt source pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">type</span></code></dt><dd><p>type of interrupt</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Checks whether the given type of interrupt is enabled on the given source.</p>
<p><strong>Return</strong></p>
<p><em>true</em> if interrupt is enabled, <em>false</em> if interrupt is disabled or on
invalid parameters</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irqdomain_map">
int <code class="sig-name descname">amdgpu_irqdomain_map</code><span class="sig-paren">(</span>struct irq_domain<em> *d</em>, unsigned int<em> irq</em>, irq_hw_number_t<em> hwirq</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irqdomain_map" title="Permalink to this definition">¶</a></dt>
<dd><p>create mapping between virtual and hardware IRQ numbers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">irq_domain</span> <span class="pre">*d</span></code></dt><dd><p>amdgpu IRQ domain pointer (unused)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">irq</span></code></dt><dd><p>virtual IRQ number</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">irq_hw_number_t</span> <span class="pre">hwirq</span></code></dt><dd><p>hardware irq number</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Current implementation assigns simple interrupt handler to the given virtual
IRQ.</p>
<p><strong>Return</strong></p>
<p>0 on success or error code otherwise</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_add_domain">
int <code class="sig-name descname">amdgpu_irq_add_domain</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_add_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>create a linear IRQ domain</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates an IRQ domain for GPU interrupt sources
that may be driven by another driver (e.g., ACP).</p>
<p><strong>Return</strong></p>
<p>0 on success or error code otherwise</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_remove_domain">
void <code class="sig-name descname">amdgpu_irq_remove_domain</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_remove_domain" title="Permalink to this definition">¶</a></dt>
<dd><p>remove the IRQ domain</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Removes the IRQ domain for GPU interrupt sources
that may be driven by another driver (e.g., ACP).</p>
</div>
<dl class="function">
<dt id="c.amdgpu_irq_create_mapping">
unsigned <code class="sig-name descname">amdgpu_irq_create_mapping</code><span class="sig-paren">(</span>struct amdgpu_device<em> *adev</em>, unsigned<em> src_id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.amdgpu_irq_create_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>create mapping between domain Linux IRQs</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">amdgpu_device</span> <span class="pre">*adev</span></code></dt><dd><p>amdgpu device pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">src_id</span></code></dt><dd><p>IH source id</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates mapping between a domain IRQ (GPU IH src id) and a Linux IRQ
Use this for components that generate a GPU interrupt, but are driven
by a different driver (e.g., ACP).</p>
<p><strong>Return</strong></p>
<p>Linux IRQ</p>
</div>
</section>
<section id="ip-blocks">
<h2>IP Blocks<a class="headerlink" href="#ip-blocks" title="Permalink to this headline">¶</a></h2>
<p>GPUs are composed of IP (intellectual property) blocks. These
IP blocks provide various functionalities: display, graphics,
video decode, etc. The IP blocks that comprise a particular GPU
are listed in the GPU’s respective SoC file. amdgpu_device.c
acquires the list of IP blocks for the GPU in use on initialization.
It can then operate on this list to perform standard driver operations
such as: init, fini, suspend, resume, etc.</p>
<p>IP block implementations are named using the following convention:
&lt;functionality&gt;_v&lt;version&gt; (E.g.: gfx_v6_0).</p>
<dl class="type">
<dt id="c.amd_ip_block_type">
enum <code class="sig-name descname">amd_ip_block_type</code><a class="headerlink" href="#c.amd_ip_block_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Used to classify IP blocks by functionality.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_COMMON</span></code></dt><dd><p>GPU Family</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_GMC</span></code></dt><dd><p>Graphics Memory Controller</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_IH</span></code></dt><dd><p>Interrupt Handler</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_SMC</span></code></dt><dd><p>System Management Controller</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_PSP</span></code></dt><dd><p>Platform Security Processor</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_DCE</span></code></dt><dd><p>Display and Compositing Engine</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_GFX</span></code></dt><dd><p>Graphics and Compute Engine</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_SDMA</span></code></dt><dd><p>System DMA Engine</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_UVD</span></code></dt><dd><p>Unified Video Decoder</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_VCE</span></code></dt><dd><p>Video Compression Engine</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_ACP</span></code></dt><dd><p>Audio Co-Processor</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_VCN</span></code></dt><dd><p>Video Core/Codec Next</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_MES</span></code></dt><dd><p>Micro-Engine Scheduler</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_JPEG</span></code></dt><dd><p>JPEG Engine</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">AMD_IP_BLOCK_TYPE_NUM</span></code></dt><dd><p>Total number of IP block types</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.amd_ip_funcs">
struct <code class="sig-name descname">amd_ip_funcs</code><a class="headerlink" href="#c.amd_ip_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>general hooks for managing amdgpu IP Blocks</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct amd_ip_funcs {
    char *name;
    int (*early_init)(void *handle);
    int (*late_init)(void *handle);
    int (*sw_init)(void *handle);
    int (*sw_fini)(void *handle);
    int (*early_fini)(void *handle);
    int (*hw_init)(void *handle);
    int (*hw_fini)(void *handle);
    void (*late_fini)(void *handle);
    int (*suspend)(void *handle);
    int (*resume)(void *handle);
    bool (*is_idle)(void *handle);
    int (*wait_for_idle)(void *handle);
    bool (*check_soft_reset)(void *handle);
    int (*pre_soft_reset)(void *handle);
    int (*soft_reset)(void *handle);
    int (*post_soft_reset)(void *handle);
    int (*set_clockgating_state)(void *handle, enum amd_clockgating_state state);
    int (*set_powergating_state)(void *handle, enum amd_powergating_state state);
    void (*get_clockgating_state)(void *handle, u64 *flags);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Name of IP block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">early_init</span></code></dt><dd><p>sets up early driver state (pre sw_init),
does not configure hw - Optional</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">late_init</span></code></dt><dd><p>sets up late driver/hw state (post hw_init) - Optional</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sw_init</span></code></dt><dd><p>sets up driver state, does not configure hw</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sw_fini</span></code></dt><dd><p>tears down driver state, does not configure hw</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">early_fini</span></code></dt><dd><p>tears down stuff before dev detached from driver</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hw_init</span></code></dt><dd><p>sets up the hw state</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hw_fini</span></code></dt><dd><p>tears down the hw state</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">late_fini</span></code></dt><dd><p>final cleanup</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suspend</span></code></dt><dd><p>handles IP specific hw/sw changes for suspend</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">resume</span></code></dt><dd><p>handles IP specific hw/sw changes for resume</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_idle</span></code></dt><dd><p>returns current IP block idle status</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wait_for_idle</span></code></dt><dd><p>poll for idle</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">check_soft_reset</span></code></dt><dd><p>check soft reset the IP block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pre_soft_reset</span></code></dt><dd><p>pre soft reset the IP block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">soft_reset</span></code></dt><dd><p>soft reset the IP block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">post_soft_reset</span></code></dt><dd><p>post soft reset the IP block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_clockgating_state</span></code></dt><dd><p>enable/disable cg for the IP block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_powergating_state</span></code></dt><dd><p>enable/disable pg for the IP block</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">get_clockgating_state</span></code></dt><dd><p>get current clockgating status</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>These hooks provide an interface for controlling the operational state
of IP blocks. After acquiring a list of IP blocks for the GPU in use,
the driver can make chip-wide state changes by walking this list and
making calls to hooks from each IP block. This list is ordered to ensure
that the driver initializes the IP blocks in a safe sequence.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Core Driver Infrastructure</a><ul>
<li><a class="reference internal" href="#gpu-hardware-structure">GPU Hardware Structure</a><ul>
<li><a class="reference internal" href="#graphics-and-compute-microcontrollers">Graphics and Compute Microcontrollers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#driver-structure">Driver Structure</a></li>
<li><a class="reference internal" href="#memory-domains">Memory Domains</a></li>
<li><a class="reference internal" href="#buffer-objects">Buffer Objects</a></li>
<li><a class="reference internal" href="#prime-buffer-sharing">PRIME Buffer Sharing</a></li>
<li><a class="reference internal" href="#mmu-notifier">MMU Notifier</a></li>
<li><a class="reference internal" href="#amdgpu-virtual-memory">AMDGPU Virtual Memory</a></li>
<li><a class="reference internal" href="#interrupt-handling">Interrupt Handling</a></li>
<li><a class="reference internal" href="#ip-blocks">IP Blocks</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/gpu/amdgpu/driver-core.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/gpu/amdgpu/driver-core.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>