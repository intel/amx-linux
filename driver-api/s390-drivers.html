
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Writing s390 channel device drivers &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="VME Device Drivers" href="vme.html" />
    <link rel="prev" title="RapidIO subsystem Channelized Messaging character device driver (rio_cm.c)" href="rapidio/rio_cm.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="writing-s390-channel-device-drivers">
<h1>Writing s390 channel device drivers<a class="headerlink" href="#writing-s390-channel-device-drivers" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Cornelia Huck</p>
</dd>
</dl>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document describes the interfaces available for device drivers that
drive s390 based channel attached I/O devices. This includes interfaces
for interaction with the hardware and interfaces for interacting with
the common driver core. Those interfaces are provided by the s390 common
I/O layer.</p>
<p>The document assumes a familarity with the technical terms associated
with the s390 channel I/O architecture. For a description of this
architecture, please refer to the “z/Architecture: Principles of
Operation”, IBM publication no. SA22-7832.</p>
<p>While most I/O devices on a s390 system are typically driven through the
channel I/O mechanism described here, there are various other methods
(like the diag interface). These are out of the scope of this document.</p>
<p>The s390 common I/O layer also provides access to some devices that are
not strictly considered I/O devices. They are considered here as well,
although they are not the focus of this document.</p>
<p>Some additional information can also be found in the kernel source under
<a class="reference internal" href="../s390/driver-model.html"><span class="doc">S/390 driver model interfaces</span></a>.</p>
</section>
<section id="the-css-bus">
<h2>The css bus<a class="headerlink" href="#the-css-bus" title="Permalink to this headline">¶</a></h2>
<p>The css bus contains the subchannels available on the system. They fall
into several categories:</p>
<ul class="simple">
<li><p>Standard I/O subchannels, for use by the system. They have a child
device on the ccw bus and are described below.</p></li>
<li><p>I/O subchannels bound to the vfio-ccw driver. See
<a class="reference internal" href="../s390/vfio-ccw.html"><span class="doc">vfio-ccw: the basic infrastructure</span></a>.</p></li>
<li><p>Message subchannels. No Linux driver currently exists.</p></li>
<li><p>CHSC subchannels (at most one). The chsc subchannel driver can be used
to send asynchronous chsc commands.</p></li>
<li><p>eADM subchannels. Used for talking to storage class memory.</p></li>
</ul>
</section>
<section id="the-ccw-bus">
<h2>The ccw bus<a class="headerlink" href="#the-ccw-bus" title="Permalink to this headline">¶</a></h2>
<p>The ccw bus typically contains the majority of devices available to a
s390 system. Named after the channel command word (ccw), the basic
command structure used to address its devices, the ccw bus contains
so-called channel attached devices. They are addressed via I/O
subchannels, visible on the css bus. A device driver for
channel-attached devices, however, will never interact with the
subchannel directly, but only via the I/O device on the ccw bus, the ccw
device.</p>
<section id="i-o-functions-for-channel-attached-devices">
<h3>I/O functions for channel-attached devices<a class="headerlink" href="#i-o-functions-for-channel-attached-devices" title="Permalink to this headline">¶</a></h3>
<p>Some hardware structures have been translated into C structures for use
by the common I/O layer and device drivers. For more information on the
hardware structures represented here, please consult the Principles of
Operation.</p>
<dl class="type">
<dt id="c.ccw1">
struct <code class="sig-name descname">ccw1</code><a class="headerlink" href="#c.ccw1" title="Permalink to this definition">¶</a></dt>
<dd><p>channel command word</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct ccw1 {
    __u8 cmd_code;
    __u8 flags;
    __u16 count;
    __u32 cda;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cmd_code</span></code></dt><dd><p>command code</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>flags, like IDA addressing, etc.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt><dd><p>byte count</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cda</span></code></dt><dd><p>data address</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The ccw is the basic structure to build channel programs that perform
operations with the device or the control unit. Only Format-1 channel
command words are supported.</p>
<dl class="type">
<dt id="c.ccw0">
struct <code class="sig-name descname">ccw0</code><a class="headerlink" href="#c.ccw0" title="Permalink to this definition">¶</a></dt>
<dd><p>channel command word</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct ccw0 {
    __u8 cmd_code;
    __u32 cda : 24;
    __u8 flags;
    __u8 reserved;
    __u16 count;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cmd_code</span></code></dt><dd><p>command code</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cda</span></code></dt><dd><p>data address</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>flags, like IDA addressing, etc.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>will be ignored</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt><dd><p>byte count</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The format-0 ccw structure.</p>
<dl class="type">
<dt id="c.erw">
struct <code class="sig-name descname">erw</code><a class="headerlink" href="#c.erw" title="Permalink to this definition">¶</a></dt>
<dd><p>extended report word</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct erw {
    __u32 res0  : 3;
    __u32 auth  : 1;
    __u32 pvrf  : 1;
    __u32 cpt   : 1;
    __u32 fsavf : 1;
    __u32 cons  : 1;
    __u32 scavf : 1;
    __u32 fsaf  : 1;
    __u32 scnt  : 6;
    __u32 res16 : 16;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">res0</span></code></dt><dd><p>reserved</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">auth</span></code></dt><dd><p>authorization check</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pvrf</span></code></dt><dd><p>path-verification-required flag</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cpt</span></code></dt><dd><p>channel-path timeout</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fsavf</span></code></dt><dd><p>failing storage address validity flag</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cons</span></code></dt><dd><p>concurrent sense</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">scavf</span></code></dt><dd><p>secondary ccw address validity flag</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fsaf</span></code></dt><dd><p>failing storage address format</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">scnt</span></code></dt><dd><p>sense count, if <strong>cons</strong> == <code class="docutils literal notranslate"><span class="pre">1</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">res16</span></code></dt><dd><p>reserved</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.erw_eadm">
struct <code class="sig-name descname">erw_eadm</code><a class="headerlink" href="#c.erw_eadm" title="Permalink to this definition">¶</a></dt>
<dd><p>EADM Subchannel extended report word</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct erw_eadm {
    __u32 : 16;
    __u32 b : 1;
    __u32 r : 1;
    __u32 : 14;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">b</span></code></dt><dd><p>aob error</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">r</span></code></dt><dd><p>arsb error</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.sublog">
struct <code class="sig-name descname">sublog</code><a class="headerlink" href="#c.sublog" title="Permalink to this definition">¶</a></dt>
<dd><p>subchannel logout area</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct sublog {
    __u32 res0  : 1;
    __u32 esf   : 7;
    __u32 lpum  : 8;
    __u32 arep  : 1;
    __u32 fvf   : 5;
    __u32 sacc  : 2;
    __u32 termc : 2;
    __u32 devsc : 1;
    __u32 serr  : 1;
    __u32 ioerr : 1;
    __u32 seqc  : 3;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">res0</span></code></dt><dd><p>reserved</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">esf</span></code></dt><dd><p>extended status flags</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lpum</span></code></dt><dd><p>last path used mask</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">arep</span></code></dt><dd><p>ancillary report</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fvf</span></code></dt><dd><p>field-validity flags</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sacc</span></code></dt><dd><p>storage access code</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">termc</span></code></dt><dd><p>termination code</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">devsc</span></code></dt><dd><p>device-status check</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">serr</span></code></dt><dd><p>secondary error</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ioerr</span></code></dt><dd><p>i/o-error alert</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">seqc</span></code></dt><dd><p>sequence code</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.esw0">
struct <code class="sig-name descname">esw0</code><a class="headerlink" href="#c.esw0" title="Permalink to this definition">¶</a></dt>
<dd><p>Format 0 Extended Status Word (ESW)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct esw0 {
    struct sublog sublog;
    struct erw erw;
    __u32 faddr[2];
    __u32 saddr;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sublog</span></code></dt><dd><p>subchannel logout</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">erw</span></code></dt><dd><p>extended report word</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">faddr</span></code></dt><dd><p>failing storage address</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">saddr</span></code></dt><dd><p>secondary ccw address</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.esw1">
struct <code class="sig-name descname">esw1</code><a class="headerlink" href="#c.esw1" title="Permalink to this definition">¶</a></dt>
<dd><p>Format 1 Extended Status Word (ESW)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct esw1 {
    __u8 zero0;
    __u8 lpum;
    __u16 zero16;
    struct erw erw;
    __u32 zeros[3];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">zero0</span></code></dt><dd><p>reserved zeros</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lpum</span></code></dt><dd><p>last path used mask</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">zero16</span></code></dt><dd><p>reserved zeros</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">erw</span></code></dt><dd><p>extended report word</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">zeros</span></code></dt><dd><p>three fullwords of zeros</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.esw2">
struct <code class="sig-name descname">esw2</code><a class="headerlink" href="#c.esw2" title="Permalink to this definition">¶</a></dt>
<dd><p>Format 2 Extended Status Word (ESW)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct esw2 {
    __u8 zero0;
    __u8 lpum;
    __u16 dcti;
    struct erw erw;
    __u32 zeros[3];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">zero0</span></code></dt><dd><p>reserved zeros</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lpum</span></code></dt><dd><p>last path used mask</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dcti</span></code></dt><dd><p>device-connect-time interval</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">erw</span></code></dt><dd><p>extended report word</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">zeros</span></code></dt><dd><p>three fullwords of zeros</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.esw3">
struct <code class="sig-name descname">esw3</code><a class="headerlink" href="#c.esw3" title="Permalink to this definition">¶</a></dt>
<dd><p>Format 3 Extended Status Word (ESW)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct esw3 {
    __u8 zero0;
    __u8 lpum;
    __u16 res;
    struct erw erw;
    __u32 zeros[3];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">zero0</span></code></dt><dd><p>reserved zeros</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lpum</span></code></dt><dd><p>last path used mask</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">res</span></code></dt><dd><p>reserved</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">erw</span></code></dt><dd><p>extended report word</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">zeros</span></code></dt><dd><p>three fullwords of zeros</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.esw_eadm">
struct <code class="sig-name descname">esw_eadm</code><a class="headerlink" href="#c.esw_eadm" title="Permalink to this definition">¶</a></dt>
<dd><p>EADM Subchannel Extended Status Word (ESW)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct esw_eadm {
    __u32 sublog;
    struct erw_eadm erw;
    __u32 : 32;
    __u32 : 32;
    __u32 : 32;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sublog</span></code></dt><dd><p>subchannel logout</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">erw</span></code></dt><dd><p>extended report word</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.irb">
struct <code class="sig-name descname">irb</code><a class="headerlink" href="#c.irb" title="Permalink to this definition">¶</a></dt>
<dd><p>interruption response block</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct irb {
    union scsw scsw;
    union {
        struct esw0 esw0;
        struct esw1 esw1;
        struct esw2 esw2;
        struct esw3 esw3;
        struct esw_eadm eadm;
    } esw;
    __u8 ecw[32];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">scsw</span></code></dt><dd><p>subchannel status word</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">esw</span></code></dt><dd><p>extended status word</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ecw</span></code></dt><dd><p>extended control word</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The irb that is handed to the device driver when an interrupt occurs. For
solicited interrupts, the common I/O layer already performs checks whether
a field is valid; a field not being valid is always passed as <code class="docutils literal notranslate"><span class="pre">0</span></code>.
If a unit check occurred, <strong>ecw</strong> may contain sense data; this is retrieved
by the common I/O layer itself if the device doesn’t support concurrent
sense (so that the device driver never needs to perform basic sense itself).
For unsolicited interrupts, the irb is passed as-is (expect for sense data,
if applicable).</p>
<dl class="type">
<dt id="c.ciw">
struct <code class="sig-name descname">ciw</code><a class="headerlink" href="#c.ciw" title="Permalink to this definition">¶</a></dt>
<dd><p>command information word (CIW) layout</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct ciw {
    __u32 et       :  2;
    __u32 reserved :  2;
    __u32 ct       :  4;
    __u32 cmd      :  8;
    __u32 count    : 16;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">et</span></code></dt><dd><p>entry type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reserved</span></code></dt><dd><p>reserved bits</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ct</span></code></dt><dd><p>command type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cmd</span></code></dt><dd><p>command code</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt><dd><p>command count</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.ccw_dev_id">
struct <code class="sig-name descname">ccw_dev_id</code><a class="headerlink" href="#c.ccw_dev_id" title="Permalink to this definition">¶</a></dt>
<dd><p>unique identifier for ccw devices</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct ccw_dev_id {
    u8 ssid;
    u16 devno;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ssid</span></code></dt><dd><p>subchannel set id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">devno</span></code></dt><dd><p>device number</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>This structure is not directly based on any hardware structure. The
hardware identifies a device by its device number and its subchannel,
which is in turn identified by its id. In order to get a unique identifier
for ccw devices across subchannel sets, <strong>struct</strong> ccw_dev_id has been
introduced.</p>
<dl class="function">
<dt id="c.ccw_dev_id_is_equal">
int <code class="sig-name descname">ccw_dev_id_is_equal</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_dev_id" title="ccw_dev_id">ccw_dev_id</a><em> *dev_id1</em>, struct <a class="reference internal" href="#c.ccw_dev_id" title="ccw_dev_id">ccw_dev_id</a><em> *dev_id2</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_dev_id_is_equal" title="Permalink to this definition">¶</a></dt>
<dd><p>compare two ccw_dev_ids</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_dev_id</span> <span class="pre">*dev_id1</span></code></dt><dd><p>a ccw_dev_id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_dev_id</span> <span class="pre">*dev_id2</span></code></dt><dd><p>another ccw_dev_id</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">1</span></code> if the two structures are equal field-by-field,
<code class="docutils literal notranslate"><span class="pre">0</span></code> if not.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>any</p>
</div>
<dl class="function">
<dt id="c.pathmask_to_pos">
u8 <code class="sig-name descname">pathmask_to_pos</code><span class="sig-paren">(</span>u8<em> mask</em><span class="sig-paren">)</span><a class="headerlink" href="#c.pathmask_to_pos" title="Permalink to this definition">¶</a></dt>
<dd><p>find the position of the left-most bit in a pathmask</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">mask</span></code></dt><dd><p>pathmask with at least one bit set</p>
</dd>
</dl>
</div>
</section>
<section id="ccw-devices">
<h3>ccw devices<a class="headerlink" href="#ccw-devices" title="Permalink to this headline">¶</a></h3>
<p>Devices that want to initiate channel I/O need to attach to the ccw bus.
Interaction with the driver core is done via the common I/O layer, which
provides the abstractions of ccw devices and ccw device drivers.</p>
<p>The functions that initiate or terminate channel I/O all act upon a ccw
device structure. Device drivers must not bypass those functions or
strange side effects may happen.</p>
<dl class="type">
<dt id="c.ccw_device">
struct <code class="sig-name descname">ccw_device</code><a class="headerlink" href="#c.ccw_device" title="Permalink to this definition">¶</a></dt>
<dd><p>channel attached device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct ccw_device {
    spinlock_t *ccwlock;
    struct ccw_device_id id;
    struct ccw_driver *drv;
    struct device dev;
    int online;
    void (*handler) (struct ccw_device *, unsigned long, struct irb *);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ccwlock</span></code></dt><dd><p>pointer to device lock</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><p>id of this device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">drv</span></code></dt><dd><p>ccw driver for this device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt><dd><p>embedded device structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">online</span></code></dt><dd><p>online status of device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">handler</span></code></dt><dd><p>interrupt handler</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p><strong>handler</strong> is a member of the device rather than the driver since a driver
can have different interrupt handlers for different ccw devices
(multi-subchannel drivers).</p>
<dl class="type">
<dt id="c.ccw_driver">
struct <code class="sig-name descname">ccw_driver</code><a class="headerlink" href="#c.ccw_driver" title="Permalink to this definition">¶</a></dt>
<dd><p>device driver for channel attached devices</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct ccw_driver {
    struct ccw_device_id *ids;
    int (*probe) (struct ccw_device *);
    void (*remove) (struct ccw_device *);
    int (*set_online) (struct ccw_device *);
    int (*set_offline) (struct ccw_device *);
    int (*notify) (struct ccw_device *, int);
    void (*path_event) (struct ccw_device *, int *);
    void (*shutdown) (struct ccw_device *);
    enum uc_todo (*uc_handler) (struct ccw_device *, struct irb *);
    struct device_driver driver;
    enum interruption_class int_class;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ids</span></code></dt><dd><p>ids supported by this driver</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">probe</span></code></dt><dd><p>function called on probe</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">remove</span></code></dt><dd><p>function called on remove</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_online</span></code></dt><dd><p>called when setting device online</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_offline</span></code></dt><dd><p>called when setting device offline</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">notify</span></code></dt><dd><p>notify driver of device state changes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">path_event</span></code></dt><dd><p>notify driver of channel path events</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">shutdown</span></code></dt><dd><p>called at device shutdown</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uc_handler</span></code></dt><dd><p>callback for unit check handler</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">driver</span></code></dt><dd><p>embedded device driver structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int_class</span></code></dt><dd><p>interruption class to use for accounting interrupts</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.ccw_device_set_offline">
int <code class="sig-name descname">ccw_device_set_offline</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_set_offline" title="Permalink to this definition">¶</a></dt>
<dd><p>disable a ccw device for I/O</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function calls the driver’s set_offline() function for <strong>cdev</strong>, if
given, and then disables <strong>cdev</strong>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success and a negative error value on failure.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>enabled, ccw device lock not held</p>
</div>
<dl class="function">
<dt id="c.ccw_device_set_online">
int <code class="sig-name descname">ccw_device_set_online</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_set_online" title="Permalink to this definition">¶</a></dt>
<dd><p>enable a ccw device for I/O</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function first enables <strong>cdev</strong> and then calls the driver’s set_online()
function for <strong>cdev</strong>, if given. If set_online() returns an error, <strong>cdev</strong> is
disabled again.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success and a negative error value on failure.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>enabled, ccw device lock not held</p>
</div>
<dl class="function">
<dt id="c.get_ccwdev_by_dev_id">
struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a> * <code class="sig-name descname">get_ccwdev_by_dev_id</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_dev_id" title="ccw_dev_id">ccw_dev_id</a><em> *dev_id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.get_ccwdev_by_dev_id" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain device from a ccw device id</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_dev_id</span> <span class="pre">*dev_id</span></code></dt><dd><p>id of the device to be searched</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function searches all devices attached to the ccw bus for a device
matching <strong>dev_id</strong>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p>If a device is found its reference count is increased and returned;
else <code class="docutils literal notranslate"><span class="pre">NULL</span></code> is returned.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.get_ccwdev_by_busid">
struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a> * <code class="sig-name descname">get_ccwdev_by_busid</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_driver" title="ccw_driver">ccw_driver</a><em> *cdrv</em>, const char<em> *bus_id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.get_ccwdev_by_busid" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain device from a bus id</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_driver</span> <span class="pre">*cdrv</span></code></dt><dd><p>driver the device is owned by</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*bus_id</span></code></dt><dd><p>bus id of the device to be searched</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function searches all devices owned by <strong>cdrv</strong> for a device with a bus
id matching <strong>bus_id</strong>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p>If a match is found, its reference count of the found device is increased
and it is returned; else <code class="docutils literal notranslate"><span class="pre">NULL</span></code> is returned.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccw_driver_register">
int <code class="sig-name descname">ccw_driver_register</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_driver" title="ccw_driver">ccw_driver</a><em> *cdriver</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_driver_register" title="Permalink to this definition">¶</a></dt>
<dd><p>register a ccw driver</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_driver</span> <span class="pre">*cdriver</span></code></dt><dd><p>driver to be registered</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is mainly a wrapper around <a class="reference internal" href="infrastructure.html#c.driver_register" title="driver_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">driver_register()</span></code></a>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success and a negative error value on failure.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccw_driver_unregister">
void <code class="sig-name descname">ccw_driver_unregister</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_driver" title="ccw_driver">ccw_driver</a><em> *cdriver</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_driver_unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>deregister a ccw driver</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_driver</span> <span class="pre">*cdriver</span></code></dt><dd><p>driver to be deregistered</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is mainly a wrapper around <a class="reference internal" href="infrastructure.html#c.driver_unregister" title="driver_unregister"><code class="xref c c-func docutils literal notranslate"><span class="pre">driver_unregister()</span></code></a>.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_siosl">
int <code class="sig-name descname">ccw_device_siosl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_siosl" title="Permalink to this definition">¶</a></dt>
<dd><p>initiate logging</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is used to invoke model-dependent logging within the channel
subsystem.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_set_options_mask">
int <code class="sig-name descname">ccw_device_set_options_mask</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, unsigned long<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_set_options_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>set some options and unset the rest</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device for which the options are to be set</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">flags</span></code></dt><dd><p>options to be set</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>All flags specified in <strong>flags</strong> are set, all flags not specified in <strong>flags</strong>
are cleared.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success, -<code class="docutils literal notranslate"><span class="pre">EINVAL</span></code> on an invalid flag combination.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccw_device_set_options">
int <code class="sig-name descname">ccw_device_set_options</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, unsigned long<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_set_options" title="Permalink to this definition">¶</a></dt>
<dd><p>set some options</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device for which the options are to be set</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">flags</span></code></dt><dd><p>options to be set</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>All flags specified in <strong>flags</strong> are set, the remainder is left untouched.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success, -<code class="docutils literal notranslate"><span class="pre">EINVAL</span></code> if an invalid flag combination would ensue.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccw_device_clear_options">
void <code class="sig-name descname">ccw_device_clear_options</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, unsigned long<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_clear_options" title="Permalink to this definition">¶</a></dt>
<dd><p>clear some options</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device for which the options are to be cleared</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">flags</span></code></dt><dd><p>options to be cleared</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>All flags specified in <strong>flags</strong> are cleared, the remainder is left untouched.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_is_pathgroup">
int <code class="sig-name descname">ccw_device_is_pathgroup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_is_pathgroup" title="Permalink to this definition">¶</a></dt>
<dd><p>determine if paths to this device are grouped</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Return non-zero if there is a path group, zero otherwise.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_is_multipath">
int <code class="sig-name descname">ccw_device_is_multipath</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_is_multipath" title="Permalink to this definition">¶</a></dt>
<dd><p>determine if device is operating in multipath mode</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Return non-zero if device is operating in multipath mode, zero otherwise.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_clear">
int <code class="sig-name descname">ccw_device_clear</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, unsigned long<em> intparm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_clear" title="Permalink to this definition">¶</a></dt>
<dd><p>terminate I/O request processing</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>interruption parameter to be returned upon conclusion of csch</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p><a class="reference internal" href="#c.ccw_device_clear" title="ccw_device_clear"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_clear()</span></code></a> calls csch on <strong>cdev</strong>’s subchannel.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success,
-<code class="docutils literal notranslate"><span class="pre">ENODEV</span></code> on device not operational,
-<code class="docutils literal notranslate"><span class="pre">EINVAL</span></code> on invalid device state.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>Interrupts disabled, ccw device lock held</p>
</div>
<dl class="function">
<dt id="c.ccw_device_start_timeout_key">
int <code class="sig-name descname">ccw_device_start_timeout_key</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct <a class="reference internal" href="#c.ccw1" title="ccw1">ccw1</a><em> *cpa</em>, unsigned long<em> intparm</em>, __u8<em> lpm</em>, __u8<em> key</em>, unsigned long<em> flags</em>, int<em> expires</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_start_timeout_key" title="Permalink to this definition">¶</a></dt>
<dd><p>start a s390 channel program with timeout and key</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw1</span> <span class="pre">*cpa</span></code></dt><dd><p>logical start address of channel program</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>user specific interruption parameter; will be presented back to
<strong>cdev</strong>’s interrupt handler. Allows a device driver to associate
the interrupt with a particular I/O request.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__u8</span> <span class="pre">lpm</span></code></dt><dd><p>defines the channel path to be used for a specific I/O request. A
value of 0 will make cio use the opm.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__u8</span> <span class="pre">key</span></code></dt><dd><p>storage key to be used for the I/O</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">flags</span></code></dt><dd><p>additional flags; defines the action to be performed for I/O
processing.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">expires</span></code></dt><dd><p>timeout value in jiffies</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start a S/390 channel program. When the interrupt arrives, the
IRQ handler is called, either immediately, delayed (dev-end missing,
or sense required) or never (no IRQ handler registered).
This function notifies the device driver if the channel program has not
completed during the time specified by <strong>expires</strong>. If a timeout occurs, the
channel program is terminated via xsch, hsch or csch, and the device’s
interrupt handler will be called with an irb containing ERR_PTR(-<code class="docutils literal notranslate"><span class="pre">ETIMEDOUT</span></code>).
The interruption handler will echo back the <strong>intparm</strong> specified here, unless
another interruption parameter is specified by a subsequent invocation of
<a class="reference internal" href="#c.ccw_device_halt" title="ccw_device_halt"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_halt()</span></code></a> or <a class="reference internal" href="#c.ccw_device_clear" title="ccw_device_clear"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_clear()</span></code></a>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code>, if the operation was successful;
-<code class="docutils literal notranslate"><span class="pre">EBUSY</span></code>, if the device is busy, or status pending;
-<code class="docutils literal notranslate"><span class="pre">EACCES</span></code>, if no path specified in <strong>lpm</strong> is operational;
-<code class="docutils literal notranslate"><span class="pre">ENODEV</span></code>, if the device is not operational.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>Interrupts disabled, ccw device lock held</p>
</div>
<dl class="function">
<dt id="c.ccw_device_start_key">
int <code class="sig-name descname">ccw_device_start_key</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct <a class="reference internal" href="#c.ccw1" title="ccw1">ccw1</a><em> *cpa</em>, unsigned long<em> intparm</em>, __u8<em> lpm</em>, __u8<em> key</em>, unsigned long<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_start_key" title="Permalink to this definition">¶</a></dt>
<dd><p>start a s390 channel program with key</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw1</span> <span class="pre">*cpa</span></code></dt><dd><p>logical start address of channel program</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>user specific interruption parameter; will be presented back to
<strong>cdev</strong>’s interrupt handler. Allows a device driver to associate
the interrupt with a particular I/O request.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__u8</span> <span class="pre">lpm</span></code></dt><dd><p>defines the channel path to be used for a specific I/O request. A
value of 0 will make cio use the opm.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__u8</span> <span class="pre">key</span></code></dt><dd><p>storage key to be used for the I/O</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">flags</span></code></dt><dd><p>additional flags; defines the action to be performed for I/O
processing.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start a S/390 channel program. When the interrupt arrives, the
IRQ handler is called, either immediately, delayed (dev-end missing,
or sense required) or never (no IRQ handler registered).
The interruption handler will echo back the <strong>intparm</strong> specified here, unless
another interruption parameter is specified by a subsequent invocation of
<a class="reference internal" href="#c.ccw_device_halt" title="ccw_device_halt"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_halt()</span></code></a> or <a class="reference internal" href="#c.ccw_device_clear" title="ccw_device_clear"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_clear()</span></code></a>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code>, if the operation was successful;
-<code class="docutils literal notranslate"><span class="pre">EBUSY</span></code>, if the device is busy, or status pending;
-<code class="docutils literal notranslate"><span class="pre">EACCES</span></code>, if no path specified in <strong>lpm</strong> is operational;
-<code class="docutils literal notranslate"><span class="pre">ENODEV</span></code>, if the device is not operational.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>Interrupts disabled, ccw device lock held</p>
</div>
<dl class="function">
<dt id="c.ccw_device_start">
int <code class="sig-name descname">ccw_device_start</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct <a class="reference internal" href="#c.ccw1" title="ccw1">ccw1</a><em> *cpa</em>, unsigned long<em> intparm</em>, __u8<em> lpm</em>, unsigned long<em> flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_start" title="Permalink to this definition">¶</a></dt>
<dd><p>start a s390 channel program</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw1</span> <span class="pre">*cpa</span></code></dt><dd><p>logical start address of channel program</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>user specific interruption parameter; will be presented back to
<strong>cdev</strong>’s interrupt handler. Allows a device driver to associate
the interrupt with a particular I/O request.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__u8</span> <span class="pre">lpm</span></code></dt><dd><p>defines the channel path to be used for a specific I/O request. A
value of 0 will make cio use the opm.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">flags</span></code></dt><dd><p>additional flags; defines the action to be performed for I/O
processing.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start a S/390 channel program. When the interrupt arrives, the
IRQ handler is called, either immediately, delayed (dev-end missing,
or sense required) or never (no IRQ handler registered).
The interruption handler will echo back the <strong>intparm</strong> specified here, unless
another interruption parameter is specified by a subsequent invocation of
<a class="reference internal" href="#c.ccw_device_halt" title="ccw_device_halt"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_halt()</span></code></a> or <a class="reference internal" href="#c.ccw_device_clear" title="ccw_device_clear"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_clear()</span></code></a>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code>, if the operation was successful;
-<code class="docutils literal notranslate"><span class="pre">EBUSY</span></code>, if the device is busy, or status pending;
-<code class="docutils literal notranslate"><span class="pre">EACCES</span></code>, if no path specified in <strong>lpm</strong> is operational;
-<code class="docutils literal notranslate"><span class="pre">ENODEV</span></code>, if the device is not operational.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>Interrupts disabled, ccw device lock held</p>
</div>
<dl class="function">
<dt id="c.ccw_device_start_timeout">
int <code class="sig-name descname">ccw_device_start_timeout</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct <a class="reference internal" href="#c.ccw1" title="ccw1">ccw1</a><em> *cpa</em>, unsigned long<em> intparm</em>, __u8<em> lpm</em>, unsigned long<em> flags</em>, int<em> expires</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_start_timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>start a s390 channel program with timeout</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw1</span> <span class="pre">*cpa</span></code></dt><dd><p>logical start address of channel program</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>user specific interruption parameter; will be presented back to
<strong>cdev</strong>’s interrupt handler. Allows a device driver to associate
the interrupt with a particular I/O request.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__u8</span> <span class="pre">lpm</span></code></dt><dd><p>defines the channel path to be used for a specific I/O request. A
value of 0 will make cio use the opm.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">flags</span></code></dt><dd><p>additional flags; defines the action to be performed for I/O
processing.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">expires</span></code></dt><dd><p>timeout value in jiffies</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start a S/390 channel program. When the interrupt arrives, the
IRQ handler is called, either immediately, delayed (dev-end missing,
or sense required) or never (no IRQ handler registered).
This function notifies the device driver if the channel program has not
completed during the time specified by <strong>expires</strong>. If a timeout occurs, the
channel program is terminated via xsch, hsch or csch, and the device’s
interrupt handler will be called with an irb containing ERR_PTR(-<code class="docutils literal notranslate"><span class="pre">ETIMEDOUT</span></code>).
The interruption handler will echo back the <strong>intparm</strong> specified here, unless
another interruption parameter is specified by a subsequent invocation of
<a class="reference internal" href="#c.ccw_device_halt" title="ccw_device_halt"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_halt()</span></code></a> or <a class="reference internal" href="#c.ccw_device_clear" title="ccw_device_clear"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_clear()</span></code></a>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code>, if the operation was successful;
-<code class="docutils literal notranslate"><span class="pre">EBUSY</span></code>, if the device is busy, or status pending;
-<code class="docutils literal notranslate"><span class="pre">EACCES</span></code>, if no path specified in <strong>lpm</strong> is operational;
-<code class="docutils literal notranslate"><span class="pre">ENODEV</span></code>, if the device is not operational.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>Interrupts disabled, ccw device lock held</p>
</div>
<dl class="function">
<dt id="c.ccw_device_halt">
int <code class="sig-name descname">ccw_device_halt</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, unsigned long<em> intparm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_halt" title="Permalink to this definition">¶</a></dt>
<dd><p>halt I/O request processing</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>interruption parameter to be returned upon conclusion of hsch</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p><a class="reference internal" href="#c.ccw_device_halt" title="ccw_device_halt"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_halt()</span></code></a> calls hsch on <strong>cdev</strong>’s subchannel.
The interruption handler will echo back the <strong>intparm</strong> specified here, unless
another interruption parameter is specified by a subsequent invocation of
<a class="reference internal" href="#c.ccw_device_clear" title="ccw_device_clear"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_clear()</span></code></a>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success,
-<code class="docutils literal notranslate"><span class="pre">ENODEV</span></code> on device not operational,
-<code class="docutils literal notranslate"><span class="pre">EINVAL</span></code> on invalid device state,
-<code class="docutils literal notranslate"><span class="pre">EBUSY</span></code> on device busy or interrupt pending.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>Interrupts disabled, ccw device lock held</p>
</div>
<dl class="function">
<dt id="c.ccw_device_resume">
int <code class="sig-name descname">ccw_device_resume</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_resume" title="Permalink to this definition">¶</a></dt>
<dd><p>resume channel program execution</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>target ccw device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p><a class="reference internal" href="#c.ccw_device_resume" title="ccw_device_resume"><code class="xref c c-func docutils literal notranslate"><span class="pre">ccw_device_resume()</span></code></a> calls rsch on <strong>cdev</strong>’s subchannel.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success,
-<code class="docutils literal notranslate"><span class="pre">ENODEV</span></code> on device not operational,
-<code class="docutils literal notranslate"><span class="pre">EINVAL</span></code> on invalid device state,
-<code class="docutils literal notranslate"><span class="pre">EBUSY</span></code> on device busy or interrupt pending.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>Interrupts disabled, ccw device lock held</p>
</div>
<dl class="function">
<dt id="c.ccw_device_get_ciw">
struct <a class="reference internal" href="#c.ciw" title="ciw">ciw</a> * <code class="sig-name descname">ccw_device_get_ciw</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, __u32<em> ct</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_ciw" title="Permalink to this definition">¶</a></dt>
<dd><p>Search for CIW command in extended sense data.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device to inspect</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__u32</span> <span class="pre">ct</span></code></dt><dd><p>command type to look for</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>During SenseID, command information words (CIWs) describing special
commands available to the device may have been stored in the extended
sense data. This function searches for CIWs of a specified command
type in the extended sense data.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">NULL</span></code> if no extended sense data has been stored or if no CIW of the
specified command type could be found,
else a pointer to the CIW of the specified command type.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccw_device_get_path_mask">
__u8 <code class="sig-name descname">ccw_device_get_path_mask</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_path_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>get currently available paths</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device to be queried</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> if no subchannel for the device is available,
else the mask of currently available paths for the ccw device’s subchannel.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccw_device_get_chp_desc">
struct channel_path_desc_fmt0 * <code class="sig-name descname">ccw_device_get_chp_desc</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, int<em> chp_idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_chp_desc" title="Permalink to this definition">¶</a></dt>
<dd><p>return newly allocated channel-path descriptor</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device to obtain the descriptor for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">chp_idx</span></code></dt><dd><p>index of the channel path</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>On success return a newly allocated copy of the channel-path description
data associated with the given channel path. Return <code class="docutils literal notranslate"><span class="pre">NULL</span></code> on error.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_get_util_str">
u8 * <code class="sig-name descname">ccw_device_get_util_str</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, int<em> chp_idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_util_str" title="Permalink to this definition">¶</a></dt>
<dd><p>return newly allocated utility strings</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device to obtain the utility strings for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">chp_idx</span></code></dt><dd><p>index of the channel path</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>On success return a newly allocated copy of the utility strings
associated with the given channel path. Return <code class="docutils literal notranslate"><span class="pre">NULL</span></code> on error.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_get_id">
void <code class="sig-name descname">ccw_device_get_id</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct <a class="reference internal" href="#c.ccw_dev_id" title="ccw_dev_id">ccw_dev_id</a><em> *dev_id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_id" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain a ccw device id</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device to obtain the id for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_dev_id</span> <span class="pre">*dev_id</span></code></dt><dd><p>where to fill in the values</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.ccw_device_tm_start_timeout_key">
int <code class="sig-name descname">ccw_device_tm_start_timeout_key</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct tcw<em> *tcw</em>, unsigned long<em> intparm</em>, u8<em> lpm</em>, u8<em> key</em>, int<em> expires</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_tm_start_timeout_key" title="Permalink to this definition">¶</a></dt>
<dd><p>perform start function</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device on which to perform the start function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tcw</span> <span class="pre">*tcw</span></code></dt><dd><p>transport-command word to be started</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>user defined parameter to be passed to the interrupt handler</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">lpm</span></code></dt><dd><p>mask of paths to use</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">key</span></code></dt><dd><p>storage key to use for storage access</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">expires</span></code></dt><dd><p>time span in jiffies after which to abort request</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start the tcw on the given ccw device. Return zero on success, non-zero
otherwise.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_tm_start_key">
int <code class="sig-name descname">ccw_device_tm_start_key</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct tcw<em> *tcw</em>, unsigned long<em> intparm</em>, u8<em> lpm</em>, u8<em> key</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_tm_start_key" title="Permalink to this definition">¶</a></dt>
<dd><p>perform start function</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device on which to perform the start function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tcw</span> <span class="pre">*tcw</span></code></dt><dd><p>transport-command word to be started</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>user defined parameter to be passed to the interrupt handler</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">lpm</span></code></dt><dd><p>mask of paths to use</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">key</span></code></dt><dd><p>storage key to use for storage access</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start the tcw on the given ccw device. Return zero on success, non-zero
otherwise.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_tm_start">
int <code class="sig-name descname">ccw_device_tm_start</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct tcw<em> *tcw</em>, unsigned long<em> intparm</em>, u8<em> lpm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_tm_start" title="Permalink to this definition">¶</a></dt>
<dd><p>perform start function</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device on which to perform the start function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tcw</span> <span class="pre">*tcw</span></code></dt><dd><p>transport-command word to be started</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>user defined parameter to be passed to the interrupt handler</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">lpm</span></code></dt><dd><p>mask of paths to use</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start the tcw on the given ccw device. Return zero on success, non-zero
otherwise.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_tm_start_timeout">
int <code class="sig-name descname">ccw_device_tm_start_timeout</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct tcw<em> *tcw</em>, unsigned long<em> intparm</em>, u8<em> lpm</em>, int<em> expires</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_tm_start_timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>perform start function</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device on which to perform the start function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tcw</span> <span class="pre">*tcw</span></code></dt><dd><p>transport-command word to be started</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">intparm</span></code></dt><dd><p>user defined parameter to be passed to the interrupt handler</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">lpm</span></code></dt><dd><p>mask of paths to use</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">expires</span></code></dt><dd><p>time span in jiffies after which to abort request</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start the tcw on the given ccw device. Return zero on success, non-zero
otherwise.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_get_mdc">
int <code class="sig-name descname">ccw_device_get_mdc</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, u8<em> mask</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_mdc" title="Permalink to this definition">¶</a></dt>
<dd><p>accumulate max data count</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device for which the max data count is accumulated</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">mask</span></code></dt><dd><p>mask of paths to use</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Return the number of 64K-bytes blocks all paths at least support
for a transport command. Return value 0 indicates failure.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_tm_intrg">
int <code class="sig-name descname">ccw_device_tm_intrg</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_tm_intrg" title="Permalink to this definition">¶</a></dt>
<dd><p>perform interrogate function</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device on which to perform the interrogate function</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform an interrogate function on the given ccw device. Return zero on
success, non-zero otherwise.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_get_schid">
void <code class="sig-name descname">ccw_device_get_schid</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct subchannel_id<em> *schid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_schid" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain a subchannel id</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device to obtain the id for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">subchannel_id</span> <span class="pre">*schid</span></code></dt><dd><p>where to fill in the values</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.ccw_device_pnso">
int <code class="sig-name descname">ccw_device_pnso</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct chsc_pnso_area<em> *pnso_area</em>, u8<em> oc</em>, struct chsc_pnso_resume_token<em> resume_token</em>, int<em> cnc</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_pnso" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform Network-Subchannel Operation</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device on which PNSO is performed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">chsc_pnso_area</span> <span class="pre">*pnso_area</span></code></dt><dd><p>request and response block for the operation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">oc</span></code></dt><dd><p>Operation Code</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">chsc_pnso_resume_token</span> <span class="pre">resume_token</span></code></dt><dd><p>resume token for multiblock response</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">cnc</span></code></dt><dd><p>Boolean change-notification control</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>pnso_area must be allocated by the caller with get_zeroed_page(GFP_KERNEL)</p>
<p>Returns 0 on success.</p>
</div>
<dl class="function">
<dt id="c.ccw_device_get_cssid">
int <code class="sig-name descname">ccw_device_get_cssid</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, u8<em> *cssid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_cssid" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain Channel Subsystem ID</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device to obtain the CSSID for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*cssid</span></code></dt><dd><p>The resulting Channel Subsystem ID</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.ccw_device_get_iid">
int <code class="sig-name descname">ccw_device_get_iid</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, u8<em> *iid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_iid" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain MIF-image ID</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device to obtain the MIF-image ID for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*iid</span></code></dt><dd><p>The resulting MIF-image ID</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.ccw_device_get_chpid">
int <code class="sig-name descname">ccw_device_get_chpid</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, int<em> chp_idx</em>, u8<em> *chpid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_chpid" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain Channel Path ID</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device to obtain the Channel Path ID for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">chp_idx</span></code></dt><dd><p>Index of the channel path</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*chpid</span></code></dt><dd><p>The resulting Channel Path ID</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.ccw_device_get_chid">
int <code class="sig-name descname">ccw_device_get_chid</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, int<em> chp_idx</em>, u16<em> *chid</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccw_device_get_chid" title="Permalink to this definition">¶</a></dt>
<dd><p>obtain Channel ID associated with specified CHPID</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>device to obtain the Channel ID for</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">chp_idx</span></code></dt><dd><p>Index of the channel path</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u16</span> <span class="pre">*chid</span></code></dt><dd><p>The resulting Channel ID</p>
</dd>
</dl>
</div>
</section>
<section id="the-channel-measurement-facility">
<h3>The channel-measurement facility<a class="headerlink" href="#the-channel-measurement-facility" title="Permalink to this headline">¶</a></h3>
<p>The channel-measurement facility provides a means to collect measurement
data which is made available by the channel subsystem for each channel
attached device.</p>
<dl class="type">
<dt id="c.cmbdata">
struct <code class="sig-name descname">cmbdata</code><a class="headerlink" href="#c.cmbdata" title="Permalink to this definition">¶</a></dt>
<dd><p>channel measurement block data for user space</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct cmbdata {
    __u64 size;
    __u64 elapsed_time;
    __u64 ssch_rsch_count;
    __u64 sample_count;
    __u64 device_connect_time;
    __u64 function_pending_time;
    __u64 device_disconnect_time;
    __u64 control_unit_queuing_time;
    __u64 device_active_only_time;
    __u64 device_busy_time;
    __u64 initial_command_response_time;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>size of the stored data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">elapsed_time</span></code></dt><dd><p>time since last sampling</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssch_rsch_count</span></code></dt><dd><p>number of ssch and rsch</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sample_count</span></code></dt><dd><p>number of samples</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device_connect_time</span></code></dt><dd><p>time of device connect</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">function_pending_time</span></code></dt><dd><p>time of function pending</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device_disconnect_time</span></code></dt><dd><p>time of device disconnect</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">control_unit_queuing_time</span></code></dt><dd><p>time of control unit queuing</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device_active_only_time</span></code></dt><dd><p>time of device active only</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device_busy_time</span></code></dt><dd><p>time of device busy (ext. format)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">initial_command_response_time</span></code></dt><dd><p>initial command response time (ext. format)</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>All values are stored as 64 bit for simplicity, especially
in 32 bit emulation mode. All time values are normalized to
nanoseconds.
Currently, two formats are known, which differ by the size of
this structure, i.e. the last two members are only set when
the extended channel measurement facility (first shipped in
z990 machines) is activated.
Potentially, more fields could be added, which would result in a
new ioctl number.</p>
<dl class="function">
<dt id="c.enable_cmf">
int <code class="sig-name descname">enable_cmf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.enable_cmf" title="Permalink to this definition">¶</a></dt>
<dd><p>switch on the channel measurement for a specific device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>The ccw device to be enabled</p>
<p>Enable channel measurements for <strong>cdev</strong>. If this is called on a device
for which channel measurement is already enabled a reset of the
measurement data is triggered.</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">0</span></code> for success or a negative error value.</p>
<p><strong>Context</strong></p>
<p>non-atomic</p>
</div>
<dl class="function">
<dt id="c.disable_cmf">
int <code class="sig-name descname">disable_cmf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.disable_cmf" title="Permalink to this definition">¶</a></dt>
<dd><p>switch off the channel measurement for a specific device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>The ccw device to be disabled</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">0</span></code> for success or a negative error value.</p>
<p><strong>Context</strong></p>
<p>non-atomic</p>
</div>
<dl class="function">
<dt id="c.cmf_read">
u64 <code class="sig-name descname">cmf_read</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, int<em> index</em><span class="sig-paren">)</span><a class="headerlink" href="#c.cmf_read" title="Permalink to this definition">¶</a></dt>
<dd><p>read one value from the current channel measurement block</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>the channel to be read</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">index</span></code></dt><dd><p>the index of the value to be read</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>The value read or <code class="docutils literal notranslate"><span class="pre">0</span></code> if the value cannot be read.</p>
<p><strong>Context</strong></p>
<p>any</p>
</div>
<dl class="function">
<dt id="c.cmf_readall">
int <code class="sig-name descname">cmf_readall</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em>, struct <a class="reference internal" href="#c.cmbdata" title="cmbdata">cmbdata</a><em> *data</em><span class="sig-paren">)</span><a class="headerlink" href="#c.cmf_readall" title="Permalink to this definition">¶</a></dt>
<dd><p>read the current channel measurement block</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>the channel to be read</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">cmbdata</span> <span class="pre">*data</span></code></dt><dd><p>a pointer to a data block that will be filled</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success, a negative error value otherwise.</p>
<p><strong>Context</strong></p>
<p>any</p>
</div>
</section>
</section>
<section id="the-ccwgroup-bus">
<h2>The ccwgroup bus<a class="headerlink" href="#the-ccwgroup-bus" title="Permalink to this headline">¶</a></h2>
<p>The ccwgroup bus only contains artificial devices, created by the user.
Many networking devices (e.g. qeth) are in fact composed of several ccw
devices (like read, write and data channel for qeth). The ccwgroup bus
provides a mechanism to create a meta-device which contains those ccw
devices as slave devices and can be associated with the netdevice.</p>
<section id="ccw-group-devices">
<h3>ccw group devices<a class="headerlink" href="#ccw-group-devices" title="Permalink to this headline">¶</a></h3>
<dl class="type">
<dt id="c.ccwgroup_device">
struct <code class="sig-name descname">ccwgroup_device</code><a class="headerlink" href="#c.ccwgroup_device" title="Permalink to this definition">¶</a></dt>
<dd><p>ccw group device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct ccwgroup_device {
    enum {
        CCWGROUP_OFFLINE,
        CCWGROUP_ONLINE,
    } state;
    unsigned int count;
    struct device   dev;
    struct work_struct ungroup_work;
    struct ccw_device *cdev[];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">state</span></code></dt><dd><p>online/offline state</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt><dd><p>number of attached slave devices</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt><dd><p>embedded device structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ungroup_work</span></code></dt><dd><p>used to ungroup the ccwgroup device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cdev</span></code></dt><dd><p>variable number of slave devices, allocated as needed</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.ccwgroup_driver">
struct <code class="sig-name descname">ccwgroup_driver</code><a class="headerlink" href="#c.ccwgroup_driver" title="Permalink to this definition">¶</a></dt>
<dd><p>driver for ccw group devices</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct ccwgroup_driver {
    int (*setup) (struct ccwgroup_device *);
    void (*remove) (struct ccwgroup_device *);
    int (*set_online) (struct ccwgroup_device *);
    int (*set_offline) (struct ccwgroup_device *);
    void (*shutdown)(struct ccwgroup_device *);
    struct device_driver driver;
    struct ccw_driver *ccw_driver;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">setup</span></code></dt><dd><p>function called during device creation to setup the device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">remove</span></code></dt><dd><p>function called on remove</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_online</span></code></dt><dd><p>function called when device is set online</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_offline</span></code></dt><dd><p>function called when device is set offline</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">shutdown</span></code></dt><dd><p>function called when device is shut down</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">driver</span></code></dt><dd><p>embedded driver structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ccw_driver</span></code></dt><dd><p>supported ccw_driver (optional)</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.ccwgroup_set_online">
int <code class="sig-name descname">ccwgroup_set_online</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccwgroup_device" title="ccwgroup_device">ccwgroup_device</a><em> *gdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccwgroup_set_online" title="Permalink to this definition">¶</a></dt>
<dd><p>enable a ccwgroup device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccwgroup_device</span> <span class="pre">*gdev</span></code></dt><dd><p>target ccwgroup device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function attempts to put the ccwgroup device into the online state.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success and a negative error value on failure.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccwgroup_set_offline">
int <code class="sig-name descname">ccwgroup_set_offline</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccwgroup_device" title="ccwgroup_device">ccwgroup_device</a><em> *gdev</em>, bool<em> call_gdrv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccwgroup_set_offline" title="Permalink to this definition">¶</a></dt>
<dd><p>disable a ccwgroup device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccwgroup_device</span> <span class="pre">*gdev</span></code></dt><dd><p>target ccwgroup device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">call_gdrv</span></code></dt><dd><p>Call the registered gdrv set_offline function</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function attempts to put the ccwgroup device into the offline state.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success and a negative error value on failure.</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccwgroup_create_dev">
int <code class="sig-name descname">ccwgroup_create_dev</code><span class="sig-paren">(</span>struct <a class="reference internal" href="infrastructure.html#c.device" title="device">device</a><em> *parent</em>, struct <a class="reference internal" href="#c.ccwgroup_driver" title="ccwgroup_driver">ccwgroup_driver</a><em> *gdrv</em>, int<em> num_devices</em>, const char<em> *buf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccwgroup_create_dev" title="Permalink to this definition">¶</a></dt>
<dd><p>create and register a ccw group device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*parent</span></code></dt><dd><p>parent device for the new device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccwgroup_driver</span> <span class="pre">*gdrv</span></code></dt><dd><p>driver for the new group device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">num_devices</span></code></dt><dd><p>number of slave devices</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*buf</span></code></dt><dd><p>buffer containing comma separated bus ids of slave devices</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Create and register a new ccw group device as a child of <strong>parent</strong>. Slave
devices are obtained from the list of bus ids given in <strong>buf</strong>.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">0</span></code> on success and an error code on failure.</p>
</div></blockquote>
<p><strong>Context</strong></p>
<p>non-atomic</p>
</div>
<dl class="function">
<dt id="c.ccwgroup_driver_register">
int <code class="sig-name descname">ccwgroup_driver_register</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccwgroup_driver" title="ccwgroup_driver">ccwgroup_driver</a><em> *cdriver</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccwgroup_driver_register" title="Permalink to this definition">¶</a></dt>
<dd><p>register a ccw group driver</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccwgroup_driver</span> <span class="pre">*cdriver</span></code></dt><dd><p>driver to be registered</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is mainly a wrapper around <a class="reference internal" href="infrastructure.html#c.driver_register" title="driver_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">driver_register()</span></code></a>.</p>
</div>
<dl class="function">
<dt id="c.ccwgroup_driver_unregister">
void <code class="sig-name descname">ccwgroup_driver_unregister</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccwgroup_driver" title="ccwgroup_driver">ccwgroup_driver</a><em> *cdriver</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccwgroup_driver_unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>deregister a ccw group driver</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccwgroup_driver</span> <span class="pre">*cdriver</span></code></dt><dd><p>driver to be deregistered</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function is mainly a wrapper around <a class="reference internal" href="infrastructure.html#c.driver_unregister" title="driver_unregister"><code class="xref c c-func docutils literal notranslate"><span class="pre">driver_unregister()</span></code></a>.</p>
</div>
<dl class="function">
<dt id="c.ccwgroup_probe_ccwdev">
int <code class="sig-name descname">ccwgroup_probe_ccwdev</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccwgroup_probe_ccwdev" title="Permalink to this definition">¶</a></dt>
<dd><p>probe function for slave devices</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device to be probed</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a dummy probe function for ccw devices that are slave devices in
a ccw group device.</p>
<p><strong>Return</strong></p>
<blockquote>
<div><p>always <code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.ccwgroup_remove_ccwdev">
void <code class="sig-name descname">ccwgroup_remove_ccwdev</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.ccw_device" title="ccw_device">ccw_device</a><em> *cdev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.ccwgroup_remove_ccwdev" title="Permalink to this definition">¶</a></dt>
<dd><p>remove function for slave devices</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ccw_device</span> <span class="pre">*cdev</span></code></dt><dd><p>ccw device to be removed</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a remove function for ccw devices that are slave devices in a ccw
group device. It sets the ccw device offline and also deregisters the
embedding ccw group device.</p>
</div>
</section>
</section>
<section id="generic-interfaces">
<h2>Generic interfaces<a class="headerlink" href="#generic-interfaces" title="Permalink to this headline">¶</a></h2>
<p>The following section contains interfaces in use not only by drivers
dealing with ccw devices, but drivers for various other s390 hardware
as well.</p>
<section id="adapter-interrupts">
<h3>Adapter interrupts<a class="headerlink" href="#adapter-interrupts" title="Permalink to this headline">¶</a></h3>
<p>The common I/O layer provides helper functions for dealing with adapter
interrupts and interrupt vectors.</p>
<dl class="function">
<dt id="c.register_adapter_interrupt">
int <code class="sig-name descname">register_adapter_interrupt</code><span class="sig-paren">(</span>struct airq_struct<em> *airq</em><span class="sig-paren">)</span><a class="headerlink" href="#c.register_adapter_interrupt" title="Permalink to this definition">¶</a></dt>
<dd><p>register adapter interrupt handler</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">airq_struct</span> <span class="pre">*airq</span></code></dt><dd><p>pointer to adapter interrupt descriptor</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns 0 on success, or -EINVAL.</p>
</div>
<dl class="function">
<dt id="c.unregister_adapter_interrupt">
void <code class="sig-name descname">unregister_adapter_interrupt</code><span class="sig-paren">(</span>struct airq_struct<em> *airq</em><span class="sig-paren">)</span><a class="headerlink" href="#c.unregister_adapter_interrupt" title="Permalink to this definition">¶</a></dt>
<dd><p>unregister adapter interrupt handler</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">airq_struct</span> <span class="pre">*airq</span></code></dt><dd><p>pointer to adapter interrupt descriptor</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.airq_iv_create">
struct airq_iv * <code class="sig-name descname">airq_iv_create</code><span class="sig-paren">(</span>unsigned long<em> bits</em>, unsigned long<em> flags</em>, unsigned long<em> *vec</em><span class="sig-paren">)</span><a class="headerlink" href="#c.airq_iv_create" title="Permalink to this definition">¶</a></dt>
<dd><p>create an interrupt vector</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">bits</span></code></dt><dd><p>number of bits in the interrupt vector</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">flags</span></code></dt><dd><p>allocation flags</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">*vec</span></code></dt><dd><p>pointer to pinned guest memory if AIRQ_IV_GUESTVEC</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns a pointer to an interrupt vector structure</p>
</div>
<dl class="function">
<dt id="c.airq_iv_release">
void <code class="sig-name descname">airq_iv_release</code><span class="sig-paren">(</span>struct airq_iv<em> *iv</em><span class="sig-paren">)</span><a class="headerlink" href="#c.airq_iv_release" title="Permalink to this definition">¶</a></dt>
<dd><p>release an interrupt vector</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">airq_iv</span> <span class="pre">*iv</span></code></dt><dd><p>pointer to interrupt vector structure</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.airq_iv_alloc">
unsigned long <code class="sig-name descname">airq_iv_alloc</code><span class="sig-paren">(</span>struct airq_iv<em> *iv</em>, unsigned long<em> num</em><span class="sig-paren">)</span><a class="headerlink" href="#c.airq_iv_alloc" title="Permalink to this definition">¶</a></dt>
<dd><p>allocate irq bits from an interrupt vector</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">airq_iv</span> <span class="pre">*iv</span></code></dt><dd><p>pointer to an interrupt vector structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">num</span></code></dt><dd><p>number of consecutive irq bits to allocate</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns the bit number of the first irq in the allocated block of irqs,
or -1UL if no bit is available or the AIRQ_IV_ALLOC flag has not been
specified</p>
</div>
<dl class="function">
<dt id="c.airq_iv_free">
void <code class="sig-name descname">airq_iv_free</code><span class="sig-paren">(</span>struct airq_iv<em> *iv</em>, unsigned long<em> bit</em>, unsigned long<em> num</em><span class="sig-paren">)</span><a class="headerlink" href="#c.airq_iv_free" title="Permalink to this definition">¶</a></dt>
<dd><p>free irq bits of an interrupt vector</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">airq_iv</span> <span class="pre">*iv</span></code></dt><dd><p>pointer to interrupt vector structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">bit</span></code></dt><dd><p>number of the first irq bit to free</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">num</span></code></dt><dd><p>number of consecutive irq bits to free</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.airq_iv_scan">
unsigned long <code class="sig-name descname">airq_iv_scan</code><span class="sig-paren">(</span>struct airq_iv<em> *iv</em>, unsigned long<em> start</em>, unsigned long<em> end</em><span class="sig-paren">)</span><a class="headerlink" href="#c.airq_iv_scan" title="Permalink to this definition">¶</a></dt>
<dd><p>scan interrupt vector for non-zero bits</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">airq_iv</span> <span class="pre">*iv</span></code></dt><dd><p>pointer to interrupt vector structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">start</span></code></dt><dd><p>bit number to start the search</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">end</span></code></dt><dd><p>bit number to end the search</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns the bit number of the next non-zero interrupt bit, or
-1UL if the scan completed without finding any more any non-zero bits.</p>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Writing s390 channel device drivers</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#the-css-bus">The css bus</a></li>
<li><a class="reference internal" href="#the-ccw-bus">The ccw bus</a><ul>
<li><a class="reference internal" href="#i-o-functions-for-channel-attached-devices">I/O functions for channel-attached devices</a></li>
<li><a class="reference internal" href="#ccw-devices">ccw devices</a></li>
<li><a class="reference internal" href="#the-channel-measurement-facility">The channel-measurement facility</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-ccwgroup-bus">The ccwgroup bus</a><ul>
<li><a class="reference internal" href="#ccw-group-devices">ccw group devices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generic-interfaces">Generic interfaces</a><ul>
<li><a class="reference internal" href="#adapter-interrupts">Adapter interrupts</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/driver-api/s390-drivers.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/driver-api/s390-drivers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>