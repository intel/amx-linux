
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>USB Anchors &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="USB bulk streams" href="bulk-streams.html" />
    <link rel="prev" title="USB Gadget API for Linux" href="gadget.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="usb-anchors">
<h1>USB Anchors<a class="headerlink" href="#usb-anchors" title="Permalink to this headline">¶</a></h1>
<section id="what-is-anchor">
<h2>What is anchor?<a class="headerlink" href="#what-is-anchor" title="Permalink to this headline">¶</a></h2>
<p>A USB driver needs to support some callbacks requiring
a driver to cease all IO to an interface. To do so, a
driver has to keep track of the URBs it has submitted
to know they’ve all completed or to call usb_kill_urb
for them. The anchor is a data structure takes care of
keeping track of URBs and provides methods to deal with
multiple URBs.</p>
</section>
<section id="allocation-and-initialisation">
<h2>Allocation and Initialisation<a class="headerlink" href="#allocation-and-initialisation" title="Permalink to this headline">¶</a></h2>
<p>There’s no API to allocate an anchor. It is simply declared
as struct usb_anchor. <code class="xref c c-func docutils literal notranslate"><span class="pre">init_usb_anchor()</span></code> must be called to
initialise the data structure.</p>
</section>
<section id="deallocation">
<h2>Deallocation<a class="headerlink" href="#deallocation" title="Permalink to this headline">¶</a></h2>
<p>Once it has no more URBs associated with it, the anchor can be
freed with normal memory management operations.</p>
</section>
<section id="association-and-disassociation-of-urbs-with-anchors">
<h2>Association and disassociation of URBs with anchors<a class="headerlink" href="#association-and-disassociation-of-urbs-with-anchors" title="Permalink to this headline">¶</a></h2>
<p>An association of URBs to an anchor is made by an explicit
call to <a class="reference internal" href="usb.html#c.usb_anchor_urb" title="usb_anchor_urb"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_anchor_urb()</span></code></a>. The association is maintained until
an URB is finished by (successful) completion. Thus disassociation
is automatic. A function is provided to forcibly finish (kill)
all URBs associated with an anchor.
Furthermore, disassociation can be made with <a class="reference internal" href="usb.html#c.usb_unanchor_urb" title="usb_unanchor_urb"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_unanchor_urb()</span></code></a></p>
</section>
<section id="operations-on-multitudes-of-urbs">
<h2>Operations on multitudes of URBs<a class="headerlink" href="#operations-on-multitudes-of-urbs" title="Permalink to this headline">¶</a></h2>
<section id="usb-kill-anchored-urbs">
<h3><a class="reference internal" href="usb.html#c.usb_kill_anchored_urbs" title="usb_kill_anchored_urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_kill_anchored_urbs()</span></code></a><a class="headerlink" href="#usb-kill-anchored-urbs" title="Permalink to this headline">¶</a></h3>
<p>This function kills all URBs associated with an anchor. The URBs
are called in the reverse temporal order they were submitted.
This way no data can be reordered.</p>
</section>
<section id="usb-unlink-anchored-urbs">
<h3><a class="reference internal" href="usb.html#c.usb_unlink_anchored_urbs" title="usb_unlink_anchored_urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_unlink_anchored_urbs()</span></code></a><a class="headerlink" href="#usb-unlink-anchored-urbs" title="Permalink to this headline">¶</a></h3>
<p>This function unlinks all URBs associated with an anchor. The URBs
are processed in the reverse temporal order they were submitted.
This is similar to <a class="reference internal" href="usb.html#c.usb_kill_anchored_urbs" title="usb_kill_anchored_urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_kill_anchored_urbs()</span></code></a>, but it will not sleep.
Therefore no guarantee is made that the URBs have been unlinked when
the call returns. They may be unlinked later but will be unlinked in
finite time.</p>
</section>
<section id="usb-scuttle-anchored-urbs">
<h3><a class="reference internal" href="usb.html#c.usb_scuttle_anchored_urbs" title="usb_scuttle_anchored_urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_scuttle_anchored_urbs()</span></code></a><a class="headerlink" href="#usb-scuttle-anchored-urbs" title="Permalink to this headline">¶</a></h3>
<p>All URBs of an anchor are unanchored en masse.</p>
</section>
<section id="usb-wait-anchor-empty-timeout">
<h3><a class="reference internal" href="usb.html#c.usb_wait_anchor_empty_timeout" title="usb_wait_anchor_empty_timeout"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_wait_anchor_empty_timeout()</span></code></a><a class="headerlink" href="#usb-wait-anchor-empty-timeout" title="Permalink to this headline">¶</a></h3>
<p>This function waits for all URBs associated with an anchor to finish
or a timeout, whichever comes first. Its return value will tell you
whether the timeout was reached.</p>
</section>
<section id="usb-anchor-empty">
<h3><a class="reference internal" href="usb.html#c.usb_anchor_empty" title="usb_anchor_empty"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_anchor_empty()</span></code></a><a class="headerlink" href="#usb-anchor-empty" title="Permalink to this headline">¶</a></h3>
<p>Returns true if no URBs are associated with an anchor. Locking
is the caller’s responsibility.</p>
</section>
<section id="usb-get-from-anchor">
<h3><a class="reference internal" href="usb.html#c.usb_get_from_anchor" title="usb_get_from_anchor"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_get_from_anchor()</span></code></a><a class="headerlink" href="#usb-get-from-anchor" title="Permalink to this headline">¶</a></h3>
<p>Returns the oldest anchored URB of an anchor. The URB is unanchored
and returned with a reference. As you may mix URBs to several
destinations in one anchor you have no guarantee the chronologically
first submitted URB is returned.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">USB Anchors</a><ul>
<li><a class="reference internal" href="#what-is-anchor">What is anchor?</a></li>
<li><a class="reference internal" href="#allocation-and-initialisation">Allocation and Initialisation</a></li>
<li><a class="reference internal" href="#deallocation">Deallocation</a></li>
<li><a class="reference internal" href="#association-and-disassociation-of-urbs-with-anchors">Association and disassociation of URBs with anchors</a></li>
<li><a class="reference internal" href="#operations-on-multitudes-of-urbs">Operations on multitudes of URBs</a><ul>
<li><a class="reference internal" href="#usb-kill-anchored-urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_kill_anchored_urbs()</span></code></a></li>
<li><a class="reference internal" href="#usb-unlink-anchored-urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_unlink_anchored_urbs()</span></code></a></li>
<li><a class="reference internal" href="#usb-scuttle-anchored-urbs"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_scuttle_anchored_urbs()</span></code></a></li>
<li><a class="reference internal" href="#usb-wait-anchor-empty-timeout"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_wait_anchor_empty_timeout()</span></code></a></li>
<li><a class="reference internal" href="#usb-anchor-empty"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_anchor_empty()</span></code></a></li>
<li><a class="reference internal" href="#usb-get-from-anchor"><code class="xref c c-func docutils literal notranslate"><span class="pre">usb_get_from_anchor()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/usb/anchors.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/usb/anchors.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>