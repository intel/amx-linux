
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>N_TTY &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="VFIO Mediated devices" href="../vfio-mediated-device.html" />
    <link rel="prev" title="GSM 0710 tty multiplexor HOWTO" href="n_gsm.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="n-tty">
<h1>N_TTY<a class="headerlink" href="#n-tty" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#external-functions" id="id1">External Functions</a></p></li>
<li><p><a class="reference internal" href="#internal-functions" id="id2">Internal Functions</a></p></li>
</ul>
</div>
<p>The default (and fallback) <a class="reference internal" href="tty_ldisc.html"><span class="doc">TTY line discipline</span></a>. It tries to
handle characters as per POSIX.</p>
<section id="external-functions">
<h2><a class="toc-backref" href="#id1">External Functions</a><a class="headerlink" href="#external-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.n_tty_inherit_ops">
void <code class="sig-name descname">n_tty_inherit_ops</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_ldisc.html#c.tty_ldisc_ops" title="tty_ldisc_ops">tty_ldisc_ops</a><em> *ops</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_inherit_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>inherit N_TTY methods</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_ldisc_ops</span> <span class="pre">*ops</span></code></dt><dd><p><a class="reference internal" href="tty_ldisc.html#c.tty_ldisc_ops" title="tty_ldisc_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_ldisc_ops</span></code></a> where to save N_TTY methods</p>
<p>Enables a ‘subclass’ line discipline to ‘inherit’ N_TTY methods.</p>
</dd>
</dl>
</div>
</section>
<section id="internal-functions">
<h2><a class="toc-backref" href="#id2">Internal Functions</a><a class="headerlink" href="#internal-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.n_tty_kick_worker">
void <code class="sig-name descname">n_tty_kick_worker</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_kick_worker" title="Permalink to this definition">¶</a></dt>
<dd><p>start input worker (if required)</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Re-schedules the flip buffer work if it may have stopped.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>Caller holds exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>, or</p></li>
<li><dl class="simple">
<dt>n_tty_read()/consumer path:</dt><dd><p>holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.n_tty_write_wakeup">
void <code class="sig-name descname">n_tty_write_wakeup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_write_wakeup" title="Permalink to this definition">¶</a></dt>
<dd><p>asynchronous I/O notifier</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Required for the ptys, serial driver etc. since processes that attach
themselves to the master and rely on ASYNC IO must be woken up.</p>
</div>
<dl class="function">
<dt id="c.put_tty_queue">
void <code class="sig-name descname">put_tty_queue</code><span class="sig-paren">(</span>unsigned char<em> c</em>, struct n_tty_data<em> *ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.put_tty_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>add character to tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>character</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a character to the tty read_buf queue.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.reset_buffer_flags">
void <code class="sig-name descname">reset_buffer_flags</code><span class="sig-paren">(</span>struct n_tty_data<em> *ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.reset_buffer_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>reset buffer state</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>line disc data to reset</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Reset the read buffer counters and clear the flags. Called from
<a class="reference internal" href="#c.n_tty_open" title="n_tty_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_open()</span></code></a> and <a class="reference internal" href="#c.n_tty_flush_buffer" title="n_tty_flush_buffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_flush_buffer()</span></code></a>.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>caller holds exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>, or</p></li>
<li><p>(locking is not required)</p></li>
</ul>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.n_tty_flush_buffer">
void <code class="sig-name descname">n_tty_flush_buffer</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_flush_buffer" title="Permalink to this definition">¶</a></dt>
<dd><p>clean input queue</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Flush the input buffer. Called when the tty layer wants the buffer flushed
(eg at hangup) or when the <code class="docutils literal notranslate"><span class="pre">N_TTY</span></code> line discipline internally has to clean
the pending queue (for example some signals).</p>
<p>Holds <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code> to exclude producer/consumer while buffer indices are
reset.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">ctrl</span></code>.lock, exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</div>
<dl class="function">
<dt id="c.is_utf8_continuation">
int <code class="sig-name descname">is_utf8_continuation</code><span class="sig-paren">(</span>unsigned char<em> c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.is_utf8_continuation" title="Permalink to this definition">¶</a></dt>
<dd><p>utf8 multibyte check</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>byte to check</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if the utf8 character <strong>c</strong> is a multibyte continuation
character. We use this to correctly compute the on-screen size of the
character when printing.</p>
</div>
<dl class="function">
<dt id="c.is_continuation">
int <code class="sig-name descname">is_continuation</code><span class="sig-paren">(</span>unsigned char<em> c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.is_continuation" title="Permalink to this definition">¶</a></dt>
<dd><p>multibyte check</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>byte to check</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if the utf8 character <strong>c</strong> is a multibyte continuation character
and the terminal is in unicode mode.</p>
</div>
<dl class="function">
<dt id="c.do_output_char">
int <code class="sig-name descname">do_output_char</code><span class="sig-paren">(</span>unsigned char<em> c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, int<em> space</em><span class="sig-paren">)</span><a class="headerlink" href="#c.do_output_char" title="Permalink to this definition">¶</a></dt>
<dd><p>output one character</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>character (or partial unicode symbol)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">space</span></code></dt><dd><p>space available in tty driver write buffer</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a helper function that handles one output character (including
special characters like TAB, CR, LF, etc.), doing OPOST processing and
putting the results in the tty driver’s write buffer.</p>
<p>Note that Linux currently ignores TABDLY, CRDLY, VTDLY, FFDLY and NLDLY.
They simply aren’t relevant in the world today. If you ever need them, add
them here.</p>
<p>Locking: should be called under the <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect the column state
and space left in the buffer.</p>
<p><strong>Return</strong></p>
<p>the number of bytes of buffer space used or -1 if no space left.</p>
</div>
<dl class="function">
<dt id="c.process_output">
int <code class="sig-name descname">process_output</code><span class="sig-paren">(</span>unsigned char<em> c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.process_output" title="Permalink to this definition">¶</a></dt>
<dd><p>output post processor</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>character (or partial unicode symbol)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Output one character with OPOST processing.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect column state and space left (also, this is
called from <a class="reference internal" href="#c.n_tty_write" title="n_tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_write()</span></code></a> under the tty layer write lock).</p>
<p><strong>Return</strong></p>
<p>-1 when the output device is full and the character must be
retried.</p>
</div>
<dl class="function">
<dt id="c.process_output_block">
ssize_t <code class="sig-name descname">process_output_block</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, const unsigned char<em> *buf</em>, unsigned int<em> nr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.process_output_block" title="Permalink to this definition">¶</a></dt>
<dd><p>block post processor</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*buf</span></code></dt><dd><p>character buffer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">nr</span></code></dt><dd><p>number of bytes to output</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Output a block of characters with OPOST processing.</p>
<p>This path is used to speed up block console writes, among other things when
processing blocks of output data. It handles only the simple cases normally
found and helps to generate blocks of symbols for the console driver and
thus improve performance.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect column state and space left (also, this is
called from <a class="reference internal" href="#c.n_tty_write" title="n_tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_write()</span></code></a> under the tty layer write lock).</p>
<p><strong>Return</strong></p>
<p>the number of characters output.</p>
</div>
<dl class="function">
<dt id="c.__process_echoes">
size_t <code class="sig-name descname">__process_echoes</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__process_echoes" title="Permalink to this definition">¶</a></dt>
<dd><p>write pending echo characters</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write previously buffered echo (and other ldisc-generated) characters to the
tty.</p>
<p>Characters generated by the ldisc (including echoes) need to be buffered
because the driver’s write buffer can fill during heavy program output.
Echoing straight to the driver will often fail under these conditions,
causing lost characters and resulting mismatches of ldisc state information.</p>
<p>Since the ldisc state must represent the characters actually sent to the
driver at the time of the write, operations like certain changes in column
state are also saved in the buffer and executed here.</p>
<p>A circular fifo buffer is used so that the most recent characters are
prioritized. Also, when control characters are echoed with a prefixed “^”,
the pair is treated atomically and thus not separated.</p>
<p>Locking: callers must hold <code class="docutils literal notranslate"><span class="pre">output_lock</span></code>.</p>
</div>
<dl class="function">
<dt id="c.add_echo_byte">
void <code class="sig-name descname">add_echo_byte</code><span class="sig-paren">(</span>unsigned char<em> c</em>, struct n_tty_data<em> *ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.add_echo_byte" title="Permalink to this definition">¶</a></dt>
<dd><p>add a byte to the echo buffer</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>unicode byte to echo</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a character or operation byte to the echo buffer.</p>
</div>
<dl class="function">
<dt id="c.echo_move_back_col">
void <code class="sig-name descname">echo_move_back_col</code><span class="sig-paren">(</span>struct n_tty_data<em> *ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_move_back_col" title="Permalink to this definition">¶</a></dt>
<dd><p>add operation to move back a column</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to move back one column.</p>
</div>
<dl class="function">
<dt id="c.echo_set_canon_col">
void <code class="sig-name descname">echo_set_canon_col</code><span class="sig-paren">(</span>struct n_tty_data<em> *ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_set_canon_col" title="Permalink to this definition">¶</a></dt>
<dd><p>add operation to set the canon column</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to set the canon column to the current
column.</p>
</div>
<dl class="function">
<dt id="c.echo_erase_tab">
void <code class="sig-name descname">echo_erase_tab</code><span class="sig-paren">(</span>unsigned int<em> num_chars</em>, int<em> after_tab</em>, struct n_tty_data<em> *ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_erase_tab" title="Permalink to this definition">¶</a></dt>
<dd><p>add operation to erase a tab</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">num_chars</span></code></dt><dd><p>number of character columns already used</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">after_tab</span></code></dt><dd><p>true if num_chars starts after a previous tab</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to erase a tab.</p>
<p>Called by the eraser function, which knows how many character columns have
been used since either a previous tab or the start of input. This
information will be used later, along with canon column (if applicable), to
go back the correct number of columns.</p>
</div>
<dl class="function">
<dt id="c.echo_char_raw">
void <code class="sig-name descname">echo_char_raw</code><span class="sig-paren">(</span>unsigned char<em> c</em>, struct n_tty_data<em> *ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_char_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>echo a character raw</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>unicode byte to echo</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>line disc data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Echo user input back onto the screen. This must be called only when
L_ECHO(tty) is true. Called from the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path.</p>
<p>This variant does not treat control characters specially.</p>
</div>
<dl class="function">
<dt id="c.echo_char">
void <code class="sig-name descname">echo_char</code><span class="sig-paren">(</span>unsigned char<em> c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_char" title="Permalink to this definition">¶</a></dt>
<dd><p>echo a character</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>unicode byte to echo</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Echo user input back onto the screen. This must be called only when
L_ECHO(tty) is true. Called from the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path.</p>
<p>This variant tags control characters to be echoed as “^X” (where X is the
letter representing the control char).</p>
</div>
<dl class="function">
<dt id="c.finish_erasing">
void <code class="sig-name descname">finish_erasing</code><span class="sig-paren">(</span>struct n_tty_data<em> *ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.finish_erasing" title="Permalink to this definition">¶</a></dt>
<dd><p>complete erase</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt><dd><p>n_tty data</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.eraser">
void <code class="sig-name descname">eraser</code><span class="sig-paren">(</span>unsigned char<em> c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.eraser" title="Permalink to this definition">¶</a></dt>
<dd><p>handle erase function</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>character input</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform erase and necessary output when an erase character is present in the
stream from the driver layer. Handles the complexities of UTF-8 multibyte
symbols.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.isig">
void <code class="sig-name descname">isig</code><span class="sig-paren">(</span>int<em> sig</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.isig" title="Permalink to this definition">¶</a></dt>
<dd><p>handle the ISIG optio</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">sig</span></code></dt><dd><p>signal</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when a signal is being sent due to terminal input. Called from the
<a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path, so serialized.</p>
<p>Performs input and output flush if !NOFLSH. In this context, the echo
buffer is ‘output’. The signal is processed first to alert any current
readers or writers to discontinue and exit their i/o loops.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">ctrl</span></code>.lock</p>
</div>
<dl class="function">
<dt id="c.n_tty_receive_break">
void <code class="sig-name descname">n_tty_receive_break</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_break" title="Permalink to this definition">¶</a></dt>
<dd><p>handle break</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>An RS232 break event has been hit in the incoming bitstream. This can cause
a variety of events depending upon the termios settings.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive termios_rwsem</p>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>may get exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code> if flushing input buffer</p>
</div>
<dl class="function">
<dt id="c.n_tty_receive_overrun">
void <code class="sig-name descname">n_tty_receive_overrun</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_overrun" title="Permalink to this definition">¶</a></dt>
<dd><p>handle overrun reporting</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Data arrived faster than we could process it. While the tty driver has
flagged this the bits that were missed are gone forever.</p>
<p>Called from the receive_buf path so single threaded. Does not need locking
as num_overrun and overrun_time are function private.</p>
</div>
<dl class="function">
<dt id="c.n_tty_receive_parity_error">
void <code class="sig-name descname">n_tty_receive_parity_error</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, unsigned char<em> c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_parity_error" title="Permalink to this definition">¶</a></dt>
<dd><p>error notifier</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>character</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Process a parity error and queue the right data to indicate the error case
if necessary.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.n_tty_receive_char_flow_ctrl">
bool <code class="sig-name descname">n_tty_receive_char_flow_ctrl</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, unsigned char<em> c</em>, bool<em> lookahead_done</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_char_flow_ctrl" title="Permalink to this definition">¶</a></dt>
<dd><p>receive flow control chars</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>character</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">lookahead_done</span></code></dt><dd><p>lookahead has processed this character already</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Receive and process flow control character actions.</p>
<p>In case lookahead for flow control chars already handled the character in
advance to the normal receive, the actions are skipped during normal
receive.</p>
<p>Returns true if <strong>c</strong> is consumed as flow-control character, the character
must not be treated as normal character.</p>
</div>
<dl class="function">
<dt id="c.n_tty_receive_char">
void <code class="sig-name descname">n_tty_receive_char</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, unsigned char<em> c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_char" title="Permalink to this definition">¶</a></dt>
<dd><p>perform processing</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt><dd><p>character</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Process an individual character of input received from the driver.  This is
serialized with respect to itself by the rules for the driver above.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>
publishes canon_head if canonical mode is active</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.n_tty_receive_buf_common">
int <code class="sig-name descname">n_tty_receive_buf_common</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, const unsigned char<em> *cp</em>, const char<em> *fp</em>, int<em> count</em>, int<em> flow</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_buf_common" title="Permalink to this definition">¶</a></dt>
<dd><p>process input</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>device to receive input</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*cp</span></code></dt><dd><p>input chars</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*fp</span></code></dt><dd><p>flags for each char (if <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, all chars are <code class="docutils literal notranslate"><span class="pre">TTY_NORMAL</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">count</span></code></dt><dd><p>number of input chars in <strong>cp</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">flow</span></code></dt><dd><p>enable flow control</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by the terminal driver when a block of characters has been received.
This function must be called from soft contexts not from interrupt context.
The driver is responsible for making calls one at a time and in order (or
using <a class="reference internal" href="tty_buffer.html#c.flush_to_ldisc" title="flush_to_ldisc"><code class="xref c c-func docutils literal notranslate"><span class="pre">flush_to_ldisc()</span></code></a>).</p>
<p>In canonical mode, the maximum line length is 4096 chars (including the line
termination char); lines longer than 4096 chars are truncated. After 4095
chars, input data is still processed but not stored. Overflow processing
ensures the tty can always receive more input until at least one line can be
read.</p>
<p>In non-canonical mode, the read buffer will only accept 4095 chars; this
provides the necessary space for a newline char if the input mode is
switched to canonical.</p>
<p>Note it is possible for the read buffer to _contain_ 4096 chars in
non-canonical mode: the read buffer could already contain the maximum canon
line of 4096 chars when the mode is switched to non-canonical.</p>
<dl class="simple">
<dt>Locking: n_tty_receive_buf()/producer path:</dt><dd><p>claims non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>
publishes commit_head or canon_head</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>the # of input chars from <strong>cp</strong> which were processed.</p>
</div>
<dl class="function">
<dt id="c.n_tty_set_termios">
void <code class="sig-name descname">n_tty_set_termios</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, const struct ktermios<em> *old</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_set_termios" title="Permalink to this definition">¶</a></dt>
<dd><p>termios data changed</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">ktermios</span> <span class="pre">*old</span></code></dt><dd><p>previous data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by the tty layer when the user changes termios flags so that the line
discipline can plan ahead. This function cannot sleep and is protected from
re-entry by the tty layer. The user is guaranteed that this function will
not be re-entered or in progress when the ldisc is closed.</p>
<p>Locking: Caller holds <strong>tty-&gt;termios_rwsem</strong></p>
</div>
<dl class="function">
<dt id="c.n_tty_close">
void <code class="sig-name descname">n_tty_close</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_close" title="Permalink to this definition">¶</a></dt>
<dd><p>close the ldisc for this tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called from the terminal layer when this line discipline is being shut down,
either because of a close or becsuse of a discipline change. The function
will not be called while other ldisc methods are in progress.</p>
</div>
<dl class="function">
<dt id="c.n_tty_open">
int <code class="sig-name descname">n_tty_open</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_open" title="Permalink to this definition">¶</a></dt>
<dd><p>open an ldisc</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal to open</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when this line discipline is being attached to the terminal device.
Can sleep. Called serialized so that no other events will occur in parallel.
No further open will occur until a close.</p>
</div>
<dl class="function">
<dt id="c.copy_from_read_buf">
bool <code class="sig-name descname">copy_from_read_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, unsigned char<em> **kbp</em>, size_t<em> *nr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.copy_from_read_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>copy read data directly</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">**kbp</span></code></dt><dd><p>data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">*nr</span></code></dt><dd><p>size of data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Helper function to speed up <a class="reference internal" href="#c.n_tty_read" title="n_tty_read"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_read()</span></code></a>. It is only called when <code class="docutils literal notranslate"><span class="pre">ICANON</span></code> is
off; it copies characters straight from the tty queue.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>called under the <strong>ldata-&gt;atomic_read_lock</strong> sem</p></li>
<li><dl class="simple">
<dt>n_tty_read()/consumer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>;
read_tail published</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if it successfully copied data, but there is still more data
to be had.</p>
</div>
<dl class="function">
<dt id="c.canon_copy_from_read_buf">
bool <code class="sig-name descname">canon_copy_from_read_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, unsigned char<em> **kbp</em>, size_t<em> *nr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.canon_copy_from_read_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>copy read data in canonical mode</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">**kbp</span></code></dt><dd><p>data</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">*nr</span></code></dt><dd><p>size of data</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Helper function for <a class="reference internal" href="#c.n_tty_read" title="n_tty_read"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_read()</span></code></a>. It is only called when <code class="docutils literal notranslate"><span class="pre">ICANON</span></code> is on; it
copies one line of input up to and including the line-delimiting character
into the result buffer.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>called under the <code class="docutils literal notranslate"><span class="pre">atomic_read_lock</span></code> mutex</p></li>
<li><dl class="simple">
<dt>n_tty_read()/consumer path:</dt><dd><p>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>;
read_tail published</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>When termios is changed from non-canonical to canonical mode and the
read buffer contains data, <a class="reference internal" href="#c.n_tty_set_termios" title="n_tty_set_termios"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_set_termios()</span></code></a> simulates an EOF push (as if
C-d were input) _without_ the <code class="docutils literal notranslate"><span class="pre">DISABLED_CHAR</span></code> in the buffer. This causes data
already processed as input to be immediately available as input although a
newline has not been received.</p>
</div>
<dl class="function">
<dt id="c.job_control">
int <code class="sig-name descname">job_control</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, struct file<em> *file</em><span class="sig-paren">)</span><a class="headerlink" href="#c.job_control" title="Permalink to this definition">¶</a></dt>
<dd><p>check job control</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>file handle</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform job control management checks on this <strong>file</strong>/<strong>tty</strong> descriptor and if
appropriate send any needed signals and return a negative error code if
action should be taken.</p>
<dl class="simple">
<dt>Locking:</dt><dd><ul class="simple">
<li><p>redirected write test is safe</p></li>
<li><p>current-&gt;signal-&gt;tty check is safe</p></li>
<li><p>ctrl.lock to safely reference <strong>tty-&gt;ctrl.pgrp</strong></p></li>
</ul>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.n_tty_read">
ssize_t <code class="sig-name descname">n_tty_read</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, struct file<em> *file</em>, unsigned char<em> *kbuf</em>, size_t<em> nr</em>, void<em> **cookie</em>, unsigned long<em> offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_read" title="Permalink to this definition">¶</a></dt>
<dd><p>read function for tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>file object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*kbuf</span></code></dt><dd><p>kernelspace buffer pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">nr</span></code></dt><dd><p>size of I/O</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**cookie</span></code></dt><dd><p>if non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code>, this is a continuation read</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">offset</span></code></dt><dd><p>where to continue reading from (unused in n_tty)</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform reads for the line discipline. We are guaranteed that the line
discipline will not be closed under us but we may get multiple parallel
readers and must handle this ourselves. We may also get a hangup. Always
called in user context, may sleep.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<dl class="simple">
<dt>Locking: n_tty_read()/consumer path:</dt><dd><p>claims non-exclusive termios_rwsem;
publishes read_tail</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.n_tty_write">
ssize_t <code class="sig-name descname">n_tty_write</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, struct file<em> *file</em>, const unsigned char<em> *buf</em>, size_t<em> nr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_write" title="Permalink to this definition">¶</a></dt>
<dd><p>write function for tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>file object</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*buf</span></code></dt><dd><p>userspace buffer pointer</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">nr</span></code></dt><dd><p>size of I/O</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write function of the terminal device. This is serialized with respect to
other write callers but not to termios changes, reads and other such events.
Since the receive code will echo characters, thus calling driver write
methods, the <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> is used in the output processing functions called
here as well as in the echo processing function to protect the column state
and space left in the buffer.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<dl class="simple">
<dt>Locking: output_lock to protect column state and space left</dt><dd><p>(note that the process_output*() functions take this lock themselves)</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.n_tty_poll">
__poll_t <code class="sig-name descname">n_tty_poll</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, struct file<em> *file</em>, poll_table<em> *wait</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_poll" title="Permalink to this definition">¶</a></dt>
<dd><p>poll method for N_TTY</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt><dd><p>file accessing it</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">poll_table</span> <span class="pre">*wait</span></code></dt><dd><p>poll table</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when the line discipline is asked to poll() for data or for special
events. This code is not serialized with respect to other events save
open/close.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<p>Locking: called without the kernel lock held – fine.</p>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">N_TTY</a><ul>
<li><a class="reference internal" href="#external-functions">External Functions</a></li>
<li><a class="reference internal" href="#internal-functions">Internal Functions</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/tty/n_tty.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/tty/n_tty.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>