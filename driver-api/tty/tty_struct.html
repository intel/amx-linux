
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>TTY Struct &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TTY Line Discipline" href="tty_ldisc.html" />
    <link rel="prev" title="TTY Port" href="tty_port.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tty-struct">
<h1>TTY Struct<a class="headerlink" href="#tty-struct" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#initialization" id="id1">Initialization</a></p></li>
<li><p><a class="reference internal" href="#name" id="id2">Name</a></p></li>
<li><p><a class="reference internal" href="#reference-counting" id="id3">Reference counting</a></p></li>
<li><p><a class="reference internal" href="#install" id="id4">Install</a></p></li>
<li><p><a class="reference internal" href="#read-write" id="id5">Read &amp; Write</a></p></li>
<li><p><a class="reference internal" href="#start-stop" id="id6">Start &amp; Stop</a></p></li>
<li><p><a class="reference internal" href="#wakeup" id="id7">Wakeup</a></p></li>
<li><p><a class="reference internal" href="#hangup" id="id8">Hangup</a></p></li>
<li><p><a class="reference internal" href="#misc" id="id9">Misc</a></p></li>
<li><p><a class="reference internal" href="#tty-struct-flags" id="id10">TTY Struct Flags</a></p></li>
<li><p><a class="reference internal" href="#tty-struct-reference" id="id11">TTY Struct Reference</a></p></li>
</ul>
</div>
<p><a class="reference internal" href="#c.tty_struct" title="tty_struct"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span></code></a> is allocated by the TTY layer upon the first open of the TTY
device and released after the last close. The TTY layer passes this structure
to most of struct tty_operation’s hooks. Members of tty_struct are documented
in <a class="reference internal" href="#tty-struct-reference">TTY Struct Reference</a> at the bottom.</p>
<section id="initialization">
<h2><a class="toc-backref" href="#id1">Initialization</a><a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_init_termios">
void <code class="sig-name descname">tty_init_termios</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_init_termios" title="Permalink to this definition">¶</a></dt>
<dd><p>helper for termios setup</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>the tty to set up</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Initialise the termios structure for this tty. This runs under the
<code class="docutils literal notranslate"><span class="pre">tty_mutex</span></code> currently so we can be relaxed about ordering.</p>
</div>
</section>
<section id="name">
<h2><a class="toc-backref" href="#id2">Name</a><a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_name">
const char * <code class="sig-name descname">tty_name</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_name" title="Permalink to this definition">¶</a></dt>
<dd><p>return tty naming</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty structure</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Convert a tty structure into a name. The name reflects the kernel naming
policy and if udev is in use may not reflect user space</p>
<p>Locking: none</p>
</div>
</section>
<section id="reference-counting">
<h2><a class="toc-backref" href="#id3">Reference counting</a><a class="headerlink" href="#reference-counting" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_kref_get">
struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="sig-name descname">tty_kref_get</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_kref_get" title="Permalink to this definition">¶</a></dt>
<dd><p>get a tty reference</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty device</p>
<p>Return a new reference to a tty object. The caller must hold
sufficient locks/counts to ensure that their existing reference cannot
go away</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.tty_kref_put">
void <code class="sig-name descname">tty_kref_put</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_kref_put" title="Permalink to this definition">¶</a></dt>
<dd><p>release a tty kref</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Release a reference to the <strong>tty</strong> device and if need be let the kref layer
destruct the object for us.</p>
</div>
</section>
<section id="install">
<h2><a class="toc-backref" href="#id4">Install</a><a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_standard_install">
int <code class="sig-name descname">tty_standard_install</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em> *driver</em>, struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_standard_install" title="Permalink to this definition">¶</a></dt>
<dd><p>usual tty-&gt;ops-&gt;install</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt><dd><p>the driver for the tty</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>the tty</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>If the <strong>driver</strong> overrides <strong>tty-&gt;ops-&gt;install</strong>, it still can call this function
to perform the standard install operations.</p>
</div>
</section>
<section id="read-write">
<h2><a class="toc-backref" href="#id5">Read &amp; Write</a><a class="headerlink" href="#read-write" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_put_char">
int <code class="sig-name descname">tty_put_char</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, unsigned char<em> ch</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_put_char" title="Permalink to this definition">¶</a></dt>
<dd><p>write one character to a tty</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">ch</span></code></dt><dd><p>character to write</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write one byte to the <strong>tty</strong> using the provided <strong>tty-&gt;ops-&gt;put_char()</strong> method
if present.</p>
<p><strong>Note</strong></p>
<p>the specific put_char operation in the driver layer may go
away soon. Don’t call it directly, use this method</p>
<p><strong>Return</strong></p>
<p>the number of characters successfully output.</p>
</div>
</section>
<section id="start-stop">
<h2><a class="toc-backref" href="#id6">Start &amp; Stop</a><a class="headerlink" href="#start-stop" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.stop_tty">
void <code class="sig-name descname">stop_tty</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.stop_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>propagate flow control</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty to stop</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform flow control to the driver. May be called on an already stopped
device and will not re-call the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver-&gt;stop()</span></code></a> method.</p>
<p>This functionality is used by both the line disciplines for halting incoming
flow and by the driver. It may therefore be called from any context, may be
under the tty <code class="docutils literal notranslate"><span class="pre">atomic_write_lock</span></code> but not always.</p>
<dl class="simple">
<dt>Locking:</dt><dd><p>flow.lock</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.start_tty">
void <code class="sig-name descname">start_tty</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.start_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>propagate flow control</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty to start</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start a tty that has been stopped if at all possible. If <strong>tty</strong> was previously
stopped and is now being started, the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver-&gt;start()</span></code></a> method is invoked
and the line discipline woken.</p>
<dl class="simple">
<dt>Locking:</dt><dd><p>flow.lock</p>
</dd>
</dl>
</div>
</section>
<section id="wakeup">
<h2><a class="toc-backref" href="#id7">Wakeup</a><a class="headerlink" href="#wakeup" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_wakeup">
void <code class="sig-name descname">tty_wakeup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_wakeup" title="Permalink to this definition">¶</a></dt>
<dd><p>request more data</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>terminal</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Internal and external helper for wakeups of tty. This function informs the
line discipline if present that the driver is ready to receive more output
data.</p>
</div>
</section>
<section id="hangup">
<h2><a class="toc-backref" href="#id8">Hangup</a><a class="headerlink" href="#hangup" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_hangup">
void <code class="sig-name descname">tty_hangup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_hangup" title="Permalink to this definition">¶</a></dt>
<dd><p>trigger a hangup event</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty to hangup</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>A carrier loss (virtual or otherwise) has occurred on <strong>tty</strong>. Schedule a
hangup sequence to run after this event.</p>
</div>
<dl class="function">
<dt id="c.tty_vhangup">
void <code class="sig-name descname">tty_vhangup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_vhangup" title="Permalink to this definition">¶</a></dt>
<dd><p>process vhangup</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty to hangup</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The user has asked via system call for the terminal to be hung up. We do
this synchronously so that when the syscall returns the process is complete.
That guarantee is necessary for security reasons.</p>
</div>
<dl class="function">
<dt id="c.tty_hung_up_p">
int <code class="sig-name descname">tty_hung_up_p</code><span class="sig-paren">(</span>struct file<em> *filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_hung_up_p" title="Permalink to this definition">¶</a></dt>
<dd><p>was tty hung up</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt><dd><p>file pointer of tty</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if the tty has been subject to a vhangup or a carrier loss</p>
</div>
</section>
<section id="misc">
<h2><a class="toc-backref" href="#id9">Misc</a><a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_do_resize">
int <code class="sig-name descname">tty_do_resize</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em> *tty</em>, struct winsize<em> *ws</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_do_resize" title="Permalink to this definition">¶</a></dt>
<dd><p>resize event</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt><dd><p>tty being resized</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">winsize</span> <span class="pre">*ws</span></code></dt><dd><p>new dimensions</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Update the termios variables and send the necessary signals to peform a
terminal resize correctly.</p>
</div>
</section>
<section id="tty-struct-flags">
<h2><a class="toc-backref" href="#id10">TTY Struct Flags</a><a class="headerlink" href="#tty-struct-flags" title="Permalink to this headline">¶</a></h2>
<p>These bits are used in the <code class="xref c c-member docutils literal notranslate"><span class="pre">tty_struct.flags</span></code> field.</p>
<p>So that interrupts won’t be able to mess up the queues,
copy_to_cooked must be atomic with respect to itself, as must
tty-&gt;write.  Thus, you must use the inline functions <a class="reference internal" href="../../core-api/kernel-api.html#c.set_bit" title="set_bit"><code class="xref c c-func docutils literal notranslate"><span class="pre">set_bit()</span></code></a> and
<a class="reference internal" href="../../core-api/kernel-api.html#c.clear_bit" title="clear_bit"><code class="xref c c-func docutils literal notranslate"><span class="pre">clear_bit()</span></code></a> to make things atomic.</p>
<dl class="simple">
<dt>TTY_THROTTLED</dt><dd><p>Driver input is throttled. The ldisc should call
<code class="xref c c-member docutils literal notranslate"><span class="pre">tty_driver.unthrottle()</span></code> in order to resume reception when
it is ready to process more data (at threshold min).</p>
</dd>
<dt>TTY_IO_ERROR</dt><dd><p>If set, causes all subsequent userspace read/write calls on the tty to
fail, returning -<code class="docutils literal notranslate"><span class="pre">EIO</span></code>. (May be no ldisc too.)</p>
</dd>
<dt>TTY_OTHER_CLOSED</dt><dd><p>Device is a pty and the other side has closed.</p>
</dd>
<dt>TTY_EXCLUSIVE</dt><dd><p>Exclusive open mode (a single opener).</p>
</dd>
<dt>TTY_DO_WRITE_WAKEUP</dt><dd><p>If set, causes the driver to call the
<code class="xref c c-member docutils literal notranslate"><span class="pre">tty_ldisc_ops.write_wakeup()</span></code> method in order to resume
transmission when it can accept more data to transmit.</p>
</dd>
<dt>TTY_LDISC_OPEN</dt><dd><p>Indicates that a line discipline is open. For debugging purposes only.</p>
</dd>
<dt>TTY_PTY_LOCK</dt><dd><p>A flag private to pty code to implement <code class="docutils literal notranslate"><span class="pre">TIOCSPTLCK</span></code>/<code class="docutils literal notranslate"><span class="pre">TIOCGPTLCK</span></code> logic.</p>
</dd>
<dt>TTY_NO_WRITE_SPLIT</dt><dd><p>Prevent driver from splitting up writes into smaller chunks (preserve
write boundaries to driver).</p>
</dd>
<dt>TTY_HUPPED</dt><dd><p>The TTY was hung up. This is set post <code class="xref c c-member docutils literal notranslate"><span class="pre">tty_driver.hangup()</span></code>.</p>
</dd>
<dt>TTY_HUPPING</dt><dd><p>The TTY is in the process of hanging up to abort potential readers.</p>
</dd>
<dt>TTY_LDISC_CHANGING</dt><dd><p>Line discipline for this TTY is being changed. I/O should not block
when this is set. Use tty_io_nonblock() to check.</p>
</dd>
<dt>TTY_LDISC_HALTED</dt><dd><p>Line discipline for this TTY was stopped. No work should be queued to
this ldisc.</p>
</dd>
</dl>
</section>
<section id="tty-struct-reference">
<h2><a class="toc-backref" href="#id11">TTY Struct Reference</a><a class="headerlink" href="#tty-struct-reference" title="Permalink to this headline">¶</a></h2>
<dl class="type">
<dt id="c.tty_struct">
struct <code class="sig-name descname">tty_struct</code><a class="headerlink" href="#c.tty_struct" title="Permalink to this definition">¶</a></dt>
<dd><p>state associated with a tty while open</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct tty_struct {
    struct kref kref;
    struct device *dev;
    struct tty_driver *driver;
    const struct tty_operations *ops;
    int index;
    struct ld_semaphore ldisc_sem;
    struct tty_ldisc *ldisc;
    struct mutex atomic_write_lock;
    struct mutex legacy_mutex;
    struct mutex throttle_mutex;
    struct rw_semaphore termios_rwsem;
    struct mutex winsize_mutex;
    struct ktermios termios, termios_locked;
    char name[64];
    unsigned long flags;
    int count;
    struct winsize winsize;
    struct {
        spinlock_t lock;
        bool stopped;
        bool tco_stopped;
        unsigned long unused[0];
    } flow;
    struct {
        spinlock_t lock;
        struct pid *pgrp;
        struct pid *session;
        unsigned char pktstatus;
        bool packet;
        unsigned long unused[0];
    } ctrl;
    int hw_stopped;
    unsigned int receive_room;
    int flow_change;
    struct tty_struct *link;
    struct fasync_struct *fasync;
    wait_queue_head_t write_wait;
    wait_queue_head_t read_wait;
    struct work_struct hangup_work;
    void *disc_data;
    void *driver_data;
    spinlock_t files_lock;
    struct list_head tty_files;
#define N_TTY_BUF_SIZE 4096;
    int closing;
    unsigned char *write_buf;
    int write_cnt;
    struct work_struct SAK_work;
    struct tty_port *port;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">kref</span></code></dt><dd><p>reference counting by <a class="reference internal" href="#c.tty_kref_get" title="tty_kref_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_kref_get()</span></code></a> and <a class="reference internal" href="#c.tty_kref_put" title="tty_kref_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_kref_put()</span></code></a>, reaching zero
frees the structure</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt><dd><p>class device or <code class="docutils literal notranslate"><span class="pre">NULL</span></code> (e.g. ptys, serdev)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">driver</span></code></dt><dd><p><a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span></code></a> operating this tty</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ops</span></code></dt><dd><p><a class="reference internal" href="tty_driver.html#c.tty_operations" title="tty_operations"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_operations</span></code></a> of <strong>driver</strong> for this tty (open, close, etc.)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">index</span></code></dt><dd><p>index of this tty (e.g. to construct <strong>name</strong> like tty12)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ldisc_sem</span></code></dt><dd><p>protects line discipline changes (<strong>ldisc</strong>) – lock tty not pty</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ldisc</span></code></dt><dd><p>the current line discipline for this tty (n_tty by default)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">atomic_write_lock</span></code></dt><dd><p>protects against concurrent writers, i.e. locks
<strong>write_cnt</strong>, <strong>write_buf</strong> and similar</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">legacy_mutex</span></code></dt><dd><p>leftover from history (BKL -&gt; BTM -&gt; <strong>legacy_mutex</strong>),
protecting several operations on this tty</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">throttle_mutex</span></code></dt><dd><p>protects against concurrent tty_throttle_safe() and
tty_unthrottle_safe() (but not tty_unthrottle())</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></dt><dd><p>protects <strong>termios</strong> and <strong>termios_locked</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">winsize_mutex</span></code></dt><dd><p>protects <strong>winsize</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">termios</span></code></dt><dd><p>termios for the current tty, copied from/to <strong>driver.termios</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">termios_locked</span></code></dt><dd><p>locked termios (by <code class="docutils literal notranslate"><span class="pre">TIOCGLCKTRMIOS</span></code> and <code class="docutils literal notranslate"><span class="pre">TIOCSLCKTRMIOS</span></code>
ioctls)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>name of the tty constructed by <a class="reference internal" href="tty_internals.html#c.tty_line_name" title="tty_line_name"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_line_name()</span></code></a> (e.g. ttyS3)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>bitwise OR of <code class="docutils literal notranslate"><span class="pre">TTY_THROTTLED</span></code>, <code class="docutils literal notranslate"><span class="pre">TTY_IO_ERROR</span></code>, …</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt><dd><p>count of open processes, reaching zero cancels all the work for
this tty and drops a <strong>kref</strong> too (but does not free this tty)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">winsize</span></code></dt><dd><p>size of the terminal “window” (cf. <strong>winsize_mutex</strong>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow</span></code></dt><dd><p>flow settings grouped together, see also <strong>flow.unused</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow.lock</span></code></dt><dd><p>lock for <strong>flow</strong> members</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow.stopped</span></code></dt><dd><p>tty stopped/started by <a class="reference internal" href="#c.stop_tty" title="stop_tty"><code class="xref c c-func docutils literal notranslate"><span class="pre">stop_tty()</span></code></a>/<a class="reference internal" href="#c.start_tty" title="start_tty"><code class="xref c c-func docutils literal notranslate"><span class="pre">start_tty()</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow.tco_stopped</span></code></dt><dd><p>tty stopped/started by <code class="docutils literal notranslate"><span class="pre">TCOOFF</span></code>/<code class="docutils literal notranslate"><span class="pre">TCOON</span></code> ioctls (it has
precedence over <strong>flow.stopped</strong>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow.unused</span></code></dt><dd><p>alignment for Alpha, so that no members other than <strong>flow</strong>.* are
modified by the same 64b word store. The <strong>flow</strong>’s __aligned is
there for the very same reason.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl</span></code></dt><dd><p>control settings grouped together, see also <strong>ctrl.unused</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.lock</span></code></dt><dd><p>lock for <strong>ctrl</strong> members</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.pgrp</span></code></dt><dd><p>process group of this tty (setpgrp(2))</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.session</span></code></dt><dd><p>session of this tty (setsid(2)). Writes are protected by both
<strong>ctrl.lock</strong> and <strong>legacy_mutex</strong>, readers must use at least one of
them.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.pktstatus</span></code></dt><dd><p>packet mode status (bitwise OR of <code class="docutils literal notranslate"><span class="pre">TIOCPKT_</span></code> constants)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.packet</span></code></dt><dd><p>packet mode enabled</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.unused</span></code></dt><dd><p>alignment for Alpha, see <strong>flow.unused</strong> for explanation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hw_stopped</span></code></dt><dd><p>not controlled by the tty layer, under <strong>driver</strong>’s control for CTS
handling</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">receive_room</span></code></dt><dd><p>bytes permitted to feed to <strong>ldisc</strong> without any being lost</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow_change</span></code></dt><dd><p>controls behavior of throttling, see tty_throttle_safe() and
tty_unthrottle_safe()</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">link</span></code></dt><dd><p>link to another pty (master -&gt; slave and vice versa)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fasync</span></code></dt><dd><p>state for <code class="docutils literal notranslate"><span class="pre">O_ASYNC</span></code> (for <code class="docutils literal notranslate"><span class="pre">SIGIO</span></code>); managed by fasync_helper()</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_wait</span></code></dt><dd><p>concurrent writers are waiting in this queue until they are
allowed to write</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">read_wait</span></code></dt><dd><p>readers wait for data in this queue</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hangup_work</span></code></dt><dd><p>normally a work to perform a hangup (do_tty_hangup()); while
freeing the tty, (re)used to <a class="reference internal" href="tty_internals.html#c.release_one_tty" title="release_one_tty"><code class="xref c c-func docutils literal notranslate"><span class="pre">release_one_tty()</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">disc_data</span></code></dt><dd><p>pointer to <strong>ldisc</strong>’s private data (e.g. to <code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">driver_data</span></code></dt><dd><p>pointer to <strong>driver</strong>’s private data (e.g. <code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">uart_state</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">files_lock</span></code></dt><dd><p>protects <strong>tty_files</strong> list</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tty_files</span></code></dt><dd><p>list of (re)openers of this tty (i.e. linked <code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span>
<span class="pre">tty_file_private</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">closing</span></code></dt><dd><p>when set during close, n_tty processes only START &amp; STOP chars</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_buf</span></code></dt><dd><p>temporary buffer used during <a class="reference internal" href="tty_internals.html#c.tty_write" title="tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_write()</span></code></a> to copy user data to</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_cnt</span></code></dt><dd><p>count of bytes written in <a class="reference internal" href="tty_internals.html#c.tty_write" title="tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_write()</span></code></a> to <strong>write_buf</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SAK_work</span></code></dt><dd><p>if the tty has a pending do_SAK, it is queued here</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt><dd><p>persistent storage for this device (i.e. <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a>)</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>All of the state associated with a tty while the tty is open. Persistent
storage for tty devices is referenced here as <strong>port</strong> and is documented in
<a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">TTY Struct</a><ul>
<li><a class="reference internal" href="#initialization">Initialization</a></li>
<li><a class="reference internal" href="#name">Name</a></li>
<li><a class="reference internal" href="#reference-counting">Reference counting</a></li>
<li><a class="reference internal" href="#install">Install</a></li>
<li><a class="reference internal" href="#read-write">Read &amp; Write</a></li>
<li><a class="reference internal" href="#start-stop">Start &amp; Stop</a></li>
<li><a class="reference internal" href="#wakeup">Wakeup</a></li>
<li><a class="reference internal" href="#hangup">Hangup</a></li>
<li><a class="reference internal" href="#misc">Misc</a></li>
<li><a class="reference internal" href="#tty-struct-flags">TTY Struct Flags</a></li>
<li><a class="reference internal" href="#tty-struct-reference">TTY Struct Reference</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/tty/tty_struct.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/tty/tty_struct.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>