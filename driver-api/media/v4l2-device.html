
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2.5. V4L2 device instance &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.6. V4L2 File handlers" href="v4l2-fh.html" />
    <link rel="prev" title="2.4. Video device’ s internal representation" href="v4l2-dev.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="v4l2-device-instance">
<h1><span class="section-number">2.5. </span>V4L2 device instance<a class="headerlink" href="#v4l2-device-instance" title="Permalink to this headline">¶</a></h1>
<p>Each device instance is represented by a <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a>.
Very simple devices can just allocate this struct, but most of the time you
would embed this struct inside a larger struct.</p>
<p>You must register the device instance by calling:</p>
<blockquote>
<div><p><a class="reference internal" href="#c.v4l2_device_register" title="v4l2_device_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_register</span></code></a>
(dev, <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a>).</p>
</div></blockquote>
<p>Registration will initialize the <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a> struct. If the
dev-&gt;driver_data field is <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, it will be linked to
<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a> argument.</p>
<p>Drivers that want integration with the media device framework need to set
dev-&gt;driver_data manually to point to the driver-specific device structure
that embed the <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> instance. This is achieved by a
<code class="docutils literal notranslate"><span class="pre">dev_set_drvdata()</span></code> call before registering the V4L2 device instance.
They must also set the <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> mdev field to point to a
properly initialized and registered <a class="reference internal" href="mc-core.html#c.media_device" title="media_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">media_device</span></code></a> instance.</p>
<p>If <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a>-&gt;name is empty then it will be set to a
value derived from dev (driver name followed by the bus_id, to be precise).
If you set it up before  calling <a class="reference internal" href="#c.v4l2_device_register" title="v4l2_device_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_register()</span></code></a> then it will
be untouched. If dev is <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, then you <strong>must</strong> setup
<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a>-&gt;name before calling
<a class="reference internal" href="#c.v4l2_device_register" title="v4l2_device_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_register()</span></code></a>.</p>
<p>You can use <a class="reference internal" href="#c.v4l2_device_set_name" title="v4l2_device_set_name"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_set_name()</span></code></a> to set the name based on a driver
name and a driver-global atomic_t instance. This will generate names like
<code class="docutils literal notranslate"><span class="pre">ivtv0</span></code>, <code class="docutils literal notranslate"><span class="pre">ivtv1</span></code>, etc. If the name ends with a digit, then it will insert
a dash: <code class="docutils literal notranslate"><span class="pre">cx18-0</span></code>, <code class="docutils literal notranslate"><span class="pre">cx18-1</span></code>, etc. This function returns the instance number.</p>
<p>The first <code class="docutils literal notranslate"><span class="pre">dev</span></code> argument is normally the <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span></code> pointer of a
<code class="docutils literal notranslate"><span class="pre">pci_dev</span></code>, <code class="docutils literal notranslate"><span class="pre">usb_interface</span></code> or <code class="docutils literal notranslate"><span class="pre">platform_device</span></code>. It is rare for dev to
be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, but it happens with ISA devices or when one device creates
multiple PCI devices, thus making it impossible to associate
<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a> with a particular parent.</p>
<p>You can also supply a <code class="docutils literal notranslate"><span class="pre">notify()</span></code> callback that can be called by sub-devices
to notify you of events. Whether you need to set this depends on the
sub-device. Any notifications a sub-device supports must be defined in a header
in <code class="docutils literal notranslate"><span class="pre">include/media/subdevice.h</span></code>.</p>
<p>V4L2 devices are unregistered by calling:</p>
<blockquote>
<div><p><a class="reference internal" href="#c.v4l2_device_unregister" title="v4l2_device_unregister"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_unregister()</span></code></a>
(<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a>).</p>
</div></blockquote>
<p>If the dev-&gt;driver_data field points to <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a>,
it will be reset to <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Unregistering will also automatically unregister
all subdevs from the device.</p>
<p>If you have a hotpluggable device (e.g. a USB device), then when a disconnect
happens the parent device becomes invalid. Since <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a> has a
pointer to that parent device it has to be cleared as well to mark that the
parent is gone. To do this call:</p>
<blockquote>
<div><p><a class="reference internal" href="#c.v4l2_device_disconnect" title="v4l2_device_disconnect"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_disconnect()</span></code></a>
(<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a>).</p>
</div></blockquote>
<p>This does <em>not</em> unregister the subdevs, so you still need to call the
<a class="reference internal" href="#c.v4l2_device_unregister" title="v4l2_device_unregister"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_unregister()</span></code></a> function for that. If your driver is not
hotpluggable, then there is no need to call <a class="reference internal" href="#c.v4l2_device_disconnect" title="v4l2_device_disconnect"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_disconnect()</span></code></a>.</p>
<p>Sometimes you need to iterate over all devices registered by a specific
driver. This is usually the case if multiple device drivers use the same
hardware. E.g. the ivtvfb driver is a framebuffer driver that uses the ivtv
hardware. The same is true for alsa drivers for example.</p>
<p>You can iterate over all registered devices as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="k">struct</span> <span class="nc">device</span><span class="w"> </span><span class="o">*</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span> <span class="nc">v4l2_device</span><span class="w"> </span><span class="o">*</span><span class="n">v4l2_dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dev_get_drvdata</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* test if this device was inited */</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v4l2_dev</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">iterate</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span> <span class="nc">device_driver</span><span class="w"> </span><span class="o">*</span><span class="n">drv</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="cm">/* Find driver &#39;ivtv&#39; on the PCI bus.</span>
<span class="cm">        pci_bus_type is a global. For USB buses use usb_bus_type. */</span><span class="w"></span>
<span class="w">        </span><span class="n">drv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">driver_find</span><span class="p">(</span><span class="s">&quot;ivtv&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pci_bus_type</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="cm">/* iterate over all ivtv device instances */</span><span class="w"></span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">driver_for_each_device</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">put_driver</span><span class="p">(</span><span class="n">drv</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Sometimes you need to keep a running counter of the device instance. This is
commonly used to map a device instance to an index of a module option array.</p>
<p>The recommended approach is as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">atomic_t</span><span class="w"> </span><span class="n">drv_instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ATOMIC_INIT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">drv_probe</span><span class="p">(</span><span class="k">struct</span> <span class="nc">pci_dev</span><span class="w"> </span><span class="o">*</span><span class="n">pdev</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span> <span class="nc">pci_device_id</span><span class="w"> </span><span class="o">*</span><span class="n">pci_id</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="n">state</span><span class="o">-&gt;</span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atomic_inc_return</span><span class="p">(</span><span class="o">&amp;</span><span class="n">drv_instance</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you have multiple device nodes then it can be difficult to know when it is
safe to unregister <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a> for hotpluggable devices. For this
purpose <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a> has refcounting support. The refcount is
increased whenever <a class="reference internal" href="v4l2-dev.html#c.video_register_device" title="video_register_device"><code class="xref c c-func docutils literal notranslate"><span class="pre">video_register_device()</span></code></a> is called and it is
decreased whenever that device node is released. When the refcount reaches
zero, then the <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a> release() callback is called. You can
do your final cleanup there.</p>
<p>If other device nodes (e.g. ALSA) are created, then you can increase and
decrease the refcount manually as well by calling:</p>
<blockquote>
<div><p><a class="reference internal" href="#c.v4l2_device_get" title="v4l2_device_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_get()</span></code></a>
(<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a>).</p>
</div></blockquote>
<p>or:</p>
<blockquote>
<div><p><a class="reference internal" href="#c.v4l2_device_put" title="v4l2_device_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_put()</span></code></a>
(<a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_dev</span></code></a>).</p>
</div></blockquote>
<p>Since the initial refcount is 1 you also need to call
<a class="reference internal" href="#c.v4l2_device_put" title="v4l2_device_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_put()</span></code></a> in the <code class="docutils literal notranslate"><span class="pre">disconnect()</span></code> callback (for USB devices)
or in the <code class="docutils literal notranslate"><span class="pre">remove()</span></code> callback (for e.g. PCI devices), otherwise the refcount
will never reach 0.</p>
<section id="v4l2-device-functions-and-data-structures">
<h2><span class="section-number">2.5.1. </span>v4l2_device functions and data structures<a class="headerlink" href="#v4l2-device-functions-and-data-structures" title="Permalink to this headline">¶</a></h2>
<dl class="type">
<dt id="c.v4l2_device">
struct <code class="sig-name descname">v4l2_device</code><a class="headerlink" href="#c.v4l2_device" title="Permalink to this definition">¶</a></dt>
<dd><p>main struct to for V4L2 device drivers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct v4l2_device {
    struct device *dev;
    struct media_device *mdev;
    struct list_head subdevs;
    spinlock_t lock;
    char name[V4L2_DEVICE_NAME_SIZE];
    void (*notify)(struct v4l2_subdev *sd, unsigned int notification, void *arg);
    struct v4l2_ctrl_handler *ctrl_handler;
    struct v4l2_prio_state prio;
    struct kref ref;
    void (*release)(struct v4l2_device *v4l2_dev);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt><dd><p>pointer to <a class="reference internal" href="../infrastructure.html#c.device" title="device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mdev</span></code></dt><dd><p>pointer to <a class="reference internal" href="mc-core.html#c.media_device" title="media_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">media_device</span></code></a>, may be NULL.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">subdevs</span></code></dt><dd><p>used to keep track of the registered subdevs</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lock</span></code></dt><dd><p>lock this struct; can be used by the driver as well
if this struct is embedded into a larger struct.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>unique device name, by default the driver name + bus ID</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">notify</span></code></dt><dd><p>notify operation called by some sub-devices.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl_handler</span></code></dt><dd><p>The control handler. May be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">prio</span></code></dt><dd><p>Device’s priority state</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ref</span></code></dt><dd><p>Keep track of the references to this struct.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">release</span></code></dt><dd><p>Release function that is called when the ref count
goes to 0.</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>Each instance of a V4L2 device should create the v4l2_device struct,
either stand-alone or embedded in a larger struct.</p>
<p>It allows easy access to sub-devices (see v4l2-subdev.h) and provides
basic V4L2 device-level support.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p><strong>dev-&gt;driver_data</strong> points to this struct.</p></li>
<li><p><strong>dev</strong> might be <code class="docutils literal notranslate"><span class="pre">NULL</span></code> if there is no parent device</p></li>
</ol>
</div>
<dl class="function">
<dt id="c.v4l2_device_get">
void <code class="sig-name descname">v4l2_device_get</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_get" title="Permalink to this definition">¶</a></dt>
<dd><p>gets a V4L2 device reference</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is an ancillary routine meant to increment the usage for the
struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a> pointed by <strong>v4l2_dev</strong>.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_put">
int <code class="sig-name descname">v4l2_device_put</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_put" title="Permalink to this definition">¶</a></dt>
<dd><p>puts a V4L2 device reference</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is an ancillary routine meant to decrement the usage for the
struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a> pointed by <strong>v4l2_dev</strong>.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_register">
int <code class="sig-name descname">v4l2_device_register</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../infrastructure.html#c.device" title="device">device</a><em> *dev</em>, struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_register" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize v4l2_dev and make <strong>dev-&gt;driver_data</strong> point to <strong>v4l2_dev</strong>.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="../infrastructure.html#c.device" title="device"><code class="xref c c-type docutils literal notranslate"><span class="pre">device</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>dev</strong> may be <code class="docutils literal notranslate"><span class="pre">NULL</span></code> in rare cases (ISA devices).
In such case the caller must fill in the <strong>v4l2_dev-&gt;name</strong> field
before calling this function.</p>
</div>
</div>
<dl class="function">
<dt id="c.v4l2_device_set_name">
int <code class="sig-name descname">v4l2_device_set_name</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em>, const char<em> *basename</em>, atomic_t<em> *instance</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_set_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Optional function to initialize the name field of struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a></p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*basename</span></code></dt><dd><p>base name for the device name</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">atomic_t</span> <span class="pre">*instance</span></code></dt><dd><p>pointer to a static atomic_t var with the instance usage for
the device driver.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p><a class="reference internal" href="#c.v4l2_device_set_name" title="v4l2_device_set_name"><code class="xref c c-func docutils literal notranslate"><span class="pre">v4l2_device_set_name()</span></code></a> initializes the name field of struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a>
using the driver name and a driver-global atomic_t instance.</p>
<p>This function will increment the instance counter and returns the
instance value used in the name.</p>
<p>The first time this is called the name field will be set to foo0 and
this function returns 0. If the name ends with a digit (e.g. cx18),
then the name will be set to cx18-0 since cx180 would look really odd.</p>
<p><strong>Example</strong></p>
<blockquote>
<div><p>static atomic_t drv_instance = ATOMIC_INIT(0);</p>
<p>…</p>
<p>instance = v4l2_device_set_name(&amp;v4l2_dev, “foo”, &amp;drv_instance);</p>
</div></blockquote>
</div>
<dl class="function">
<dt id="c.v4l2_device_disconnect">
void <code class="sig-name descname">v4l2_device_disconnect</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Change V4L2 device state to disconnected.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Should be called when the USB parent disconnects.
Since the parent disappears, this ensures that <strong>v4l2_dev</strong> doesn’t have
an invalid parent pointer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function sets <strong>v4l2_dev-&gt;dev</strong> to NULL.</p>
</div>
</div>
<dl class="function">
<dt id="c.v4l2_device_unregister">
void <code class="sig-name descname">v4l2_device_unregister</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>Unregister all sub-devices and any other resources related to <strong>v4l2_dev</strong>.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a></p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.v4l2_device_register_subdev">
int <code class="sig-name descname">v4l2_device_register_subdev</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em>, struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev">v4l2_subdev</a><em> *sd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_register_subdev" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a subdev with a v4l2 device.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span> <span class="pre">*sd</span></code></dt><dd><p>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>While registered, the subdev module is marked as in-use.</p>
<p>An error is returned if the module is no longer loaded on any attempts
to register it.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_unregister_subdev">
void <code class="sig-name descname">v4l2_device_unregister_subdev</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev">v4l2_subdev</a><em> *sd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_unregister_subdev" title="Permalink to this definition">¶</a></dt>
<dd><p>Unregisters a subdev with a v4l2 device.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span> <span class="pre">*sd</span></code></dt><dd><p>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Can also be called if the subdev wasn’t registered. In such
case, it will do nothing.</p>
</div>
</div>
<dl class="function">
<dt id="c.__v4l2_device_register_subdev_nodes">
int <code class="sig-name descname">__v4l2_device_register_subdev_nodes</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em>, bool<em> read_only</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_register_subdev_nodes" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers device nodes for all subdevs of the v4l2 device that are marked with the <code class="docutils literal notranslate"><span class="pre">V4L2_SUBDEV_FL_HAS_DEVNODE</span></code> flag.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">read_only</span></code></dt><dd><p>subdevices read-only flag. True to register the subdevices
device nodes in read-only mode, false to allow full access to the
subdevice userspace API.</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.v4l2_device_register_subdev_nodes">
int <code class="sig-name descname">v4l2_device_register_subdev_nodes</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_register_subdev_nodes" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers subdevices device nodes with unrestricted access to the subdevice userspace operations</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Internally calls <a class="reference internal" href="#c.__v4l2_device_register_subdev_nodes" title="__v4l2_device_register_subdev_nodes"><code class="xref c c-func docutils literal notranslate"><span class="pre">__v4l2_device_register_subdev_nodes()</span></code></a>. See its documentation
for more details.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_register_ro_subdev_nodes">
int <code class="sig-name descname">v4l2_device_register_ro_subdev_nodes</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_register_ro_subdev_nodes" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers subdevices device nodes in read-only mode</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a></p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Internally calls <a class="reference internal" href="#c.__v4l2_device_register_subdev_nodes" title="__v4l2_device_register_subdev_nodes"><code class="xref c c-func docutils literal notranslate"><span class="pre">__v4l2_device_register_subdev_nodes()</span></code></a>. See its documentation
for more details.</p>
</div>
<dl class="function">
<dt id="c.v4l2_subdev_notify">
void <code class="sig-name descname">v4l2_subdev_notify</code><span class="sig-paren">(</span>struct <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev">v4l2_subdev</a><em> *sd</em>, unsigned int<em> notification</em>, void<em> *arg</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_subdev_notify" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends a notification to v4l2_device.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span> <span class="pre">*sd</span></code></dt><dd><p>pointer to <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">notification</span></code></dt><dd><p>type of notification. Please notice that the notification
type is driver-specific.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*arg</span></code></dt><dd><p>arguments for the notification. Those are specific to each
notification type.</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.v4l2_device_supports_requests">
bool <code class="sig-name descname">v4l2_device_supports_requests</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.v4l2_device" title="v4l2_device">v4l2_device</a><em> *v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_supports_requests" title="Permalink to this definition">¶</a></dt>
<dd><p>Test if requests are supported.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span> <span class="pre">*v4l2_dev</span></code></dt><dd><p>pointer to <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a></p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.v4l2_device_for_each_subdev">
<code class="sig-name descname">v4l2_device_for_each_subdev</code><span class="sig-paren">(</span><em>sd</em>, <em>v4l2_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_for_each_subdev" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper macro that interates over all sub-devices of a given <a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_device</span></code></a>.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sd</span></code></dt><dd><p>pointer that will be filled by the macro with all
<a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a> pointer used as an iterator by the loop.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>This macro iterates over all sub-devices owned by the <strong>v4l2_dev</strong> device.
It acts as a for loop iterator and executes the next statement with
the <strong>sd</strong> variable pointing to each sub-device in turn.</p>
</div>
<dl class="function">
<dt id="c.__v4l2_device_call_subdevs_p">
<code class="sig-name descname">__v4l2_device_call_subdevs_p</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>sd</em>, <em>cond</em>, <em>o</em>, <em>f</em>, <em>args…</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_call_subdevs_p" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the condition.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sd</span></code></dt><dd><p>pointer that will be filled by the macro with all
<a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a> pointer used as an iterator by the loop.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cond</span></code></dt><dd><p>condition to be match</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">args...</span></code></dt><dd><p>arguments for <strong>f</strong>.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Ignore any errors.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
</div>
<dl class="function">
<dt id="c.__v4l2_device_call_subdevs">
<code class="sig-name descname">__v4l2_device_call_subdevs</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>cond</em>, <em>o</em>, <em>f</em>, <em>args…</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_call_subdevs" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the condition.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cond</span></code></dt><dd><p>condition to be match</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">args...</span></code></dt><dd><p>arguments for <strong>f</strong>.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Ignore any errors.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
</div>
<dl class="function">
<dt id="c.__v4l2_device_call_subdevs_until_err_p">
<code class="sig-name descname">__v4l2_device_call_subdevs_until_err_p</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>sd</em>, <em>cond</em>, <em>o</em>, <em>f</em>, <em>args…</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_call_subdevs_until_err_p" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the condition.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sd</span></code></dt><dd><p>pointer that will be filled by the macro with all
<a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a> sub-devices associated with <strong>v4l2_dev</strong>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cond</span></code></dt><dd><p>condition to be match</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">args...</span></code></dt><dd><p>arguments for <strong>f</strong>.</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p><strong>Description</strong></p>
<p>If the operation returns an error other than 0 or <code class="docutils literal notranslate"><span class="pre">-ENOIOCTLCMD</span></code>
for any subdevice, then abort and return with that error code, zero
otherwise.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
</div>
<dl class="function">
<dt id="c.__v4l2_device_call_subdevs_until_err">
<code class="sig-name descname">__v4l2_device_call_subdevs_until_err</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>cond</em>, <em>o</em>, <em>f</em>, <em>args…</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__v4l2_device_call_subdevs_until_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the condition.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cond</span></code></dt><dd><p>condition to be match</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">args...</span></code></dt><dd><p>arguments for <strong>f</strong>.</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p><strong>Description</strong></p>
<p>If the operation returns an error other than 0 or <code class="docutils literal notranslate"><span class="pre">-ENOIOCTLCMD</span></code>
for any subdevice, then abort and return with that error code,
zero otherwise.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_call_all">
<code class="sig-name descname">v4l2_device_call_all</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpid</em>, <em>o</em>, <em>f</em>, <em>args…</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_call_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_subdev.grp_id</span></code></a>, as assigned by the bridge driver.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">grpid</span></code></dt><dd><p><a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id group ID to match.
Use 0 to match them all.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">args...</span></code></dt><dd><p>arguments for <strong>f</strong>.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Ignore any errors.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_call_until_err">
<code class="sig-name descname">v4l2_device_call_until_err</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpid</em>, <em>o</em>, <em>f</em>, <em>args…</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_call_until_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the specified operation for all subdevs matching the <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_subdev.grp_id</span></code></a>, as assigned by the bridge driver, until an error occurs.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">grpid</span></code></dt><dd><p><a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id group ID to match.
Use 0 to match them all.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">args...</span></code></dt><dd><p>arguments for <strong>f</strong>.</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p><strong>Description</strong></p>
<p>If the operation returns an error other than 0 or <code class="docutils literal notranslate"><span class="pre">-ENOIOCTLCMD</span></code>
for any subdevice, then abort and return with that error code,
zero otherwise.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_mask_call_all">
<code class="sig-name descname">v4l2_device_mask_call_all</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpmsk</em>, <em>o</em>, <em>f</em>, <em>args…</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_mask_call_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the specified operation for all subdevices where a group ID matches a specified bitmask.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">grpmsk</span></code></dt><dd><p>bitmask to be checked against <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id
group ID to be matched. Use 0 to match them all.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">args...</span></code></dt><dd><p>arguments for <strong>f</strong>.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Ignore any errors.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_mask_call_until_err">
<code class="sig-name descname">v4l2_device_mask_call_until_err</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpmsk</em>, <em>o</em>, <em>f</em>, <em>args…</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_mask_call_until_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the specified operation for all subdevices where a group ID matches a specified bitmask.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">grpmsk</span></code></dt><dd><p>bitmask to be checked against <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id
group ID to be matched. Use 0 to match them all.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">args...</span></code></dt><dd><p>arguments for <strong>f</strong>.</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p><strong>Description</strong></p>
<p>If the operation returns an error other than 0 or <code class="docutils literal notranslate"><span class="pre">-ENOIOCTLCMD</span></code>
for any subdevice, then abort and return with that error code,
zero otherwise.</p>
<p><strong>Note</strong></p>
<p>subdevs cannot be added or deleted while walking
the subdevs list.</p>
</div>
<dl class="function">
<dt id="c.v4l2_device_has_op">
<code class="sig-name descname">v4l2_device_has_op</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpid</em>, <em>o</em>, <em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_has_op" title="Permalink to this definition">¶</a></dt>
<dd><p>checks if any subdev with matching grpid has a given ops.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">grpid</span></code></dt><dd><p><a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id group ID to match.
Use 0 to match them all.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.v4l2_device_mask_has_op">
<code class="sig-name descname">v4l2_device_mask_has_op</code><span class="sig-paren">(</span><em>v4l2_dev</em>, <em>grpmsk</em>, <em>o</em>, <em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#c.v4l2_device_mask_has_op" title="Permalink to this definition">¶</a></dt>
<dd><p>checks if any subdev with matching group mask has a given ops.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">v4l2_dev</span></code></dt><dd><p><a class="reference internal" href="#c.v4l2_device" title="v4l2_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_device</span></code></a> owning the sub-devices to iterate over.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">grpmsk</span></code></dt><dd><p>bitmask to be checked against <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev" title="v4l2_subdev"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev</span></code></a>-&gt;grp_id
group ID to be matched. Use 0 to match them all.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">o</span></code></dt><dd><p>name of the element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a> that contains <strong>f</strong>.
Each element there groups a set of operations functions.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">f</span></code></dt><dd><p>operation function that will be called if <strong>cond</strong> matches.
The operation functions are defined in groups, according to
each element at <a class="reference internal" href="v4l2-subdev.html#c.v4l2_subdev_ops" title="v4l2_subdev_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">v4l2_subdev_ops</span></code></a>.</p>
</dd>
</dl>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.5. V4L2 device instance</a><ul>
<li><a class="reference internal" href="#v4l2-device-functions-and-data-structures">2.5.1. v4l2_device functions and data structures</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/media/v4l2-device.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/media/v4l2-device.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>