
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7. Pixel data transmitter and receiver drivers &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8. Writing camera sensor drivers" href="camera-sensor.html" />
    <link rel="prev" title="6. CEC Kernel Support" href="cec-core.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pixel-data-transmitter-and-receiver-drivers">
<span id="transmitter-receiver"></span><h1><span class="section-number">7. </span>Pixel data transmitter and receiver drivers<a class="headerlink" href="#pixel-data-transmitter-and-receiver-drivers" title="Permalink to this headline">¶</a></h1>
<p>V4L2 supports various devices that transmit and receive pixel data. Examples of
these devices include a camera sensor, a TV tuner and a parallel or a CSI-2
receiver in an SoC.</p>
<section id="bus-types">
<h2><span class="section-number">7.1. </span>Bus types<a class="headerlink" href="#bus-types" title="Permalink to this headline">¶</a></h2>
<p>The following busses are the most common. This section discusses these two only.</p>
<section id="mipi-csi-2">
<h3><span class="section-number">7.1.1. </span>MIPI CSI-2<a class="headerlink" href="#mipi-csi-2" title="Permalink to this headline">¶</a></h3>
<p>CSI-2 is a data bus intended for transferring images from cameras to
the host SoC. It is defined by the <a class="reference external" href="https://www.mipi.org/">MIPI alliance</a>.</p>
</section>
<section id="parallel">
<h3><span class="section-number">7.1.2. </span>Parallel<a class="headerlink" href="#parallel" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Rec._601">BT.601</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/ITU-R_BT.656">BT.656</a> are the most common parallel busses.</p>
</section>
</section>
<section id="transmitter-drivers">
<h2><span class="section-number">7.2. </span>Transmitter drivers<a class="headerlink" href="#transmitter-drivers" title="Permalink to this headline">¶</a></h2>
<p>Transmitter drivers generally need to provide the receiver drivers with the
configuration of the transmitter. What is required depends on the type of the
bus. These are common for both busses.</p>
<section id="media-bus-pixel-code">
<h3><span class="section-number">7.2.1. </span>Media bus pixel code<a class="headerlink" href="#media-bus-pixel-code" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="../../userspace-api/media/v4l/subdev-formats.html#v4l2-mbus-pixelcode"><span class="std std-ref">Media Bus Pixel Codes</span></a>.</p>
</section>
<section id="link-frequency">
<h3><span class="section-number">7.2.2. </span>Link frequency<a class="headerlink" href="#link-frequency" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../../userspace-api/media/v4l/ext-ctrls-image-process.html#v4l2-cid-link-freq"><span class="std std-ref">V4L2_CID_LINK_FREQ</span></a> control is used to tell the
receiver the frequency of the bus (i.e. it is not the same as the symbol rate).</p>
</section>
<section id="s-stream-callback">
<h3><span class="section-number">7.2.3. </span><code class="docutils literal notranslate"><span class="pre">.s_stream()</span></code> callback<a class="headerlink" href="#s-stream-callback" title="Permalink to this headline">¶</a></h3>
<p>The struct struct v4l2_subdev_video_ops-&gt;s_stream() callback is used by the
receiver driver to control the transmitter driver’s streaming state.</p>
</section>
</section>
<section id="csi-2-transmitter-drivers">
<h2><span class="section-number">7.3. </span>CSI-2 transmitter drivers<a class="headerlink" href="#csi-2-transmitter-drivers" title="Permalink to this headline">¶</a></h2>
<section id="pixel-rate">
<h3><span class="section-number">7.3.1. </span>Pixel rate<a class="headerlink" href="#pixel-rate" title="Permalink to this headline">¶</a></h3>
<p>The pixel rate on the bus is calculated as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pixel_rate = link_freq * 2 * nr_of_lanes * 16 / k / bits_per_sample
</pre></div>
</div>
<p>where</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">variables in pixel rate calculation</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>variable or constant</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>link_freq</p></td>
<td><p>The value of the <code class="docutils literal notranslate"><span class="pre">V4L2_CID_LINK_FREQ</span></code> integer64 menu item.</p></td>
</tr>
<tr class="row-odd"><td><p>nr_of_lanes</p></td>
<td><p>Number of data lanes used on the CSI-2 link. This can
be obtained from the OF endpoint configuration.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Data is transferred on both rising and falling edge of the signal.</p></td>
</tr>
<tr class="row-odd"><td><p>bits_per_sample</p></td>
<td><p>Number of bits per sample.</p></td>
</tr>
<tr class="row-even"><td><p>k</p></td>
<td><p>16 for D-PHY and 7 for C-PHY</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pixel rate calculated this way is <strong>not</strong> the same thing as the
pixel rate on the camera sensor’s pixel array which is indicated by the
<a class="reference internal" href="../../userspace-api/media/v4l/ext-ctrls-image-process.html#v4l2-cid-pixel-rate"><span class="std std-ref">V4L2_CID_PIXEL_RATE</span></a> control.</p>
</div>
</section>
<section id="lp-11-and-lp-111-modes">
<h3><span class="section-number">7.3.2. </span>LP-11 and LP-111 modes<a class="headerlink" href="#lp-11-and-lp-111-modes" title="Permalink to this headline">¶</a></h3>
<p>As part of transitioning to high speed mode, a CSI-2 transmitter typically
briefly sets the bus to LP-11 or LP-111 state, depending on the PHY. This period
may be as short as 100 µs, during which the receiver observes this state and
proceeds its own part of high speed mode transition.</p>
<p>Most receivers are capable of autonomously handling this once the software has
configured them to do so, but there are receivers which require software
involvement in observing LP-11 or LP-111 state. 100 µs is a brief period to hit
in software, especially when there is no interrupt telling something is
happening.</p>
<p>One way to address this is to configure the transmitter side explicitly to LP-11
or LP-111 mode, which requires support from the transmitter hardware. This is
not universally available. Many devices return to this state once streaming is
stopped while the state after power-on is LP-00 or LP-000.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.pre_streamon()</span></code> callback may be used to prepare a transmitter for
transitioning to streaming state, but not yet start streaming. Similarly, the
<code class="docutils literal notranslate"><span class="pre">.post_streamoff()</span></code> callback is used to undo what was done by the
<code class="docutils literal notranslate"><span class="pre">.pre_streamon()</span></code> callback. The caller of <code class="docutils literal notranslate"><span class="pre">.pre_streamon()</span></code> is thus required
to call <code class="docutils literal notranslate"><span class="pre">.post_streamoff()</span></code> for each successful call of <code class="docutils literal notranslate"><span class="pre">.pre_streamon()</span></code>.</p>
<p>In the context of CSI-2, the <code class="docutils literal notranslate"><span class="pre">.pre_streamon()</span></code> callback is used to transition
the transmitter to the LP-11 or LP-111 mode. This also requires powering on the
device, so this should be only done when it is needed.</p>
<p>Receiver drivers that do not need explicit LP-11 or LP-111 mode setup are waived
from calling the two callbacks.</p>
</section>
<section id="stopping-the-transmitter">
<h3><span class="section-number">7.3.3. </span>Stopping the transmitter<a class="headerlink" href="#stopping-the-transmitter" title="Permalink to this headline">¶</a></h3>
<p>A transmitter stops sending the stream of images as a result of
calling the <code class="docutils literal notranslate"><span class="pre">.s_stream()</span></code> callback. Some transmitters may stop the
stream at a frame boundary whereas others stop immediately,
effectively leaving the current frame unfinished. The receiver driver
should not make assumptions either way, but function properly in both
cases.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7. Pixel data transmitter and receiver drivers</a><ul>
<li><a class="reference internal" href="#bus-types">7.1. Bus types</a><ul>
<li><a class="reference internal" href="#mipi-csi-2">7.1.1. MIPI CSI-2</a></li>
<li><a class="reference internal" href="#parallel">7.1.2. Parallel</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transmitter-drivers">7.2. Transmitter drivers</a><ul>
<li><a class="reference internal" href="#media-bus-pixel-code">7.2.1. Media bus pixel code</a></li>
<li><a class="reference internal" href="#link-frequency">7.2.2. Link frequency</a></li>
<li><a class="reference internal" href="#s-stream-callback">7.2.3. <code class="docutils literal notranslate"><span class="pre">.s_stream()</span></code> callback</a></li>
</ul>
</li>
<li><a class="reference internal" href="#csi-2-transmitter-drivers">7.3. CSI-2 transmitter drivers</a><ul>
<li><a class="reference internal" href="#pixel-rate">7.3.1. Pixel rate</a></li>
<li><a class="reference internal" href="#lp-11-and-lp-111-modes">7.3.2. LP-11 and LP-111 modes</a></li>
<li><a class="reference internal" href="#stopping-the-transmitter">7.3.3. Stopping the transmitter</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/media/tx-rx.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/media/tx-rx.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>