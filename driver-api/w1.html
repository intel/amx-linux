
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>W1: Dallas’ 1-wire bus &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Linux RapidIO Subsystem" href="rapidio/index.html" />
    <link rel="prev" title="NVDIMM Runtime Firmware Activation" href="nvdimm/firmware-activate.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="w1-dallas-1-wire-bus">
<h1>W1: Dallas’ 1-wire bus<a class="headerlink" href="#w1-dallas-1-wire-bus" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>David Fries</p>
</dd>
</dl>
<section id="w1-api-internal-to-the-kernel">
<h2>W1 API internal to the kernel<a class="headerlink" href="#w1-api-internal-to-the-kernel" title="Permalink to this headline">¶</a></h2>
<section id="include-linux-w1-h">
<h3>include/linux/w1.h<a class="headerlink" href="#include-linux-w1-h" title="Permalink to this headline">¶</a></h3>
<p>W1 kernel API functions.</p>
<dl class="type">
<dt id="c.w1_reg_num">
struct <code class="sig-name descname">w1_reg_num</code><a class="headerlink" href="#c.w1_reg_num" title="Permalink to this definition">¶</a></dt>
<dd><p>broken out slave device id</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_reg_num {
#if defined(__LITTLE_ENDIAN_BITFIELD);
    __u64 family:8,id:48, crc:8;
#elif defined(__BIG_ENDIAN_BITFIELD);
    __u64 crc:8,id:48, family:8;
#else;
#error &quot;Please fix &lt;asm/byteorder.h&gt;&quot;;
#endif;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">family</span></code></dt><dd><p>identifies the type of device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><p>along with family is the unique device id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">crc</span></code></dt><dd><p>checksum of the other bytes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">crc</span></code></dt><dd><p>checksum of the other bytes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><p>along with family is the unique device id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">family</span></code></dt><dd><p>identifies the type of device</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.w1_slave">
struct <code class="sig-name descname">w1_slave</code><a class="headerlink" href="#c.w1_slave" title="Permalink to this definition">¶</a></dt>
<dd><p>holds a single slave device on the bus</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_slave {
    struct module           *owner;
    unsigned char           name[W1_MAXNAMELEN];
    struct list_head        w1_slave_entry;
    struct w1_reg_num       reg_num;
    atomic_t refcnt;
    int ttl;
    unsigned long           flags;
    struct w1_master        *master;
    struct w1_family        *family;
    void *family_data;
    struct device           dev;
    struct device           *hwmon;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">owner</span></code></dt><dd><p>Points to the one wire “wire” kernel module.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>Device id is ascii.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">w1_slave_entry</span></code></dt><dd><p>data for the linked list</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reg_num</span></code></dt><dd><p>the slave id in binary</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">refcnt</span></code></dt><dd><p>reference count, delete when 0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ttl</span></code></dt><dd><p>decrement per search this slave isn’t found, deatch at 0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>bit flags for W1_SLAVE_ACTIVE W1_SLAVE_DETACH</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master</span></code></dt><dd><p>bus which this slave is on</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">family</span></code></dt><dd><p>module for device family type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">family_data</span></code></dt><dd><p>pointer for use by the family module</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt><dd><p>kernel device identifier</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hwmon</span></code></dt><dd><p>pointer to hwmon device</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.w1_bus_master">
struct <code class="sig-name descname">w1_bus_master</code><a class="headerlink" href="#c.w1_bus_master" title="Permalink to this definition">¶</a></dt>
<dd><p>operations available on a bus master</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_bus_master {
    void *data;
    u8 (*read_bit)(void *);
    void (*write_bit)(void *, u8);
    u8 (*touch_bit)(void *, u8);
    u8 (*read_byte)(void *);
    void (*write_byte)(void *, u8);
    u8 (*read_block)(void *, u8 *, int);
    void (*write_block)(void *, const u8 *, int);
    u8 (*triplet)(void *, u8);
    u8 (*reset_bus)(void *);
    u8 (*set_pullup)(void *, int);
    void (*search)(void *, struct w1_master *, u8, w1_slave_found_callback);
    char *dev_id;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>the first parameter in all the functions below</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">read_bit</span></code></dt><dd><p>Sample the line level <strong>return</strong> the level read (0 or 1)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_bit</span></code></dt><dd><p>Sets the line level</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">touch_bit</span></code></dt><dd><p>the lowest-level function for devices that really support the
1-wire protocol.
touch_bit(0) = write-0 cycle
touch_bit(1) = write-1 / read cycle
<strong>return</strong> the bit read (0 or 1)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">read_byte</span></code></dt><dd><p>Reads a bytes. Same as 8 touch_bit(1) calls.
<strong>return</strong> the byte read</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_byte</span></code></dt><dd><p>Writes a byte. Same as 8 touch_bit(x) calls.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">read_block</span></code></dt><dd><p>Same as a series of read_byte() calls
<strong>return</strong> the number of bytes read</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_block</span></code></dt><dd><p>Same as a series of write_byte() calls</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">triplet</span></code></dt><dd><p>Combines two reads and a smart write for ROM searches
<strong>return</strong> bit0=Id bit1=comp_id bit2=dir_taken</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reset_bus</span></code></dt><dd><p>long write-0 with a read for the presence pulse detection
<strong>return</strong> -1=Error, 0=Device present, 1=No device present</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_pullup</span></code></dt><dd><p>Put out a strong pull-up pulse of the specified duration.
<strong>return</strong> -1=Error, 0=completed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">search</span></code></dt><dd><p>Really nice hardware can handles the different types of ROM search
w1_master* is passed to the slave found callback.
u8 is search_type, W1_SEARCH or W1_ALARM_SEARCH</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev_id</span></code></dt><dd><p>Optional device id string, which w1 slaves could use for
creating names, which then give a connection to the w1 master</p>
</dd>
</dl>
</div>
<p><strong>Note</strong></p>
<p>read_bit and write_bit are very low level functions and should only
be used with hardware that doesn’t really support 1-wire operations,
like a parallel/serial port.
Either define read_bit and write_bit OR define, at minimum, touch_bit and
reset_bus.</p>
<dl class="type">
<dt id="c.w1_master_flags">
enum <code class="sig-name descname">w1_master_flags</code><a class="headerlink" href="#c.w1_master_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>bitfields used in w1_master.flags</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">W1_ABORT_SEARCH</span></code></dt><dd><p>abort searching early on shutdown</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_WARN_MAX_COUNT</span></code></dt><dd><p>limit warning when the maximum count is reached</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.w1_master">
struct <code class="sig-name descname">w1_master</code><a class="headerlink" href="#c.w1_master" title="Permalink to this definition">¶</a></dt>
<dd><p>one per bus master</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_master {
    struct list_head        w1_master_entry;
    struct module           *owner;
    unsigned char           name[W1_MAXNAMELEN];
    struct mutex            list_mutex;
    struct list_head        slist;
    struct list_head        async_list;
    int max_slave_count, slave_count;
    unsigned long           attempts;
    int slave_ttl;
    int initialized;
    u32 id;
    int search_count;
    u64 search_id;
    atomic_t refcnt;
    void *priv;
    int enable_pullup;
    int pullup_duration;
    long flags;
    struct task_struct      *thread;
    struct mutex            mutex;
    struct mutex            bus_mutex;
    struct device_driver    *driver;
    struct device           dev;
    struct w1_bus_master    *bus_master;
    u32 seq;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">w1_master_entry</span></code></dt><dd><p>master linked list</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">owner</span></code></dt><dd><p>module owner</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>dynamically allocate bus name</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">list_mutex</span></code></dt><dd><p>protect slist and async_list</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">slist</span></code></dt><dd><p>linked list of slaves</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">async_list</span></code></dt><dd><p>linked list of netlink commands to execute</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">max_slave_count</span></code></dt><dd><p>maximum number of slaves to search for at a time</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">slave_count</span></code></dt><dd><p>current number of slaves known</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">attempts</span></code></dt><dd><p>number of searches ran</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">slave_ttl</span></code></dt><dd><p>number of searches before a slave is timed out</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">initialized</span></code></dt><dd><p>prevent init/removal race conditions</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><p>w1 bus number</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">search_count</span></code></dt><dd><p>number of automatic searches to run, -1 unlimited</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">search_id</span></code></dt><dd><p>allows continuing a search</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">refcnt</span></code></dt><dd><p>reference count</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">priv</span></code></dt><dd><p>private data storage</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enable_pullup</span></code></dt><dd><p>allows a strong pullup</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pullup_duration</span></code></dt><dd><p>time for the next strong pullup</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>one of w1_master_flags</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">thread</span></code></dt><dd><p>thread for bus search and netlink commands</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mutex</span></code></dt><dd><p>protect most of w1_master</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bus_mutex</span></code></dt><dd><p>pretect concurrent bus access</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">driver</span></code></dt><dd><p>sysfs driver</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt><dd><p>sysfs device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bus_master</span></code></dt><dd><p>io operations available</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">seq</span></code></dt><dd><p>sequence number used for netlink broadcasts</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.w1_family_ops">
struct <code class="sig-name descname">w1_family_ops</code><a class="headerlink" href="#c.w1_family_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>operations for a family type</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_family_ops {
    int (*add_slave)(struct w1_slave *sl);
    void (*remove_slave)(struct w1_slave *sl);
    const struct attribute_group **groups;
    const struct hwmon_chip_info *chip_info;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">add_slave</span></code></dt><dd><p>add_slave</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">remove_slave</span></code></dt><dd><p>remove_slave</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">groups</span></code></dt><dd><p>sysfs group</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">chip_info</span></code></dt><dd><p>pointer to struct hwmon_chip_info</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.w1_family">
struct <code class="sig-name descname">w1_family</code><a class="headerlink" href="#c.w1_family" title="Permalink to this definition">¶</a></dt>
<dd><p>reference counted family structure.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_family {
    struct list_head        family_entry;
    u8 fid;
    const struct w1_family_ops *fops;
    const struct of_device_id *of_match_table;
    atomic_t refcnt;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">family_entry</span></code></dt><dd><p>family linked list</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fid</span></code></dt><dd><p>8 bit family identifier</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fops</span></code></dt><dd><p>operations for this family</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">of_match_table</span></code></dt><dd><p>open firmware match table</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">refcnt</span></code></dt><dd><p>reference counter</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.module_w1_family">
<code class="sig-name descname">module_w1_family</code><span class="sig-paren">(</span><em>__w1_family</em><span class="sig-paren">)</span><a class="headerlink" href="#c.module_w1_family" title="Permalink to this definition">¶</a></dt>
<dd><p>Helper macro for registering a 1-Wire families</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">__w1_family</span></code></dt><dd><p>w1_family struct</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Helper macro for 1-Wire families which do not do anything special in module
init/exit. This eliminates a lot of boilerplate. Each module may only
use this macro once, and calling it replaces <a class="reference internal" href="basics.html#c.module_init" title="module_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">module_init()</span></code></a> and <a class="reference internal" href="basics.html#c.module_exit" title="module_exit"><code class="xref c c-func docutils literal notranslate"><span class="pre">module_exit()</span></code></a></p>
</div>
</section>
<section id="drivers-w1-w1-c">
<h3>drivers/w1/w1.c<a class="headerlink" href="#drivers-w1-w1-c" title="Permalink to this headline">¶</a></h3>
<p>W1 core functions.</p>
<dl class="function">
<dt id="c.w1_search">
void <code class="sig-name descname">w1_search</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, u8<em> search_type</em>, w1_slave_found_callback<em> cb</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a ROM Search &amp; registers any devices found.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>The master device to search</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">search_type</span></code></dt><dd><p>W1_SEARCH to search all devices, or W1_ALARM_SEARCH
to return only devices in the alarmed state</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">w1_slave_found_callback</span> <span class="pre">cb</span></code></dt><dd><p>Function to call when a device is found</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The 1-wire search is a simple binary tree search.
For each bit of the address, we read two bits and write one bit.
The bit written will put to sleep all devies that don’t match that bit.
When the two reads differ, the direction choice is obvious.
When both bits are 0, we must choose a path to take.
When we can scan all 64 bits without having to choose a path, we are done.</p>
<p>See “Application note 187 1-wire search algorithm” at www.maxim-ic.com</p>
</div>
<dl class="function">
<dt id="c.w1_process_callbacks">
int <code class="sig-name descname">w1_process_callbacks</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_process_callbacks" title="Permalink to this definition">¶</a></dt>
<dd><p>execute each dev-&gt;async_list callback entry</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>w1_master device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The w1 master list_mutex must be held.</p>
<p><strong>Return</strong></p>
<p>1 if there were commands to executed 0 otherwise</p>
</div>
</section>
<section id="drivers-w1-w1-family-c">
<h3>drivers/w1/w1_family.c<a class="headerlink" href="#drivers-w1-w1-family-c" title="Permalink to this headline">¶</a></h3>
<p>Allows registering device family operations.</p>
<dl class="function">
<dt id="c.w1_register_family">
int <code class="sig-name descname">w1_register_family</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_family" title="w1_family">w1_family</a><em> *newf</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_register_family" title="Permalink to this definition">¶</a></dt>
<dd><p>register a device family driver</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_family</span> <span class="pre">*newf</span></code></dt><dd><p>family to register</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.w1_unregister_family">
void <code class="sig-name descname">w1_unregister_family</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_family" title="w1_family">w1_family</a><em> *fent</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_unregister_family" title="Permalink to this definition">¶</a></dt>
<dd><p>unregister a device family driver</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_family</span> <span class="pre">*fent</span></code></dt><dd><p>family to unregister</p>
</dd>
</dl>
</div>
</section>
<section id="drivers-w1-w1-internal-h">
<h3>drivers/w1/w1_internal.h<a class="headerlink" href="#drivers-w1-w1-internal-h" title="Permalink to this headline">¶</a></h3>
<p>W1 internal initialization for master devices.</p>
<dl class="type">
<dt id="c.w1_async_cmd">
struct <code class="sig-name descname">w1_async_cmd</code><a class="headerlink" href="#c.w1_async_cmd" title="Permalink to this definition">¶</a></dt>
<dd><p>execute callback from the w1_process kthread</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_async_cmd {
    struct list_head        async_entry;
    void (*cb)(struct w1_master *dev, struct w1_async_cmd *async_cmd);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">async_entry</span></code></dt><dd><p>link entry</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cb</span></code></dt><dd><p>callback function, must list_del and destroy this list before
returning</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>When inserted into the w1_master async_list, w1_process will execute
the callback.  Embed this into the structure with the command details.</p>
</section>
<section id="drivers-w1-w1-int-c">
<h3>drivers/w1/w1_int.c<a class="headerlink" href="#drivers-w1-w1-int-c" title="Permalink to this headline">¶</a></h3>
<p>W1 internal initialization for master devices.</p>
<dl class="function">
<dt id="c.w1_add_master_device">
int <code class="sig-name descname">w1_add_master_device</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_bus_master" title="w1_bus_master">w1_bus_master</a><em> *master</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_add_master_device" title="Permalink to this definition">¶</a></dt>
<dd><p>registers a new master device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_bus_master</span> <span class="pre">*master</span></code></dt><dd><p>master bus device to register</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.w1_remove_master_device">
void <code class="sig-name descname">w1_remove_master_device</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_bus_master" title="w1_bus_master">w1_bus_master</a><em> *bm</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_remove_master_device" title="Permalink to this definition">¶</a></dt>
<dd><p>unregister a master device</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_bus_master</span> <span class="pre">*bm</span></code></dt><dd><p>master bus device to remove</p>
</dd>
</dl>
</div>
</section>
<section id="drivers-w1-w1-netlink-h">
<h3>drivers/w1/w1_netlink.h<a class="headerlink" href="#drivers-w1-w1-netlink-h" title="Permalink to this headline">¶</a></h3>
<p>W1 external netlink API structures and commands.</p>
<dl class="type">
<dt id="c.w1_cn_msg_flags">
enum <code class="sig-name descname">w1_cn_msg_flags</code><a class="headerlink" href="#c.w1_cn_msg_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>bitfield flags for struct cn_msg.flags</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">W1_CN_BUNDLE</span></code></dt><dd><p>Request bundling replies into fewer messagse.  Be prepared
to handle multiple struct cn_msg, <a class="reference internal" href="#c.w1_netlink_msg" title="w1_netlink_msg"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_netlink_msg</span></code></a>, and
<a class="reference internal" href="#c.w1_netlink_cmd" title="w1_netlink_cmd"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_netlink_cmd</span></code></a> in one packet.</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.w1_netlink_message_types">
enum <code class="sig-name descname">w1_netlink_message_types</code><a class="headerlink" href="#c.w1_netlink_message_types" title="Permalink to this definition">¶</a></dt>
<dd><p>message type</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">W1_SLAVE_ADD</span></code></dt><dd><p>notification that a slave device was added</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_SLAVE_REMOVE</span></code></dt><dd><p>notification that a slave device was removed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_MASTER_ADD</span></code></dt><dd><p>notification that a new bus master was added</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_MASTER_REMOVE</span></code></dt><dd><p>notification that a bus masterwas removed</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_MASTER_CMD</span></code></dt><dd><p>initiate operations on a specific master</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_SLAVE_CMD</span></code></dt><dd><p>sends reset, selects the slave, then does a read/write/touch
operation</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_LIST_MASTERS</span></code></dt><dd><p>used to determine the bus master identifiers</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.w1_netlink_msg">
struct <code class="sig-name descname">w1_netlink_msg</code><a class="headerlink" href="#c.w1_netlink_msg" title="Permalink to this definition">¶</a></dt>
<dd><p>holds w1 message type, id, and result</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_netlink_msg {
    __u8 type;
    __u8 status;
    __u16 len;
    union {
        __u8 id[8];
        struct w1_mst {
            __u32 id;
            __u32 res;
        } mst;
    } id;
    __u8 data[];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>one of <a class="reference internal" href="#c.w1_netlink_message_types" title="w1_netlink_message_types"><code class="xref c c-type docutils literal notranslate"><span class="pre">enum</span> <span class="pre">w1_netlink_message_types</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">status</span></code></dt><dd><p>kernel feedback for success 0 or errno failure value</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">len</span></code></dt><dd><p>length of data following w1_netlink_msg</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><p>union holding bus master id (msg.id) and slave device id (id[8]).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id.id</span></code></dt><dd><p>Slave ID (8 bytes)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id.mst</span></code></dt><dd><p>bus master identification</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id.mst.id</span></code></dt><dd><p>bus master ID</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id.mst.res</span></code></dt><dd><p>bus master reserved</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>start address of any following data</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>The base message structure for w1 messages over netlink.
The netlink connector data sequence is, struct nlmsghdr, struct cn_msg,
then one or more <a class="reference internal" href="#c.w1_netlink_msg" title="w1_netlink_msg"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_netlink_msg</span></code></a> (each with optional data).</p>
<dl class="type">
<dt id="c.w1_commands">
enum <code class="sig-name descname">w1_commands</code><a class="headerlink" href="#c.w1_commands" title="Permalink to this definition">¶</a></dt>
<dd><p>commands available for master or slave operations</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Constants</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_READ</span></code></dt><dd><p>read len bytes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_WRITE</span></code></dt><dd><p>write len bytes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_SEARCH</span></code></dt><dd><p>initiate a standard search, returns only the slave
devices found during that search</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_ALARM_SEARCH</span></code></dt><dd><p>search for devices that are currently alarming</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_TOUCH</span></code></dt><dd><p>Touches a series of bytes.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_RESET</span></code></dt><dd><p>sends a bus reset on the given master</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_SLAVE_ADD</span></code></dt><dd><p>adds a slave to the given master,
8 byte slave id at data[0]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_SLAVE_REMOVE</span></code></dt><dd><p>removes a slave to the given master,
8 byte slave id at data[0]</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_LIST_SLAVES</span></code></dt><dd><p>list of slaves registered on this master</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">W1_CMD_MAX</span></code></dt><dd><p>number of available commands</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.w1_netlink_cmd">
struct <code class="sig-name descname">w1_netlink_cmd</code><a class="headerlink" href="#c.w1_netlink_cmd" title="Permalink to this definition">¶</a></dt>
<dd><p>holds the command and data</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct w1_netlink_cmd {
    __u8 cmd;
    __u8 res;
    __u16 len;
    __u8 data[];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cmd</span></code></dt><dd><p>one of <a class="reference internal" href="#c.w1_commands" title="w1_commands"><code class="xref c c-type docutils literal notranslate"><span class="pre">enum</span> <span class="pre">w1_commands</span></code></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">res</span></code></dt><dd><p>reserved</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">len</span></code></dt><dd><p>length of data following w1_netlink_cmd</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>start address of any following data</p>
</dd>
</dl>
</div>
<p><strong>Description</strong></p>
<p>One or more <a class="reference internal" href="#c.w1_netlink_cmd" title="w1_netlink_cmd"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_netlink_cmd</span></code></a> is placed starting at w1_netlink_msg.data
each with optional data.</p>
</section>
<section id="drivers-w1-w1-io-c">
<h3>drivers/w1/w1_io.c<a class="headerlink" href="#drivers-w1-w1-io-c" title="Permalink to this headline">¶</a></h3>
<p>W1 input/output.</p>
<dl class="function">
<dt id="c.w1_touch_bit">
u8 <code class="sig-name descname">w1_touch_bit</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, int<em> bit</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_touch_bit" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a write-0 or write-1 cycle and samples the level.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">bit</span></code></dt><dd><p>0 - write a 0, 1 - write a 0 read the level</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.w1_write_8">
void <code class="sig-name descname">w1_write_8</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, u8<em> byte</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_write_8" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes 8 bits.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">byte</span></code></dt><dd><p>the byte to write</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.w1_triplet">
u8 <code class="sig-name descname">w1_triplet</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, int<em> bdir</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_triplet" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li><p>Does a triplet - used for searching ROM addresses.</p></li>
</ul>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">bdir</span></code></dt><dd><p>the bit to write if both id_bit and comp_bit are 0</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<dl class="simple">
<dt>Return bits:</dt><dd><p>bit 0 = id_bit
bit 1 = comp_bit
bit 2 = dir_taken</p>
</dd>
</dl>
<p>If both bits 0 &amp; 1 are set, the search should be restarted.</p>
<p><strong>Return</strong></p>
<p>bit fields - see above</p>
</div>
<dl class="function">
<dt id="c.w1_read_8">
u8 <code class="sig-name descname">w1_read_8</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_read_8" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads 8 bits.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>the byte read</p>
</div>
<dl class="function">
<dt id="c.w1_write_block">
void <code class="sig-name descname">w1_write_block</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, const u8<em> *buf</em>, int<em> len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_write_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes a series of bytes.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">u8</span> <span class="pre">*buf</span></code></dt><dd><p>pointer to the data to write</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">len</span></code></dt><dd><p>the number of bytes to write</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.w1_touch_block">
void <code class="sig-name descname">w1_touch_block</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, u8<em> *buf</em>, int<em> len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_touch_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Touches a series of bytes.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*buf</span></code></dt><dd><p>pointer to the data to write</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">len</span></code></dt><dd><p>the number of bytes to write</p>
</dd>
</dl>
</div>
<dl class="function">
<dt id="c.w1_read_block">
u8 <code class="sig-name descname">w1_read_block</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, u8<em> *buf</em>, int<em> len</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_read_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a series of bytes.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u8</span> <span class="pre">*buf</span></code></dt><dd><p>pointer to the buffer to fill</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">len</span></code></dt><dd><p>the number of bytes to read</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>the number of bytes read</p>
</div>
<dl class="function">
<dt id="c.w1_reset_bus">
int <code class="sig-name descname">w1_reset_bus</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_reset_bus" title="Permalink to this definition">¶</a></dt>
<dd><p>Issues a reset bus sequence.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>0=Device present, 1=No device present or error</p>
</div>
<dl class="function">
<dt id="c.w1_reset_select_slave">
int <code class="sig-name descname">w1_reset_select_slave</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_slave" title="w1_slave">w1_slave</a><em> *sl</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_reset_select_slave" title="Permalink to this definition">¶</a></dt>
<dd><p>reset and select a slave</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_slave</span> <span class="pre">*sl</span></code></dt><dd><p>the slave to select</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Resets the bus and then selects the slave by sending either a skip rom
or a rom match.  A skip rom is issued if there is only one device
registered on the bus.
The w1 master lock must be held.</p>
<p><strong>Return</strong></p>
<p>0=success, anything else=error</p>
</div>
<dl class="function">
<dt id="c.w1_reset_resume_command">
int <code class="sig-name descname">w1_reset_resume_command</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_reset_resume_command" title="Permalink to this definition">¶</a></dt>
<dd><p>resume instead of another match ROM</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>When the workflow with a slave amongst many requires several
successive commands a reset between each, this function is similar
to doing a reset then a match ROM for the last matched ROM. The
advantage being that the matched ROM step is skipped in favor of the
resume command. The slave must support the command of course.</p>
<p>If the bus has only one slave, traditionnaly the match ROM is skipped
and a “SKIP ROM” is done for efficiency. On multi-slave busses, this
doesn’t work of course, but the resume command is the next best thing.</p>
<p>The w1 master lock must be held.</p>
</div>
<dl class="function">
<dt id="c.w1_next_pullup">
void <code class="sig-name descname">w1_next_pullup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, int<em> delay</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_next_pullup" title="Permalink to this definition">¶</a></dt>
<dd><p>register for a strong pullup</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">delay</span></code></dt><dd><p>time in milliseconds</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Put out a strong pull-up of the specified duration after the next write
operation.  Not all hardware supports strong pullups.  Hardware that
doesn’t support strong pullups will sleep for the given time after the
write operation without a strong pullup.  This is a one shot request for
the next write, specifying zero will clear a previous request.
The w1 master lock must be held.</p>
<p><strong>Return</strong></p>
<p>0=success, anything else=error</p>
</div>
<dl class="function">
<dt id="c.w1_write_bit">
void <code class="sig-name descname">w1_write_bit</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em>, int<em> bit</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_write_bit" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a write-0 or write-1 cycle.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">bit</span></code></dt><dd><p>bit to write</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Only call if dev-&gt;bus_master-&gt;touch_bit is NULL</p>
</div>
<dl class="function">
<dt id="c.w1_pre_write">
void <code class="sig-name descname">w1_pre_write</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_pre_write" title="Permalink to this definition">¶</a></dt>
<dd><p>pre-write operations</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Pre-write operation, currently only supporting strong pullups.
Program the hardware for a strong pullup, if one has been requested and
the hardware supports it.</p>
</div>
<dl class="function">
<dt id="c.w1_post_write">
void <code class="sig-name descname">w1_post_write</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_post_write" title="Permalink to this definition">¶</a></dt>
<dd><p>post-write options</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Post-write operation, currently only supporting strong pullups.
If a strong pullup was requested, clear it if the hardware supports
them, or execute the delay otherwise, in either case clear the request.</p>
</div>
<dl class="function">
<dt id="c.w1_read_bit">
u8 <code class="sig-name descname">w1_read_bit</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.w1_master" title="w1_master">w1_master</a><em> *dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.w1_read_bit" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a write-1 cycle and samples the level.</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">w1_master</span> <span class="pre">*dev</span></code></dt><dd><p>the master device</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>Only call if dev-&gt;bus_master-&gt;touch_bit is NULL</p>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">W1: Dallas’ 1-wire bus</a><ul>
<li><a class="reference internal" href="#w1-api-internal-to-the-kernel">W1 API internal to the kernel</a><ul>
<li><a class="reference internal" href="#include-linux-w1-h">include/linux/w1.h</a></li>
<li><a class="reference internal" href="#drivers-w1-w1-c">drivers/w1/w1.c</a></li>
<li><a class="reference internal" href="#drivers-w1-w1-family-c">drivers/w1/w1_family.c</a></li>
<li><a class="reference internal" href="#drivers-w1-w1-internal-h">drivers/w1/w1_internal.h</a></li>
<li><a class="reference internal" href="#drivers-w1-w1-int-c">drivers/w1/w1_int.c</a></li>
<li><a class="reference internal" href="#drivers-w1-w1-netlink-h">drivers/w1/w1_netlink.h</a></li>
<li><a class="reference internal" href="#drivers-w1-w1-io-c">drivers/w1/w1_io.c</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/driver-api/w1.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/driver-api/w1.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>