
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>NVDIMM Runtime Firmware Activation &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="W1: Dallas’ 1-wire bus" href="../w1.html" />
    <link rel="prev" title="NVDIMM Security" href="security.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="nvdimm-runtime-firmware-activation">
<h1>NVDIMM Runtime Firmware Activation<a class="headerlink" href="#nvdimm-runtime-firmware-activation" title="Permalink to this headline">¶</a></h1>
<p>Some persistent memory devices run a firmware locally on the device /
“DIMM” to perform tasks like media management, capacity provisioning,
and health monitoring. The process of updating that firmware typically
involves a reboot because it has implications for in-flight memory
transactions. However, reboots are disruptive and at least the Intel
persistent memory platform implementation, described by the Intel ACPI
DSM specification [1], has added support for activating firmware at
runtime.</p>
<p>A native sysfs interface is implemented in libnvdimm to allow platform
to advertise and control their local runtime firmware activation
capability.</p>
<p>The libnvdimm bus object, ndbusX, implements an ndbusX/firmware/activate
attribute that shows the state of the firmware activation as one of ‘idle’,
‘armed’, ‘overflow’, and ‘busy’.</p>
<ul class="simple">
<li><p>idle:
No devices are set / armed to activate firmware</p></li>
<li><p>armed:
At least one device is armed</p></li>
<li><p>busy:
In the busy state armed devices are in the process of transitioning
back to idle and completing an activation cycle.</p></li>
<li><p>overflow:
If the platform has a concept of incremental work needed to perform
the activation it could be the case that too many DIMMs are armed for
activation. In that scenario the potential for firmware activation to
timeout is indicated by the ‘overflow’ state.</p></li>
</ul>
<p>The ‘ndbusX/firmware/activate’ property can be written with a value of
either ‘live’, or ‘quiesce’. A value of ‘quiesce’ triggers the kernel to
run firmware activation from within the equivalent of the hibernation
‘freeze’ state where drivers and applications are notified to stop their
modifications of system memory. A value of ‘live’ attempts
firmware activation without this hibernation cycle. The
‘ndbusX/firmware/activate’ property will be elided completely if no
firmware activation capability is detected.</p>
<p>Another property ‘ndbusX/firmware/capability’ indicates a value of
‘live’ or ‘quiesce’, where ‘live’ indicates that the firmware
does not require or inflict any quiesce period on the system to update
firmware. A capability value of ‘quiesce’ indicates that firmware does
expect and injects a quiet period for the memory controller, but ‘live’
may still be written to ‘ndbusX/firmware/activate’ as an override to
assume the risk of racing firmware update with in-flight device and
application activity. The ‘ndbusX/firmware/capability’ property will be
elided completely if no firmware activation capability is detected.</p>
<p>The libnvdimm memory-device / DIMM object, nmemX, implements
‘nmemX/firmware/activate’ and ‘nmemX/firmware/result’ attributes to
communicate the per-device firmware activation state. Similar to the
‘ndbusX/firmware/activate’ attribute, the ‘nmemX/firmware/activate’
attribute indicates ‘idle’, ‘armed’, or ‘busy’. The state transitions
from ‘armed’ to ‘idle’ when the system is prepared to activate firmware,
firmware staged + state set to armed, and ‘ndbusX/firmware/activate’ is
triggered. After that activation event the nmemX/firmware/result
attribute reflects the state of the last activation as one of:</p>
<ul class="simple">
<li><p>none:
No runtime activation triggered since the last time the device was reset</p></li>
<li><p>success:
The last runtime activation completed successfully.</p></li>
<li><p>fail:
The last runtime activation failed for device-specific reasons.</p></li>
<li><p>not_staged:
The last runtime activation failed due to a sequencing error of the
firmware image not being staged.</p></li>
<li><p>need_reset:
Runtime firmware activation failed, but the firmware can still be
activated via the legacy method of power-cycling the system.</p></li>
</ul>
<p>[1]: <a class="reference external" href="https://docs.pmem.io/persistent-memory/">https://docs.pmem.io/persistent-memory/</a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/driver-api/nvdimm/firmware-activate.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/driver-api/nvdimm/firmware-activate.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>