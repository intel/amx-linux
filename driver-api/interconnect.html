
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Generic System Interconnect Subsystem &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Device Frequency Scaling" href="devfreq.html" />
    <link rel="prev" title="I3C master controller driver API" href="i3c/master-driver-api.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="generic-system-interconnect-subsystem">
<h1>Generic System Interconnect Subsystem<a class="headerlink" href="#generic-system-interconnect-subsystem" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This framework is designed to provide a standard kernel interface to control
the settings of the interconnects on an SoC. These settings can be throughput,
latency and priority between multiple interconnected devices or functional
blocks. This can be controlled dynamically in order to save power or provide
maximum performance.</p>
<p>The interconnect bus is hardware with configurable parameters, which can be
set on a data path according to the requests received from various drivers.
An example of interconnect buses are the interconnects between various
components or functional blocks in chipsets. There can be multiple interconnects
on an SoC that can be multi-tiered.</p>
<p>Below is a simplified diagram of a real-world SoC interconnect bus topology.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+----------------+    +----------------+
| HW Accelerator |---&gt;|      M NoC     |&lt;---------------+
+----------------+    +----------------+                |
                        |      |                    +------------+
 +-----+  +-------------+      V       +------+     |            |
 | DDR |  |                +--------+  | PCIe |     |            |
 +-----+  |                | Slaves |  +------+     |            |
   ^ ^    |                +--------+     |         |   C NoC    |
   | |    V                               V         |            |
+------------------+   +------------------------+   |            |   +-----+
|                  |--&gt;|                        |--&gt;|            |--&gt;| CPU |
|                  |--&gt;|                        |&lt;--|            |   +-----+
|     Mem NoC      |   |         S NoC          |   +------------+
|                  |&lt;--|                        |---------+    |
|                  |&lt;--|                        |&lt;------+ |    |   +--------+
+------------------+   +------------------------+       | |    +--&gt;| Slaves |
  ^  ^    ^    ^          ^                             | |        +--------+
  |  |    |    |          |                             | V
+------+  |  +-----+   +-----+  +---------+   +----------------+   +--------+
| CPUs |  |  | GPU |   | DSP |  | Masters |--&gt;|       P NoC    |--&gt;| Slaves |
+------+  |  +-----+   +-----+  +---------+   +----------------+   +--------+
          |
      +-------+
      | Modem |
      +-------+
</pre></div>
</div>
</section>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<p>Interconnect provider is the software definition of the interconnect hardware.
The interconnect providers on the above diagram are M NoC, S NoC, C NoC, P NoC
and Mem NoC.</p>
<p>Interconnect node is the software definition of the interconnect hardware
port. Each interconnect provider consists of multiple interconnect nodes,
which are connected to other SoC components including other interconnect
providers. The point on the diagram where the CPUs connect to the memory is
called an interconnect node, which belongs to the Mem NoC interconnect provider.</p>
<p>Interconnect endpoints are the first or the last element of the path. Every
endpoint is a node, but not every node is an endpoint.</p>
<p>Interconnect path is everything between two endpoints including all the nodes
that have to be traversed to reach from a source to destination node. It may
include multiple master-slave pairs across several interconnect providers.</p>
<p>Interconnect consumers are the entities which make use of the data paths exposed
by the providers. The consumers send requests to providers requesting various
throughput, latency and priority. Usually the consumers are device drivers, that
send request based on their needs. An example for a consumer is a video decoder
that supports various formats and image sizes.</p>
</section>
<section id="interconnect-providers">
<h2>Interconnect providers<a class="headerlink" href="#interconnect-providers" title="Permalink to this headline">¶</a></h2>
<p>Interconnect provider is an entity that implements methods to initialize and
configure interconnect bus hardware. The interconnect provider drivers should
be registered with the interconnect provider core.</p>
<dl class="type">
<dt id="c.icc_node_data">
struct <code class="sig-name descname">icc_node_data</code><a class="headerlink" href="#c.icc_node_data" title="Permalink to this definition">¶</a></dt>
<dd><p>icc node data</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct icc_node_data {
    struct icc_node *node;
    u32 tag;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">node</span></code></dt><dd><p>icc node</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tag</span></code></dt><dd><p>tag</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.icc_onecell_data">
struct <code class="sig-name descname">icc_onecell_data</code><a class="headerlink" href="#c.icc_onecell_data" title="Permalink to this definition">¶</a></dt>
<dd><p>driver data for onecell interconnect providers</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct icc_onecell_data {
    unsigned int num_nodes;
    struct icc_node *nodes[];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">num_nodes</span></code></dt><dd><p>number of nodes in this device</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nodes</span></code></dt><dd><p>array of pointers to the nodes in this device</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.icc_provider">
struct <code class="sig-name descname">icc_provider</code><a class="headerlink" href="#c.icc_provider" title="Permalink to this definition">¶</a></dt>
<dd><p>interconnect provider (controller) entity that might provide multiple interconnect controls</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct icc_provider {
    struct list_head        provider_list;
    struct list_head        nodes;
    int (*set)(struct icc_node *src, struct icc_node *dst);
    int (*aggregate)(struct icc_node *node, u32 tag, u32 avg_bw, u32 peak_bw, u32 *agg_avg, u32 *agg_peak);
    void (*pre_aggregate)(struct icc_node *node);
    int (*get_bw)(struct icc_node *node, u32 *avg, u32 *peak);
    struct icc_node* (*xlate)(struct of_phandle_args *spec, void *data);
    struct icc_node_data* (*xlate_extended)(struct of_phandle_args *spec, void *data);
    struct device           *dev;
    int users;
    bool inter_set;
    void *data;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">provider_list</span></code></dt><dd><p>list of the registered interconnect providers</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nodes</span></code></dt><dd><p>internal list of the interconnect provider nodes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set</span></code></dt><dd><p>pointer to device specific set operation function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aggregate</span></code></dt><dd><p>pointer to device specific aggregate operation function</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pre_aggregate</span></code></dt><dd><p>pointer to device specific function that is called
before the aggregation begins (optional)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">get_bw</span></code></dt><dd><p>pointer to device specific function to get current bandwidth</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xlate</span></code></dt><dd><p>provider-specific callback for mapping nodes from phandle arguments</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xlate_extended</span></code></dt><dd><p>vendor-specific callback for mapping node data from phandle arguments</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt><dd><p>the device this interconnect provider belongs to</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">users</span></code></dt><dd><p>count of active users</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">inter_set</span></code></dt><dd><p>whether inter-provider pairs will be configured with <strong>set</strong></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>pointer to private data</p>
</dd>
</dl>
</div>
<dl class="type">
<dt id="c.icc_node">
struct <code class="sig-name descname">icc_node</code><a class="headerlink" href="#c.icc_node" title="Permalink to this definition">¶</a></dt>
<dd><p>entity that is part of the interconnect topology</p>
</dd></dl>

<div class="kernelindent docutils container">
<p><strong>Definition</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct icc_node {
    int id;
    const char              *name;
    struct icc_node         **links;
    size_t num_links;
    struct icc_provider     *provider;
    struct list_head        node_list;
    struct list_head        search_list;
    struct icc_node         *reverse;
    u8 is_traversed:1;
    struct hlist_head       req_list;
    u32 avg_bw;
    u32 peak_bw;
    u32 init_avg;
    u32 init_peak;
    void *data;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><p>platform specific node id</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>node name used in debugfs</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">links</span></code></dt><dd><p>a list of targets pointing to where we can go next when traversing</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_links</span></code></dt><dd><p>number of links to other interconnect nodes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">provider</span></code></dt><dd><p>points to the interconnect provider of this node</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">node_list</span></code></dt><dd><p>the list entry in the parent provider’s “nodes” list</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">search_list</span></code></dt><dd><p>list used when walking the nodes graph</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reverse</span></code></dt><dd><p>pointer to previous node when walking the nodes graph</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">is_traversed</span></code></dt><dd><p>flag that is used when walking the nodes graph</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">req_list</span></code></dt><dd><p>a list of QoS constraint requests associated with this node</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">avg_bw</span></code></dt><dd><p>aggregated value of average bandwidth requests from all consumers</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">peak_bw</span></code></dt><dd><p>aggregated value of peak bandwidth requests from all consumers</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">init_avg</span></code></dt><dd><p>average bandwidth value that is read from the hardware during init</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">init_peak</span></code></dt><dd><p>peak bandwidth value that is read from the hardware during init</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>pointer to private data</p>
</dd>
</dl>
</div>
</section>
<section id="interconnect-consumers">
<h2>Interconnect consumers<a class="headerlink" href="#interconnect-consumers" title="Permalink to this headline">¶</a></h2>
<p>Interconnect consumers are the clients which use the interconnect APIs to
get paths between endpoints and set their bandwidth/latency/QoS requirements
for these interconnect paths.  These interfaces are not currently
documented.</p>
</section>
<section id="interconnect-debugfs-interfaces">
<h2>Interconnect debugfs interfaces<a class="headerlink" href="#interconnect-debugfs-interfaces" title="Permalink to this headline">¶</a></h2>
<p>Like several other subsystems interconnect will create some files for debugging
and introspection. Files in debugfs are not considered ABI so application
software shouldn’t rely on format details change between kernel versions.</p>
<p><code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/interconnect/interconnect_summary</span></code>:</p>
<p>Show all interconnect nodes in the system with their aggregated bandwidth
request. Indented under each node show bandwidth requests from each device.</p>
<p><code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/interconnect/interconnect_graph</span></code>:</p>
<p>Show the interconnect graph in the graphviz dot format. It shows all
interconnect nodes and links in the system and groups together nodes from the
same provider as subgraphs. The format is human-readable and can also be piped
through dot to generate diagrams in many graphical formats:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat /sys/kernel/debug/interconnect/interconnect_graph | \
        dot -Tsvg &gt; interconnect_graph.svg
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Generic System Interconnect Subsystem</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#interconnect-providers">Interconnect providers</a></li>
<li><a class="reference internal" href="#interconnect-consumers">Interconnect consumers</a></li>
<li><a class="reference internal" href="#interconnect-debugfs-interfaces">Interconnect debugfs interfaces</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/driver-api/interconnect.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/driver-api/interconnect.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>