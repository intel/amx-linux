
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ALSA Jack Software Injection &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ALSA SoC Layer" href="../soc/index.html" />
    <link rel="prev" title="OSS Sequencer Emulation on ALSA" href="seq-oss.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="alsa-jack-software-injection">
<h1>ALSA Jack Software Injection<a class="headerlink" href="#alsa-jack-software-injection" title="Permalink to this headline">¶</a></h1>
<section id="simple-introduction-on-jack-injection">
<h2>Simple Introduction On Jack Injection<a class="headerlink" href="#simple-introduction-on-jack-injection" title="Permalink to this headline">¶</a></h2>
<p>Here jack injection means users could inject plugin or plugout events
to the audio jacks through debugfs interface, it is helpful to
validate ALSA userspace changes. For example, we change the audio
profile switching code in the pulseaudio, and we want to verify if the
change works as expected and if the change introduce the regression,
in this case, we could inject plugin or plugout events to an audio
jack or to some audio jacks, we don’t need to physically access the
machine and plug/unplug physical devices to the audio jack.</p>
<p>In this design, an audio jack doesn’t equal to a physical audio jack.
Sometimes a physical audio jack contains multi functions, and the
ALSA driver creates multi <code class="docutils literal notranslate"><span class="pre">jack_kctl</span></code> for a <code class="docutils literal notranslate"><span class="pre">snd_jack</span></code>, here the
<code class="docutils literal notranslate"><span class="pre">snd_jack</span></code> represents a physical audio jack and the <code class="docutils literal notranslate"><span class="pre">jack_kctl</span></code>
represents a function, for example a physical jack has two functions:
headphone and mic_in, the ALSA ASoC driver will build 2 <code class="docutils literal notranslate"><span class="pre">jack_kctl</span></code>
for this jack. The jack injection is implemented based on the
<code class="docutils literal notranslate"><span class="pre">jack_kctl</span></code> instead of <code class="docutils literal notranslate"><span class="pre">snd_jack</span></code>.</p>
<p>To inject events to audio jacks, we need to enable the jack injection
via <code class="docutils literal notranslate"><span class="pre">sw_inject_enable</span></code> first, once it is enabled, this jack will not
change the state by hardware events anymore, we could inject plugin or
plugout events via <code class="docutils literal notranslate"><span class="pre">jackin_inject</span></code> and check the jack state via
<code class="docutils literal notranslate"><span class="pre">status</span></code>, after we finish our test, we need to disable the jack
injection via <code class="docutils literal notranslate"><span class="pre">sw_inject_enable</span></code> too, once it is disabled, the jack
state will be restored according to the last reported hardware events
and will change by future hardware events.</p>
</section>
<section id="the-layout-of-jack-injection-interface">
<h2>The Layout of Jack Injection Interface<a class="headerlink" href="#the-layout-of-jack-injection-interface" title="Permalink to this headline">¶</a></h2>
<p>If users enable the SND_JACK_INJECTION_DEBUG in the kernel, the audio
jack injection interface will be created as below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$debugfs_mount_dir/sound
|-- card0
|-- |-- HDMI_DP_pcm_10_Jack
|-- |-- |-- jackin_inject
|-- |-- |-- kctl_id
|-- |-- |-- mask_bits
|-- |-- |-- status
|-- |-- |-- sw_inject_enable
|-- |-- |-- type
...
|-- |-- HDMI_DP_pcm_9_Jack
|--     |-- jackin_inject
|--     |-- kctl_id
|--     |-- mask_bits
|--     |-- status
|--     |-- sw_inject_enable
|--     |-- type
|-- card1
    |-- HDMI_DP_pcm_5_Jack
    |-- |-- jackin_inject
    |-- |-- kctl_id
    |-- |-- mask_bits
    |-- |-- status
    |-- |-- sw_inject_enable
    |-- |-- type
    ...
    |-- Headphone_Jack
    |-- |-- jackin_inject
    |-- |-- kctl_id
    |-- |-- mask_bits
    |-- |-- status
    |-- |-- sw_inject_enable
    |-- |-- type
    |-- Headset_Mic_Jack
        |-- jackin_inject
        |-- kctl_id
        |-- mask_bits
        |-- status
        |-- sw_inject_enable
        |-- type
</pre></div>
</div>
</section>
<section id="the-explanation-of-the-nodes">
<h2>The Explanation Of The Nodes<a class="headerlink" href="#the-explanation-of-the-nodes" title="Permalink to this headline">¶</a></h2>
<dl>
<dt>kctl_id</dt><dd><p>read-only, get jack_kctl-&gt;kctl’s id</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat kctl_id
Headphone Jack
</pre></div>
</div>
</dd>
<dt>mask_bits</dt><dd><p>read-only, get jack_kctl’s supported events mask_bits</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat mask_bits
0x0001 HEADPHONE(0x0001)
</pre></div>
</div>
</dd>
<dt>status</dt><dd><p>read-only, get jack_kctl’s current status</p>
</dd>
</dl>
<ul>
<li><p>headphone unplugged:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat status
Unplugged
</pre></div>
</div>
</li>
<li><p>headphone plugged:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat status
Plugged
</pre></div>
</div>
</li>
</ul>
<dl>
<dt>type</dt><dd><p>read-only, get snd_jack’s supported events from type (all supported events on the physical audio jack)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat type
0x7803 HEADPHONE(0x0001) MICROPHONE(0x0002) BTN_3(0x0800) BTN_2(0x1000) BTN_1(0x2000) BTN_0(0x4000)
</pre></div>
</div>
</dd>
<dt>sw_inject_enable</dt><dd><p>read-write, enable or disable injection</p>
</dd>
</dl>
<ul>
<li><p>injection disabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat sw_inject_enable
Jack: Headphone Jack               Inject Enabled: 0
</pre></div>
</div>
</li>
<li><p>injection enabled:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# cat sw_inject_enable
Jack: Headphone Jack               Inject Enabled: 1
</pre></div>
</div>
</li>
<li><p>to enable jack injection:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# echo 1 &gt; sw_inject_enable
</pre></div>
</div>
</li>
<li><p>to disable jack injection:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# echo 0 &gt; sw_inject_enable
</pre></div>
</div>
</li>
</ul>
<dl class="simple">
<dt>jackin_inject</dt><dd><p>write-only, inject plugin or plugout</p>
</dd>
</dl>
<ul>
<li><p>to inject plugin:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# echo 1 &gt; jackin_inject
</pre></div>
</div>
</li>
<li><p>to inject plugout:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sound/card1/Headphone_Jack# echo 0 &gt; jackin_inject
</pre></div>
</div>
</li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ALSA Jack Software Injection</a><ul>
<li><a class="reference internal" href="#simple-introduction-on-jack-injection">Simple Introduction On Jack Injection</a></li>
<li><a class="reference internal" href="#the-layout-of-jack-injection-interface">The Layout of Jack Injection Interface</a></li>
<li><a class="reference internal" href="#the-explanation-of-the-nodes">The Explanation Of The Nodes</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/sound/designs/jack-injection.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/sound/designs/jack-injection.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>