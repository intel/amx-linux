
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Gadget Testing &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Infinity Usb Unlimited Readme" href="iuu_phoenix.html" />
    <link rel="prev" title="Linux Gadget Serial Driver v2.0" href="gadget_serial.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="gadget-testing">
<h1>Gadget Testing<a class="headerlink" href="#gadget-testing" title="Permalink to this headline">¶</a></h1>
<p>This file summarizes information on basic testing of USB functions
provided by gadgets.</p>
<section id="acm-function">
<h2>1. ACM function<a class="headerlink" href="#acm-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_acm.ko module.</p>
<section id="function-specific-configfs-interface">
<h3>Function-specific configfs interface<a class="headerlink" href="#function-specific-configfs-interface" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “acm”.
The ACM function provides just one attribute in its function directory:</p>
<blockquote>
<div><p>port_num</p>
</div></blockquote>
<p>The attribute is read-only.</p>
<p>There can be at most 4 ACM/generic serial/OBEX ports in the system.</p>
</section>
<section id="testing-the-acm-function">
<h3>Testing the ACM function<a class="headerlink" href="#testing-the-acm-function" title="Permalink to this headline">¶</a></h3>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &gt; /dev/ttyACM&lt;X&gt;
</pre></div>
</div>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /dev/ttyGS&lt;Y&gt;
</pre></div>
</div>
<p>then the other way round</p>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &gt; /dev/ttyGS&lt;Y&gt;
</pre></div>
</div>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /dev/ttyACM&lt;X&gt;
</pre></div>
</div>
</section>
</section>
<section id="ecm-function">
<h2>2. ECM function<a class="headerlink" href="#ecm-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_ecm.ko module.</p>
<section id="id1">
<h3>Function-specific configfs interface<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “ecm”.
The ECM function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ifname</p></td>
<td><p>network device interface name associated with this
function instance</p></td>
</tr>
<tr class="row-even"><td><p>qmult</p></td>
<td><p>queue length multiplier for high and super speed</p></td>
</tr>
<tr class="row-odd"><td><p>host_addr</p></td>
<td><p>MAC address of host’s end of this
Ethernet over USB link</p></td>
</tr>
<tr class="row-even"><td><p>dev_addr</p></td>
<td><p>MAC address of device’s end of this
Ethernet over USB link</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and after creating the functions/ecm.&lt;instance name&gt; they contain default
values: qmult is 5, dev_addr and host_addr are randomly selected.
The ifname can be written to if the function is not bound. A write must be an
interface pattern such as “usb%d”, which will cause the net core to choose the
next free usbX interface. By default, it is set to “usb%d”.</p>
</section>
<section id="testing-the-ecm-function">
<h3>Testing the ECM function<a class="headerlink" href="#testing-the-ecm-function" title="Permalink to this headline">¶</a></h3>
<p>Configure IP addresses of the device and the host. Then:</p>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;host&#39;s IP&gt;
</pre></div>
</div>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;device&#39;s IP&gt;
</pre></div>
</div>
</section>
</section>
<section id="ecm-subset-function">
<h2>3. ECM subset function<a class="headerlink" href="#ecm-subset-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_ecm_subset.ko module.</p>
<section id="id2">
<h3>Function-specific configfs interface<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “geth”.
The ECM subset function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ifname</p></td>
<td><p>network device interface name associated with this
function instance</p></td>
</tr>
<tr class="row-even"><td><p>qmult</p></td>
<td><p>queue length multiplier for high and super speed</p></td>
</tr>
<tr class="row-odd"><td><p>host_addr</p></td>
<td><p>MAC address of host’s end of this
Ethernet over USB link</p></td>
</tr>
<tr class="row-even"><td><p>dev_addr</p></td>
<td><p>MAC address of device’s end of this
Ethernet over USB link</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and after creating the functions/ecm.&lt;instance name&gt; they contain default
values: qmult is 5, dev_addr and host_addr are randomly selected.
The ifname can be written to if the function is not bound. A write must be an
interface pattern such as “usb%d”, which will cause the net core to choose the
next free usbX interface. By default, it is set to “usb%d”.</p>
</section>
<section id="testing-the-ecm-subset-function">
<h3>Testing the ECM subset function<a class="headerlink" href="#testing-the-ecm-subset-function" title="Permalink to this headline">¶</a></h3>
<p>Configure IP addresses of the device and the host. Then:</p>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;host&#39;s IP&gt;
</pre></div>
</div>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;device&#39;s IP&gt;
</pre></div>
</div>
</section>
</section>
<section id="eem-function">
<h2>4. EEM function<a class="headerlink" href="#eem-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_eem.ko module.</p>
<section id="id3">
<h3>Function-specific configfs interface<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “eem”.
The EEM function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ifname</p></td>
<td><p>network device interface name associated with this
function instance</p></td>
</tr>
<tr class="row-even"><td><p>qmult</p></td>
<td><p>queue length multiplier for high and super speed</p></td>
</tr>
<tr class="row-odd"><td><p>host_addr</p></td>
<td><p>MAC address of host’s end of this
Ethernet over USB link</p></td>
</tr>
<tr class="row-even"><td><p>dev_addr</p></td>
<td><p>MAC address of device’s end of this
Ethernet over USB link</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and after creating the functions/eem.&lt;instance name&gt; they contain default
values: qmult is 5, dev_addr and host_addr are randomly selected.
The ifname can be written to if the function is not bound. A write must be an
interface pattern such as “usb%d”, which will cause the net core to choose the
next free usbX interface. By default, it is set to “usb%d”.</p>
</section>
<section id="testing-the-eem-function">
<h3>Testing the EEM function<a class="headerlink" href="#testing-the-eem-function" title="Permalink to this headline">¶</a></h3>
<p>Configure IP addresses of the device and the host. Then:</p>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;host&#39;s IP&gt;
</pre></div>
</div>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;device&#39;s IP&gt;
</pre></div>
</div>
</section>
</section>
<section id="ffs-function">
<h2>5. FFS function<a class="headerlink" href="#ffs-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_fs.ko module.</p>
<section id="id4">
<h3>Function-specific configfs interface<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “ffs”.
The function directory is intentionally empty and not modifiable.</p>
<p>After creating the directory there is a new instance (a “device”) of FunctionFS
available in the system. Once a “device” is available, the user should follow
the standard procedure for using FunctionFS (mount it, run the userspace
process which implements the function proper). The gadget should be enabled
by writing a suitable string to usb_gadget/&lt;gadget&gt;/UDC.</p>
</section>
<section id="testing-the-ffs-function">
<h3>Testing the FFS function<a class="headerlink" href="#testing-the-ffs-function" title="Permalink to this headline">¶</a></h3>
<p>On the device: start the function’s userspace daemon, enable the gadget</p>
<p>On the host: use the USB function provided by the device</p>
</section>
</section>
<section id="hid-function">
<h2>6. HID function<a class="headerlink" href="#hid-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_hid.ko module.</p>
<section id="id5">
<h3>Function-specific configfs interface<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “hid”.
The HID function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>protocol</p></td>
<td><p>HID protocol to use</p></td>
</tr>
<tr class="row-even"><td><p>report_desc</p></td>
<td><p>data to be used in HID reports, except data
passed with /dev/hidg&lt;X&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>report_length</p></td>
<td><p>HID report length</p></td>
</tr>
<tr class="row-even"><td><p>subclass</p></td>
<td><p>HID subclass to use</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>For a keyboard the protocol and the subclass are 1, the report_length is 8,
while the report_desc is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ hd my_report_desc
00000000  05 01 09 06 a1 01 05 07  19 e0 29 e7 15 00 25 01  |..........)...%.|
00000010  75 01 95 08 81 02 95 01  75 08 81 03 95 05 75 01  |u.......u.....u.|
00000020  05 08 19 01 29 05 91 02  95 01 75 03 91 03 95 06  |....).....u.....|
00000030  75 08 15 00 25 65 05 07  19 00 29 65 81 00 c0     |u...%e....)e...|
0000003f
</pre></div>
</div>
<p>Such a sequence of bytes can be stored to the attribute with echo:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo -ne \\x05\\x01\\x09\\x06\\xa1.....
</pre></div>
</div>
</section>
<section id="testing-the-hid-function">
<h3>Testing the HID function<a class="headerlink" href="#testing-the-hid-function" title="Permalink to this headline">¶</a></h3>
<p>Device:</p>
<ul>
<li><p>create the gadget</p></li>
<li><p>connect the gadget to a host, preferably not the one used
to control the gadget</p></li>
<li><p>run a program which writes to /dev/hidg&lt;N&gt;, e.g.
a userspace program found in <a class="reference internal" href="gadget_hid.html"><span class="doc">Linux USB HID gadget driver</span></a>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./hid_gadget_test /dev/hidg0 keyboard
</pre></div>
</div>
</li>
</ul>
<p>Host:</p>
<ul class="simple">
<li><p>observe the keystrokes from the gadget</p></li>
</ul>
</section>
</section>
<section id="loopback-function">
<h2>7. LOOPBACK function<a class="headerlink" href="#loopback-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_ss_lb.ko module.</p>
<section id="id6">
<h3>Function-specific configfs interface<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “Loopback”.
The LOOPBACK function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>qlen</p></td>
<td><p>depth of loopback queue</p></td>
</tr>
<tr class="row-even"><td><p>bulk_buflen</p></td>
<td><p>buffer length</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="testing-the-loopback-function">
<h3>Testing the LOOPBACK function<a class="headerlink" href="#testing-the-loopback-function" title="Permalink to this headline">¶</a></h3>
<p>device: run the gadget</p>
<p>host: test-usb (tools/usb/testusb.c)</p>
</section>
</section>
<section id="mass-storage-function">
<h2>8. MASS STORAGE function<a class="headerlink" href="#mass-storage-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_mass_storage.ko module.</p>
<section id="id7">
<h3>Function-specific configfs interface<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “mass_storage”.
The MASS STORAGE function provides these attributes in its directory:
files:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>stall</p></td>
<td><p>Set to permit function to halt bulk endpoints.
Disabled on some USB devices known not to work
correctly. You should set it to true.</p></td>
</tr>
<tr class="row-even"><td><p>num_buffers</p></td>
<td><p>Number of pipeline buffers. Valid numbers
are 2..4. Available only if
CONFIG_USB_GADGET_DEBUG_FILES is set.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and a default lun.0 directory corresponding to SCSI LUN #0.</p>
<p>A new lun can be added with mkdir:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ mkdir functions/mass_storage.0/partition.5
</pre></div>
</div>
<p>Lun numbering does not have to be continuous, except for lun #0 which is
created by default. A maximum of 8 luns can be specified and they all must be
named following the &lt;name&gt;.&lt;number&gt; scheme. The numbers can be 0..8.
Probably a good convention is to name the luns “lun.&lt;number&gt;”,
although it is not mandatory.</p>
<p>In each lun directory there are the following attribute files:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>file</p></td>
<td><p>The path to the backing file for the LUN.
Required if LUN is not marked as removable.</p></td>
</tr>
<tr class="row-even"><td><p>ro</p></td>
<td><p>Flag specifying access to the LUN shall be
read-only. This is implied if CD-ROM emulation
is enabled as well as when it was impossible
to open “filename” in R/W mode.</p></td>
</tr>
<tr class="row-odd"><td><p>removable</p></td>
<td><p>Flag specifying that LUN shall be indicated as
being removable.</p></td>
</tr>
<tr class="row-even"><td><p>cdrom</p></td>
<td><p>Flag specifying that LUN shall be reported as
being a CD-ROM.</p></td>
</tr>
<tr class="row-odd"><td><p>nofua</p></td>
<td><p>Flag specifying that FUA flag
in SCSI WRITE(10,12)</p></td>
</tr>
<tr class="row-even"><td><p>forced_eject</p></td>
<td><p>This write-only file is useful only when
the function is active. It causes the backing
file to be forcibly detached from the LUN,
regardless of whether the host has allowed it.
Any non-zero number of bytes written will
result in ejection.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="testing-the-mass-storage-function">
<h3>Testing the MASS STORAGE function<a class="headerlink" href="#testing-the-mass-storage-function" title="Permalink to this headline">¶</a></h3>
<p>device: connect the gadget, enable it
host: dmesg, see the USB drives appear (if system configured to automatically
mount)</p>
</section>
</section>
<section id="midi-function">
<h2>9. MIDI function<a class="headerlink" href="#midi-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_midi.ko module.</p>
<section id="id8">
<h3>Function-specific configfs interface<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “midi”.
The MIDI function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>buflen</p></td>
<td><p>MIDI buffer length</p></td>
</tr>
<tr class="row-even"><td><p>id</p></td>
<td><p>ID string for the USB MIDI adapter</p></td>
</tr>
<tr class="row-odd"><td><p>in_ports</p></td>
<td><p>number of MIDI input ports</p></td>
</tr>
<tr class="row-even"><td><p>index</p></td>
<td><p>index value for the USB MIDI adapter</p></td>
</tr>
<tr class="row-odd"><td><p>out_ports</p></td>
<td><p>number of MIDI output ports</p></td>
</tr>
<tr class="row-even"><td><p>qlen</p></td>
<td><p>USB read request queue length</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="testing-the-midi-function">
<h3>Testing the MIDI function<a class="headerlink" href="#testing-the-midi-function" title="Permalink to this headline">¶</a></h3>
<p>There are two cases: playing a mid from the gadget to
the host and playing a mid from the host to the gadget.</p>
<ol class="arabic simple">
<li><p>Playing a mid from the gadget to the host:</p></li>
</ol>
<p>host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ arecordmidi -l
 Port    Client name                      Port name
 14:0    Midi Through                     Midi Through Port-0
 24:0    MIDI Gadget                      MIDI Gadget MIDI 1
$ arecordmidi -p 24:0 from_gadget.mid
</pre></div>
</div>
<p>gadget:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aplaymidi -l
 Port    Client name                      Port name
 20:0    f_midi                           f_midi

$ aplaymidi -p 20:0 to_host.mid
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Playing a mid from the host to the gadget</p></li>
</ol>
<p>gadget:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ arecordmidi -l
 Port    Client name                      Port name
 20:0    f_midi                           f_midi

$ arecordmidi -p 20:0 from_host.mid
</pre></div>
</div>
<p>host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aplaymidi -l
 Port    Client name                      Port name
 14:0    Midi Through                     Midi Through Port-0
 24:0    MIDI Gadget                      MIDI Gadget MIDI 1

$ aplaymidi -p24:0 to_gadget.mid
</pre></div>
</div>
<p>The from_gadget.mid should sound identical to the to_host.mid.</p>
<p>The from_host.id should sound identical to the to_gadget.mid.</p>
<p>MIDI files can be played to speakers/headphones with e.g. timidity installed:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aplaymidi -l
 Port    Client name                      Port name
 14:0    Midi Through                     Midi Through Port-0
 24:0    MIDI Gadget                      MIDI Gadget MIDI 1
128:0    TiMidity                         TiMidity port 0
128:1    TiMidity                         TiMidity port 1
128:2    TiMidity                         TiMidity port 2
128:3    TiMidity                         TiMidity port 3

$ aplaymidi -p 128:0 file.mid
</pre></div>
</div>
<p>MIDI ports can be logically connected using the aconnect utility, e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ aconnect 24:0 128:0 # try it on the host
</pre></div>
</div>
<p>After the gadget’s MIDI port is connected to timidity’s MIDI port,
whatever is played at the gadget side with aplaymidi -l is audible
in host’s speakers/headphones.</p>
</section>
</section>
<section id="ncm-function">
<h2>10. NCM function<a class="headerlink" href="#ncm-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_ncm.ko module.</p>
<section id="id9">
<h3>Function-specific configfs interface<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “ncm”.
The NCM function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ifname</p></td>
<td><p>network device interface name associated with this
function instance</p></td>
</tr>
<tr class="row-even"><td><p>qmult</p></td>
<td><p>queue length multiplier for high and super speed</p></td>
</tr>
<tr class="row-odd"><td><p>host_addr</p></td>
<td><p>MAC address of host’s end of this
Ethernet over USB link</p></td>
</tr>
<tr class="row-even"><td><p>dev_addr</p></td>
<td><p>MAC address of device’s end of this
Ethernet over USB link</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and after creating the functions/ncm.&lt;instance name&gt; they contain default
values: qmult is 5, dev_addr and host_addr are randomly selected.
The ifname can be written to if the function is not bound. A write must be an
interface pattern such as “usb%d”, which will cause the net core to choose the
next free usbX interface. By default, it is set to “usb%d”.</p>
</section>
<section id="testing-the-ncm-function">
<h3>Testing the NCM function<a class="headerlink" href="#testing-the-ncm-function" title="Permalink to this headline">¶</a></h3>
<p>Configure IP addresses of the device and the host. Then:</p>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;host&#39;s IP&gt;
</pre></div>
</div>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;device&#39;s IP&gt;
</pre></div>
</div>
</section>
</section>
<section id="obex-function">
<h2>11. OBEX function<a class="headerlink" href="#obex-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_obex.ko module.</p>
<section id="id10">
<h3>Function-specific configfs interface<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “obex”.
The OBEX function provides just one attribute in its function directory:</p>
<blockquote>
<div><p>port_num</p>
</div></blockquote>
<p>The attribute is read-only.</p>
<p>There can be at most 4 ACM/generic serial/OBEX ports in the system.</p>
</section>
<section id="testing-the-obex-function">
<h3>Testing the OBEX function<a class="headerlink" href="#testing-the-obex-function" title="Permalink to this headline">¶</a></h3>
<p>On device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>seriald -f /dev/ttyGS&lt;Y&gt; -s 1024
</pre></div>
</div>
<p>On host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>serialc -v &lt;vendorID&gt; -p &lt;productID&gt; -i&lt;interface#&gt; -a1 -s1024 \
        -t&lt;out endpoint addr&gt; -r&lt;in endpoint addr&gt;
</pre></div>
</div>
<p>where seriald and serialc are Felipe’s utilities found here:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/felipebalbi/usb-tools.git">https://github.com/felipebalbi/usb-tools.git</a> master</p>
</div></blockquote>
</section>
</section>
<section id="phonet-function">
<h2>12. PHONET function<a class="headerlink" href="#phonet-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_phonet.ko module.</p>
<section id="id11">
<h3>Function-specific configfs interface<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “phonet”.
The PHONET function provides just one attribute in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ifname</p></td>
<td><p>network device interface name associated with this
function instance</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="testing-the-phonet-function">
<h3>Testing the PHONET function<a class="headerlink" href="#testing-the-phonet-function" title="Permalink to this headline">¶</a></h3>
<p>It is not possible to test the SOCK_STREAM protocol without a specific piece
of hardware, so only SOCK_DGRAM has been tested. For the latter to work,
in the past I had to apply the patch mentioned here:</p>
<p><a class="reference external" href="http://www.spinics.net/lists/linux-usb/msg85689.html">http://www.spinics.net/lists/linux-usb/msg85689.html</a></p>
<p>These tools are required:</p>
<p>git://git.gitorious.org/meego-cellular/phonet-utils.git</p>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./phonet -a 0x10 -i usbpn0
$ ./pnroute add 0x6c usbpn0
$./pnroute add 0x10 usbpn0
$ ifconfig usbpn0 up
</pre></div>
</div>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./phonet -a 0x6c -i upnlink0
$ ./pnroute add 0x10 upnlink0
$ ifconfig upnlink0 up
</pre></div>
</div>
<p>Then a test program can be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>http://www.spinics.net/lists/linux-usb/msg85690.html
</pre></div>
</div>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./pnxmit -a 0x6c -r
</pre></div>
</div>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./pnxmit -a 0x10 -s 0x6c
</pre></div>
</div>
<p>As a result some data should be sent from host to device.
Then the other way round:</p>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./pnxmit -a 0x10 -r
</pre></div>
</div>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./pnxmit -a 0x6c -s 0x10
</pre></div>
</div>
</section>
</section>
<section id="rndis-function">
<h2>13. RNDIS function<a class="headerlink" href="#rndis-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_rndis.ko module.</p>
<section id="id12">
<h3>Function-specific configfs interface<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “rndis”.
The RNDIS function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ifname</p></td>
<td><p>network device interface name associated with this
function instance</p></td>
</tr>
<tr class="row-even"><td><p>qmult</p></td>
<td><p>queue length multiplier for high and super speed</p></td>
</tr>
<tr class="row-odd"><td><p>host_addr</p></td>
<td><p>MAC address of host’s end of this
Ethernet over USB link</p></td>
</tr>
<tr class="row-even"><td><p>dev_addr</p></td>
<td><p>MAC address of device’s end of this
Ethernet over USB link</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and after creating the functions/rndis.&lt;instance name&gt; they contain default
values: qmult is 5, dev_addr and host_addr are randomly selected.
The ifname can be written to if the function is not bound. A write must be an
interface pattern such as “usb%d”, which will cause the net core to choose the
next free usbX interface. By default, it is set to “usb%d”.</p>
</section>
<section id="testing-the-rndis-function">
<h3>Testing the RNDIS function<a class="headerlink" href="#testing-the-rndis-function" title="Permalink to this headline">¶</a></h3>
<p>Configure IP addresses of the device and the host. Then:</p>
<p>On the device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;host&#39;s IP&gt;
</pre></div>
</div>
<p>On the host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ping &lt;device&#39;s IP&gt;
</pre></div>
</div>
</section>
</section>
<section id="serial-function">
<h2>14. SERIAL function<a class="headerlink" href="#serial-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_gser.ko module.</p>
<section id="id13">
<h3>Function-specific configfs interface<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “gser”.
The SERIAL function provides just one attribute in its function directory:</p>
<blockquote>
<div><p>port_num</p>
</div></blockquote>
<p>The attribute is read-only.</p>
<p>There can be at most 4 ACM/generic serial/OBEX ports in the system.</p>
</section>
<section id="testing-the-serial-function">
<h3>Testing the SERIAL function<a class="headerlink" href="#testing-the-serial-function" title="Permalink to this headline">¶</a></h3>
<p>On host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>insmod usbserial
echo VID PID &gt;/sys/bus/usb-serial/drivers/generic/new_id
</pre></div>
</div>
<p>On host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &gt; /dev/ttyUSB&lt;X&gt;
</pre></div>
</div>
<p>On target:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /dev/ttyGS&lt;Y&gt;
</pre></div>
</div>
<p>then the other way round</p>
<p>On target:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat &gt; /dev/ttyGS&lt;Y&gt;
</pre></div>
</div>
<p>On host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cat /dev/ttyUSB&lt;X&gt;
</pre></div>
</div>
</section>
</section>
<section id="sourcesink-function">
<h2>15. SOURCESINK function<a class="headerlink" href="#sourcesink-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_ss_lb.ko module.</p>
<section id="id14">
<h3>Function-specific configfs interface<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “SourceSink”.
The SOURCESINK function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>pattern</p></td>
<td><p>0 (all zeros), 1 (mod63), 2 (none)</p></td>
</tr>
<tr class="row-even"><td><p>isoc_interval</p></td>
<td><p>1..16</p></td>
</tr>
<tr class="row-odd"><td><p>isoc_maxpacket</p></td>
<td><p>0 - 1023 (fs), 0 - 1024 (hs/ss)</p></td>
</tr>
<tr class="row-even"><td><p>isoc_mult</p></td>
<td><p>0..2 (hs/ss only)</p></td>
</tr>
<tr class="row-odd"><td><p>isoc_maxburst</p></td>
<td><p>0..15 (ss only)</p></td>
</tr>
<tr class="row-even"><td><p>bulk_buflen</p></td>
<td><p>buffer length</p></td>
</tr>
<tr class="row-odd"><td><p>bulk_qlen</p></td>
<td><p>depth of queue for bulk</p></td>
</tr>
<tr class="row-even"><td><p>iso_qlen</p></td>
<td><p>depth of queue for iso</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="testing-the-sourcesink-function">
<h3>Testing the SOURCESINK function<a class="headerlink" href="#testing-the-sourcesink-function" title="Permalink to this headline">¶</a></h3>
<p>device: run the gadget</p>
<p>host: test-usb (tools/usb/testusb.c)</p>
</section>
</section>
<section id="uac1-function-legacy-implementation">
<h2>16. UAC1 function (legacy implementation)<a class="headerlink" href="#uac1-function-legacy-implementation" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_uac1_legacy.ko module.</p>
<section id="id15">
<h3>Function-specific configfs interface<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory
is “uac1_legacy”.
The uac1 function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>audio_buf_size</p></td>
<td><p>audio buffer size</p></td>
</tr>
<tr class="row-even"><td><p>fn_cap</p></td>
<td><p>capture pcm device file name</p></td>
</tr>
<tr class="row-odd"><td><p>fn_cntl</p></td>
<td><p>control device file name</p></td>
</tr>
<tr class="row-even"><td><p>fn_play</p></td>
<td><p>playback pcm device file name</p></td>
</tr>
<tr class="row-odd"><td><p>req_buf_size</p></td>
<td><p>ISO OUT endpoint request buffer size</p></td>
</tr>
<tr class="row-even"><td><p>req_count</p></td>
<td><p>ISO OUT endpoint request count</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The attributes have sane default values.</p>
</section>
<section id="testing-the-uac1-function">
<h3>Testing the UAC1 function<a class="headerlink" href="#testing-the-uac1-function" title="Permalink to this headline">¶</a></h3>
<p>device: run the gadget</p>
<p>host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>aplay -l # should list our USB Audio Gadget
</pre></div>
</div>
</section>
</section>
<section id="uac2-function">
<h2>17. UAC2 function<a class="headerlink" href="#uac2-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_uac2.ko module.</p>
<section id="id16">
<h3>Function-specific configfs interface<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “uac2”.
The uac2 function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>c_chmask</p></td>
<td><p>capture channel mask</p></td>
</tr>
<tr class="row-even"><td><p>c_srate</p></td>
<td><p>list of capture sampling rates (comma-separated)</p></td>
</tr>
<tr class="row-odd"><td><p>c_ssize</p></td>
<td><p>capture sample size (bytes)</p></td>
</tr>
<tr class="row-even"><td><p>c_sync</p></td>
<td><p>capture synchronization type (async/adaptive)</p></td>
</tr>
<tr class="row-odd"><td><p>c_mute_present</p></td>
<td><p>capture mute control enable</p></td>
</tr>
<tr class="row-even"><td><p>c_volume_present</p></td>
<td><p>capture volume control enable</p></td>
</tr>
<tr class="row-odd"><td><p>c_volume_min</p></td>
<td><p>capture volume control min value (in 1/256 dB)</p></td>
</tr>
<tr class="row-even"><td><p>c_volume_max</p></td>
<td><p>capture volume control max value (in 1/256 dB)</p></td>
</tr>
<tr class="row-odd"><td><p>c_volume_res</p></td>
<td><p>capture volume control resolution (in 1/256 dB)</p></td>
</tr>
<tr class="row-even"><td><p>c_hs_bint</p></td>
<td><p>capture bInterval for HS/SS (1-4: fixed, 0: auto)</p></td>
</tr>
<tr class="row-odd"><td><p>fb_max</p></td>
<td><p>maximum extra bandwidth in async mode</p></td>
</tr>
<tr class="row-even"><td><p>p_chmask</p></td>
<td><p>playback channel mask</p></td>
</tr>
<tr class="row-odd"><td><p>p_srate</p></td>
<td><p>list of playback sampling rates (comma-separated)</p></td>
</tr>
<tr class="row-even"><td><p>p_ssize</p></td>
<td><p>playback sample size (bytes)</p></td>
</tr>
<tr class="row-odd"><td><p>p_mute_present</p></td>
<td><p>playback mute control enable</p></td>
</tr>
<tr class="row-even"><td><p>p_volume_present</p></td>
<td><p>playback volume control enable</p></td>
</tr>
<tr class="row-odd"><td><p>p_volume_min</p></td>
<td><p>playback volume control min value (in 1/256 dB)</p></td>
</tr>
<tr class="row-even"><td><p>p_volume_max</p></td>
<td><p>playback volume control max value (in 1/256 dB)</p></td>
</tr>
<tr class="row-odd"><td><p>p_volume_res</p></td>
<td><p>playback volume control resolution (in 1/256 dB)</p></td>
</tr>
<tr class="row-even"><td><p>p_hs_bint</p></td>
<td><p>playback bInterval for HS/SS (1-4: fixed, 0: auto)</p></td>
</tr>
<tr class="row-odd"><td><p>req_number</p></td>
<td><p>the number of pre-allocated request for both capture
and playback</p></td>
</tr>
<tr class="row-even"><td><p>function_name</p></td>
<td><p>name of the interface</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The attributes have sane default values.</p>
</section>
<section id="testing-the-uac2-function">
<h3>Testing the UAC2 function<a class="headerlink" href="#testing-the-uac2-function" title="Permalink to this headline">¶</a></h3>
<p>device: run the gadget
host: aplay -l # should list our USB Audio Gadget</p>
<p>This function does not require real hardware support, it just
sends a stream of audio data to/from the host. In order to
actually hear something at the device side, a command similar
to this must be used at the device side:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ arecord -f dat -t wav -D hw:2,0 | aplay -D hw:0,0 &amp;
</pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ arecord -f dat -t wav -D hw:CARD=UAC2Gadget,DEV=0 | \
  aplay -D default:CARD=OdroidU3
</pre></div>
</div>
</section>
</section>
<section id="uvc-function">
<h2>18. UVC function<a class="headerlink" href="#uvc-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_uvc.ko module.</p>
<section id="id17">
<h3>Function-specific configfs interface<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “uvc”.
The uvc function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>streaming_interval</p></td>
<td><p>interval for polling endpoint for data transfers</p></td>
</tr>
<tr class="row-even"><td><p>streaming_maxburst</p></td>
<td><p>bMaxBurst for super speed companion descriptor</p></td>
</tr>
<tr class="row-odd"><td><p>streaming_maxpacket</p></td>
<td><p>maximum packet size this endpoint is capable of
sending or receiving when this configuration is
selected</p></td>
</tr>
<tr class="row-even"><td><p>function_name</p></td>
<td><p>name of the interface</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>There are also “control” and “streaming” subdirectories, each of which contain
a number of their subdirectories. There are some sane defaults provided, but
the user must provide the following:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>control header</p></td>
<td><p>create in control/header, link from control/class/fs
and/or control/class/ss</p></td>
</tr>
<tr class="row-even"><td><p>streaming header</p></td>
<td><p>create in streaming/header, link from
streaming/class/fs and/or streaming/class/hs and/or
streaming/class/ss</p></td>
</tr>
<tr class="row-odd"><td><p>format description</p></td>
<td><p>create in streaming/mjpeg and/or
streaming/uncompressed</p></td>
</tr>
<tr class="row-even"><td><p>frame description</p></td>
<td><p>create in streaming/mjpeg/&lt;format&gt; and/or in
streaming/uncompressed/&lt;format&gt;</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Each frame description contains frame interval specification, and each
such specification consists of a number of lines with an inverval value
in each line. The rules stated above are best illustrated with an example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># mkdir functions/uvc.usb0/control/header/h
# cd functions/uvc.usb0/control/
# ln -s header/h class/fs
# ln -s header/h class/ss
# mkdir -p functions/uvc.usb0/streaming/uncompressed/u/360p
# cat &lt;&lt;EOF &gt; functions/uvc.usb0/streaming/uncompressed/u/360p/dwFrameInterval
666666
1000000
5000000
EOF
# cd $GADGET_CONFIGFS_ROOT
# mkdir functions/uvc.usb0/streaming/header/h
# cd functions/uvc.usb0/streaming/header/h
# ln -s ../../uncompressed/u
# cd ../../class/fs
# ln -s ../../header/h
# cd ../../class/hs
# ln -s ../../header/h
# cd ../../class/ss
# ln -s ../../header/h
</pre></div>
</div>
</section>
<section id="testing-the-uvc-function">
<h3>Testing the UVC function<a class="headerlink" href="#testing-the-uvc-function" title="Permalink to this headline">¶</a></h3>
<p>device: run the gadget, modprobe vivid:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># uvc-gadget -u /dev/video&lt;uvc video node #&gt; -v /dev/video&lt;vivid video node #&gt;
</pre></div>
</div>
<dl class="simple">
<dt>where uvc-gadget is this program:</dt><dd><p><a class="reference external" href="http://git.ideasonboard.org/uvc-gadget.git">http://git.ideasonboard.org/uvc-gadget.git</a></p>
</dd>
</dl>
<p>with these patches:</p>
<blockquote>
<div><p><a class="reference external" href="http://www.spinics.net/lists/linux-usb/msg99220.html">http://www.spinics.net/lists/linux-usb/msg99220.html</a></p>
</div></blockquote>
<p>host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>luvcview -f yuv
</pre></div>
</div>
</section>
</section>
<section id="printer-function">
<h2>19. PRINTER function<a class="headerlink" href="#printer-function" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_printer.ko module.</p>
<section id="id18">
<h3>Function-specific configfs interface<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “printer”.
The printer function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>pnp_string</p></td>
<td><p>Data to be passed to the host in pnp string</p></td>
</tr>
<tr class="row-even"><td><p>q_len</p></td>
<td><p>Number of requests per endpoint</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</section>
<section id="testing-the-printer-function">
<h3>Testing the PRINTER function<a class="headerlink" href="#testing-the-printer-function" title="Permalink to this headline">¶</a></h3>
<p>The most basic testing:</p>
<p>device: run the gadget:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ls -l /devices/virtual/usb_printer_gadget/
</pre></div>
</div>
<p>should show g_printer&lt;number&gt;.</p>
<p>If udev is active, then /dev/g_printer&lt;number&gt; should appear automatically.</p>
<p>host:</p>
<p>If udev is active, then e.g. /dev/usb/lp0 should appear.</p>
<p>host-&gt;device transmission:</p>
<p>device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cat /dev/g_printer&lt;number&gt;
</pre></div>
</div>
<p>host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cat &gt; /dev/usb/lp0
</pre></div>
</div>
<p>device-&gt;host transmission:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cat &gt; /dev/g_printer&lt;number&gt;
</pre></div>
</div>
<p>host:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cat /dev/usb/lp0
</pre></div>
</div>
<p>More advanced testing can be done with the prn_example
described in <a class="reference internal" href="gadget_printer.html"><span class="doc">Linux USB Printer Gadget Driver</span></a>.</p>
</section>
</section>
<section id="uac1-function-virtual-alsa-card-using-u-audio-api">
<h2>20. UAC1 function (virtual ALSA card, using u_audio API)<a class="headerlink" href="#uac1-function-virtual-alsa-card-using-u-audio-api" title="Permalink to this headline">¶</a></h2>
<p>The function is provided by usb_f_uac1.ko module.
It will create a virtual ALSA card and the audio streams are simply
sinked to and sourced from it.</p>
<section id="id19">
<h3>Function-specific configfs interface<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>The function name to use when creating the function directory is “uac1”.
The uac1 function provides these attributes in its function directory:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>c_chmask</p></td>
<td><p>capture channel mask</p></td>
</tr>
<tr class="row-even"><td><p>c_srate</p></td>
<td><p>list of capture sampling rates (comma-separated)</p></td>
</tr>
<tr class="row-odd"><td><p>c_ssize</p></td>
<td><p>capture sample size (bytes)</p></td>
</tr>
<tr class="row-even"><td><p>c_mute_present</p></td>
<td><p>capture mute control enable</p></td>
</tr>
<tr class="row-odd"><td><p>c_volume_present</p></td>
<td><p>capture volume control enable</p></td>
</tr>
<tr class="row-even"><td><p>c_volume_min</p></td>
<td><p>capture volume control min value (in 1/256 dB)</p></td>
</tr>
<tr class="row-odd"><td><p>c_volume_max</p></td>
<td><p>capture volume control max value (in 1/256 dB)</p></td>
</tr>
<tr class="row-even"><td><p>c_volume_res</p></td>
<td><p>capture volume control resolution (in 1/256 dB)</p></td>
</tr>
<tr class="row-odd"><td><p>p_chmask</p></td>
<td><p>playback channel mask</p></td>
</tr>
<tr class="row-even"><td><p>p_srate</p></td>
<td><p>list of playback sampling rates (comma-separated)</p></td>
</tr>
<tr class="row-odd"><td><p>p_ssize</p></td>
<td><p>playback sample size (bytes)</p></td>
</tr>
<tr class="row-even"><td><p>p_mute_present</p></td>
<td><p>playback mute control enable</p></td>
</tr>
<tr class="row-odd"><td><p>p_volume_present</p></td>
<td><p>playback volume control enable</p></td>
</tr>
<tr class="row-even"><td><p>p_volume_min</p></td>
<td><p>playback volume control min value (in 1/256 dB)</p></td>
</tr>
<tr class="row-odd"><td><p>p_volume_max</p></td>
<td><p>playback volume control max value (in 1/256 dB)</p></td>
</tr>
<tr class="row-even"><td><p>p_volume_res</p></td>
<td><p>playback volume control resolution (in 1/256 dB)</p></td>
</tr>
<tr class="row-odd"><td><p>req_number</p></td>
<td><p>the number of pre-allocated requests for both capture
and playback</p></td>
</tr>
<tr class="row-even"><td><p>function_name</p></td>
<td><p>name of the interface</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The attributes have sane default values.</p>
</section>
<section id="id20">
<h3>Testing the UAC1 function<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>device: run the gadget
host: aplay -l # should list our USB Audio Gadget</p>
<p>This function does not require real hardware support, it just
sends a stream of audio data to/from the host. In order to
actually hear something at the device side, a command similar
to this must be used at the device side:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ arecord -f dat -t wav -D hw:2,0 | aplay -D hw:0,0 &amp;
</pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ arecord -f dat -t wav -D hw:CARD=UAC1Gadget,DEV=0 | \
  aplay -D default:CARD=OdroidU3
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Gadget Testing</a><ul>
<li><a class="reference internal" href="#acm-function">1. ACM function</a><ul>
<li><a class="reference internal" href="#function-specific-configfs-interface">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-acm-function">Testing the ACM function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ecm-function">2. ECM function</a><ul>
<li><a class="reference internal" href="#id1">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-ecm-function">Testing the ECM function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ecm-subset-function">3. ECM subset function</a><ul>
<li><a class="reference internal" href="#id2">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-ecm-subset-function">Testing the ECM subset function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#eem-function">4. EEM function</a><ul>
<li><a class="reference internal" href="#id3">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-eem-function">Testing the EEM function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ffs-function">5. FFS function</a><ul>
<li><a class="reference internal" href="#id4">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-ffs-function">Testing the FFS function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hid-function">6. HID function</a><ul>
<li><a class="reference internal" href="#id5">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-hid-function">Testing the HID function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loopback-function">7. LOOPBACK function</a><ul>
<li><a class="reference internal" href="#id6">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-loopback-function">Testing the LOOPBACK function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mass-storage-function">8. MASS STORAGE function</a><ul>
<li><a class="reference internal" href="#id7">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-mass-storage-function">Testing the MASS STORAGE function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#midi-function">9. MIDI function</a><ul>
<li><a class="reference internal" href="#id8">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-midi-function">Testing the MIDI function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ncm-function">10. NCM function</a><ul>
<li><a class="reference internal" href="#id9">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-ncm-function">Testing the NCM function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#obex-function">11. OBEX function</a><ul>
<li><a class="reference internal" href="#id10">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-obex-function">Testing the OBEX function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#phonet-function">12. PHONET function</a><ul>
<li><a class="reference internal" href="#id11">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-phonet-function">Testing the PHONET function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rndis-function">13. RNDIS function</a><ul>
<li><a class="reference internal" href="#id12">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-rndis-function">Testing the RNDIS function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#serial-function">14. SERIAL function</a><ul>
<li><a class="reference internal" href="#id13">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-serial-function">Testing the SERIAL function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sourcesink-function">15. SOURCESINK function</a><ul>
<li><a class="reference internal" href="#id14">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-sourcesink-function">Testing the SOURCESINK function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uac1-function-legacy-implementation">16. UAC1 function (legacy implementation)</a><ul>
<li><a class="reference internal" href="#id15">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-uac1-function">Testing the UAC1 function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uac2-function">17. UAC2 function</a><ul>
<li><a class="reference internal" href="#id16">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-uac2-function">Testing the UAC2 function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uvc-function">18. UVC function</a><ul>
<li><a class="reference internal" href="#id17">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-uvc-function">Testing the UVC function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#printer-function">19. PRINTER function</a><ul>
<li><a class="reference internal" href="#id18">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#testing-the-printer-function">Testing the PRINTER function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uac1-function-virtual-alsa-card-using-u-audio-api">20. UAC1 function (virtual ALSA card, using u_audio API)</a><ul>
<li><a class="reference internal" href="#id19">Function-specific configfs interface</a></li>
<li><a class="reference internal" href="#id20">Testing the UAC1 function</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/usb/gadget-testing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usb/gadget-testing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>