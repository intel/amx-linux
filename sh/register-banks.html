
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Notes on register bank usage in the kernel &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Feature status on sh architecture" href="features.html" />
    <link rel="prev" title="Adding a new board to LinuxSH" href="new-machine.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="notes-on-register-bank-usage-in-the-kernel">
<h1>Notes on register bank usage in the kernel<a class="headerlink" href="#notes-on-register-bank-usage-in-the-kernel" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The SH-3 and SH-4 CPU families traditionally include a single partial register
bank (selected by SR.RB, only r0 … r7 are banked), whereas other families
may have more full-featured banking or simply no such capabilities at all.</p>
</section>
<section id="sr-rb-banking">
<h2>SR.RB banking<a class="headerlink" href="#sr-rb-banking" title="Permalink to this headline">¶</a></h2>
<p>In the case of this type of banking, banked registers are mapped directly to
r0 … r7 if SR.RB is set to the bank we are interested in, otherwise ldc/stc
can still be used to reference the banked registers (as r0_bank … r7_bank)
when in the context of another bank. The developer must keep the SR.RB value
in mind when writing code that utilizes these banked registers, for obvious
reasons. Userspace is also not able to poke at the bank1 values, so these can
be used rather effectively as scratch registers by the kernel.</p>
<p>Presently the kernel uses several of these registers.</p>
<blockquote>
<div><ul>
<li><p>r0_bank, r1_bank (referenced as k0 and k1, used for scratch
registers when doing exception handling).</p></li>
<li><p>r2_bank (used to track the EXPEVT/INTEVT code)</p>
<blockquote>
<div><ul class="simple">
<li><p>Used by do_IRQ() and friends for doing irq mapping based off
of the interrupt exception vector jump table offset</p></li>
</ul>
</div></blockquote>
</li>
<li><p>r6_bank (global interrupt mask)</p>
<blockquote>
<div><ul class="simple">
<li><p>The SR.IMASK interrupt handler makes use of this to set the
interrupt priority level (used by local_irq_enable())</p></li>
</ul>
</div></blockquote>
</li>
<li><p>r7_bank (current)</p></li>
</ul>
</div></blockquote>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Notes on register bank usage in the kernel</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#sr-rb-banking">SR.RB banking</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/sh/register-banks.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/sh/register-banks.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>