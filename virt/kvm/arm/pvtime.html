
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Paravirtualized time support for arm64 &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="PTP_KVM support for arm/arm64" href="ptp_kvm.html" />
    <link rel="prev" title="ARM Hypercall Interface" href="hypercalls.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="paravirtualized-time-support-for-arm64">
<h1>Paravirtualized time support for arm64<a class="headerlink" href="#paravirtualized-time-support-for-arm64" title="Permalink to this headline">¶</a></h1>
<p>Arm specification DEN0057/A defines a standard for paravirtualised time
support for AArch64 guests:</p>
<p><a class="reference external" href="https://developer.arm.com/docs/den0057/a">https://developer.arm.com/docs/den0057/a</a></p>
<p>KVM/arm64 implements the stolen time part of this specification by providing
some hypervisor service calls to support a paravirtualized guest obtaining a
view of the amount of time stolen from its execution.</p>
<p>Two new SMCCC compatible hypercalls are defined:</p>
<ul class="simple">
<li><p>PV_TIME_FEATURES: 0xC5000020</p></li>
<li><p>PV_TIME_ST:       0xC5000021</p></li>
</ul>
<p>These are only available in the SMC64/HVC64 calling convention as
paravirtualized time is not available to 32 bit Arm guests. The existence of
the PV_TIME_FEATURES hypercall should be probed using the SMCCC 1.1
ARCH_FEATURES mechanism before calling it.</p>
<p>PV_TIME_FEATURES</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 11%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Function ID:</p></td>
<td><p>(uint32)</p></td>
<td><p>0xC5000020</p></td>
</tr>
<tr class="row-even"><td><p>PV_call_id:</p></td>
<td><p>(uint32)</p></td>
<td><p>The function to query for support.
Currently only PV_TIME_ST is supported.</p></td>
</tr>
<tr class="row-odd"><td><p>Return value:</p></td>
<td><p>(int64)</p></td>
<td><p>NOT_SUPPORTED (-1) or SUCCESS (0) if the relevant
PV-time feature is supported by the hypervisor.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>PV_TIME_ST</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 12%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Function ID:</p></td>
<td><p>(uint32)</p></td>
<td><p>0xC5000021</p></td>
</tr>
<tr class="row-even"><td><p>Return value:</p></td>
<td><p>(int64)</p></td>
<td><p>IPA of the stolen time data structure for this
VCPU. On failure:
NOT_SUPPORTED (-1)</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The IPA returned by PV_TIME_ST should be mapped by the guest as normal memory
with inner and outer write back caching attributes, in the inner shareable
domain. A total of 16 bytes from the IPA returned are guaranteed to be
meaningfully filled by the hypervisor (see structure below).</p>
<p>PV_TIME_ST returns the structure for the calling VCPU.</p>
<section id="stolen-time">
<h2>Stolen Time<a class="headerlink" href="#stolen-time" title="Permalink to this headline">¶</a></h2>
<p>The structure pointed to by the PV_TIME_ST hypercall is as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Byte Length</p></th>
<th class="head"><p>Byte Offset</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Revision</p></td>
<td><p>4</p></td>
<td><p>0</p></td>
<td><p>Must be 0 for version 1.0</p></td>
</tr>
<tr class="row-odd"><td><p>Attributes</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
<td><p>Must be 0</p></td>
</tr>
<tr class="row-even"><td><p>Stolen time</p></td>
<td><p>8</p></td>
<td><p>8</p></td>
<td><p>Stolen time in unsigned
nanoseconds indicating how
much time this VCPU thread
was involuntarily not
running on a physical CPU.</p></td>
</tr>
</tbody>
</table>
<p>All values in the structure are stored little-endian.</p>
<p>The structure will be updated by the hypervisor prior to scheduling a VCPU. It
will be present within a reserved region of the normal memory given to the
guest. The guest should not attempt to write into this memory. There is a
structure per VCPU of the guest.</p>
<p>It is advisable that one or more 64k pages are set aside for the purpose of
these structures and not used for other purposes, this enables the guest to map
the region using 64k pages and avoids conflicting attributes with other memory.</p>
<p>For the user space interface see
<a class="reference internal" href="../devices/vcpu.html#kvm-arm-vcpu-pvtime-ctrl"><span class="std std-ref">Documentation/virt/kvm/devices/vcpu.rst</span></a>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Paravirtualized time support for arm64</a><ul>
<li><a class="reference internal" href="#stolen-time">Stolen Time</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/virt/kvm/arm/pvtime.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/virt/kvm/arm/pvtime.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>