
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>s390 (IBM Z) Boot/IPL of Protected VMs &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="s390 (IBM Z) Protected Virtualization dumps" href="s390-pv-dump.html" />
    <link rel="prev" title="s390 (IBM Z) Ultravisor and Protected VMs" href="s390-pv.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="s390-ibm-z-boot-ipl-of-protected-vms">
<h1>s390 (IBM Z) Boot/IPL of Protected VMs<a class="headerlink" href="#s390-ibm-z-boot-ipl-of-protected-vms" title="Permalink to this headline">¶</a></h1>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>The memory of Protected Virtual Machines (PVMs) is not accessible to
I/O or the hypervisor. In those cases where the hypervisor needs to
access the memory of a PVM, that memory must be made accessible.
Memory made accessible to the hypervisor will be encrypted. See
<a class="reference internal" href="s390-pv.html"><span class="doc">s390 (IBM Z) Ultravisor and Protected VMs</span></a> for details.”</p>
<p>On IPL (boot) a small plaintext bootloader is started, which provides
information about the encrypted components and necessary metadata to
KVM to decrypt the protected virtual machine.</p>
<p>Based on this data, KVM will make the protected virtual machine known
to the Ultravisor (UV) and instruct it to secure the memory of the
PVM, decrypt the components and verify the data and address list
hashes, to ensure integrity. Afterwards KVM can run the PVM via the
SIE instruction which the UV will intercept and execute on KVM’s
behalf.</p>
<p>As the guest image is just like an opaque kernel image that does the
switch into PV mode itself, the user can load encrypted guest
executables and data via every available method (network, dasd, scsi,
direct kernel, …) without the need to change the boot process.</p>
</section>
<section id="diag308">
<h2>Diag308<a class="headerlink" href="#diag308" title="Permalink to this headline">¶</a></h2>
<p>This diagnose instruction is the basic mechanism to handle IPL and
related operations for virtual machines. The VM can set and retrieve
IPL information blocks, that specify the IPL method/devices and
request VM memory and subsystem resets, as well as IPLs.</p>
<p>For PVMs this concept has been extended with new subcodes:</p>
<p>Subcode 8: Set an IPL Information Block of type 5 (information block
for PVMs)
Subcode 9: Store the saved block in guest memory
Subcode 10: Move into Protected Virtualization mode</p>
<p>The new PV load-device-specific-parameters field specifies all data
that is necessary to move into PV mode.</p>
<ul class="simple">
<li><p>PV Header origin</p></li>
<li><p>PV Header length</p></li>
<li><dl class="simple">
<dt>List of Components composed of</dt><dd><ul>
<li><p>AES-XTS Tweak prefix</p></li>
<li><p>Origin</p></li>
<li><p>Size</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The PV header contains the keys and hashes, which the UV will use to
decrypt and verify the PV, as well as control flags and a start PSW.</p>
<p>The components are for instance an encrypted kernel, kernel parameters
and initrd. The components are decrypted by the UV.</p>
<p>After the initial import of the encrypted data, all defined pages will
contain the guest content. All non-specified pages will start out as
zero pages on first access.</p>
<p>When running in protected virtualization mode, some subcodes will result in
exceptions or return error codes.</p>
<p>Subcodes 4 and 7, which specify operations that do not clear the guest
memory, will result in specification exceptions. This is because the
UV will clear all memory when a secure VM is removed, and therefore
non-clearing IPL subcodes are not allowed.</p>
<p>Subcodes 8, 9, 10 will result in specification exceptions.
Re-IPL into a protected mode is only possible via a detour into non
protected mode.</p>
</section>
<section id="keys">
<h2>Keys<a class="headerlink" href="#keys" title="Permalink to this headline">¶</a></h2>
<p>Every CEC will have a unique public key to enable tooling to build
encrypted images.
See  <a class="reference external" href="https://github.com/ibm-s390-linux/s390-tools/">s390-tools</a>
for the tooling.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">s390 (IBM Z) Boot/IPL of Protected VMs</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#diag308">Diag308</a></li>
<li><a class="reference internal" href="#keys">Keys</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/virt/kvm/s390/s390-pv-boot.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/virt/kvm/s390/s390-pv-boot.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>