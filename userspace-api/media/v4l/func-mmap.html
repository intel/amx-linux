
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7.64. V4L2 mmap() &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="7.65. V4L2 munmap()" href="func-munmap.html" />
    <link rel="prev" title="7.63. ioctl VIDIOC_SUBSCRIBE_EVENT, VIDIOC_UNSUBSCRIBE_EVENT" href="vidioc-subscribe-event.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="v4l2-mmap">
<span id="func-mmap"></span><h1><span class="section-number">7.64. </span>V4L2 mmap()<a class="headerlink" href="#v4l2-mmap" title="Permalink to this headline">¶</a></h1>
<section id="name">
<h2><span class="section-number">7.64.1. </span>Name<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h2>
<p>v4l2-mmap - Map device memory into application address space</p>
</section>
<section id="synopsis">
<h2><span class="section-number">7.64.2. </span>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<dl class="function">
<dt id="c.V4L.mmap">
void *<code class="sig-name descname">mmap</code><span class="sig-paren">(</span>void<em> *start</em>, size_t<em> length</em>, int<em> prot</em>, int<em> flags</em>, int<em> fd</em>, off_t<em> offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.V4L.mmap" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="arguments">
<h2><span class="section-number">7.64.3. </span>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h2>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">start</span></code></dt><dd><p>Map the buffer to this address in the application’s address space.
When the <code class="docutils literal notranslate"><span class="pre">MAP_FIXED</span></code> flag is specified, <code class="docutils literal notranslate"><span class="pre">start</span></code> must be a
multiple of the pagesize and mmap will fail when the specified
address cannot be used. Use of this option is discouraged;
applications should just specify a <code class="docutils literal notranslate"><span class="pre">NULL</span></code> pointer here.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">length</span></code></dt><dd><p>Length of the memory area to map. This must be the same value as
returned by the driver in the struct
<code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code> <code class="docutils literal notranslate"><span class="pre">length</span></code> field for the
single-planar API, and the same value as returned by the driver in
the struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_plane</span></code> <code class="docutils literal notranslate"><span class="pre">length</span></code> field for
the multi-planar API.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">prot</span></code></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">prot</span></code> argument describes the desired memory protection.
Regardless of the device type and the direction of data exchange it
should be set to <code class="docutils literal notranslate"><span class="pre">PROT_READ</span></code> | <code class="docutils literal notranslate"><span class="pre">PROT_WRITE</span></code>, permitting read
and write access to image buffers. Drivers should support at least
this combination of flags.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>The Linux <code class="docutils literal notranslate"><span class="pre">videobuf</span></code> kernel module, which is used by some
drivers supports only <code class="docutils literal notranslate"><span class="pre">PROT_READ</span></code> | <code class="docutils literal notranslate"><span class="pre">PROT_WRITE</span></code>. When the
driver does not support the desired protection, the
<code class="xref c c-func docutils literal notranslate"><span class="pre">mmap()</span></code> function fails.</p></li>
<li><p>Device memory accesses (e. g. the memory on a graphics card
with video capturing hardware) may incur a performance penalty
compared to main memory accesses, or reads may be significantly
slower than writes or vice versa. Other I/O methods may be more
efficient in such case.</p></li>
</ol>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">flags</span></code> parameter specifies the type of the mapped object,
mapping options and whether modifications made to the mapped copy of
the page are private to the process or are to be shared with other
references.</p>
<p><code class="docutils literal notranslate"><span class="pre">MAP_FIXED</span></code> requests that the driver selects no other address than
the one specified. If the specified address cannot be used,
<code class="xref c c-func docutils literal notranslate"><span class="pre">mmap()</span></code> will fail. If <code class="docutils literal notranslate"><span class="pre">MAP_FIXED</span></code> is specified,
<code class="docutils literal notranslate"><span class="pre">start</span></code> must be a multiple of the pagesize. Use of this option is
discouraged.</p>
<p>One of the <code class="docutils literal notranslate"><span class="pre">MAP_SHARED</span></code> or <code class="docutils literal notranslate"><span class="pre">MAP_PRIVATE</span></code> flags must be set.
<code class="docutils literal notranslate"><span class="pre">MAP_SHARED</span></code> allows applications to share the mapped memory with
other (e. g. child-) processes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Linux <code class="docutils literal notranslate"><span class="pre">videobuf</span></code> module  which is used by some
drivers supports only <code class="docutils literal notranslate"><span class="pre">MAP_SHARED</span></code>. <code class="docutils literal notranslate"><span class="pre">MAP_PRIVATE</span></code> requests
copy-on-write semantics. V4L2 applications should not set the
<code class="docutils literal notranslate"><span class="pre">MAP_PRIVATE</span></code>, <code class="docutils literal notranslate"><span class="pre">MAP_DENYWRITE</span></code>, <code class="docutils literal notranslate"><span class="pre">MAP_EXECUTABLE</span></code> or <code class="docutils literal notranslate"><span class="pre">MAP_ANON</span></code>
flags.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fd</span></code></dt><dd><p>File descriptor returned by <code class="xref c c-func docutils literal notranslate"><span class="pre">open()</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">offset</span></code></dt><dd><p>Offset of the buffer in device memory. This must be the same value
as returned by the driver in the struct
<code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_buffer</span></code> <code class="docutils literal notranslate"><span class="pre">m</span></code> union <code class="docutils literal notranslate"><span class="pre">offset</span></code> field for
the single-planar API, and the same value as returned by the driver
in the struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_plane</span></code> <code class="docutils literal notranslate"><span class="pre">m</span></code> union
<code class="docutils literal notranslate"><span class="pre">mem_offset</span></code> field for the multi-planar API.</p>
</dd>
</dl>
</section>
<section id="description">
<h2><span class="section-number">7.64.4. </span>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref c c-func docutils literal notranslate"><span class="pre">mmap()</span></code> function asks to map <code class="docutils literal notranslate"><span class="pre">length</span></code> bytes starting at
<code class="docutils literal notranslate"><span class="pre">offset</span></code> in the memory of the device specified by <code class="docutils literal notranslate"><span class="pre">fd</span></code> into the
application address space, preferably at address <code class="docutils literal notranslate"><span class="pre">start</span></code>. This latter
address is a hint only, and is usually specified as 0.</p>
<p>Suitable length and offset parameters are queried with the
<a class="reference internal" href="vidioc-querybuf.html#vidioc-querybuf"><span class="std std-ref">ioctl VIDIOC_QUERYBUF</span></a> ioctl. Buffers must be
allocated with the <a class="reference internal" href="vidioc-reqbufs.html#vidioc-reqbufs"><span class="std std-ref">ioctl VIDIOC_REQBUFS</span></a> ioctl
before they can be queried.</p>
<p>To unmap buffers the <code class="xref c c-func docutils literal notranslate"><span class="pre">munmap()</span></code> function is used.</p>
</section>
<section id="return-value">
<h2><span class="section-number">7.64.5. </span>Return Value<a class="headerlink" href="#return-value" title="Permalink to this headline">¶</a></h2>
<p>On success <code class="xref c c-func docutils literal notranslate"><span class="pre">mmap()</span></code> returns a pointer to the mapped buffer. On
error <code class="docutils literal notranslate"><span class="pre">MAP_FAILED</span></code> (-1) is returned, and the <code class="docutils literal notranslate"><span class="pre">errno</span></code> variable is set
appropriately. Possible error codes are:</p>
<dl>
<dt>EBADF</dt><dd><p><code class="docutils literal notranslate"><span class="pre">fd</span></code> is not a valid file descriptor.</p>
</dd>
<dt>EACCES</dt><dd><p><code class="docutils literal notranslate"><span class="pre">fd</span></code> is not open for reading and writing.</p>
</dd>
<dt>EINVAL</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">start</span></code> or <code class="docutils literal notranslate"><span class="pre">length</span></code> or <code class="docutils literal notranslate"><span class="pre">offset</span></code> are not suitable. (E. g.
they are too large, or not aligned on a <code class="docutils literal notranslate"><span class="pre">PAGESIZE</span></code> boundary.)</p>
<p>The <code class="docutils literal notranslate"><span class="pre">flags</span></code> or <code class="docutils literal notranslate"><span class="pre">prot</span></code> value is not supported.</p>
<p>No buffers have been allocated with the
<a class="reference internal" href="vidioc-reqbufs.html#vidioc-reqbufs"><span class="std std-ref">ioctl VIDIOC_REQBUFS</span></a> ioctl.</p>
</dd>
<dt>ENOMEM</dt><dd><p>Not enough physical or virtual memory was available to complete the
request.</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.64. V4L2 mmap()</a><ul>
<li><a class="reference internal" href="#name">7.64.1. Name</a></li>
<li><a class="reference internal" href="#synopsis">7.64.2. Synopsis</a></li>
<li><a class="reference internal" href="#arguments">7.64.3. Arguments</a></li>
<li><a class="reference internal" href="#description">7.64.4. Description</a></li>
<li><a class="reference internal" href="#return-value">7.64.5. Return Value</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/userspace-api/media/v4l/func-mmap.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/userspace-api/media/v4l/func-mmap.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>