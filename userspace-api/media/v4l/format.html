
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1.25. Data Formats &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="1.26. Single- and multi-planar APIs" href="planar-apis.html" />
    <link rel="prev" title="1.24. Guidelines for Video4Linux pixel format 4CCs" href="fourcc.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="data-formats">
<span id="format"></span><h1><span class="section-number">1.25. </span>Data Formats<a class="headerlink" href="#data-formats" title="Permalink to this headline">¶</a></h1>
<section id="data-format-negotiation">
<h2><span class="section-number">1.25.1. </span>Data Format Negotiation<a class="headerlink" href="#data-format-negotiation" title="Permalink to this headline">¶</a></h2>
<p>Different devices exchange different kinds of data with applications,
for example video images, raw or sliced VBI data, RDS datagrams. Even
within one kind many different formats are possible, in particular there is an
abundance of image formats. Although drivers must provide a default and
the selection persists across closing and reopening a device,
applications should always negotiate a data format before engaging in
data exchange. Negotiation means the application asks for a particular
format and the driver selects and reports the best the hardware can do
to satisfy the request. Of course applications can also just query the
current selection.</p>
<p>A single mechanism exists to negotiate all data formats using the
aggregate struct <code class="xref c c-type docutils literal notranslate"><span class="pre">v4l2_format</span></code> and the
<a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_G_FMT</span></a> and
<a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_S_FMT</span></a> ioctls. Additionally the
<a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_TRY_FMT</span></a> ioctl can be used to examine
what the hardware <em>could</em> do, without actually selecting a new data
format. The data formats supported by the V4L2 API are covered in the
respective device section in <a class="reference internal" href="devices.html#devices"><span class="std std-ref">Interfaces</span></a>. For a closer look at
image formats see <a class="reference internal" href="pixfmt.html#pixfmt"><span class="std std-ref">Image Formats</span></a>.</p>
<p>The <a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_S_FMT</span></a> ioctl is a major turning-point in the
initialization sequence. Prior to this point multiple panel applications
can access the same device concurrently to select the current input,
change controls or modify other properties. The first <a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_S_FMT</span></a>
assigns a logical stream (video data, VBI data etc.) exclusively to one
file descriptor.</p>
<p>Exclusive means no other application, more precisely no other file
descriptor, can grab this stream or change device properties
inconsistent with the negotiated parameters. A video standard change for
example, when the new standard uses a different number of scan lines,
can invalidate the selected image format. Therefore only the file
descriptor owning the stream can make invalidating changes. Accordingly
multiple file descriptors which grabbed different logical streams
prevent each other from interfering with their settings. When for
example video overlay is about to start or already in progress,
simultaneous video capturing may be restricted to the same cropping and
image size.</p>
<p>When applications omit the <a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_S_FMT</span></a> ioctl its locking side
effects are implied by the next step, the selection of an I/O method
with the <a class="reference internal" href="vidioc-reqbufs.html#vidioc-reqbufs"><span class="std std-ref">ioctl VIDIOC_REQBUFS</span></a> ioctl or implicit
with the first <code class="xref c c-func docutils literal notranslate"><span class="pre">read()</span></code> or
<code class="xref c c-func docutils literal notranslate"><span class="pre">write()</span></code> call.</p>
<p>Generally only one logical stream can be assigned to a file descriptor,
the exception being drivers permitting simultaneous video capturing and
overlay using the same file descriptor for compatibility with V4L and
earlier versions of V4L2. Switching the logical stream or returning into
“panel mode” is possible by closing and reopening the device. Drivers
<em>may</em> support a switch using <a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_S_FMT</span></a>.</p>
<p>All drivers exchanging data with applications must support the
<a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_G_FMT</span></a> and <a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_S_FMT</span></a> ioctl. Implementation of the
<a class="reference internal" href="vidioc-g-fmt.html#vidioc-g-fmt"><span class="std std-ref">VIDIOC_TRY_FMT</span></a> is highly recommended but optional.</p>
</section>
<section id="image-format-enumeration">
<h2><span class="section-number">1.25.2. </span>Image Format Enumeration<a class="headerlink" href="#image-format-enumeration" title="Permalink to this headline">¶</a></h2>
<p>Apart of the generic format negotiation functions a special ioctl to
enumerate all image formats supported by video capture, overlay or
output devices is available. <a class="footnote-reference brackets" href="#f1" id="id1">1</a></p>
<p>The <a class="reference internal" href="vidioc-enum-fmt.html#vidioc-enum-fmt"><span class="std std-ref">ioctl VIDIOC_ENUM_FMT</span></a> ioctl must be supported
by all drivers exchanging image data with applications.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Drivers are not supposed to convert image formats in kernel space.
They must enumerate only formats directly supported by the hardware.
If necessary driver writers should publish an example conversion
routine or library for integration into applications.</p>
</div>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Enumerating formats an application has no a-priori knowledge of
(otherwise it could explicitly ask for them and need not enumerate)
seems useless, but there are applications serving as proxy between
drivers and the actual video applications for which this is useful.</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.25. Data Formats</a><ul>
<li><a class="reference internal" href="#data-format-negotiation">1.25.1. Data Format Negotiation</a></li>
<li><a class="reference internal" href="#image-format-enumeration">1.25.2. Image Format Enumeration</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/userspace-api/media/v4l/format.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/userspace-api/media/v4l/format.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>