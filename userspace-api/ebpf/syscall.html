
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>eBPF Syscall &#8212; The Linux Kernel 6.2.0-rc4+ documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="IOCTLs" href="../ioctl/index.html" />
    <link rel="prev" title="eBPF Userspace API" href="index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="ebpf-syscall">
<h1>eBPF Syscall<a class="headerlink" href="#ebpf-syscall" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Authors</dt>
<dd class="field-odd"><ul class="simple">
<li><p>Alexei Starovoitov &lt;<a class="reference external" href="mailto:ast&#37;&#52;&#48;kernel&#46;org">ast<span>&#64;</span>kernel<span>&#46;</span>org</a>&gt;</p></li>
<li><p>Joe Stringer &lt;<a class="reference external" href="mailto:joe&#37;&#52;&#48;wand&#46;net&#46;nz">joe<span>&#64;</span>wand<span>&#46;</span>net<span>&#46;</span>nz</a>&gt;</p></li>
<li><p>Michael Kerrisk &lt;<a class="reference external" href="mailto:mtk&#46;manpages&#37;&#52;&#48;gmail&#46;com">mtk<span>&#46;</span>manpages<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</dd>
</dl>
<p>The primary info for the bpf syscall is available in the <a class="reference external" href="https://www.kernel.org/doc/man-pages/">man-pages</a>
for <a class="reference external" href="https://man7.org/linux/man-pages/man2/bpf.2.html">bpf(2)</a>.</p>
<section id="bpf-subcommand-reference">
<h2>bpf() subcommand reference<a class="headerlink" href="#bpf-subcommand-reference" title="Permalink to this headline">¶</a></h2>
<p>The operation to be performed by the <strong>bpf</strong>() system call is determined
by the <em>cmd</em> argument. Each operation takes an accompanying argument,
provided via <em>attr</em>, which is a pointer to a union of type <em>bpf_attr</em> (see
below). The size argument is the size of the union pointed to by <em>attr</em>.</p>
<dl>
<dt>BPF_MAP_CREATE</dt><dd><dl>
<dt>Description</dt><dd><p>Create a map and return a file descriptor that refers to the
map. The close-on-exec file descriptor flag (see <strong>fcntl</strong>(2))
is automatically enabled for the new file descriptor.</p>
<p>Applying <strong>close</strong>(2) to the file descriptor returned by
<strong>BPF_MAP_CREATE</strong> will delete the map (but see NOTES).</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_LOOKUP_ELEM</dt><dd><dl>
<dt>Description</dt><dd><p>Look up an element with a given <em>key</em> in the map referred to
by the file descriptor <em>map_fd</em>.</p>
<p>The <em>flags</em> argument may be specified as one of the
following:</p>
<dl class="simple">
<dt><strong>BPF_F_LOCK</strong></dt><dd><p>Look up the value of a spin-locked map without
returning the lock. This must be specified if the
elements contain a spinlock.</p>
</dd>
</dl>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_UPDATE_ELEM</dt><dd><dl>
<dt>Description</dt><dd><p>Create or update an element (key/value pair) in a specified map.</p>
<p>The <em>flags</em> argument should be specified as one of the
following:</p>
<dl class="simple">
<dt><strong>BPF_ANY</strong></dt><dd><p>Create a new element or update an existing element.</p>
</dd>
<dt><strong>BPF_NOEXIST</strong></dt><dd><p>Create a new element only if it did not exist.</p>
</dd>
<dt><strong>BPF_EXIST</strong></dt><dd><p>Update an existing element.</p>
</dd>
<dt><strong>BPF_F_LOCK</strong></dt><dd><p>Update a spin_lock-ed map element.</p>
</dd>
</dl>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
<p>May set <em>errno</em> to <strong>EINVAL</strong>, <strong>EPERM</strong>, <strong>ENOMEM</strong>,
<strong>E2BIG</strong>, <strong>EEXIST</strong>, or <strong>ENOENT</strong>.</p>
<dl class="simple">
<dt><strong>E2BIG</strong></dt><dd><p>The number of elements in the map reached the
<em>max_entries</em> limit specified at map creation time.</p>
</dd>
<dt><strong>EEXIST</strong></dt><dd><p>If <em>flags</em> specifies <strong>BPF_NOEXIST</strong> and the element
with <em>key</em> already exists in the map.</p>
</dd>
<dt><strong>ENOENT</strong></dt><dd><p>If <em>flags</em> specifies <strong>BPF_EXIST</strong> and the element with
<em>key</em> does not exist in the map.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>BPF_MAP_DELETE_ELEM</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Look up and delete an element by key in a specified map.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_GET_NEXT_KEY</dt><dd><dl>
<dt>Description</dt><dd><p>Look up an element by key in a specified map and return the key
of the next element. Can be used to iterate over all elements
in the map.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
<p>The following cases can be used to iterate over all elements of
the map:</p>
<ul class="simple">
<li><p>If <em>key</em> is not found, the operation returns zero and sets
the <em>next_key</em> pointer to the key of the first element.</p></li>
<li><p>If <em>key</em> is found, the operation returns zero and sets the
<em>next_key</em> pointer to the key of the next element.</p></li>
<li><p>If <em>key</em> is the last element, returns -1 and <em>errno</em> is set
to <strong>ENOENT</strong>.</p></li>
</ul>
<p>May set <em>errno</em> to <strong>ENOMEM</strong>, <strong>EFAULT</strong>, <strong>EPERM</strong>, or
<strong>EINVAL</strong> on error.</p>
</dd>
</dl>
</dd>
<dt>BPF_PROG_LOAD</dt><dd><dl>
<dt>Description</dt><dd><p>Verify and load an eBPF program, returning a new file
descriptor associated with the program.</p>
<p>Applying <strong>close</strong>(2) to the file descriptor returned by
<strong>BPF_PROG_LOAD</strong> will unload the eBPF program (but see NOTES).</p>
<p>The close-on-exec file descriptor flag (see <strong>fcntl</strong>(2)) is
automatically enabled for the new file descriptor.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_OBJ_PIN</dt><dd><dl>
<dt>Description</dt><dd><p>Pin an eBPF program or map referred by the specified <em>bpf_fd</em>
to the provided <em>pathname</em> on the filesystem.</p>
<p>The <em>pathname</em> argument must not contain a dot (“.”).</p>
<p>On success, <em>pathname</em> retains a reference to the eBPF object,
preventing deallocation of the object when the original
<em>bpf_fd</em> is closed. This allow the eBPF object to live beyond
<strong>close</strong>(<em>bpf_fd</em>), and hence the lifetime of the parent
process.</p>
<p>Applying <strong>unlink</strong>(2) or similar calls to the <em>pathname</em>
unpins the object from the filesystem, removing the reference.
If no other file descriptors or filesystem nodes refer to the
same object, it will be deallocated (see NOTES).</p>
<p>The filesystem type for the parent directory of <em>pathname</em> must
be <strong>BPF_FS_MAGIC</strong>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_OBJ_GET</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Open a file descriptor for the eBPF object pinned to the
specified <em>pathname</em>.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_PROG_ATTACH</dt><dd><dl>
<dt>Description</dt><dd><p>Attach an eBPF program to a <em>target_fd</em> at the specified
<em>attach_type</em> hook.</p>
<p>The <em>attach_type</em> specifies the eBPF attachment point to
attach the program to, and must be one of <em>bpf_attach_type</em>
(see below).</p>
<p>The <em>attach_bpf_fd</em> must be a valid file descriptor for a
loaded eBPF program of a cgroup, flow dissector, LIRC, sockmap
or sock_ops type corresponding to the specified <em>attach_type</em>.</p>
<p>The <em>target_fd</em> must be a valid file descriptor for a kernel
object which depends on the attach type of <em>attach_bpf_fd</em>:</p>
<p><strong>BPF_PROG_TYPE_CGROUP_DEVICE</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SKB</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SOCK</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SOCK_ADDR</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SOCKOPT</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SYSCTL</strong>,
<strong>BPF_PROG_TYPE_SOCK_OPS</strong></p>
<blockquote>
<div><p>Control Group v2 hierarchy with the eBPF controller
enabled. Requires the kernel to be compiled with
<strong>CONFIG_CGROUP_BPF</strong>.</p>
</div></blockquote>
<p><strong>BPF_PROG_TYPE_FLOW_DISSECTOR</strong></p>
<blockquote>
<div><p>Network namespace (eg /proc/self/ns/net).</p>
</div></blockquote>
<p><strong>BPF_PROG_TYPE_LIRC_MODE2</strong></p>
<blockquote>
<div><p>LIRC device path (eg /dev/lircN). Requires the kernel
to be compiled with <strong>CONFIG_BPF_LIRC_MODE2</strong>.</p>
</div></blockquote>
<p><strong>BPF_PROG_TYPE_SK_SKB</strong>,
<strong>BPF_PROG_TYPE_SK_MSG</strong></p>
<blockquote>
<div><p>eBPF map of socket type (eg <strong>BPF_MAP_TYPE_SOCKHASH</strong>).</p>
</div></blockquote>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_PROG_DETACH</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Detach the eBPF program associated with the <em>target_fd</em> at the
hook specified by <em>attach_type</em>. The program must have been
previously attached using <strong>BPF_PROG_ATTACH</strong>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_PROG_TEST_RUN</dt><dd><dl>
<dt>Description</dt><dd><p>Run the eBPF program associated with the <em>prog_fd</em> a <em>repeat</em>
number of times against a provided program context <em>ctx_in</em> and
data <em>data_in</em>, and return the modified program context
<em>ctx_out</em>, <em>data_out</em> (for example, packet data), result of the
execution <em>retval</em>, and <em>duration</em> of the test run.</p>
<p>The sizes of the buffers provided as input and output
parameters <em>ctx_in</em>, <em>ctx_out</em>, <em>data_in</em>, and <em>data_out</em> must
be provided in the corresponding variables <em>ctx_size_in</em>,
<em>ctx_size_out</em>, <em>data_size_in</em>, and/or <em>data_size_out</em>. If any
of these parameters are not provided (ie set to NULL), the
corresponding size field must be zero.</p>
<p>Some program types have particular requirements:</p>
<dl class="simple">
<dt><strong>BPF_PROG_TYPE_SK_LOOKUP</strong></dt><dd><p><em>data_in</em> and <em>data_out</em> must be NULL.</p>
</dd>
</dl>
<p><strong>BPF_PROG_TYPE_RAW_TRACEPOINT</strong>,
<strong>BPF_PROG_TYPE_RAW_TRACEPOINT_WRITABLE</strong></p>
<blockquote>
<div><p><em>ctx_out</em>, <em>data_in</em> and <em>data_out</em> must be NULL.
<em>repeat</em> must be zero.</p>
</div></blockquote>
<p>BPF_PROG_RUN is an alias for BPF_PROG_TEST_RUN.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
<dl class="simple">
<dt><strong>ENOSPC</strong></dt><dd><p>Either <em>data_size_out</em> or <em>ctx_size_out</em> is too small.</p>
</dd>
<dt><strong>ENOTSUPP</strong></dt><dd><p>This command is not supported by the program type of
the program referred to by <em>prog_fd</em>.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>BPF_PROG_GET_NEXT_ID</dt><dd><dl>
<dt>Description</dt><dd><p>Fetch the next eBPF program currently loaded into the kernel.</p>
<p>Looks for the eBPF program with an id greater than <em>start_id</em>
and updates <em>next_id</em> on success. If no other eBPF programs
remain with ids higher than <em>start_id</em>, returns -1 and sets
<em>errno</em> to <strong>ENOENT</strong>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, or when no id remains, -1
is returned and <em>errno</em> is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_GET_NEXT_ID</dt><dd><dl>
<dt>Description</dt><dd><p>Fetch the next eBPF map currently loaded into the kernel.</p>
<p>Looks for the eBPF map with an id greater than <em>start_id</em>
and updates <em>next_id</em> on success. If no other eBPF maps
remain with ids higher than <em>start_id</em>, returns -1 and sets
<em>errno</em> to <strong>ENOENT</strong>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, or when no id remains, -1
is returned and <em>errno</em> is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_PROG_GET_FD_BY_ID</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Open a file descriptor for the eBPF program corresponding to
<em>prog_id</em>.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_GET_FD_BY_ID</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Open a file descriptor for the eBPF map corresponding to
<em>map_id</em>.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_OBJ_GET_INFO_BY_FD</dt><dd><dl>
<dt>Description</dt><dd><p>Obtain information about the eBPF object corresponding to
<em>bpf_fd</em>.</p>
<p>Populates up to <em>info_len</em> bytes of <em>info</em>, which will be in
one of the following formats depending on the eBPF object type
of <em>bpf_fd</em>:</p>
<ul class="simple">
<li><p><strong>struct bpf_prog_info</strong></p></li>
<li><p><strong>struct bpf_map_info</strong></p></li>
<li><p><strong>struct bpf_btf_info</strong></p></li>
<li><p><strong>struct bpf_link_info</strong></p></li>
</ul>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_PROG_QUERY</dt><dd><dl>
<dt>Description</dt><dd><p>Obtain information about eBPF programs associated with the
specified <em>attach_type</em> hook.</p>
<p>The <em>target_fd</em> must be a valid file descriptor for a kernel
object which depends on the attach type of <em>attach_bpf_fd</em>:</p>
<p><strong>BPF_PROG_TYPE_CGROUP_DEVICE</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SKB</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SOCK</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SOCK_ADDR</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SOCKOPT</strong>,
<strong>BPF_PROG_TYPE_CGROUP_SYSCTL</strong>,
<strong>BPF_PROG_TYPE_SOCK_OPS</strong></p>
<blockquote>
<div><p>Control Group v2 hierarchy with the eBPF controller
enabled. Requires the kernel to be compiled with
<strong>CONFIG_CGROUP_BPF</strong>.</p>
</div></blockquote>
<p><strong>BPF_PROG_TYPE_FLOW_DISSECTOR</strong></p>
<blockquote>
<div><p>Network namespace (eg /proc/self/ns/net).</p>
</div></blockquote>
<p><strong>BPF_PROG_TYPE_LIRC_MODE2</strong></p>
<blockquote>
<div><p>LIRC device path (eg /dev/lircN). Requires the kernel
to be compiled with <strong>CONFIG_BPF_LIRC_MODE2</strong>.</p>
</div></blockquote>
<p><strong>BPF_PROG_QUERY</strong> always fetches the number of programs
attached and the <em>attach_flags</em> which were used to attach those
programs. Additionally, if <em>prog_ids</em> is nonzero and the number
of attached programs is less than <em>prog_cnt</em>, populates
<em>prog_ids</em> with the eBPF program ids of the programs attached
at <em>target_fd</em>.</p>
<p>The following flags may alter the result:</p>
<dl class="simple">
<dt><strong>BPF_F_QUERY_EFFECTIVE</strong></dt><dd><p>Only return information regarding programs which are
currently effective at the specified <em>target_fd</em>.</p>
</dd>
</dl>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_RAW_TRACEPOINT_OPEN</dt><dd><dl>
<dt>Description</dt><dd><p>Attach an eBPF program to a tracepoint <em>name</em> to access kernel
internal arguments of the tracepoint in their raw form.</p>
<p>The <em>prog_fd</em> must be a valid file descriptor associated with
a loaded eBPF program of type <strong>BPF_PROG_TYPE_RAW_TRACEPOINT</strong>.</p>
<p>No ABI guarantees are made about the content of tracepoint
arguments exposed to the corresponding eBPF program.</p>
<p>Applying <strong>close</strong>(2) to the file descriptor returned by
<strong>BPF_RAW_TRACEPOINT_OPEN</strong> will delete the map (but see NOTES).</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_BTF_LOAD</dt><dd><dl>
<dt>Description</dt><dd><p>Verify and load BPF Type Format (BTF) metadata into the kernel,
returning a new file descriptor associated with the metadata.
BTF is described in more detail at
<a class="reference external" href="https://www.kernel.org/doc/html/latest/bpf/btf.html">https://www.kernel.org/doc/html/latest/bpf/btf.html</a>.</p>
<p>The <em>btf</em> parameter must point to valid memory providing
<em>btf_size</em> bytes of BTF binary metadata.</p>
<p>The returned file descriptor can be passed to other <strong>bpf</strong>()
subcommands such as <strong>BPF_PROG_LOAD</strong> or <strong>BPF_MAP_CREATE</strong> to
associate the BTF with those objects.</p>
<p>Similar to <strong>BPF_PROG_LOAD</strong>, <strong>BPF_BTF_LOAD</strong> has optional
parameters to specify a <em>btf_log_buf</em>, <em>btf_log_size</em> and
<em>btf_log_level</em> which allow the kernel to return freeform log
output regarding the BTF verification process.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_BTF_GET_FD_BY_ID</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Open a file descriptor for the BPF Type Format (BTF)
corresponding to <em>btf_id</em>.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_TASK_FD_QUERY</dt><dd><dl>
<dt>Description</dt><dd><p>Obtain information about eBPF programs associated with the
target process identified by <em>pid</em> and <em>fd</em>.</p>
<p>If the <em>pid</em> and <em>fd</em> are associated with a tracepoint, kprobe
or uprobe perf event, then the <em>prog_id</em> and <em>fd_type</em> will
be populated with the eBPF program id and file descriptor type
of type <strong>bpf_task_fd_type</strong>. If associated with a kprobe or
uprobe, the  <em>probe_offset</em> and <em>probe_addr</em> will also be
populated. Optionally, if <em>buf</em> is provided, then up to
<em>buf_len</em> bytes of <em>buf</em> will be populated with the name of
the tracepoint, kprobe or uprobe.</p>
<p>The resulting <em>prog_id</em> may be introspected in deeper detail
using <strong>BPF_PROG_GET_FD_BY_ID</strong> and <strong>BPF_OBJ_GET_INFO_BY_FD</strong>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_LOOKUP_AND_DELETE_ELEM</dt><dd><dl>
<dt>Description</dt><dd><p>Look up an element with the given <em>key</em> in the map referred to
by the file descriptor <em>fd</em>, and if found, delete the element.</p>
<p>For <strong>BPF_MAP_TYPE_QUEUE</strong> and <strong>BPF_MAP_TYPE_STACK</strong> map
types, the <em>flags</em> argument needs to be set to 0, but for other
map types, it may be specified as:</p>
<dl class="simple">
<dt><strong>BPF_F_LOCK</strong></dt><dd><p>Look up and delete the value of a spin-locked map
without returning the lock. This must be specified if
the elements contain a spinlock.</p>
</dd>
</dl>
<p>The <strong>BPF_MAP_TYPE_QUEUE</strong> and <strong>BPF_MAP_TYPE_STACK</strong> map types
implement this command as a “pop” operation, deleting the top
element rather than one corresponding to <em>key</em>.
The <em>key</em> and <em>key_len</em> parameters should be zeroed when
issuing this operation for these map types.</p>
<p>This command is only valid for the following map types:
* <strong>BPF_MAP_TYPE_QUEUE</strong>
* <strong>BPF_MAP_TYPE_STACK</strong>
* <strong>BPF_MAP_TYPE_HASH</strong>
* <strong>BPF_MAP_TYPE_PERCPU_HASH</strong>
* <strong>BPF_MAP_TYPE_LRU_HASH</strong>
* <strong>BPF_MAP_TYPE_LRU_PERCPU_HASH</strong></p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_FREEZE</dt><dd><dl>
<dt>Description</dt><dd><p>Freeze the permissions of the specified map.</p>
<p>Write permissions may be frozen by passing zero <em>flags</em>.
Upon success, no future syscall invocations may alter the
map state of <em>map_fd</em>. Write operations from eBPF programs
are still possible for a frozen map.</p>
<p>Not supported for maps of type <strong>BPF_MAP_TYPE_STRUCT_OPS</strong>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_BTF_GET_NEXT_ID</dt><dd><dl>
<dt>Description</dt><dd><p>Fetch the next BPF Type Format (BTF) object currently loaded
into the kernel.</p>
<p>Looks for the BTF object with an id greater than <em>start_id</em>
and updates <em>next_id</em> on success. If no other BTF objects
remain with ids higher than <em>start_id</em>, returns -1 and sets
<em>errno</em> to <strong>ENOENT</strong>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, or when no id remains, -1
is returned and <em>errno</em> is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_LOOKUP_BATCH</dt><dd><dl>
<dt>Description</dt><dd><p>Iterate and fetch multiple elements in a map.</p>
<p>Two opaque values are used to manage batch operations,
<em>in_batch</em> and <em>out_batch</em>. Initially, <em>in_batch</em> must be set
to NULL to begin the batched operation. After each subsequent
<strong>BPF_MAP_LOOKUP_BATCH</strong>, the caller should pass the resultant
<em>out_batch</em> as the <em>in_batch</em> for the next operation to
continue iteration from the current point.</p>
<p>The <em>keys</em> and <em>values</em> are output parameters which must point
to memory large enough to hold <em>count</em> items based on the key
and value size of the map <em>map_fd</em>. The <em>keys</em> buffer must be
of <em>key_size</em> * <em>count</em>. The <em>values</em> buffer must be of
<em>value_size</em> * <em>count</em>.</p>
<p>The <em>elem_flags</em> argument may be specified as one of the
following:</p>
<dl class="simple">
<dt><strong>BPF_F_LOCK</strong></dt><dd><p>Look up the value of a spin-locked map without
returning the lock. This must be specified if the
elements contain a spinlock.</p>
</dd>
</dl>
<p>On success, <em>count</em> elements from the map are copied into the
user buffer, with the keys copied into <em>keys</em> and the values
copied into the corresponding indices in <em>values</em>.</p>
<p>If an error is returned and <em>errno</em> is not <strong>EFAULT</strong>, <em>count</em>
is set to the number of successfully processed elements.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
<p>May set <em>errno</em> to <strong>ENOSPC</strong> to indicate that <em>keys</em> or
<em>values</em> is too small to dump an entire bucket during
iteration of a hash-based map type.</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_LOOKUP_AND_DELETE_BATCH</dt><dd><dl>
<dt>Description</dt><dd><p>Iterate and delete all elements in a map.</p>
<p>This operation has the same behavior as
<strong>BPF_MAP_LOOKUP_BATCH</strong> with two exceptions:</p>
<ul class="simple">
<li><p>Every element that is successfully returned is also deleted
from the map. This is at least <em>count</em> elements. Note that
<em>count</em> is both an input and an output parameter.</p></li>
<li><p>Upon returning with <em>errno</em> set to <strong>EFAULT</strong>, up to
<em>count</em> elements may be deleted without returning the keys
and values of the deleted elements.</p></li>
</ul>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_MAP_UPDATE_BATCH</dt><dd><dl>
<dt>Description</dt><dd><p>Update multiple elements in a map by <em>key</em>.</p>
<p>The <em>keys</em> and <em>values</em> are input parameters which must point
to memory large enough to hold <em>count</em> items based on the key
and value size of the map <em>map_fd</em>. The <em>keys</em> buffer must be
of <em>key_size</em> * <em>count</em>. The <em>values</em> buffer must be of
<em>value_size</em> * <em>count</em>.</p>
<p>Each element specified in <em>keys</em> is sequentially updated to the
value in the corresponding index in <em>values</em>. The <em>in_batch</em>
and <em>out_batch</em> parameters are ignored and should be zeroed.</p>
<p>The <em>elem_flags</em> argument should be specified as one of the
following:</p>
<dl class="simple">
<dt><strong>BPF_ANY</strong></dt><dd><p>Create new elements or update a existing elements.</p>
</dd>
<dt><strong>BPF_NOEXIST</strong></dt><dd><p>Create new elements only if they do not exist.</p>
</dd>
<dt><strong>BPF_EXIST</strong></dt><dd><p>Update existing elements.</p>
</dd>
<dt><strong>BPF_F_LOCK</strong></dt><dd><p>Update spin_lock-ed map elements. This must be
specified if the map value contains a spinlock.</p>
</dd>
</dl>
<p>On success, <em>count</em> elements from the map are updated.</p>
<p>If an error is returned and <em>errno</em> is not <strong>EFAULT</strong>, <em>count</em>
is set to the number of successfully processed elements.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
<p>May set <em>errno</em> to <strong>EINVAL</strong>, <strong>EPERM</strong>, <strong>ENOMEM</strong>, or
<strong>E2BIG</strong>. <strong>E2BIG</strong> indicates that the number of elements in
the map reached the <em>max_entries</em> limit specified at map
creation time.</p>
<p>May set <em>errno</em> to one of the following error codes under
specific circumstances:</p>
<dl class="simple">
<dt><strong>EEXIST</strong></dt><dd><p>If <em>flags</em> specifies <strong>BPF_NOEXIST</strong> and the element
with <em>key</em> already exists in the map.</p>
</dd>
<dt><strong>ENOENT</strong></dt><dd><p>If <em>flags</em> specifies <strong>BPF_EXIST</strong> and the element with
<em>key</em> does not exist in the map.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>BPF_MAP_DELETE_BATCH</dt><dd><dl>
<dt>Description</dt><dd><p>Delete multiple elements in a map by <em>key</em>.</p>
<p>The <em>keys</em> parameter is an input parameter which must point
to memory large enough to hold <em>count</em> items based on the key
size of the map <em>map_fd</em>, that is, <em>key_size</em> * <em>count</em>.</p>
<p>Each element specified in <em>keys</em> is sequentially deleted. The
<em>in_batch</em>, <em>out_batch</em>, and <em>values</em> parameters are ignored
and should be zeroed.</p>
<p>The <em>elem_flags</em> argument may be specified as one of the
following:</p>
<dl class="simple">
<dt><strong>BPF_F_LOCK</strong></dt><dd><p>Look up the value of a spin-locked map without
returning the lock. This must be specified if the
elements contain a spinlock.</p>
</dd>
</dl>
<p>On success, <em>count</em> elements from the map are updated.</p>
<p>If an error is returned and <em>errno</em> is not <strong>EFAULT</strong>, <em>count</em>
is set to the number of successfully processed elements. If
<em>errno</em> is <strong>EFAULT</strong>, up to <em>count</em> elements may be been
deleted.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_LINK_CREATE</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Attach an eBPF program to a <em>target_fd</em> at the specified
<em>attach_type</em> hook and return a file descriptor handle for
managing the link.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_LINK_UPDATE</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Update the eBPF program in the specified <em>link_fd</em> to
<em>new_prog_fd</em>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_LINK_GET_FD_BY_ID</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Open a file descriptor for the eBPF Link corresponding to
<em>link_id</em>.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_LINK_GET_NEXT_ID</dt><dd><dl>
<dt>Description</dt><dd><p>Fetch the next eBPF link currently loaded into the kernel.</p>
<p>Looks for the eBPF link with an id greater than <em>start_id</em>
and updates <em>next_id</em> on success. If no other eBPF links
remain with ids higher than <em>start_id</em>, returns -1 and sets
<em>errno</em> to <strong>ENOENT</strong>.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, or when no id remains, -1
is returned and <em>errno</em> is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_ENABLE_STATS</dt><dd><dl>
<dt>Description</dt><dd><p>Enable eBPF runtime statistics gathering.</p>
<p>Runtime statistics gathering for the eBPF runtime is disabled
by default to minimize the corresponding performance overhead.
This command enables statistics globally.</p>
<p>Multiple programs may independently enable statistics.
After gathering the desired statistics, eBPF runtime statistics
may be disabled again by calling <strong>close</strong>(2) for the file
descriptor returned by this function. Statistics will only be
disabled system-wide when all outstanding file descriptors
returned by prior calls for this subcommand are closed.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_ITER_CREATE</dt><dd><dl>
<dt>Description</dt><dd><p>Create an iterator on top of the specified <em>link_fd</em> (as
previously created using <strong>BPF_LINK_CREATE</strong>) and return a
file descriptor that can be used to trigger the iteration.</p>
<p>If the resulting file descriptor is pinned to the filesystem
using  <strong>BPF_OBJ_PIN</strong>, then subsequent <strong>read</strong>(2) syscalls
for that path will trigger the iterator to read kernel state
using the eBPF program attached to <em>link_fd</em>.</p>
</dd>
<dt>Return</dt><dd><p>A new file descriptor (a nonnegative integer), or -1 if an
error occurred (in which case, <em>errno</em> is set appropriately).</p>
</dd>
</dl>
</dd>
<dt>BPF_LINK_DETACH</dt><dd><dl class="simple">
<dt>Description</dt><dd><p>Forcefully detach the specified <em>link_fd</em> from its
corresponding attachment point.</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>BPF_PROG_BIND_MAP</dt><dd><dl>
<dt>Description</dt><dd><p>Bind a map to the lifetime of an eBPF program.</p>
<p>The map identified by <em>map_fd</em> is bound to the program
identified by <em>prog_fd</em> and only released when <em>prog_fd</em> is
released. This may be used in cases where metadata should be
associated with a program which otherwise does not contain any
references to the map (for example, embedded in the eBPF
program instructions).</p>
</dd>
<dt>Return</dt><dd><p>Returns zero on success. On error, -1 is returned and <em>errno</em>
is set appropriately.</p>
</dd>
</dl>
</dd>
<dt>NOTES</dt><dd><p>eBPF objects (maps and programs) can be shared between processes.</p>
<ul class="simple">
<li><p>After <strong>fork</strong>(2), the child inherits file descriptors
referring to the same eBPF objects.</p></li>
<li><p>File descriptors referring to eBPF objects can be transferred over
<strong>unix</strong>(7) domain sockets.</p></li>
<li><p>File descriptors referring to eBPF objects can be duplicated in the
usual way, using <strong>dup</strong>(2) and similar calls.</p></li>
<li><p>File descriptors referring to eBPF objects can be pinned to the
filesystem using the <strong>BPF_OBJ_PIN</strong> command of <strong>bpf</strong>(2).</p></li>
</ul>
<p>An eBPF object is deallocated only after all file descriptors referring
to the object have been closed and no references remain pinned to the
filesystem or attached (for example, bound to a program or device).</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">The Linux Kernel</a></h1>



<p class="blurb">6.2.0-rc4-6.2.0-rc4+</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">eBPF Syscall</a><ul>
<li><a class="reference internal" href="#bpf-subcommand-reference">bpf() subcommand reference</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/userspace-api/ebpf/syscall.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The kernel development community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/userspace-api/ebpf/syscall.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>